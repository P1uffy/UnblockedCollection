/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var e,t,n={8916:(e,t,n)=>{"use strict";n.d(t,{A:()=>p});var r=n(1601),i=n.n(r),s=n(6314),o=n.n(s),a=n(4417),l=n.n(a),u=new URL(n(1316),n.b),c=new URL(n(2797),n.b),h=o()(i()),d=l()(u),f=l()(c);h.push([e.id,`/*\n! tailwindcss v3.4.1 | MIT License | https://tailwindcss.com\n*//*\n1. Prevent padding and border from affecting element width. (https://github.com/mozdevs/cssremedy/issues/4)\n2. Allow adding a border to an element by just adding a border-width. (https://github.com/tailwindcss/tailwindcss/pull/116)\n*/\n\n*,\n::before,\n::after {\n  box-sizing: border-box; /* 1 */\n  border-width: 0; /* 2 */\n  border-style: solid; /* 2 */\n  border-color: #e5e7eb; /* 2 */\n}\n\n::before,\n::after {\n  --tw-content: '';\n}\n\n/*\n1. Use a consistent sensible line-height in all browsers.\n2. Prevent adjustments of font size after orientation changes in iOS.\n3. Use a more readable tab size.\n4. Use the user's configured \`sans\` font-family by default.\n5. Use the user's configured \`sans\` font-feature-settings by default.\n6. Use the user's configured \`sans\` font-variation-settings by default.\n7. Disable tap highlights on iOS\n*/\n\nhtml,\n:host {\n  line-height: 1.5; /* 1 */\n  -webkit-text-size-adjust: 100%; /* 2 */\n  -moz-tab-size: 4; /* 3 */\n  -o-tab-size: 4;\n     tab-size: 4; /* 3 */\n  font-family: Play, sans-serif; /* 4 */\n  font-feature-settings: normal; /* 5 */\n  font-variation-settings: normal; /* 6 */\n  -webkit-tap-highlight-color: transparent; /* 7 */\n}\n\n/*\n1. Remove the margin in all browsers.\n2. Inherit line-height from \`html\` so users can set them as a class directly on the \`html\` element.\n*/\n\nbody {\n  margin: 0; /* 1 */\n  line-height: inherit; /* 2 */\n}\n\n/*\n1. Add the correct height in Firefox.\n2. Correct the inheritance of border color in Firefox. (https://bugzilla.mozilla.org/show_bug.cgi?id=190655)\n3. Ensure horizontal rules are visible by default.\n*/\n\nhr {\n  height: 0; /* 1 */\n  color: inherit; /* 2 */\n  border-top-width: 1px; /* 3 */\n}\n\n/*\nAdd the correct text decoration in Chrome, Edge, and Safari.\n*/\n\nabbr:where([title]) {\n  -webkit-text-decoration: underline dotted;\n          text-decoration: underline dotted;\n}\n\n/*\nRemove the default font size and weight for headings.\n*/\n\nh1,\nh2,\nh3,\nh4,\nh5,\nh6 {\n  font-size: inherit;\n  font-weight: inherit;\n}\n\n/*\nReset links to optimize for opt-in styling instead of opt-out.\n*/\n\na {\n  color: inherit;\n  text-decoration: inherit;\n}\n\n/*\nAdd the correct font weight in Edge and Safari.\n*/\n\nb,\nstrong {\n  font-weight: bolder;\n}\n\n/*\n1. Use the user's configured \`mono\` font-family by default.\n2. Use the user's configured \`mono\` font-feature-settings by default.\n3. Use the user's configured \`mono\` font-variation-settings by default.\n4. Correct the odd \`em\` font sizing in all browsers.\n*/\n\ncode,\nkbd,\nsamp,\npre {\n  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; /* 1 */\n  font-feature-settings: normal; /* 2 */\n  font-variation-settings: normal; /* 3 */\n  font-size: 1em; /* 4 */\n}\n\n/*\nAdd the correct font size in all browsers.\n*/\n\nsmall {\n  font-size: 80%;\n}\n\n/*\nPrevent \`sub\` and \`sup\` elements from affecting the line height in all browsers.\n*/\n\nsub,\nsup {\n  font-size: 75%;\n  line-height: 0;\n  position: relative;\n  vertical-align: baseline;\n}\n\nsub {\n  bottom: -0.25em;\n}\n\nsup {\n  top: -0.5em;\n}\n\n/*\n1. Remove text indentation from table contents in Chrome and Safari. (https://bugs.chromium.org/p/chromium/issues/detail?id=999088, https://bugs.webkit.org/show_bug.cgi?id=201297)\n2. Correct table border color inheritance in all Chrome and Safari. (https://bugs.chromium.org/p/chromium/issues/detail?id=935729, https://bugs.webkit.org/show_bug.cgi?id=195016)\n3. Remove gaps between table borders by default.\n*/\n\ntable {\n  text-indent: 0; /* 1 */\n  border-color: inherit; /* 2 */\n  border-collapse: collapse; /* 3 */\n}\n\n/*\n1. Change the font styles in all browsers.\n2. Remove the margin in Firefox and Safari.\n3. Remove default padding in all browsers.\n*/\n\nbutton,\ninput,\noptgroup,\nselect,\ntextarea {\n  font-family: inherit; /* 1 */\n  font-feature-settings: inherit; /* 1 */\n  font-variation-settings: inherit; /* 1 */\n  font-size: 100%; /* 1 */\n  font-weight: inherit; /* 1 */\n  line-height: inherit; /* 1 */\n  color: inherit; /* 1 */\n  margin: 0; /* 2 */\n  padding: 0; /* 3 */\n}\n\n/*\nRemove the inheritance of text transform in Edge and Firefox.\n*/\n\nbutton,\nselect {\n  text-transform: none;\n}\n\n/*\n1. Correct the inability to style clickable types in iOS and Safari.\n2. Remove default button styles.\n*/\n\nbutton,\n[type='button'],\n[type='reset'],\n[type='submit'] {\n  -webkit-appearance: button; /* 1 */\n  background-color: transparent; /* 2 */\n  background-image: none; /* 2 */\n}\n\n/*\nUse the modern Firefox focus style for all focusable elements.\n*/\n\n:-moz-focusring {\n  outline: auto;\n}\n\n/*\nRemove the additional \`:invalid\` styles in Firefox. (https://github.com/mozilla/gecko-dev/blob/2f9eacd9d3d995c937b4251a5557d95d494c9be1/layout/style/res/forms.css#L728-L737)\n*/\n\n:-moz-ui-invalid {\n  box-shadow: none;\n}\n\n/*\nAdd the correct vertical alignment in Chrome and Firefox.\n*/\n\nprogress {\n  vertical-align: baseline;\n}\n\n/*\nCorrect the cursor style of increment and decrement buttons in Safari.\n*/\n\n::-webkit-inner-spin-button,\n::-webkit-outer-spin-button {\n  height: auto;\n}\n\n/*\n1. Correct the odd appearance in Chrome and Safari.\n2. Correct the outline style in Safari.\n*/\n\n[type='search'] {\n  -webkit-appearance: textfield; /* 1 */\n  outline-offset: -2px; /* 2 */\n}\n\n/*\nRemove the inner padding in Chrome and Safari on macOS.\n*/\n\n::-webkit-search-decoration {\n  -webkit-appearance: none;\n}\n\n/*\n1. Correct the inability to style clickable types in iOS and Safari.\n2. Change font properties to \`inherit\` in Safari.\n*/\n\n::-webkit-file-upload-button {\n  -webkit-appearance: button; /* 1 */\n  font: inherit; /* 2 */\n}\n\n/*\nAdd the correct display in Chrome and Safari.\n*/\n\nsummary {\n  display: list-item;\n}\n\n/*\nRemoves the default spacing and border for appropriate elements.\n*/\n\nblockquote,\ndl,\ndd,\nh1,\nh2,\nh3,\nh4,\nh5,\nh6,\nhr,\nfigure,\np,\npre {\n  margin: 0;\n}\n\nfieldset {\n  margin: 0;\n  padding: 0;\n}\n\nlegend {\n  padding: 0;\n}\n\nol,\nul,\nmenu {\n  list-style: none;\n  margin: 0;\n  padding: 0;\n}\n\n/*\nReset default styling for dialogs.\n*/\ndialog {\n  padding: 0;\n}\n\n/*\nPrevent resizing textareas horizontally by default.\n*/\n\ntextarea {\n  resize: vertical;\n}\n\n/*\n1. Reset the default placeholder opacity in Firefox. (https://github.com/tailwindlabs/tailwindcss/issues/3300)\n2. Set the default placeholder color to the user's configured gray 400 color.\n*/\n\ninput::-moz-placeholder, textarea::-moz-placeholder {\n  opacity: 1; /* 1 */\n  color: #9ca3af; /* 2 */\n}\n\ninput::placeholder,\ntextarea::placeholder {\n  opacity: 1; /* 1 */\n  color: #9ca3af; /* 2 */\n}\n\n/*\nSet the default cursor for buttons.\n*/\n\nbutton,\n[role="button"] {\n  cursor: pointer;\n}\n\n/*\nMake sure disabled buttons don't get the pointer cursor.\n*/\n:disabled {\n  cursor: default;\n}\n\n/*\n1. Make replaced elements \`display: block\` by default. (https://github.com/mozdevs/cssremedy/issues/14)\n2. Add \`vertical-align: middle\` to align replaced elements more sensibly by default. (https://github.com/jensimmons/cssremedy/issues/14#issuecomment-634934210)\n   This can trigger a poorly considered lint error in some tools but is included by design.\n*/\n\nimg,\nsvg,\nvideo,\ncanvas,\naudio,\niframe,\nembed,\nobject {\n  display: block; /* 1 */\n  vertical-align: middle; /* 2 */\n}\n\n/*\nConstrain images and videos to the parent width and preserve their intrinsic aspect ratio. (https://github.com/mozdevs/cssremedy/issues/14)\n*/\n\nimg,\nvideo {\n  max-width: 100%;\n  height: auto;\n}\n\n/* Make elements with the HTML hidden attribute stay hidden by default */\n[hidden] {\n  display: none;\n}\n\n*, ::before, ::after {\n  --tw-border-spacing-x: 0;\n  --tw-border-spacing-y: 0;\n  --tw-translate-x: 0;\n  --tw-translate-y: 0;\n  --tw-rotate: 0;\n  --tw-skew-x: 0;\n  --tw-skew-y: 0;\n  --tw-scale-x: 1;\n  --tw-scale-y: 1;\n  --tw-pan-x:  ;\n  --tw-pan-y:  ;\n  --tw-pinch-zoom:  ;\n  --tw-scroll-snap-strictness: proximity;\n  --tw-gradient-from-position:  ;\n  --tw-gradient-via-position:  ;\n  --tw-gradient-to-position:  ;\n  --tw-ordinal:  ;\n  --tw-slashed-zero:  ;\n  --tw-numeric-figure:  ;\n  --tw-numeric-spacing:  ;\n  --tw-numeric-fraction:  ;\n  --tw-ring-inset:  ;\n  --tw-ring-offset-width: 0px;\n  --tw-ring-offset-color: #fff;\n  --tw-ring-color: rgb(59 130 246 / 0.5);\n  --tw-ring-offset-shadow: 0 0 #0000;\n  --tw-ring-shadow: 0 0 #0000;\n  --tw-shadow: 0 0 #0000;\n  --tw-shadow-colored: 0 0 #0000;\n  --tw-blur:  ;\n  --tw-brightness:  ;\n  --tw-contrast:  ;\n  --tw-grayscale:  ;\n  --tw-hue-rotate:  ;\n  --tw-invert:  ;\n  --tw-saturate:  ;\n  --tw-sepia:  ;\n  --tw-drop-shadow:  ;\n  --tw-backdrop-blur:  ;\n  --tw-backdrop-brightness:  ;\n  --tw-backdrop-contrast:  ;\n  --tw-backdrop-grayscale:  ;\n  --tw-backdrop-hue-rotate:  ;\n  --tw-backdrop-invert:  ;\n  --tw-backdrop-opacity:  ;\n  --tw-backdrop-saturate:  ;\n  --tw-backdrop-sepia:  ;\n}\n\n::backdrop {\n  --tw-border-spacing-x: 0;\n  --tw-border-spacing-y: 0;\n  --tw-translate-x: 0;\n  --tw-translate-y: 0;\n  --tw-rotate: 0;\n  --tw-skew-x: 0;\n  --tw-skew-y: 0;\n  --tw-scale-x: 1;\n  --tw-scale-y: 1;\n  --tw-pan-x:  ;\n  --tw-pan-y:  ;\n  --tw-pinch-zoom:  ;\n  --tw-scroll-snap-strictness: proximity;\n  --tw-gradient-from-position:  ;\n  --tw-gradient-via-position:  ;\n  --tw-gradient-to-position:  ;\n  --tw-ordinal:  ;\n  --tw-slashed-zero:  ;\n  --tw-numeric-figure:  ;\n  --tw-numeric-spacing:  ;\n  --tw-numeric-fraction:  ;\n  --tw-ring-inset:  ;\n  --tw-ring-offset-width: 0px;\n  --tw-ring-offset-color: #fff;\n  --tw-ring-color: rgb(59 130 246 / 0.5);\n  --tw-ring-offset-shadow: 0 0 #0000;\n  --tw-ring-shadow: 0 0 #0000;\n  --tw-shadow: 0 0 #0000;\n  --tw-shadow-colored: 0 0 #0000;\n  --tw-blur:  ;\n  --tw-brightness:  ;\n  --tw-contrast:  ;\n  --tw-grayscale:  ;\n  --tw-hue-rotate:  ;\n  --tw-invert:  ;\n  --tw-saturate:  ;\n  --tw-sepia:  ;\n  --tw-drop-shadow:  ;\n  --tw-backdrop-blur:  ;\n  --tw-backdrop-brightness:  ;\n  --tw-backdrop-contrast:  ;\n  --tw-backdrop-grayscale:  ;\n  --tw-backdrop-hue-rotate:  ;\n  --tw-backdrop-invert:  ;\n  --tw-backdrop-opacity:  ;\n  --tw-backdrop-saturate:  ;\n  --tw-backdrop-sepia:  ;\n}\n.sr-only {\n  position: absolute;\n  width: 1px;\n  height: 1px;\n  padding: 0;\n  margin: -1px;\n  overflow: hidden;\n  clip: rect(0, 0, 0, 0);\n  white-space: nowrap;\n  border-width: 0;\n}\n.pointer-events-none {\n  pointer-events: none;\n}\n.pointer-events-auto {\n  pointer-events: auto;\n}\n.visible {\n  visibility: visible;\n}\n.fixed {\n  position: fixed;\n}\n.absolute {\n  position: absolute;\n}\n.relative {\n  position: relative;\n}\n.inset-0 {\n  inset: 0px;\n}\n.-top-16 {\n  top: -4rem;\n}\n.bottom-0 {\n  bottom: 0px;\n}\n.bottom-0\\.5 {\n  bottom: 0.125rem;\n}\n.bottom-2 {\n  bottom: 0.5rem;\n}\n.bottom-4 {\n  bottom: 1rem;\n}\n.left-0 {\n  left: 0px;\n}\n.left-0\\.5 {\n  left: 0.125rem;\n}\n.left-1\\/2 {\n  left: 50%;\n}\n.left-2 {\n  left: 0.5rem;\n}\n.left-4 {\n  left: 1rem;\n}\n.right-0 {\n  right: 0px;\n}\n.right-2 {\n  right: 0.5rem;\n}\n.right-4 {\n  right: 1rem;\n}\n.top-0 {\n  top: 0px;\n}\n.top-1\\/2 {\n  top: 50%;\n}\n.top-2 {\n  top: 0.5rem;\n}\n.top-20 {\n  top: 5rem;\n}\n.top-4 {\n  top: 1rem;\n}\n.z-50 {\n  z-index: 50;\n}\n.m-0 {\n  margin: 0px;\n}\n.m-0\\.5 {\n  margin: 0.125rem;\n}\n.m-1 {\n  margin: 0.25rem;\n}\n.m-2 {\n  margin: 0.5rem;\n}\n.mx-4 {\n  margin-left: 1rem;\n  margin-right: 1rem;\n}\n.mx-auto {\n  margin-left: auto;\n  margin-right: auto;\n}\n.mb-1 {\n  margin-bottom: 0.25rem;\n}\n.mb-1\\.5 {\n  margin-bottom: 0.375rem;\n}\n.mb-2 {\n  margin-bottom: 0.5rem;\n}\n.mb-3 {\n  margin-bottom: 0.75rem;\n}\n.mb-4 {\n  margin-bottom: 1rem;\n}\n.mb-6 {\n  margin-bottom: 1.5rem;\n}\n.ml-1 {\n  margin-left: 0.25rem;\n}\n.ml-4 {\n  margin-left: 1rem;\n}\n.ml-6 {\n  margin-left: 1.5rem;\n}\n.mr-1 {\n  margin-right: 0.25rem;\n}\n.mr-2 {\n  margin-right: 0.5rem;\n}\n.mt-1 {\n  margin-top: 0.25rem;\n}\n.mt-1\\.5 {\n  margin-top: 0.375rem;\n}\n.mt-2 {\n  margin-top: 0.5rem;\n}\n.mt-4 {\n  margin-top: 1rem;\n}\n.mt-40 {\n  margin-top: 10rem;\n}\n.mt-8 {\n  margin-top: 2rem;\n}\n.block {\n  display: block;\n}\n.inline-block {\n  display: inline-block;\n}\n.flex {\n  display: flex;\n}\n.grid {\n  display: grid;\n}\n.hidden {\n  display: none;\n}\n.h-1 {\n  height: 0.25rem;\n}\n.h-1\\.5 {\n  height: 0.375rem;\n}\n.h-1\\/2 {\n  height: 50%;\n}\n.h-10 {\n  height: 2.5rem;\n}\n.h-16 {\n  height: 4rem;\n}\n.h-2 {\n  height: 0.5rem;\n}\n.h-3 {\n  height: 0.75rem;\n}\n.h-4 {\n  height: 1rem;\n}\n.h-48 {\n  height: 12rem;\n}\n.h-6 {\n  height: 1.5rem;\n}\n.h-8 {\n  height: 2rem;\n}\n.h-fit {\n  height: -moz-fit-content;\n  height: fit-content;\n}\n.h-full {\n  height: 100%;\n}\n.h-px {\n  height: 1px;\n}\n.max-h-\\[40vh\\] {\n  max-height: 40vh;\n}\n.max-h-\\[60vh\\] {\n  max-height: 60vh;\n}\n.max-h-\\[80vh\\] {\n  max-height: 80vh;\n}\n.w-1 {\n  width: 0.25rem;\n}\n.w-1\\.5 {\n  width: 0.375rem;\n}\n.w-1\\/2 {\n  width: 50%;\n}\n.w-10 {\n  width: 2.5rem;\n}\n.w-12 {\n  width: 3rem;\n}\n.w-16 {\n  width: 4rem;\n}\n.w-2 {\n  width: 0.5rem;\n}\n.w-24 {\n  width: 6rem;\n}\n.w-28 {\n  width: 7rem;\n}\n.w-3 {\n  width: 0.75rem;\n}\n.w-4 {\n  width: 1rem;\n}\n.w-48 {\n  width: 12rem;\n}\n.w-52 {\n  width: 13rem;\n}\n.w-6 {\n  width: 1.5rem;\n}\n.w-64 {\n  width: 16rem;\n}\n.w-72 {\n  width: 18rem;\n}\n.w-8 {\n  width: 2rem;\n}\n.w-96 {\n  width: 24rem;\n}\n.w-\\[200px\\] {\n  width: 200px;\n}\n.w-full {\n  width: 100%;\n}\n.w-px {\n  width: 1px;\n}\n.max-w-md {\n  max-width: 28rem;\n}\n.flex-1 {\n  flex: 1 1 0%;\n}\n.flex-shrink-0 {\n  flex-shrink: 0;\n}\n.flex-grow {\n  flex-grow: 1;\n}\n.-translate-x-1\\/2 {\n  --tw-translate-x: -50%;\n  transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));\n}\n.-translate-y-1\\/2 {\n  --tw-translate-y: -50%;\n  transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));\n}\n.skew-x-0 {\n  --tw-skew-x: 0deg;\n  transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));\n}\n.transform {\n  transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));\n}\n@keyframes bounce {\n\n  0%, 100% {\n    transform: translateY(-25%);\n    animation-timing-function: cubic-bezier(0.8,0,1,1);\n  }\n\n  50% {\n    transform: none;\n    animation-timing-function: cubic-bezier(0,0,0.2,1);\n  }\n}\n.animate-bounce {\n  animation: bounce 1s infinite;\n}\n@keyframes pulse {\n\n  50% {\n    opacity: .5;\n  }\n}\n.animate-pulse {\n  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n}\n.cursor-not-allowed {\n  cursor: not-allowed;\n}\n.cursor-pointer {\n  cursor: pointer;\n}\n.appearance-none {\n  -webkit-appearance: none;\n     -moz-appearance: none;\n          appearance: none;\n}\n.grid-cols-2 {\n  grid-template-columns: repeat(2, minmax(0, 1fr));\n}\n.grid-cols-5 {\n  grid-template-columns: repeat(5, minmax(0, 1fr));\n}\n.flex-col {\n  flex-direction: column;\n}\n.items-start {\n  align-items: flex-start;\n}\n.items-center {\n  align-items: center;\n}\n.justify-end {\n  justify-content: flex-end;\n}\n.justify-center {\n  justify-content: center;\n}\n.justify-between {\n  justify-content: space-between;\n}\n.gap-1 {\n  gap: 0.25rem;\n}\n.gap-2 {\n  gap: 0.5rem;\n}\n.gap-4 {\n  gap: 1rem;\n}\n.gap-8 {\n  gap: 2rem;\n}\n.space-x-2 > :not([hidden]) ~ :not([hidden]) {\n  --tw-space-x-reverse: 0;\n  margin-right: calc(0.5rem * var(--tw-space-x-reverse));\n  margin-left: calc(0.5rem * calc(1 - var(--tw-space-x-reverse)));\n}\n.space-x-3 > :not([hidden]) ~ :not([hidden]) {\n  --tw-space-x-reverse: 0;\n  margin-right: calc(0.75rem * var(--tw-space-x-reverse));\n  margin-left: calc(0.75rem * calc(1 - var(--tw-space-x-reverse)));\n}\n.space-x-4 > :not([hidden]) ~ :not([hidden]) {\n  --tw-space-x-reverse: 0;\n  margin-right: calc(1rem * var(--tw-space-x-reverse));\n  margin-left: calc(1rem * calc(1 - var(--tw-space-x-reverse)));\n}\n.space-x-8 > :not([hidden]) ~ :not([hidden]) {\n  --tw-space-x-reverse: 0;\n  margin-right: calc(2rem * var(--tw-space-x-reverse));\n  margin-left: calc(2rem * calc(1 - var(--tw-space-x-reverse)));\n}\n.space-y-1 > :not([hidden]) ~ :not([hidden]) {\n  --tw-space-y-reverse: 0;\n  margin-top: calc(0.25rem * calc(1 - var(--tw-space-y-reverse)));\n  margin-bottom: calc(0.25rem * var(--tw-space-y-reverse));\n}\n.space-y-1\\.5 > :not([hidden]) ~ :not([hidden]) {\n  --tw-space-y-reverse: 0;\n  margin-top: calc(0.375rem * calc(1 - var(--tw-space-y-reverse)));\n  margin-bottom: calc(0.375rem * var(--tw-space-y-reverse));\n}\n.space-y-3 > :not([hidden]) ~ :not([hidden]) {\n  --tw-space-y-reverse: 0;\n  margin-top: calc(0.75rem * calc(1 - var(--tw-space-y-reverse)));\n  margin-bottom: calc(0.75rem * var(--tw-space-y-reverse));\n}\n.space-y-4 > :not([hidden]) ~ :not([hidden]) {\n  --tw-space-y-reverse: 0;\n  margin-top: calc(1rem * calc(1 - var(--tw-space-y-reverse)));\n  margin-bottom: calc(1rem * var(--tw-space-y-reverse));\n}\n.space-y-6 > :not([hidden]) ~ :not([hidden]) {\n  --tw-space-y-reverse: 0;\n  margin-top: calc(1.5rem * calc(1 - var(--tw-space-y-reverse)));\n  margin-bottom: calc(1.5rem * var(--tw-space-y-reverse));\n}\n.overflow-auto {\n  overflow: auto;\n}\n.overflow-hidden {\n  overflow: hidden;\n}\n.overflow-y-auto {\n  overflow-y: auto;\n}\n.whitespace-nowrap {\n  white-space: nowrap;\n}\n.rounded {\n  border-radius: 0.25rem;\n}\n.rounded-full {\n  border-radius: 9999px;\n}\n.rounded-lg {\n  border-radius: 0.5rem;\n}\n.rounded-md {\n  border-radius: 0.375rem;\n}\n.rounded-xl {\n  border-radius: 0.75rem;\n}\n.rounded-bl-lg {\n  border-bottom-left-radius: 0.5rem;\n}\n.rounded-bl-md {\n  border-bottom-left-radius: 0.375rem;\n}\n.rounded-br {\n  border-bottom-right-radius: 0.25rem;\n}\n.rounded-tr-lg {\n  border-top-right-radius: 0.5rem;\n}\n.rounded-tr-md {\n  border-top-right-radius: 0.375rem;\n}\n.border {\n  border-width: 1px;\n}\n.border-2 {\n  border-width: 2px;\n}\n.border-b {\n  border-bottom-width: 1px;\n}\n.border-b-2 {\n  border-bottom-width: 2px;\n}\n.border-t {\n  border-top-width: 1px;\n}\n.border-solid {\n  border-style: solid;\n}\n.border-\\[\\#ffe700\\] {\n  --tw-border-opacity: 1;\n  border-color: rgb(255 231 0 / var(--tw-border-opacity));\n}\n.border-black {\n  --tw-border-opacity: 1;\n  border-color: rgb(0 0 0 / var(--tw-border-opacity));\n}\n.border-fuchsia-400 {\n  --tw-border-opacity: 1;\n  border-color: rgb(232 121 249 / var(--tw-border-opacity));\n}\n.border-gray-300 {\n  --tw-border-opacity: 1;\n  border-color: rgb(209 213 219 / var(--tw-border-opacity));\n}\n.border-gray-700 {\n  --tw-border-opacity: 1;\n  border-color: rgb(55 65 81 / var(--tw-border-opacity));\n}\n.border-green-400 {\n  --tw-border-opacity: 1;\n  border-color: rgb(74 222 128 / var(--tw-border-opacity));\n}\n.border-indigo-600 {\n  --tw-border-opacity: 1;\n  border-color: rgb(79 70 229 / var(--tw-border-opacity));\n}\n.border-red-400 {\n  --tw-border-opacity: 1;\n  border-color: rgb(248 113 113 / var(--tw-border-opacity));\n}\n.border-red-500 {\n  --tw-border-opacity: 1;\n  border-color: rgb(239 68 68 / var(--tw-border-opacity));\n}\n.border-slate-200 {\n  --tw-border-opacity: 1;\n  border-color: rgb(226 232 240 / var(--tw-border-opacity));\n}\n.border-slate-600 {\n  --tw-border-opacity: 1;\n  border-color: rgb(71 85 105 / var(--tw-border-opacity));\n}\n.border-transparent {\n  border-color: transparent;\n}\n.border-white {\n  --tw-border-opacity: 1;\n  border-color: rgb(255 255 255 / var(--tw-border-opacity));\n}\n.border-yellow-200 {\n  --tw-border-opacity: 1;\n  border-color: rgb(254 240 138 / var(--tw-border-opacity));\n}\n.border-opacity-100 {\n  --tw-border-opacity: 1;\n}\n.border-opacity-25 {\n  --tw-border-opacity: 0.25;\n}\n.bg-black {\n  --tw-bg-opacity: 1;\n  background-color: rgb(0 0 0 / var(--tw-bg-opacity));\n}\n.bg-fuchsia-400 {\n  --tw-bg-opacity: 1;\n  background-color: rgb(232 121 249 / var(--tw-bg-opacity));\n}\n.bg-gray-100 {\n  --tw-bg-opacity: 1;\n  background-color: rgb(243 244 246 / var(--tw-bg-opacity));\n}\n.bg-gray-200 {\n  --tw-bg-opacity: 1;\n  background-color: rgb(229 231 235 / var(--tw-bg-opacity));\n}\n.bg-gray-400 {\n  --tw-bg-opacity: 1;\n  background-color: rgb(156 163 175 / var(--tw-bg-opacity));\n}\n.bg-gray-500 {\n  --tw-bg-opacity: 1;\n  background-color: rgb(107 114 128 / var(--tw-bg-opacity));\n}\n.bg-gray-600 {\n  --tw-bg-opacity: 1;\n  background-color: rgb(75 85 99 / var(--tw-bg-opacity));\n}\n.bg-gray-700 {\n  --tw-bg-opacity: 1;\n  background-color: rgb(55 65 81 / var(--tw-bg-opacity));\n}\n.bg-gray-800 {\n  --tw-bg-opacity: 1;\n  background-color: rgb(31 41 55 / var(--tw-bg-opacity));\n}\n.bg-green-500 {\n  --tw-bg-opacity: 1;\n  background-color: rgb(34 197 94 / var(--tw-bg-opacity));\n}\n.bg-slate-800 {\n  --tw-bg-opacity: 1;\n  background-color: rgb(30 41 59 / var(--tw-bg-opacity));\n}\n.bg-transparent {\n  background-color: transparent;\n}\n.bg-yellow-400 {\n  --tw-bg-opacity: 1;\n  background-color: rgb(250 204 21 / var(--tw-bg-opacity));\n}\n.bg-yellow-500 {\n  --tw-bg-opacity: 1;\n  background-color: rgb(234 179 8 / var(--tw-bg-opacity));\n}\n.bg-opacity-25 {\n  --tw-bg-opacity: 0.25;\n}\n.bg-opacity-50 {\n  --tw-bg-opacity: 0.5;\n}\n.bg-opacity-70 {\n  --tw-bg-opacity: 0.7;\n}\n.bg-opacity-75 {\n  --tw-bg-opacity: 0.75;\n}\n.bg-opacity-85 {\n  --tw-bg-opacity: 0.85;\n}\n.fill-white {\n  fill: #fff;\n}\n.p-1 {\n  padding: 0.25rem;\n}\n.p-10 {\n  padding: 2.5rem;\n}\n.p-2 {\n  padding: 0.5rem;\n}\n.p-3 {\n  padding: 0.75rem;\n}\n.p-4 {\n  padding: 1rem;\n}\n.p-6 {\n  padding: 1.5rem;\n}\n.px-1 {\n  padding-left: 0.25rem;\n  padding-right: 0.25rem;\n}\n.px-2 {\n  padding-left: 0.5rem;\n  padding-right: 0.5rem;\n}\n.px-3 {\n  padding-left: 0.75rem;\n  padding-right: 0.75rem;\n}\n.px-4 {\n  padding-left: 1rem;\n  padding-right: 1rem;\n}\n.py-1 {\n  padding-top: 0.25rem;\n  padding-bottom: 0.25rem;\n}\n.py-1\\.5 {\n  padding-top: 0.375rem;\n  padding-bottom: 0.375rem;\n}\n.py-2 {\n  padding-top: 0.5rem;\n  padding-bottom: 0.5rem;\n}\n.pl-2 {\n  padding-left: 0.5rem;\n}\n.pr-2 {\n  padding-right: 0.5rem;\n}\n.pr-4 {\n  padding-right: 1rem;\n}\n.pt-12 {\n  padding-top: 3rem;\n}\n.pt-4 {\n  padding-top: 1rem;\n}\n.text-left {\n  text-align: left;\n}\n.text-center {\n  text-align: center;\n}\n.text-right {\n  text-align: right;\n}\n.text-2xl {\n  font-size: 1.5rem;\n  line-height: 2rem;\n}\n.text-3xl {\n  font-size: 1.875rem;\n  line-height: 2.25rem;\n}\n.text-lg {\n  font-size: 1.125rem;\n  line-height: 1.75rem;\n}\n.text-sm {\n  font-size: 0.875rem;\n  line-height: 1.25rem;\n}\n.text-xl {\n  font-size: 1.25rem;\n  line-height: 1.75rem;\n}\n.text-xs {\n  font-size: 0.75rem;\n  line-height: 1rem;\n}\n.font-bold {\n  font-weight: 700;\n}\n.font-medium {\n  font-weight: 500;\n}\n.font-normal {\n  font-weight: 400;\n}\n.font-semibold {\n  font-weight: 600;\n}\n.capitalize {\n  text-transform: capitalize;\n}\n.italic {\n  font-style: italic;\n}\n.leading-10 {\n  line-height: 2.5rem;\n}\n.tracking-wider {\n  letter-spacing: 0.05em;\n}\n.text-\\[\\#66c0f4\\] {\n  --tw-text-opacity: 1;\n  color: rgb(102 192 244 / var(--tw-text-opacity));\n}\n.text-\\[\\#8aff4b\\] {\n  --tw-text-opacity: 1;\n  color: rgb(138 255 75 / var(--tw-text-opacity));\n}\n.text-\\[\\#d700e0\\] {\n  --tw-text-opacity: 1;\n  color: rgb(215 0 224 / var(--tw-text-opacity));\n}\n.text-\\[\\#ffe700\\] {\n  --tw-text-opacity: 1;\n  color: rgb(255 231 0 / var(--tw-text-opacity));\n}\n.text-black {\n  --tw-text-opacity: 1;\n  color: rgb(0 0 0 / var(--tw-text-opacity));\n}\n.text-blue-300 {\n  --tw-text-opacity: 1;\n  color: rgb(147 197 253 / var(--tw-text-opacity));\n}\n.text-blue-600 {\n  --tw-text-opacity: 1;\n  color: rgb(37 99 235 / var(--tw-text-opacity));\n}\n.text-fuchsia-400 {\n  --tw-text-opacity: 1;\n  color: rgb(232 121 249 / var(--tw-text-opacity));\n}\n.text-gray-400 {\n  --tw-text-opacity: 1;\n  color: rgb(156 163 175 / var(--tw-text-opacity));\n}\n.text-gray-500 {\n  --tw-text-opacity: 1;\n  color: rgb(107 114 128 / var(--tw-text-opacity));\n}\n.text-green-400 {\n  --tw-text-opacity: 1;\n  color: rgb(74 222 128 / var(--tw-text-opacity));\n}\n.text-green-500 {\n  --tw-text-opacity: 1;\n  color: rgb(34 197 94 / var(--tw-text-opacity));\n}\n.text-slate-300 {\n  --tw-text-opacity: 1;\n  color: rgb(203 213 225 / var(--tw-text-opacity));\n}\n.text-slate-400 {\n  --tw-text-opacity: 1;\n  color: rgb(148 163 184 / var(--tw-text-opacity));\n}\n.text-slate-50 {\n  --tw-text-opacity: 1;\n  color: rgb(248 250 252 / var(--tw-text-opacity));\n}\n.text-white {\n  --tw-text-opacity: 1;\n  color: rgb(255 255 255 / var(--tw-text-opacity));\n}\n.text-yellow-500 {\n  --tw-text-opacity: 1;\n  color: rgb(234 179 8 / var(--tw-text-opacity));\n}\n.line-through {\n  text-decoration-line: line-through;\n}\n.accent-fuchsia-400 {\n  accent-color: #e879f9;\n}\n.opacity-50 {\n  opacity: 0.5;\n}\n.opacity-75 {\n  opacity: 0.75;\n}\n.shadow-lg {\n  --tw-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);\n  --tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);\n  box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);\n}\n.shadow-md {\n  --tw-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);\n  --tw-shadow-colored: 0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);\n  box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);\n}\n.outline-none {\n  outline: 2px solid transparent;\n  outline-offset: 2px;\n}\n.outline {\n  outline-style: solid;\n}\n.blur {\n  --tw-blur: blur(8px);\n  filter: var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow);\n}\n.drop-shadow-xl {\n  --tw-drop-shadow: drop-shadow(0 20px 13px rgb(0 0 0 / 0.03)) drop-shadow(0 8px 5px rgb(0 0 0 / 0.08));\n  filter: var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow);\n}\n.filter {\n  filter: var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow);\n}\n.transition {\n  transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, -webkit-backdrop-filter;\n  transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;\n  transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter, -webkit-backdrop-filter;\n  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n  transition-duration: 150ms;\n}\n.transition-all {\n  transition-property: all;\n  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n  transition-duration: 150ms;\n}\n.transition-colors {\n  transition-property: color, background-color, border-color, text-decoration-color, fill, stroke;\n  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n  transition-duration: 150ms;\n}\n.duration-200 {\n  transition-duration: 200ms;\n}\n\n/* FONTS */\n@font-face {\n    font-family: 'Play';\n    src: url(${d}) format('truetype');\n    font-weight: normal;\n    font-style: normal;\n}\n\n@font-face {\n    font-family: 'Play';\n    src: url(${f}) format('truetype');\n    font-weight: bold;\n    font-style: normal;\n}\n\nhtml {\n    height: 100%;\n    overflow: hidden;\n}\n\nbody {\n    background-color: black;\n    width: 100%;\n    height: 100%;\n    cursor: cell;\n\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n}\n\n.selectable {\n    -webkit-user-select: text;\n    -moz-user-select: text;\n    user-select: text;\n}\n\n#canvas,\n#background-canvas,\n#foreground-canvas,\n#overlay-canvas {\n    display: none;\n    position: absolute;\n    top: 0;\n    left: 0;\n    /* transition: all 1s; */\n}\n\n#foreground-canvas,\n#overlay-canvas {\n    pointer-events: none;\n}\n\n.minimap {\n    display: none;\n    position: absolute;\n    top: 0;\n    right: 0;\n    width: 800px;\n    height: 800px;\n    border: 1px solid white;\n    z-index: 100;\n}\n\n#minimap-obstacle {\n    background: rgb(51, 36, 76);\n    background: linear-gradient(0deg, rgba(51, 36, 76, 1) 50%, rgba(51, 36, 76, 0.5) 100%);\n    /* background: linear-gradient(0deg, rgb(29 139 163) 50%, rgb(0 181 255 / 50%) 100%); */\n    /* background: linear-gradient(0deg, rgb(9 38 45) 50%, rgb(0 95 134 / 50%) 100%); */\n}\n\n.item-button-transition {\n    transition-property: border-color, left;\n    transition-duration: 1s, 250ms;\n    /* Slow transition for fading out */\n    transition-timing-function: ease-in-out;\n}\n\n.item-button-transition:hover {\n    transition-duration: 0s;\n    /* Immediate change when hovering in */\n}\n\n.text-outline {\n    text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;\n}\n\n.ui-box {\n    box-shadow:\n        rgba(22, 31, 39, 0.42) 0px 60px 123px -25px,\n        rgba(19, 26, 32, 0.08) 0px 35px 75px -35px;\n}\n\n/* WIP */\n.card-2 {\n    box-shadow: inset 0 0 10px rgba(203, 213, 225, 0.5), rgba(22, 31, 39, 0.42) 0px 60px 123px -25px, rgba(19, 26, 32, 0.08) 0px 35px 75px -35px;\n    border: 1px solid rgb(30 41 59);\n}\n\n.card-2 .separator {\n    height: 2px; /* I want this to be 1px but that makes it disappear in certain circumstances so setting it to 2px and lower the radial-gradient opacity (from 0.7 to 0.4) */\n    width: 100%;\n    background: radial-gradient(\n        ellipse at center,\n        rgba(255, 255, 255, 0.4) 0%,\n        rgba(255, 255, 255, 0) 70%\n    );\n    margin: 20px auto;\n    box-shadow: 0 0 30px rgba(255, 255, 255, 0.5);\n}\n\n.before\\:absolute::before {\n  content: var(--tw-content);\n  position: absolute;\n}\n\n.before\\:-top-4::before {\n  content: var(--tw-content);\n  top: -1rem;\n}\n\n.before\\:right-0::before {\n  content: var(--tw-content);\n  right: 0px;\n}\n\n.before\\:top-0::before {\n  content: var(--tw-content);\n  top: 0px;\n}\n\n.before\\:mr-2::before {\n  content: var(--tw-content);\n  margin-right: 0.5rem;\n}\n\n.before\\:h-12::before {\n  content: var(--tw-content);\n  height: 3rem;\n}\n\n.before\\:h-20::before {\n  content: var(--tw-content);\n  height: 5rem;\n}\n\n.before\\:w-6::before {\n  content: var(--tw-content);\n  width: 1.5rem;\n}\n\n.before\\:translate-x-12::before {\n  content: var(--tw-content);\n  --tw-translate-x: 3rem;\n  transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));\n}\n\n.before\\:rotate-6::before {\n  content: var(--tw-content);\n  --tw-rotate: 6deg;\n  transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));\n}\n\n.before\\:bg-white::before {\n  content: var(--tw-content);\n  --tw-bg-opacity: 1;\n  background-color: rgb(255 255 255 / var(--tw-bg-opacity));\n}\n\n.before\\:text-\\[\\#ffe700\\]::before {\n  content: var(--tw-content);\n  --tw-text-opacity: 1;\n  color: rgb(255 231 0 / var(--tw-text-opacity));\n}\n\n.before\\:opacity-10::before {\n  content: var(--tw-content);\n  opacity: 0.1;\n}\n\n.before\\:duration-700::before {\n  content: var(--tw-content);\n  transition-duration: 700ms;\n}\n\n.before\\:content-\\[\\'\\2022\\'\\]::before {\n  --tw-content: '•';\n  content: var(--tw-content);\n}\n\n.before\\:content-\\[\\'\\2605\\'\\]::before {\n  --tw-content: '★';\n  content: var(--tw-content);\n}\n\n.last\\:mb-0:last-child {\n  margin-bottom: 0px;\n}\n\n.hover\\:left-0:hover {\n  left: 0px;\n}\n\n.hover\\:left-2:hover {\n  left: 0.5rem;\n}\n\n.hover\\:border-opacity-0:hover {\n  --tw-border-opacity: 0;\n}\n\n.hover\\:border-opacity-100:hover {\n  --tw-border-opacity: 1;\n}\n\n.hover\\:border-opacity-50:hover {\n  --tw-border-opacity: 0.5;\n}\n\n.hover\\:bg-gray-600:hover {\n  --tw-bg-opacity: 1;\n  background-color: rgb(75 85 99 / var(--tw-bg-opacity));\n}\n\n.hover\\:bg-slate-700:hover {\n  --tw-bg-opacity: 1;\n  background-color: rgb(51 65 85 / var(--tw-bg-opacity));\n}\n\n.hover\\:bg-slate-900:hover {\n  --tw-bg-opacity: 1;\n  background-color: rgb(15 23 42 / var(--tw-bg-opacity));\n}\n\n.hover\\:bg-opacity-50:hover {\n  --tw-bg-opacity: 0.5;\n}\n\n.hover\\:text-\\[\\#ffe700\\]:hover {\n  --tw-text-opacity: 1;\n  color: rgb(255 231 0 / var(--tw-text-opacity));\n}\n\n.hover\\:text-blue-400:hover {\n  --tw-text-opacity: 1;\n  color: rgb(96 165 250 / var(--tw-text-opacity));\n}\n\n.hover\\:text-red-500:hover {\n  --tw-text-opacity: 1;\n  color: rgb(239 68 68 / var(--tw-text-opacity));\n}\n\n.hover\\:text-white:hover {\n  --tw-text-opacity: 1;\n  color: rgb(255 255 255 / var(--tw-text-opacity));\n}\n\n.hover\\:opacity-100:hover {\n  opacity: 1;\n}\n\n.hover\\:before\\:-translate-x-44:hover::before {\n  content: var(--tw-content);\n  --tw-translate-x: -11rem;\n  transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));\n}\n\n.hover\\:before\\:-translate-x-52:hover::before {\n  content: var(--tw-content);\n  --tw-translate-x: -13rem;\n  transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));\n}\n\n.focus\\:border-slate-400:focus {\n  --tw-border-opacity: 1;\n  border-color: rgb(148 163 184 / var(--tw-border-opacity));\n}\n\n.focus\\:ring-blue-500:focus {\n  --tw-ring-opacity: 1;\n  --tw-ring-color: rgb(59 130 246 / var(--tw-ring-opacity));\n}\n\n.active\\:scale-90:active {\n  --tw-scale-x: .9;\n  --tw-scale-y: .9;\n  transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));\n}\n\n.active\\:bg-opacity-75:active {\n  --tw-bg-opacity: 0.75;\n}`,""]);const p=h},6314:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,i,s){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(r)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(o[l]=!0)}for(var u=0;u<e.length;u++){var c=[].concat(e[u]);r&&o[c[0]]||(void 0!==s&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=s),n&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=n):c[2]=n),i&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=i):c[4]="".concat(i)),t.push(c))}},t}},4417:e=>{"use strict";e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},1601:e=>{"use strict";e.exports=function(e){return e[1]}},6570:e=>{"use strict";function t(e,t,r){r=r||2;var s,o,a,l,h,d,p,m=t&&t.length,g=m?t[0]*r:e.length,y=n(e,0,g,r,!0),v=[];if(!y||y.next===y.prev)return v;if(m&&(y=function(e,t,r,i){var s,o,a,l=[];for(s=0,o=t.length;s<o;s++)(a=n(e,t[s]*i,s<o-1?t[s+1]*i:e.length,i,!1))===a.next&&(a.steiner=!0),l.push(f(a));for(l.sort(u),s=0;s<l.length;s++)r=c(l[s],r);return r}(e,t,y,r)),e.length>80*r){s=a=e[0],o=l=e[1];for(var x=r;x<g;x+=r)(h=e[x])<s&&(s=h),(d=e[x+1])<o&&(o=d),h>a&&(a=h),d>l&&(l=d);p=0!==(p=Math.max(a-s,l-o))?32767/p:0}return i(y,v,r,s,o,p,0),v}function n(e,t,n,r,i){var s,o;if(i===C(e,t,n,r)>0)for(s=t;s<n;s+=r)o=_(s,e[s],e[s+1],o);else for(s=n-r;s>=t;s-=r)o=_(s,e[s],e[s+1],o);return o&&y(o,o.next)&&(T(o),o=o.next),o}function r(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!y(r,r.next)&&0!==g(r.prev,r,r.next))r=r.next;else{if(T(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function i(e,t,n,u,c,h,f){if(e){!f&&h&&function(e,t,n,r){var i=e;do{0===i.z&&(i.z=d(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,s,o,a,l,u=1;do{for(n=e,e=null,s=null,o=0;n;){for(o++,r=n,a=0,t=0;t<u&&(a++,r=r.nextZ);t++);for(l=u;a>0||l>0&&r;)0!==a&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,l--),s?s.nextZ=i:e=i,i.prevZ=s,s=i;n=r}s.nextZ=null,u*=2}while(o>1)}(i)}(e,u,c,h);for(var p,m,g=e;e.prev!==e.next;)if(p=e.prev,m=e.next,h?o(e,u,c,h):s(e))t.push(p.i/n|0),t.push(e.i/n|0),t.push(m.i/n|0),T(e),e=m.next,g=m.next;else if((e=m)===g){f?1===f?i(e=a(r(e),t,n),t,n,u,c,h,2):2===f&&l(e,t,n,u,c,h):i(r(e),t,n,u,c,h,1);break}}}function s(e){var t=e.prev,n=e,r=e.next;if(g(t,n,r)>=0)return!1;for(var i=t.x,s=n.x,o=r.x,a=t.y,l=n.y,u=r.y,c=i<s?i<o?i:o:s<o?s:o,h=a<l?a<u?a:u:l<u?l:u,d=i>s?i>o?i:o:s>o?s:o,f=a>l?a>u?a:u:l>u?l:u,m=r.next;m!==t;){if(m.x>=c&&m.x<=d&&m.y>=h&&m.y<=f&&p(i,a,s,l,o,u,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function o(e,t,n,r){var i=e.prev,s=e,o=e.next;if(g(i,s,o)>=0)return!1;for(var a=i.x,l=s.x,u=o.x,c=i.y,h=s.y,f=o.y,m=a<l?a<u?a:u:l<u?l:u,y=c<h?c<f?c:f:h<f?h:f,v=a>l?a>u?a:u:l>u?l:u,x=c>h?c>f?c:f:h>f?h:f,b=d(m,y,t,n,r),w=d(v,x,t,n,r),S=e.prevZ,_=e.nextZ;S&&S.z>=b&&_&&_.z<=w;){if(S.x>=m&&S.x<=v&&S.y>=y&&S.y<=x&&S!==i&&S!==o&&p(a,c,l,h,u,f,S.x,S.y)&&g(S.prev,S,S.next)>=0)return!1;if(S=S.prevZ,_.x>=m&&_.x<=v&&_.y>=y&&_.y<=x&&_!==i&&_!==o&&p(a,c,l,h,u,f,_.x,_.y)&&g(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;S&&S.z>=b;){if(S.x>=m&&S.x<=v&&S.y>=y&&S.y<=x&&S!==i&&S!==o&&p(a,c,l,h,u,f,S.x,S.y)&&g(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;_&&_.z<=w;){if(_.x>=m&&_.x<=v&&_.y>=y&&_.y<=x&&_!==i&&_!==o&&p(a,c,l,h,u,f,_.x,_.y)&&g(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function a(e,t,n){var i=e;do{var s=i.prev,o=i.next.next;!y(s,o)&&v(s,i,i.next,o)&&w(s,o)&&w(o,s)&&(t.push(s.i/n|0),t.push(i.i/n|0),t.push(o.i/n|0),T(i),T(i.next),i=e=o),i=i.next}while(i!==e);return r(i)}function l(e,t,n,s,o,a){var l=e;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&m(l,u)){var c=S(l,u);return l=r(l,l.next),c=r(c,c.next),i(l,t,n,s,o,a,0),void i(c,t,n,s,o,a,0)}u=u.next}l=l.next}while(l!==e)}function u(e,t){return e.x-t.x}function c(e,t){var n=function(e,t){var n,r=t,i=e.x,s=e.y,o=-1/0;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){var a=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=i&&a>o&&(o=a,n=r.x<r.next.x?r:r.next,a===i))return n}r=r.next}while(r!==t);if(!n)return null;var l,u=n,c=n.x,d=n.y,f=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&p(s<d?i:o,s,c,d,s<d?o:i,s,r.x,r.y)&&(l=Math.abs(s-r.y)/(i-r.x),w(r,e)&&(l<f||l===f&&(r.x>n.x||r.x===n.x&&h(n,r)))&&(n=r,f=l)),r=r.next}while(r!==u);return n}(e,t);if(!n)return t;var i=S(n,e);return r(i,i.next),r(n,n.next)}function h(e,t){return g(e.prev,e,t.prev)<0&&g(t.next,e,e.next)<0}function d(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function f(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function p(e,t,n,r,i,s,o,a){return(i-o)*(t-a)>=(e-o)*(s-a)&&(e-o)*(r-a)>=(n-o)*(t-a)&&(n-o)*(s-a)>=(i-o)*(r-a)}function m(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&v(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(w(e,t)&&w(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,s=(e.y+t.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(g(e.prev,e,t.prev)||g(e,t.prev,t))||y(e,t)&&g(e.prev,e,e.next)>0&&g(t.prev,t,t.next)>0)}function g(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function y(e,t){return e.x===t.x&&e.y===t.y}function v(e,t,n,r){var i=b(g(e,t,n)),s=b(g(e,t,r)),o=b(g(n,r,e)),a=b(g(n,r,t));return i!==s&&o!==a||!(0!==i||!x(e,n,t))||!(0!==s||!x(e,r,t))||!(0!==o||!x(n,e,r))||!(0!==a||!x(n,t,r))}function x(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function b(e){return e>0?1:e<0?-1:0}function w(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function S(e,t){var n=new E(e.i,e.x,e.y),r=new E(t.i,t.x,t.y),i=e.next,s=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function _(e,t,n,r){var i=new E(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function T(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function E(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C(e,t,n,r){for(var i=0,s=t,o=n-r;s<n;s+=r)i+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return i}e.exports=t,e.exports.default=t,t.deviation=function(e,t,n,r){var i=t&&t.length,s=i?t[0]*n:e.length,o=Math.abs(C(e,0,s,n));if(i)for(var a=0,l=t.length;a<l;a++){var u=t[a]*n,c=a<l-1?t[a+1]*n:e.length;o-=Math.abs(C(e,u,c,n))}var h=0;for(a=0;a<r.length;a+=3){var d=r[a]*n,f=r[a+1]*n,p=r[a+2]*n;h+=Math.abs((e[d]-e[p])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[p+1]-e[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},t.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var s=0;s<e[i].length;s++)for(var o=0;o<t;o++)n.vertices.push(e[i][s][o]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n}},228:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,r,s,o){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new i(r,s||e,o),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),a.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,o=new Array(s);i<s;i++)o[i]=r[i].fn;return o},a.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},a.prototype.emit=function(e,t,r,i,s,o){var a=n?n+e:e;if(!this._events[a])return!1;var l,u,c=this._events[a],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,s),!0;case 6:return c.fn.call(c.context,t,r,i,s,o),!0}for(u=1,l=new Array(h-1);u<h;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var d,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),h){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,r);break;case 4:c[u].fn.call(c[u].context,t,r,i);break;default:if(!l)for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];c[u].fn.apply(c[u].context,l)}}return!0},a.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,r,i){var s=n?n+e:e;if(!this._events[s])return this;if(!t)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==t||i&&!a.once||r&&a.context!==r||o(this,s);else{for(var l=0,u=[],c=a.length;l<c;l++)(a[l].fn!==t||i&&!a[l].once||r&&a[l].context!==r)&&u.push(a[l]);u.length?this._events[s]=1===u.length?u[0]:u:o(this,s)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&o(this,t)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a},1630:e=>{"use strict";function t(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,n,r,i){n=n||"&",r=r||"=";var s={};if("string"!=typeof e||0===e.length)return s;var o=/\+/g;e=e.split(n);var a=1e3;i&&"number"==typeof i.maxKeys&&(a=i.maxKeys);var l=e.length;a>0&&l>a&&(l=a);for(var u=0;u<l;++u){var c,h,d,f,p=e[u].replace(o,"%20"),m=p.indexOf(r);m>=0?(c=p.substr(0,m),h=p.substr(m+1)):(c=p,h=""),d=decodeURIComponent(c),f=decodeURIComponent(h),t(s,d)?Array.isArray(s[d])?s[d].push(f):s[d]=[s[d],f]:s[d]=f}return s}},9106:e=>{"use strict";var t=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,n,r,i){return n=n||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((function(i){var s=encodeURIComponent(t(i))+r;return Array.isArray(e[i])?e[i].map((function(e){return s+encodeURIComponent(t(e))})).join(n):s+encodeURIComponent(t(e[i]))})).join(n):i?encodeURIComponent(t(i))+r+encodeURIComponent(t(e)):""}},7186:(e,t,n)=>{"use strict";t.decode=t.parse=n(1630),t.encode=t.stringify=n(9106)},2551:(e,t,n)=>{"use strict";var r=n(6540),i=n(9982);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,a={};function l(e,t){u(e,t),u(e+"Capture",t)}function u(e,t){for(a[e]=t,e=0;e<t.length;e++)o.add(t[e])}var c=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function m(e,t,n,r,i,s,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=o}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var y=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}function x(e,t,n,r){var i=g.hasOwnProperty(t)?g[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null==t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!h.call(p,e)||!h.call(f,e)&&(d.test(e)?p[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(y,v);g[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(y,v);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(y,v);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var b=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),S=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),k=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),I=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var F=Symbol.iterator;function N(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=F&&e[F]||e["@@iterator"])?e:null}var L,B=Object.assign;function O(e){if(void 0===L)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);L=t&&t[1]||""}return"\n"+L+e}var z=!1;function j(e,t){if(!e||z)return"";z=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var r=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){r=e}e.call(t.prototype)}else{try{throw Error()}catch(e){r=e}e()}}catch(t){if(t&&r&&"string"==typeof t.stack){for(var i=t.stack.split("\n"),s=r.stack.split("\n"),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(1!==o||1!==a)do{if(o--,0>--a||i[o]!==s[a]){var l="\n"+i[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=o&&0<=a);break}}}finally{z=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?O(e):""}function U(e){switch(e.tag){case 5:return O(e.type);case 16:return O("Lazy");case 13:return O("Suspense");case 19:return O("SuspenseList");case 0:case 2:case 15:return j(e.type,!1);case 11:return j(e.type.render,!1);case 1:return j(e.type,!0);default:return""}}function G(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case _:return"Fragment";case S:return"Portal";case E:return"Profiler";case T:return"StrictMode";case M:return"Suspense";case P:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case k:return(e.displayName||"Context")+".Consumer";case C:return(e._context.displayName||"Context")+".Provider";case A:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case R:return null!==(t=e.displayName||null)?t:G(e.type)||"Memo";case I:t=e._payload,e=e._init;try{return G(e(t))}catch(e){}}return null}function V(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return G(t);case 8:return t===T?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function W(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function X(e){e._valueTracker||(e._valueTracker=function(e){var t=W(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var i=n.get,s=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function $(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=W(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function Y(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function q(e,t){var n=t.checked;return B({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function K(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=H(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Z(e,t){null!=(t=t.checked)&&x(e,"checked",t,!1)}function Q(e,t){Z(e,t);var n=H(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function J(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&Y(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+H(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return B({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(s(92));if(te(n)){if(1<n.length)throw Error(s(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:H(n)}}function se(e,t){var n=H(t.value),r=H(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ae(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ae(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ue,ce,he=(ce=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ue=ue||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ue.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return ce(e,t)}))}:ce);function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=me(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(fe).forEach((function(e){pe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]}))}));var ye=B({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ve(e,t){if(t){if(ye[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(s(62))}}function xe(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var be=null;function we(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Se=null,_e=null,Te=null;function Ee(e){if(e=xi(e)){if("function"!=typeof Se)throw Error(s(280));var t=e.stateNode;t&&(t=wi(t),Se(e.stateNode,e.type,t))}}function Ce(e){_e?Te?Te.push(e):Te=[e]:_e=e}function ke(){if(_e){var e=_e,t=Te;if(Te=_e=null,Ee(e),t)for(e=0;e<t.length;e++)Ee(t[e])}}function Ae(e,t){return e(t)}function Me(){}var Pe=!1;function Re(e,t,n){if(Pe)return e(t,n);Pe=!0;try{return Ae(e,t,n)}finally{Pe=!1,(null!==_e||null!==Te)&&(Me(),ke())}}function Ie(e,t){var n=e.stateNode;if(null===n)return null;var r=wi(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(s(231,t,typeof n));return n}var De=!1;if(c)try{var Fe={};Object.defineProperty(Fe,"passive",{get:function(){De=!0}}),window.addEventListener("test",Fe,Fe),window.removeEventListener("test",Fe,Fe)}catch(ce){De=!1}function Ne(e,t,n,r,i,s,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(e){this.onError(e)}}var Le=!1,Be=null,Oe=!1,ze=null,je={onError:function(e){Le=!0,Be=e}};function Ue(e,t,n,r,i,s,o,a,l){Le=!1,Be=null,Ne.apply(je,arguments)}function Ge(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ve(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function He(e){if(Ge(e)!==e)throw Error(s(188))}function We(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ge(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return He(i),e;if(o===r)return He(i),t;o=o.sibling}throw Error(s(188))}if(n.return!==r.return)n=i,r=o;else{for(var a=!1,l=i.child;l;){if(l===n){a=!0,n=i,r=o;break}if(l===r){a=!0,r=i,n=o;break}l=l.sibling}if(!a){for(l=o.child;l;){if(l===n){a=!0,n=o,r=i;break}if(l===r){a=!0,r=o,n=i;break}l=l.sibling}if(!a)throw Error(s(189))}}if(n.alternate!==r)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(e))?Xe(e):null}function Xe(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Xe(e);if(null!==t)return t;e=e.sibling}return null}var $e=i.unstable_scheduleCallback,Ye=i.unstable_cancelCallback,qe=i.unstable_shouldYield,Ke=i.unstable_requestPaint,Ze=i.unstable_now,Qe=i.unstable_getCurrentPriorityLevel,Je=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,st=null,ot=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(at(e)/lt|0)|0},at=Math.log,lt=Math.LN2,ut=64,ct=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,s=e.pingedLanes,o=268435455&n;if(0!==o){var a=o&~i;0!==a?r=ht(a):0!=(s&=o)&&(r=ht(s))}else 0!=(o=n&~i)?r=ht(o):0!==s&&(r=ht(s));if(0===r)return 0;if(0!==t&&t!==r&&!(t&i)&&((i=r&-r)>=(s=t&-t)||16===i&&4194240&s))return t;if(4&r&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-ot(t)),r|=e[n],t&=~i;return r}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!=(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ut;return!(4194240&(ut<<=1))&&(ut=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=n}function vt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-ot(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var xt=0;function bt(e){return 1<(e&=-e)?4<e?268435455&e?16:536870912:4:1}var wt,St,_t,Tt,Et,Ct=!1,kt=[],At=null,Mt=null,Pt=null,Rt=new Map,It=new Map,Dt=[],Ft="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Nt(e,t){switch(e){case"focusin":case"focusout":At=null;break;case"dragenter":case"dragleave":Mt=null;break;case"mouseover":case"mouseout":Pt=null;break;case"pointerover":case"pointerout":Rt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":It.delete(t.pointerId)}}function Lt(e,t,n,r,i,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},null!==t&&null!==(t=xi(t))&&St(t),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Bt(e){var t=vi(e.target);if(null!==t){var n=Ge(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ve(n)))return e.blockedOn=t,void Et(e.priority,(function(){_t(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ot(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=xi(n))&&St(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);be=r,n.target.dispatchEvent(r),be=null,t.shift()}return!0}function zt(e,t,n){Ot(e)&&n.delete(t)}function jt(){Ct=!1,null!==At&&Ot(At)&&(At=null),null!==Mt&&Ot(Mt)&&(Mt=null),null!==Pt&&Ot(Pt)&&(Pt=null),Rt.forEach(zt),It.forEach(zt)}function Ut(e,t){e.blockedOn===t&&(e.blockedOn=null,Ct||(Ct=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,jt)))}function Gt(e){function t(t){return Ut(t,e)}if(0<kt.length){Ut(kt[0],e);for(var n=1;n<kt.length;n++){var r=kt[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==At&&Ut(At,e),null!==Mt&&Ut(Mt,e),null!==Pt&&Ut(Pt,e),Rt.forEach(t),It.forEach(t),n=0;n<Dt.length;n++)(r=Dt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Dt.length&&null===(n=Dt[0]).blockedOn;)Bt(n),null===n.blockedOn&&Dt.shift()}var Vt=b.ReactCurrentBatchConfig,Ht=!0;function Wt(e,t,n,r){var i=xt,s=Vt.transition;Vt.transition=null;try{xt=1,$t(e,t,n,r)}finally{xt=i,Vt.transition=s}}function Xt(e,t,n,r){var i=xt,s=Vt.transition;Vt.transition=null;try{xt=4,$t(e,t,n,r)}finally{xt=i,Vt.transition=s}}function $t(e,t,n,r){if(Ht){var i=qt(e,t,n,r);if(null===i)Hr(e,t,r,Yt,n),Nt(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return At=Lt(At,e,t,n,r,i),!0;case"dragenter":return Mt=Lt(Mt,e,t,n,r,i),!0;case"mouseover":return Pt=Lt(Pt,e,t,n,r,i),!0;case"pointerover":var s=i.pointerId;return Rt.set(s,Lt(Rt.get(s)||null,e,t,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,It.set(s,Lt(It.get(s)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Nt(e,r),4&t&&-1<Ft.indexOf(e)){for(;null!==i;){var s=xi(i);if(null!==s&&wt(s),null===(s=qt(e,t,n,r))&&Hr(e,t,r,Yt,n),s===i)break;i=s}null!==i&&r.stopPropagation()}else Hr(e,t,r,null,n)}}var Yt=null;function qt(e,t,n,r){if(Yt=null,null!==(e=vi(e=we(r))))if(null===(t=Ge(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ve(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Yt=e,null}function Kt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qe()){case Je:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Zt=null,Qt=null,Jt=null;function en(){if(Jt)return Jt;var e,t,n=Qt,r=n.length,i="value"in Zt?Zt.value:Zt.textContent,s=i.length;for(e=0;e<r&&n[e]===i[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===i[s-t];t++);return Jt=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function sn(e){function t(t,n,r,i,s){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return B(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var on,an,ln,un={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cn=sn(un),hn=B({},un,{view:0,detail:0}),dn=sn(hn),fn=B({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:En,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(on=e.screenX-ln.screenX,an=e.screenY-ln.screenY):an=on=0,ln=e),on)},movementY:function(e){return"movementY"in e?e.movementY:an}}),pn=sn(fn),mn=sn(B({},fn,{dataTransfer:0})),gn=sn(B({},hn,{relatedTarget:0})),yn=sn(B({},un,{animationName:0,elapsedTime:0,pseudoElement:0})),vn=B({},un,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),xn=sn(vn),bn=sn(B({},un,{data:0})),wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_n={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Tn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=_n[e])&&!!t[e]}function En(){return Tn}var Cn=B({},hn,{key:function(e){if(e.key){var t=wn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Sn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:En,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),kn=sn(Cn),An=sn(B({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Mn=sn(B({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:En})),Pn=sn(B({},un,{propertyName:0,elapsedTime:0,pseudoElement:0})),Rn=B({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),In=sn(Rn),Dn=[9,13,27,32],Fn=c&&"CompositionEvent"in window,Nn=null;c&&"documentMode"in document&&(Nn=document.documentMode);var Ln=c&&"TextEvent"in window&&!Nn,Bn=c&&(!Fn||Nn&&8<Nn&&11>=Nn),On=String.fromCharCode(32),zn=!1;function jn(e,t){switch(e){case"keyup":return-1!==Dn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Un(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Gn=!1,Vn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Vn[e.type]:"textarea"===t}function Wn(e,t,n,r){Ce(r),0<(t=Xr(t,"onChange")).length&&(n=new cn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Xn=null,$n=null;function Yn(e){Or(e,0)}function qn(e){if($(bi(e)))return e}function Kn(e,t){if("change"===e)return t}var Zn=!1;if(c){var Qn;if(c){var Jn="oninput"in document;if(!Jn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Jn="function"==typeof er.oninput}Qn=Jn}else Qn=!1;Zn=Qn&&(!document.documentMode||9<document.documentMode)}function tr(){Xn&&(Xn.detachEvent("onpropertychange",nr),$n=Xn=null)}function nr(e){if("value"===e.propertyName&&qn($n)){var t=[];Wn(t,$n,e,we(e)),Re(Yn,t)}}function rr(e,t,n){"focusin"===e?(tr(),$n=n,(Xn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return qn($n)}function sr(e,t){if("click"===e)return qn(t)}function or(e,t){if("input"===e||"change"===e)return qn(t)}var ar="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function lr(e,t){if(ar(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!h.call(t,i)||!ar(e[i],t[i]))return!1}return!0}function ur(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function cr(e,t){var n,r=ur(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=ur(r)}}function hr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function dr(){for(var e=window,t=Y();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=Y((e=t.contentWindow).document)}return t}function fr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pr(e){var t=dr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&hr(n.ownerDocument.documentElement,n)){if(null!==r&&fr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=void 0===r.end?s:Math.min(r.end,i),!e.extend&&s>r&&(i=r,r=s,s=i),i=cr(n,s);var o=cr(n,r);i&&o&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),s>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mr=c&&"documentMode"in document&&11>=document.documentMode,gr=null,yr=null,vr=null,xr=!1;function br(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;xr||null==gr||gr!==Y(r)||(r="selectionStart"in(r=gr)&&fr(r)?{start:r.selectionStart,end:r.selectionEnd}:{anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},vr&&lr(vr,r)||(vr=r,0<(r=Xr(yr,"onSelect")).length&&(t=new cn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gr)))}function wr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Sr={animationend:wr("Animation","AnimationEnd"),animationiteration:wr("Animation","AnimationIteration"),animationstart:wr("Animation","AnimationStart"),transitionend:wr("Transition","TransitionEnd")},_r={},Tr={};function Er(e){if(_r[e])return _r[e];if(!Sr[e])return e;var t,n=Sr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Tr)return _r[e]=n[t];return e}c&&(Tr=document.createElement("div").style,"AnimationEvent"in window||(delete Sr.animationend.animation,delete Sr.animationiteration.animation,delete Sr.animationstart.animation),"TransitionEvent"in window||delete Sr.transitionend.transition);var Cr=Er("animationend"),kr=Er("animationiteration"),Ar=Er("animationstart"),Mr=Er("transitionend"),Pr=new Map,Rr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ir(e,t){Pr.set(e,t),l(t,[e])}for(var Dr=0;Dr<Rr.length;Dr++){var Fr=Rr[Dr];Ir(Fr.toLowerCase(),"on"+(Fr[0].toUpperCase()+Fr.slice(1)))}Ir(Cr,"onAnimationEnd"),Ir(kr,"onAnimationIteration"),Ir(Ar,"onAnimationStart"),Ir("dblclick","onDoubleClick"),Ir("focusin","onFocus"),Ir("focusout","onBlur"),Ir(Mr,"onTransitionEnd"),u("onMouseEnter",["mouseout","mouseover"]),u("onMouseLeave",["mouseout","mouseover"]),u("onPointerEnter",["pointerout","pointerover"]),u("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Nr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Lr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Nr));function Br(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,o,a,l,u){if(Ue.apply(this,arguments),Le){if(!Le)throw Error(s(198));var c=Be;Le=!1,Be=null,Oe||(Oe=!0,ze=c)}}(r,t,void 0,e),e.currentTarget=null}function Or(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var s=void 0;if(t)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;Br(i,a,u),s=l}else for(o=0;o<r.length;o++){if(l=(a=r[o]).instance,u=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;Br(i,a,u),s=l}}}if(Oe)throw e=ze,Oe=!1,ze=null,e}function zr(e,t){var n=t[mi];void 0===n&&(n=t[mi]=new Set);var r=e+"__bubble";n.has(r)||(Vr(t,e,2,!1),n.add(r))}function jr(e,t,n){var r=0;t&&(r|=4),Vr(n,e,r,t)}var Ur="_reactListening"+Math.random().toString(36).slice(2);function Gr(e){if(!e[Ur]){e[Ur]=!0,o.forEach((function(t){"selectionchange"!==t&&(Lr.has(t)||jr(t,!1,e),jr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Ur]||(t[Ur]=!0,jr("selectionchange",!1,t))}}function Vr(e,t,n,r){switch(Kt(t)){case 1:var i=Wt;break;case 4:i=Xt;break;default:i=$t}n=i.bind(null,t,n,e),i=void 0,!De||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Hr(e,t,n,r,i){var s=r;if(!(1&t||2&t||null===r))e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var a=r.stateNode.containerInfo;if(a===i||8===a.nodeType&&a.parentNode===i)break;if(4===o)for(o=r.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===i||8===l.nodeType&&l.parentNode===i))return;o=o.return}for(;null!==a;){if(null===(o=vi(a)))return;if(5===(l=o.tag)||6===l){r=s=o;continue e}a=a.parentNode}}r=r.return}Re((function(){var r=s,i=we(n),o=[];e:{var a=Pr.get(e);if(void 0!==a){var l=cn,u=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=kn;break;case"focusin":u="focus",l=gn;break;case"focusout":u="blur",l=gn;break;case"beforeblur":case"afterblur":l=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Mn;break;case Cr:case kr:case Ar:l=yn;break;case Mr:l=Pn;break;case"scroll":l=dn;break;case"wheel":l=In;break;case"copy":case"cut":case"paste":l=xn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=An}var c=!!(4&t),h=!c&&"scroll"===e,d=c?null!==a?a+"Capture":null:a;c=[];for(var f,p=r;null!==p;){var m=(f=p).stateNode;if(5===f.tag&&null!==m&&(f=m,null!==d&&null!=(m=Ie(p,d))&&c.push(Wr(p,m,f))),h)break;p=p.return}0<c.length&&(a=new l(a,u,null,n,i),o.push({event:a,listeners:c}))}}if(!(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||n===be||!(u=n.relatedTarget||n.fromElement)||!vi(u)&&!u[pi])&&(l||a)&&(a=i.window===i?i:(a=i.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=r,null!==(u=(u=n.relatedTarget||n.toElement)?vi(u):null)&&(u!==(h=Ge(u))||5!==u.tag&&6!==u.tag)&&(u=null)):(l=null,u=r),l!==u)){if(c=pn,m="onMouseLeave",d="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(c=An,m="onPointerLeave",d="onPointerEnter",p="pointer"),h=null==l?a:bi(l),f=null==u?a:bi(u),(a=new c(m,p+"leave",l,n,i)).target=h,a.relatedTarget=f,m=null,vi(i)===r&&((c=new c(d,p+"enter",u,n,i)).target=f,c.relatedTarget=h,m=c),h=m,l&&u)e:{for(d=u,p=0,f=c=l;f;f=$r(f))p++;for(f=0,m=d;m;m=$r(m))f++;for(;0<p-f;)c=$r(c),p--;for(;0<f-p;)d=$r(d),f--;for(;p--;){if(c===d||null!==d&&c===d.alternate)break e;c=$r(c),d=$r(d)}c=null}else c=null;null!==l&&Yr(o,a,l,c,!1),null!==u&&null!==h&&Yr(o,h,u,c,!0)}if("select"===(l=(a=r?bi(r):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var g=Kn;else if(Hn(a))if(Zn)g=or;else{g=ir;var y=rr}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(g=sr);switch(g&&(g=g(e,r))?Wn(o,g,n,i):(y&&y(e,a,r),"focusout"===e&&(y=a._wrapperState)&&y.controlled&&"number"===a.type&&ee(a,"number",a.value)),y=r?bi(r):window,e){case"focusin":(Hn(y)||"true"===y.contentEditable)&&(gr=y,yr=r,vr=null);break;case"focusout":vr=yr=gr=null;break;case"mousedown":xr=!0;break;case"contextmenu":case"mouseup":case"dragend":xr=!1,br(o,n,i);break;case"selectionchange":if(mr)break;case"keydown":case"keyup":br(o,n,i)}var v;if(Fn)e:{switch(e){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else Gn?jn(e,n)&&(x="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(x="onCompositionStart");x&&(Bn&&"ko"!==n.locale&&(Gn||"onCompositionStart"!==x?"onCompositionEnd"===x&&Gn&&(v=en()):(Qt="value"in(Zt=i)?Zt.value:Zt.textContent,Gn=!0)),0<(y=Xr(r,x)).length&&(x=new bn(x,e,null,n,i),o.push({event:x,listeners:y}),(v||null!==(v=Un(n)))&&(x.data=v))),(v=Ln?function(e,t){switch(e){case"compositionend":return Un(t);case"keypress":return 32!==t.which?null:(zn=!0,On);case"textInput":return(e=t.data)===On&&zn?null:e;default:return null}}(e,n):function(e,t){if(Gn)return"compositionend"===e||!Fn&&jn(e,t)?(e=en(),Jt=Qt=Zt=null,Gn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Bn&&"ko"!==t.locale?null:t.data}}(e,n))&&0<(r=Xr(r,"onBeforeInput")).length&&(i=new bn("onBeforeInput","beforeinput",null,n,i),o.push({event:i,listeners:r}),i.data=v)}Or(o,t)}))}function Wr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Xr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,s=i.stateNode;5===i.tag&&null!==s&&(i=s,null!=(s=Ie(e,n))&&r.unshift(Wr(e,s,i)),null!=(s=Ie(e,t))&&r.push(Wr(e,s,i))),e=e.return}return r}function $r(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Yr(e,t,n,r,i){for(var s=t._reactName,o=[];null!==n&&n!==r;){var a=n,l=a.alternate,u=a.stateNode;if(null!==l&&l===r)break;5===a.tag&&null!==u&&(a=u,i?null!=(l=Ie(n,s))&&o.unshift(Wr(n,l,a)):i||null!=(l=Ie(n,s))&&o.push(Wr(n,l,a))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var qr=/\r\n?/g,Kr=/\u0000|\uFFFD/g;function Zr(e){return("string"==typeof e?e:""+e).replace(qr,"\n").replace(Kr,"")}function Qr(e,t,n){if(t=Zr(t),Zr(e)!==t&&n)throw Error(s(425))}function Jr(){}var ei=null,ti=null;function ni(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ri="function"==typeof setTimeout?setTimeout:void 0,ii="function"==typeof clearTimeout?clearTimeout:void 0,si="function"==typeof Promise?Promise:void 0,oi="function"==typeof queueMicrotask?queueMicrotask:void 0!==si?function(e){return si.resolve(null).then(e).catch(ai)}:ri;function ai(e){setTimeout((function(){throw e}))}function li(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void Gt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);Gt(t)}function ui(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ci(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var hi=Math.random().toString(36).slice(2),di="__reactFiber$"+hi,fi="__reactProps$"+hi,pi="__reactContainer$"+hi,mi="__reactEvents$"+hi,gi="__reactListeners$"+hi,yi="__reactHandles$"+hi;function vi(e){var t=e[di];if(t)return t;for(var n=e.parentNode;n;){if(t=n[pi]||n[di]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ci(e);null!==e;){if(n=e[di])return n;e=ci(e)}return t}n=(e=n).parentNode}return null}function xi(e){return!(e=e[di]||e[pi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function bi(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function wi(e){return e[fi]||null}var Si=[],_i=-1;function Ti(e){return{current:e}}function Ei(e){0>_i||(e.current=Si[_i],Si[_i]=null,_i--)}function Ci(e,t){_i++,Si[_i]=e.current,e.current=t}var ki={},Ai=Ti(ki),Mi=Ti(!1),Pi=ki;function Ri(e,t){var n=e.type.contextTypes;if(!n)return ki;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,s={};for(i in n)s[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function Ii(e){return null!=e.childContextTypes}function Di(){Ei(Mi),Ei(Ai)}function Fi(e,t,n){if(Ai.current!==ki)throw Error(s(168));Ci(Ai,t),Ci(Mi,n)}function Ni(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(s(108,V(e)||"Unknown",i));return B({},n,r)}function Li(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ki,Pi=Ai.current,Ci(Ai,e),Ci(Mi,Mi.current),!0}function Bi(e,t,n){var r=e.stateNode;if(!r)throw Error(s(169));n?(e=Ni(e,t,Pi),r.__reactInternalMemoizedMergedChildContext=e,Ei(Mi),Ei(Ai),Ci(Ai,e)):Ei(Mi),Ci(Mi,n)}var Oi=null,zi=!1,ji=!1;function Ui(e){null===Oi?Oi=[e]:Oi.push(e)}function Gi(){if(!ji&&null!==Oi){ji=!0;var e=0,t=xt;try{var n=Oi;for(xt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Oi=null,zi=!1}catch(t){throw null!==Oi&&(Oi=Oi.slice(e+1)),$e(Je,Gi),t}finally{xt=t,ji=!1}}return null}var Vi=[],Hi=0,Wi=null,Xi=0,$i=[],Yi=0,qi=null,Ki=1,Zi="";function Qi(e,t){Vi[Hi++]=Xi,Vi[Hi++]=Wi,Wi=e,Xi=t}function Ji(e,t,n){$i[Yi++]=Ki,$i[Yi++]=Zi,$i[Yi++]=qi,qi=e;var r=Ki;e=Zi;var i=32-ot(r)-1;r&=~(1<<i),n+=1;var s=32-ot(t)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Ki=1<<32-ot(t)+i|n<<i|r,Zi=s+e}else Ki=1<<s|n<<i|r,Zi=e}function es(e){null!==e.return&&(Qi(e,1),Ji(e,1,0))}function ts(e){for(;e===Wi;)Wi=Vi[--Hi],Vi[Hi]=null,Xi=Vi[--Hi],Vi[Hi]=null;for(;e===qi;)qi=$i[--Yi],$i[Yi]=null,Zi=$i[--Yi],$i[Yi]=null,Ki=$i[--Yi],$i[Yi]=null}var ns=null,rs=null,is=!1,ss=null;function os(e,t){var n=Iu(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function as(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ns=e,rs=ui(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ns=e,rs=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==qi?{id:Ki,overflow:Zi}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Iu(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ns=e,rs=null,!0);default:return!1}}function ls(e){return!(!(1&e.mode)||128&e.flags)}function us(e){if(is){var t=rs;if(t){var n=t;if(!as(e,t)){if(ls(e))throw Error(s(418));t=ui(n.nextSibling);var r=ns;t&&as(e,t)?os(r,n):(e.flags=-4097&e.flags|2,is=!1,ns=e)}}else{if(ls(e))throw Error(s(418));e.flags=-4097&e.flags|2,is=!1,ns=e}}}function cs(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ns=e}function hs(e){if(e!==ns)return!1;if(!is)return cs(e),is=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ni(e.type,e.memoizedProps)),t&&(t=rs)){if(ls(e))throw ds(),Error(s(418));for(;t;)os(e,t),t=ui(t.nextSibling)}if(cs(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){rs=ui(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}rs=null}}else rs=ns?ui(e.stateNode.nextSibling):null;return!0}function ds(){for(var e=rs;e;)e=ui(e.nextSibling)}function fs(){rs=ns=null,is=!1}function ps(e){null===ss?ss=[e]:ss.push(e)}var ms=b.ReactCurrentBatchConfig;function gs(e,t){if(e&&e.defaultProps){for(var n in t=B({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var ys=Ti(null),vs=null,xs=null,bs=null;function ws(){bs=xs=vs=null}function Ss(e){var t=ys.current;Ei(ys),e._currentValue=t}function _s(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ts(e,t){vs=e,bs=xs=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(!!(e.lanes&t)&&(ba=!0),e.firstContext=null)}function Es(e){var t=e._currentValue;if(bs!==e)if(e={context:e,memoizedValue:t,next:null},null===xs){if(null===vs)throw Error(s(308));xs=e,vs.dependencies={lanes:0,firstContext:e}}else xs=xs.next=e;return t}var Cs=null;function ks(e){null===Cs?Cs=[e]:Cs.push(e)}function As(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,ks(t)):(n.next=i.next,i.next=n),t.interleaved=n,Ms(e,r)}function Ms(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Ps=!1;function Rs(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Is(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ds(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Fs(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,2&Ml){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,Ms(e,n)}return null===(i=r.interleaved)?(t.next=t,ks(r)):(t.next=i.next,i.next=t),r.interleaved=t,Ms(e,n)}function Ns(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}function Ls(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,s=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===s?i=s=o:s=s.next=o,n=n.next}while(null!==n);null===s?i=s=t:s=s.next=t}else i=s=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Bs(e,t,n,r){var i=e.updateQueue;Ps=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(null!==a){i.shared.pending=null;var l=a,u=l.next;l.next=null,null===o?s=u:o.next=u,o=l;var c=e.alternate;null!==c&&(a=(c=c.updateQueue).lastBaseUpdate)!==o&&(null===a?c.firstBaseUpdate=u:a.next=u,c.lastBaseUpdate=l)}if(null!==s){var h=i.baseState;for(o=0,c=u=l=null,a=s;;){var d=a.lane,f=a.eventTime;if((r&d)===d){null!==c&&(c=c.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=e,m=a;switch(d=t,f=n,m.tag){case 1:if("function"==typeof(p=m.payload)){h=p.call(f,h,d);break e}h=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null==(d="function"==typeof(p=m.payload)?p.call(f,h,d):p))break e;h=B({},h,d);break e;case 2:Ps=!0}}null!==a.callback&&0!==a.lane&&(e.flags|=64,null===(d=i.effects)?i.effects=[a]:d.push(a))}else f={eventTime:f,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===c?(u=c=f,l=h):c=c.next=f,o|=d;if(null===(a=a.next)){if(null===(a=i.shared.pending))break;a=(d=a).next,d.next=null,i.lastBaseUpdate=d,i.shared.pending=null}}if(null===c&&(l=h),i.baseState=l,i.firstBaseUpdate=u,i.lastBaseUpdate=c,null!==(t=i.shared.interleaved)){i=t;do{o|=i.lane,i=i.next}while(i!==t)}else null===s&&(i.shared.lanes=0);Bl|=o,e.lanes=o,e.memoizedState=h}}function Os(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!=typeof i)throw Error(s(191,i));i.call(r)}}}var zs=(new r.Component).refs;function js(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:B({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Us={isMounted:function(e){return!!(e=e._reactInternals)&&Ge(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=tu(),i=nu(e),s=Ds(r,i);s.payload=t,null!=n&&(s.callback=n),null!==(t=Fs(e,s,i))&&(ru(t,e,i,r),Ns(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=tu(),i=nu(e),s=Ds(r,i);s.tag=1,s.payload=t,null!=n&&(s.callback=n),null!==(t=Fs(e,s,i))&&(ru(t,e,i,r),Ns(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tu(),r=nu(e),i=Ds(n,r);i.tag=2,null!=t&&(i.callback=t),null!==(t=Fs(e,i,r))&&(ru(t,e,r,n),Ns(t,e,r))}};function Gs(e,t,n,r,i,s,o){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,s,o):!(t.prototype&&t.prototype.isPureReactComponent&&lr(n,r)&&lr(i,s))}function Vs(e,t,n){var r=!1,i=ki,s=t.contextType;return"object"==typeof s&&null!==s?s=Es(s):(i=Ii(t)?Pi:Ai.current,s=(r=null!=(r=t.contextTypes))?Ri(e,i):ki),t=new t(n,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Us,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=s),t}function Hs(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Us.enqueueReplaceState(t,t.state,null)}function Ws(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=zs,Rs(e);var s=t.contextType;"object"==typeof s&&null!==s?i.context=Es(s):(s=Ii(t)?Pi:Ai.current,i.context=Ri(e,s)),i.state=e.memoizedState,"function"==typeof(s=t.getDerivedStateFromProps)&&(js(e,t,s,n),i.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(t=i.state,"function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&Us.enqueueReplaceState(i,i.state,null),Bs(e,n,i,r),i.state=e.memoizedState),"function"==typeof i.componentDidMount&&(e.flags|=4194308)}function Xs(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var r=n.stateNode}if(!r)throw Error(s(147,e));var i=r,o=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=i.refs;t===zs&&(t=i.refs={}),null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!=typeof e)throw Error(s(284));if(!n._owner)throw Error(s(290,e))}return e}function $s(e,t){throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Ys(e){return(0,e._init)(e._payload)}function qs(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Fu(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Ou(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function u(e,t,n,r){var s=n.type;return s===_?h(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===s||"object"==typeof s&&null!==s&&s.$$typeof===I&&Ys(s)===t.type)?((r=i(t,n.props)).ref=Xs(e,t,n),r.return=e,r):((r=Nu(n.type,n.key,n.props,null,e.mode,r)).ref=Xs(e,t,n),r.return=e,r)}function c(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=zu(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function h(e,t,n,r,s){return null===t||7!==t.tag?((t=Lu(n,e.mode,r,s)).return=e,t):((t=i(t,n)).return=e,t)}function d(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=Ou(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Nu(t.type,t.key,t.props,null,e.mode,n)).ref=Xs(e,null,t),n.return=e,n;case S:return(t=zu(t,e.mode,n)).return=e,t;case I:return d(e,(0,t._init)(t._payload),n)}if(te(t)||N(t))return(t=Lu(t,e.mode,n,null)).return=e,t;$s(e,t)}return null}function f(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==i?null:l(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===i?u(e,t,n,r):null;case S:return n.key===i?c(e,t,n,r):null;case I:return f(e,t,(i=n._init)(n._payload),r)}if(te(n)||N(n))return null!==i?null:h(e,t,n,r,null);$s(e,n)}return null}function p(e,t,n,r,i){if("string"==typeof r&&""!==r||"number"==typeof r)return l(t,e=e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case w:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i);case S:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case I:return p(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||N(r))return h(t,e=e.get(n)||null,r,i,null);$s(t,r)}return null}function m(i,s,a,l){for(var u=null,c=null,h=s,m=s=0,g=null;null!==h&&m<a.length;m++){h.index>m?(g=h,h=null):g=h.sibling;var y=f(i,h,a[m],l);if(null===y){null===h&&(h=g);break}e&&h&&null===y.alternate&&t(i,h),s=o(y,s,m),null===c?u=y:c.sibling=y,c=y,h=g}if(m===a.length)return n(i,h),is&&Qi(i,m),u;if(null===h){for(;m<a.length;m++)null!==(h=d(i,a[m],l))&&(s=o(h,s,m),null===c?u=h:c.sibling=h,c=h);return is&&Qi(i,m),u}for(h=r(i,h);m<a.length;m++)null!==(g=p(h,i,m,a[m],l))&&(e&&null!==g.alternate&&h.delete(null===g.key?m:g.key),s=o(g,s,m),null===c?u=g:c.sibling=g,c=g);return e&&h.forEach((function(e){return t(i,e)})),is&&Qi(i,m),u}function g(i,a,l,u){var c=N(l);if("function"!=typeof c)throw Error(s(150));if(null==(l=c.call(l)))throw Error(s(151));for(var h=c=null,m=a,g=a=0,y=null,v=l.next();null!==m&&!v.done;g++,v=l.next()){m.index>g?(y=m,m=null):y=m.sibling;var x=f(i,m,v.value,u);if(null===x){null===m&&(m=y);break}e&&m&&null===x.alternate&&t(i,m),a=o(x,a,g),null===h?c=x:h.sibling=x,h=x,m=y}if(v.done)return n(i,m),is&&Qi(i,g),c;if(null===m){for(;!v.done;g++,v=l.next())null!==(v=d(i,v.value,u))&&(a=o(v,a,g),null===h?c=v:h.sibling=v,h=v);return is&&Qi(i,g),c}for(m=r(i,m);!v.done;g++,v=l.next())null!==(v=p(m,i,g,v.value,u))&&(e&&null!==v.alternate&&m.delete(null===v.key?g:v.key),a=o(v,a,g),null===h?c=v:h.sibling=v,h=v);return e&&m.forEach((function(e){return t(i,e)})),is&&Qi(i,g),c}return function e(r,s,o,l){if("object"==typeof o&&null!==o&&o.type===_&&null===o.key&&(o=o.props.children),"object"==typeof o&&null!==o){switch(o.$$typeof){case w:e:{for(var u=o.key,c=s;null!==c;){if(c.key===u){if((u=o.type)===_){if(7===c.tag){n(r,c.sibling),(s=i(c,o.props.children)).return=r,r=s;break e}}else if(c.elementType===u||"object"==typeof u&&null!==u&&u.$$typeof===I&&Ys(u)===c.type){n(r,c.sibling),(s=i(c,o.props)).ref=Xs(r,c,o),s.return=r,r=s;break e}n(r,c);break}t(r,c),c=c.sibling}o.type===_?((s=Lu(o.props.children,r.mode,l,o.key)).return=r,r=s):((l=Nu(o.type,o.key,o.props,null,r.mode,l)).ref=Xs(r,s,o),l.return=r,r=l)}return a(r);case S:e:{for(c=o.key;null!==s;){if(s.key===c){if(4===s.tag&&s.stateNode.containerInfo===o.containerInfo&&s.stateNode.implementation===o.implementation){n(r,s.sibling),(s=i(s,o.children||[])).return=r,r=s;break e}n(r,s);break}t(r,s),s=s.sibling}(s=zu(o,r.mode,l)).return=r,r=s}return a(r);case I:return e(r,s,(c=o._init)(o._payload),l)}if(te(o))return m(r,s,o,l);if(N(o))return g(r,s,o,l);$s(r,o)}return"string"==typeof o&&""!==o||"number"==typeof o?(o=""+o,null!==s&&6===s.tag?(n(r,s.sibling),(s=i(s,o)).return=r,r=s):(n(r,s),(s=Ou(o,r.mode,l)).return=r,r=s),a(r)):n(r,s)}}var Ks=qs(!0),Zs=qs(!1),Qs={},Js=Ti(Qs),eo=Ti(Qs),to=Ti(Qs);function no(e){if(e===Qs)throw Error(s(174));return e}function ro(e,t){switch(Ci(to,t),Ci(eo,e),Ci(Js,Qs),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ei(Js),Ci(Js,t)}function io(){Ei(Js),Ei(eo),Ei(to)}function so(e){no(to.current);var t=no(Js.current),n=le(t,e.type);t!==n&&(Ci(eo,e),Ci(Js,n))}function oo(e){eo.current===e&&(Ei(Js),Ei(eo))}var ao=Ti(0);function lo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(128&t.flags)return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var uo=[];function co(){for(var e=0;e<uo.length;e++)uo[e]._workInProgressVersionPrimary=null;uo.length=0}var ho=b.ReactCurrentDispatcher,fo=b.ReactCurrentBatchConfig,po=0,mo=null,go=null,yo=null,vo=!1,xo=!1,bo=0,wo=0;function So(){throw Error(s(321))}function _o(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ar(e[n],t[n]))return!1;return!0}function To(e,t,n,r,i,o){if(po=o,mo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ho.current=null===e||null===e.memoizedState?aa:la,e=n(r,i),xo){o=0;do{if(xo=!1,bo=0,25<=o)throw Error(s(301));o+=1,yo=go=null,t.updateQueue=null,ho.current=ua,e=n(r,i)}while(xo)}if(ho.current=oa,t=null!==go&&null!==go.next,po=0,yo=go=mo=null,vo=!1,t)throw Error(s(300));return e}function Eo(){var e=0!==bo;return bo=0,e}function Co(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===yo?mo.memoizedState=yo=e:yo=yo.next=e,yo}function ko(){if(null===go){var e=mo.alternate;e=null!==e?e.memoizedState:null}else e=go.next;var t=null===yo?mo.memoizedState:yo.next;if(null!==t)yo=t,go=e;else{if(null===e)throw Error(s(310));e={memoizedState:(go=e).memoizedState,baseState:go.baseState,baseQueue:go.baseQueue,queue:go.queue,next:null},null===yo?mo.memoizedState=yo=e:yo=yo.next=e}return yo}function Ao(e,t){return"function"==typeof t?t(e):t}function Mo(e){var t=ko(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=go,i=r.baseQueue,o=n.pending;if(null!==o){if(null!==i){var a=i.next;i.next=o.next,o.next=a}r.baseQueue=i=o,n.pending=null}if(null!==i){o=i.next,r=r.baseState;var l=a=null,u=null,c=o;do{var h=c.lane;if((po&h)===h)null!==u&&(u=u.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:e(r,c.action);else{var d={lane:h,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};null===u?(l=u=d,a=r):u=u.next=d,mo.lanes|=h,Bl|=h}c=c.next}while(null!==c&&c!==o);null===u?a=r:u.next=l,ar(r,t.memoizedState)||(ba=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=u,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{o=i.lane,mo.lanes|=o,Bl|=o,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Po(e){var t=ko(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,o=t.memoizedState;if(null!==i){n.pending=null;var a=i=i.next;do{o=e(o,a.action),a=a.next}while(a!==i);ar(o,t.memoizedState)||(ba=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function Ro(){}function Io(e,t){var n=mo,r=ko(),i=t(),o=!ar(r.memoizedState,i);if(o&&(r.memoizedState=i,ba=!0),r=r.queue,Ho(No.bind(null,n,r,e),[e]),r.getSnapshot!==t||o||null!==yo&&1&yo.memoizedState.tag){if(n.flags|=2048,zo(9,Fo.bind(null,n,r,i,t),void 0,null),null===Pl)throw Error(s(349));30&po||Do(n,t,i)}return i}function Do(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=mo.updateQueue)?(t={lastEffect:null,stores:null},mo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Fo(e,t,n,r){t.value=n,t.getSnapshot=r,Lo(t)&&Bo(e)}function No(e,t,n){return n((function(){Lo(t)&&Bo(e)}))}function Lo(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!ar(e,n)}catch(e){return!0}}function Bo(e){var t=Ms(e,1);null!==t&&ru(t,e,1,-1)}function Oo(e){var t=Co();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ao,lastRenderedState:e},t.queue=e,e=e.dispatch=na.bind(null,mo,e),[t.memoizedState,e]}function zo(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=mo.updateQueue)?(t={lastEffect:null,stores:null},mo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function jo(){return ko().memoizedState}function Uo(e,t,n,r){var i=Co();mo.flags|=e,i.memoizedState=zo(1|t,n,void 0,void 0===r?null:r)}function Go(e,t,n,r){var i=ko();r=void 0===r?null:r;var s=void 0;if(null!==go){var o=go.memoizedState;if(s=o.destroy,null!==r&&_o(r,o.deps))return void(i.memoizedState=zo(t,n,s,r))}mo.flags|=e,i.memoizedState=zo(1|t,n,s,r)}function Vo(e,t){return Uo(8390656,8,e,t)}function Ho(e,t){return Go(2048,8,e,t)}function Wo(e,t){return Go(4,2,e,t)}function Xo(e,t){return Go(4,4,e,t)}function $o(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Yo(e,t,n){return n=null!=n?n.concat([e]):null,Go(4,4,$o.bind(null,t,e),n)}function qo(){}function Ko(e,t){var n=ko();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&_o(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Zo(e,t){var n=ko();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&_o(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Qo(e,t,n){return 21&po?(ar(n,t)||(n=mt(),mo.lanes|=n,Bl|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,ba=!0),e.memoizedState=n)}function Jo(e,t){var n=xt;xt=0!==n&&4>n?n:4,e(!0);var r=fo.transition;fo.transition={};try{e(!1),t()}finally{xt=n,fo.transition=r}}function ea(){return ko().memoizedState}function ta(e,t,n){var r=nu(e);n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},ra(e)?ia(t,n):null!==(n=As(e,t,n,r))&&(ru(n,e,r,tu()),sa(n,t,r))}function na(e,t,n){var r=nu(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(ra(e))ia(t,i);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var o=t.lastRenderedState,a=s(o,n);if(i.hasEagerState=!0,i.eagerState=a,ar(a,o)){var l=t.interleaved;return null===l?(i.next=i,ks(t)):(i.next=l.next,l.next=i),void(t.interleaved=i)}}catch(e){}null!==(n=As(e,t,i,r))&&(ru(n,e,r,i=tu()),sa(n,t,r))}}function ra(e){var t=e.alternate;return e===mo||null!==t&&t===mo}function ia(e,t){xo=vo=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function sa(e,t,n){if(4194240&n){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}var oa={readContext:Es,useCallback:So,useContext:So,useEffect:So,useImperativeHandle:So,useInsertionEffect:So,useLayoutEffect:So,useMemo:So,useReducer:So,useRef:So,useState:So,useDebugValue:So,useDeferredValue:So,useTransition:So,useMutableSource:So,useSyncExternalStore:So,useId:So,unstable_isNewReconciler:!1},aa={readContext:Es,useCallback:function(e,t){return Co().memoizedState=[e,void 0===t?null:t],e},useContext:Es,useEffect:Vo,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,Uo(4194308,4,$o.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Uo(4194308,4,e,t)},useInsertionEffect:function(e,t){return Uo(4,2,e,t)},useMemo:function(e,t){var n=Co();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Co();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=ta.bind(null,mo,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Co().memoizedState=e},useState:Oo,useDebugValue:qo,useDeferredValue:function(e){return Co().memoizedState=e},useTransition:function(){var e=Oo(!1),t=e[0];return e=Jo.bind(null,e[1]),Co().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=mo,i=Co();if(is){if(void 0===n)throw Error(s(407));n=n()}else{if(n=t(),null===Pl)throw Error(s(349));30&po||Do(r,t,n)}i.memoizedState=n;var o={value:n,getSnapshot:t};return i.queue=o,Vo(No.bind(null,r,o,e),[e]),r.flags|=2048,zo(9,Fo.bind(null,r,o,n,t),void 0,null),n},useId:function(){var e=Co(),t=Pl.identifierPrefix;if(is){var n=Zi;t=":"+t+"R"+(n=(Ki&~(1<<32-ot(Ki)-1)).toString(32)+n),0<(n=bo++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=wo++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},la={readContext:Es,useCallback:Ko,useContext:Es,useEffect:Ho,useImperativeHandle:Yo,useInsertionEffect:Wo,useLayoutEffect:Xo,useMemo:Zo,useReducer:Mo,useRef:jo,useState:function(){return Mo(Ao)},useDebugValue:qo,useDeferredValue:function(e){return Qo(ko(),go.memoizedState,e)},useTransition:function(){return[Mo(Ao)[0],ko().memoizedState]},useMutableSource:Ro,useSyncExternalStore:Io,useId:ea,unstable_isNewReconciler:!1},ua={readContext:Es,useCallback:Ko,useContext:Es,useEffect:Ho,useImperativeHandle:Yo,useInsertionEffect:Wo,useLayoutEffect:Xo,useMemo:Zo,useReducer:Po,useRef:jo,useState:function(){return Po(Ao)},useDebugValue:qo,useDeferredValue:function(e){var t=ko();return null===go?t.memoizedState=e:Qo(t,go.memoizedState,e)},useTransition:function(){return[Po(Ao)[0],ko().memoizedState]},useMutableSource:Ro,useSyncExternalStore:Io,useId:ea,unstable_isNewReconciler:!1};function ca(e,t){try{var n="",r=t;do{n+=U(r),r=r.return}while(r);var i=n}catch(e){i="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:i,digest:null}}function ha(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function da(e,t){try{console.error(t.value)}catch(e){setTimeout((function(){throw e}))}}var fa="function"==typeof WeakMap?WeakMap:Map;function pa(e,t,n){(n=Ds(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Wl||(Wl=!0,Xl=r),da(0,t)},n}function ma(e,t,n){(n=Ds(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){da(0,t)}}var s=e.stateNode;return null!==s&&"function"==typeof s.componentDidCatch&&(n.callback=function(){da(0,t),"function"!=typeof r&&(null===$l?$l=new Set([this]):$l.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ga(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new fa;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=Cu.bind(null,e,t,n),t.then(e,e))}function ya(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function va(e,t,n,r,i){return 1&e.mode?(e.flags|=65536,e.lanes=i,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Ds(-1,1)).tag=2,Fs(n,t,1))),n.lanes|=1),e)}var xa=b.ReactCurrentOwner,ba=!1;function wa(e,t,n,r){t.child=null===e?Zs(t,null,n,r):Ks(t,e.child,n,r)}function Sa(e,t,n,r,i){n=n.render;var s=t.ref;return Ts(t,i),r=To(e,t,n,r,s,i),n=Eo(),null===e||ba?(is&&n&&es(t),t.flags|=1,wa(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Wa(e,t,i))}function _a(e,t,n,r,i){if(null===e){var s=n.type;return"function"!=typeof s||Du(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Nu(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,Ta(e,t,s,r,i))}if(s=e.child,!(e.lanes&i)){var o=s.memoizedProps;if((n=null!==(n=n.compare)?n:lr)(o,r)&&e.ref===t.ref)return Wa(e,t,i)}return t.flags|=1,(e=Fu(s,r)).ref=t.ref,e.return=t,t.child=e}function Ta(e,t,n,r,i){if(null!==e){var s=e.memoizedProps;if(lr(s,r)&&e.ref===t.ref){if(ba=!1,t.pendingProps=r=s,!(e.lanes&i))return t.lanes=e.lanes,Wa(e,t,i);131072&e.flags&&(ba=!0)}}return ka(e,t,n,r,i)}function Ea(e,t,n){var r=t.pendingProps,i=r.children,s=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(1&t.mode){if(!(1073741824&n))return e=null!==s?s.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ci(Fl,Dl),Dl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==s?s.baseLanes:n,Ci(Fl,Dl),Dl|=r}else t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ci(Fl,Dl),Dl|=n;else null!==s?(r=s.baseLanes|n,t.memoizedState=null):r=n,Ci(Fl,Dl),Dl|=r;return wa(e,t,i,n),t.child}function Ca(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function ka(e,t,n,r,i){var s=Ii(n)?Pi:Ai.current;return s=Ri(t,s),Ts(t,i),n=To(e,t,n,r,s,i),r=Eo(),null===e||ba?(is&&r&&es(t),t.flags|=1,wa(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Wa(e,t,i))}function Aa(e,t,n,r,i){if(Ii(n)){var s=!0;Li(t)}else s=!1;if(Ts(t,i),null===t.stateNode)Ha(e,t),Vs(t,n,r),Ws(t,n,r,i),r=!0;else if(null===e){var o=t.stateNode,a=t.memoizedProps;o.props=a;var l=o.context,u=n.contextType;u="object"==typeof u&&null!==u?Es(u):Ri(t,u=Ii(n)?Pi:Ai.current);var c=n.getDerivedStateFromProps,h="function"==typeof c||"function"==typeof o.getSnapshotBeforeUpdate;h||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(a!==r||l!==u)&&Hs(t,o,r,u),Ps=!1;var d=t.memoizedState;o.state=d,Bs(t,r,o,i),l=t.memoizedState,a!==r||d!==l||Mi.current||Ps?("function"==typeof c&&(js(t,n,c,r),l=t.memoizedState),(a=Ps||Gs(t,n,a,r,d,l,u))?(h||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||("function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"==typeof o.componentDidMount&&(t.flags|=4194308)):("function"==typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):("function"==typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,Is(e,t),a=t.memoizedProps,u=t.type===t.elementType?a:gs(t.type,a),o.props=u,h=t.pendingProps,d=o.context,l="object"==typeof(l=n.contextType)&&null!==l?Es(l):Ri(t,l=Ii(n)?Pi:Ai.current);var f=n.getDerivedStateFromProps;(c="function"==typeof f||"function"==typeof o.getSnapshotBeforeUpdate)||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(a!==h||d!==l)&&Hs(t,o,r,l),Ps=!1,d=t.memoizedState,o.state=d,Bs(t,r,o,i);var p=t.memoizedState;a!==h||d!==p||Mi.current||Ps?("function"==typeof f&&(js(t,n,f,r),p=t.memoizedState),(u=Ps||Gs(t,n,u,r,d,p,l)||!1)?(c||"function"!=typeof o.UNSAFE_componentWillUpdate&&"function"!=typeof o.componentWillUpdate||("function"==typeof o.componentWillUpdate&&o.componentWillUpdate(r,p,l),"function"==typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,p,l)),"function"==typeof o.componentDidUpdate&&(t.flags|=4),"function"==typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof o.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),o.props=r,o.state=p,o.context=l,r=u):("function"!=typeof o.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return Ma(e,t,n,r,s,i)}function Ma(e,t,n,r,i,s){Ca(e,t);var o=!!(128&t.flags);if(!r&&!o)return i&&Bi(t,n,!1),Wa(e,t,s);r=t.stateNode,xa.current=t;var a=o&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=Ks(t,e.child,null,s),t.child=Ks(t,null,a,s)):wa(e,t,a,s),t.memoizedState=r.state,i&&Bi(t,n,!0),t.child}function Pa(e){var t=e.stateNode;t.pendingContext?Fi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Fi(0,t.context,!1),ro(e,t.containerInfo)}function Ra(e,t,n,r,i){return fs(),ps(i),t.flags|=256,wa(e,t,n,r),t.child}var Ia,Da,Fa,Na,La={dehydrated:null,treeContext:null,retryLane:0};function Ba(e){return{baseLanes:e,cachePool:null,transitions:null}}function Oa(e,t,n){var r,i=t.pendingProps,o=ao.current,a=!1,l=!!(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&!!(2&o)),r?(a=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Ci(ao,1&o),null===e)return us(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(1&t.mode?"$!"===e.data?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(l=i.children,e=i.fallback,a?(i=t.mode,a=t.child,l={mode:"hidden",children:l},1&i||null===a?a=Bu(l,i,0,null):(a.childLanes=0,a.pendingProps=l),e=Lu(e,i,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=Ba(n),t.memoizedState=La,e):za(t,l));if(null!==(o=e.memoizedState)&&null!==(r=o.dehydrated))return function(e,t,n,r,i,o,a){if(n)return 256&t.flags?(t.flags&=-257,ja(e,t,a,r=ha(Error(s(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=r.fallback,i=t.mode,r=Bu({mode:"visible",children:r.children},i,0,null),(o=Lu(o,i,a,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,1&t.mode&&Ks(t,e.child,null,a),t.child.memoizedState=Ba(a),t.memoizedState=La,o);if(!(1&t.mode))return ja(e,t,a,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var l=r.dgst;return r=l,ja(e,t,a,r=ha(o=Error(s(419)),r,void 0))}if(l=!!(a&e.childLanes),ba||l){if(null!==(r=Pl)){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=i&(r.suspendedLanes|a)?0:i)&&i!==o.retryLane&&(o.retryLane=i,Ms(e,i),ru(r,e,i,-1))}return gu(),ja(e,t,a,r=ha(Error(s(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Au.bind(null,e),i._reactRetry=t,null):(e=o.treeContext,rs=ui(i.nextSibling),ns=t,is=!0,ss=null,null!==e&&($i[Yi++]=Ki,$i[Yi++]=Zi,$i[Yi++]=qi,Ki=e.id,Zi=e.overflow,qi=t),(t=za(t,r.children)).flags|=4096,t)}(e,t,l,i,r,o,n);if(a){a=i.fallback,l=t.mode,r=(o=e.child).sibling;var u={mode:"hidden",children:i.children};return 1&l||t.child===o?(i=Fu(o,u)).subtreeFlags=14680064&o.subtreeFlags:((i=t.child).childLanes=0,i.pendingProps=u,t.deletions=null),null!==r?a=Fu(r,a):(a=Lu(a,l,n,null)).flags|=2,a.return=t,i.return=t,i.sibling=a,t.child=i,i=a,a=t.child,l=null===(l=e.child.memoizedState)?Ba(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},a.memoizedState=l,a.childLanes=e.childLanes&~n,t.memoizedState=La,i}return e=(a=e.child).sibling,i=Fu(a,{mode:"visible",children:i.children}),!(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function za(e,t){return(t=Bu({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function ja(e,t,n,r){return null!==r&&ps(r),Ks(t,e.child,null,n),(e=za(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Ua(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),_s(e.return,t,n)}function Ga(e,t,n,r,i){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function Va(e,t,n){var r=t.pendingProps,i=r.revealOrder,s=r.tail;if(wa(e,t,r.children,n),2&(r=ao.current))r=1&r|2,t.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Ua(e,n,t);else if(19===e.tag)Ua(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ci(ao,r),1&t.mode)switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===lo(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Ga(t,!1,i,n,s);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===lo(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Ga(t,!0,n,null,s);break;case"together":Ga(t,!1,null,null,void 0);break;default:t.memoizedState=null}else t.memoizedState=null;return t.child}function Ha(e,t){!(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Wa(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Bl|=t.lanes,!(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=Fu(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Fu(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Xa(e,t){if(!is)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function $a(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Ya(e,t,n){var r=t.pendingProps;switch(ts(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $a(t),null;case 1:case 17:return Ii(t.type)&&Di(),$a(t),null;case 3:return r=t.stateNode,io(),Ei(Mi),Ei(Ai),co(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(hs(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,null!==ss&&(au(ss),ss=null))),Da(e,t),$a(t),null;case 5:oo(t);var i=no(to.current);if(n=t.type,null!==e&&null!=t.stateNode)Fa(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(s(166));return $a(t),null}if(e=no(Js.current),hs(t)){r=t.stateNode,n=t.type;var o=t.memoizedProps;switch(r[di]=t,r[fi]=o,e=!!(1&t.mode),n){case"dialog":zr("cancel",r),zr("close",r);break;case"iframe":case"object":case"embed":zr("load",r);break;case"video":case"audio":for(i=0;i<Nr.length;i++)zr(Nr[i],r);break;case"source":zr("error",r);break;case"img":case"image":case"link":zr("error",r),zr("load",r);break;case"details":zr("toggle",r);break;case"input":K(r,o),zr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},zr("invalid",r);break;case"textarea":ie(r,o),zr("invalid",r)}for(var l in ve(n,o),i=null,o)if(o.hasOwnProperty(l)){var u=o[l];"children"===l?"string"==typeof u?r.textContent!==u&&(!0!==o.suppressHydrationWarning&&Qr(r.textContent,u,e),i=["children",u]):"number"==typeof u&&r.textContent!==""+u&&(!0!==o.suppressHydrationWarning&&Qr(r.textContent,u,e),i=["children",""+u]):a.hasOwnProperty(l)&&null!=u&&"onScroll"===l&&zr("scroll",r)}switch(n){case"input":X(r),J(r,o,!0);break;case"textarea":X(r),oe(r);break;case"select":case"option":break;default:"function"==typeof o.onClick&&(r.onclick=Jr)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ae(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof r.is?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),"select"===n&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[di]=t,e[fi]=r,Ia(e,t,!1,!1),t.stateNode=e;e:{switch(l=xe(n,r),n){case"dialog":zr("cancel",e),zr("close",e),i=r;break;case"iframe":case"object":case"embed":zr("load",e),i=r;break;case"video":case"audio":for(i=0;i<Nr.length;i++)zr(Nr[i],e);i=r;break;case"source":zr("error",e),i=r;break;case"img":case"image":case"link":zr("error",e),zr("load",e),i=r;break;case"details":zr("toggle",e),i=r;break;case"input":K(e,r),i=q(e,r),zr("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=B({},r,{value:void 0}),zr("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),zr("invalid",e)}for(o in ve(n,i),u=i)if(u.hasOwnProperty(o)){var c=u[o];"style"===o?ge(e,c):"dangerouslySetInnerHTML"===o?null!=(c=c?c.__html:void 0)&&he(e,c):"children"===o?"string"==typeof c?("textarea"!==n||""!==c)&&de(e,c):"number"==typeof c&&de(e,""+c):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(a.hasOwnProperty(o)?null!=c&&"onScroll"===o&&zr("scroll",e):null!=c&&x(e,o,c,l))}switch(n){case"input":X(e),J(e,r,!1);break;case"textarea":X(e),oe(e);break;case"option":null!=r.value&&e.setAttribute("value",""+H(r.value));break;case"select":e.multiple=!!r.multiple,null!=(o=r.value)?ne(e,!!r.multiple,o,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"==typeof i.onClick&&(e.onclick=Jr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return $a(t),null;case 6:if(e&&null!=t.stateNode)Na(e,t,e.memoizedProps,r);else{if("string"!=typeof r&&null===t.stateNode)throw Error(s(166));if(n=no(to.current),no(Js.current),hs(t)){if(r=t.stateNode,n=t.memoizedProps,r[di]=t,(o=r.nodeValue!==n)&&null!==(e=ns))switch(e.tag){case 3:Qr(r.nodeValue,n,!!(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Qr(r.nodeValue,n,!!(1&e.mode))}o&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[di]=t,t.stateNode=r}return $a(t),null;case 13:if(Ei(ao),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(is&&null!==rs&&1&t.mode&&!(128&t.flags))ds(),fs(),t.flags|=98560,o=!1;else if(o=hs(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(s(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(s(317));o[di]=t}else fs(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;$a(t),o=!1}else null!==ss&&(au(ss),ss=null),o=!0;if(!o)return 65536&t.flags?t:null}return 128&t.flags?(t.lanes=n,t):((r=null!==r)!=(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,1&t.mode&&(null===e||1&ao.current?0===Nl&&(Nl=3):gu())),null!==t.updateQueue&&(t.flags|=4),$a(t),null);case 4:return io(),Da(e,t),null===e&&Gr(t.stateNode.containerInfo),$a(t),null;case 10:return Ss(t.type._context),$a(t),null;case 19:if(Ei(ao),null===(o=t.memoizedState))return $a(t),null;if(r=!!(128&t.flags),null===(l=o.rendering))if(r)Xa(o,!1);else{if(0!==Nl||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(l=lo(e))){for(t.flags|=128,Xa(o,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(o=n).flags&=14680066,null===(l=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ci(ao,1&ao.current|2),t.child}e=e.sibling}null!==o.tail&&Ze()>Vl&&(t.flags|=128,r=!0,Xa(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=lo(l))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Xa(o,!0),null===o.tail&&"hidden"===o.tailMode&&!l.alternate&&!is)return $a(t),null}else 2*Ze()-o.renderingStartTime>Vl&&1073741824!==n&&(t.flags|=128,r=!0,Xa(o,!1),t.lanes=4194304);o.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=o.last)?n.sibling=l:t.child=l,o.last=l)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Ze(),t.sibling=null,n=ao.current,Ci(ao,r?1&n|2:1&n),t):($a(t),null);case 22:case 23:return du(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&1&t.mode?!!(1073741824&Dl)&&($a(t),6&t.subtreeFlags&&(t.flags|=8192)):$a(t),null;case 24:case 25:return null}throw Error(s(156,t.tag))}function qa(e,t){switch(ts(t),t.tag){case 1:return Ii(t.type)&&Di(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return io(),Ei(Mi),Ei(Ai),co(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 5:return oo(t),null;case 13:if(Ei(ao),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));fs()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ei(ao),null;case 4:return io(),null;case 10:return Ss(t.type._context),null;case 22:case 23:return du(),null;default:return null}}Ia=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Da=function(){},Fa=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,no(Js.current);var s,o=null;switch(n){case"input":i=q(e,i),r=q(e,r),o=[];break;case"select":i=B({},i,{value:void 0}),r=B({},r,{value:void 0}),o=[];break;case"textarea":i=re(e,i),r=re(e,r),o=[];break;default:"function"!=typeof i.onClick&&"function"==typeof r.onClick&&(e.onclick=Jr)}for(c in ve(n,r),n=null,i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&null!=i[c])if("style"===c){var l=i[c];for(s in l)l.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else"dangerouslySetInnerHTML"!==c&&"children"!==c&&"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&"autoFocus"!==c&&(a.hasOwnProperty(c)?o||(o=[]):(o=o||[]).push(c,null));for(c in r){var u=r[c];if(l=null!=i?i[c]:void 0,r.hasOwnProperty(c)&&u!==l&&(null!=u||null!=l))if("style"===c)if(l){for(s in l)!l.hasOwnProperty(s)||u&&u.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in u)u.hasOwnProperty(s)&&l[s]!==u[s]&&(n||(n={}),n[s]=u[s])}else n||(o||(o=[]),o.push(c,n)),n=u;else"dangerouslySetInnerHTML"===c?(u=u?u.__html:void 0,l=l?l.__html:void 0,null!=u&&l!==u&&(o=o||[]).push(c,u)):"children"===c?"string"!=typeof u&&"number"!=typeof u||(o=o||[]).push(c,""+u):"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&(a.hasOwnProperty(c)?(null!=u&&"onScroll"===c&&zr("scroll",e),o||l===u||(o=[])):(o=o||[]).push(c,u))}n&&(o=o||[]).push("style",n);var c=o;(t.updateQueue=c)&&(t.flags|=4)}},Na=function(e,t,n,r){n!==r&&(t.flags|=4)};var Ka=!1,Za=!1,Qa="function"==typeof WeakSet?WeakSet:Set,Ja=null;function el(e,t){var n=e.ref;if(null!==n)if("function"==typeof n)try{n(null)}catch(n){Eu(e,t,n)}else n.current=null}function tl(e,t,n){try{n()}catch(n){Eu(e,t,n)}}var nl=!1;function rl(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var s=i.destroy;i.destroy=void 0,void 0!==s&&tl(t,n,s)}i=i.next}while(i!==r)}}function il(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function sl(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"==typeof t?t(e):t.current=e}}function ol(e){var t=e.alternate;null!==t&&(e.alternate=null,ol(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&null!==(t=e.stateNode)&&(delete t[di],delete t[fi],delete t[mi],delete t[gi],delete t[yi]),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ll(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ul(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=Jr));else if(4!==r&&null!==(e=e.child))for(ul(e,t,n),e=e.sibling;null!==e;)ul(e,t,n),e=e.sibling}function cl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}var hl=null,dl=!1;function fl(e,t,n){for(n=n.child;null!==n;)pl(e,t,n),n=n.sibling}function pl(e,t,n){if(st&&"function"==typeof st.onCommitFiberUnmount)try{st.onCommitFiberUnmount(it,n)}catch(e){}switch(n.tag){case 5:Za||el(n,t);case 6:var r=hl,i=dl;hl=null,fl(e,t,n),dl=i,null!==(hl=r)&&(dl?(e=hl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):hl.removeChild(n.stateNode));break;case 18:null!==hl&&(dl?(e=hl,n=n.stateNode,8===e.nodeType?li(e.parentNode,n):1===e.nodeType&&li(e,n),Gt(e)):li(hl,n.stateNode));break;case 4:r=hl,i=dl,hl=n.stateNode.containerInfo,dl=!0,fl(e,t,n),hl=r,dl=i;break;case 0:case 11:case 14:case 15:if(!Za&&null!==(r=n.updateQueue)&&null!==(r=r.lastEffect)){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,void 0!==o&&(2&s||4&s)&&tl(n,t,o),i=i.next}while(i!==r)}fl(e,t,n);break;case 1:if(!Za&&(el(n,t),"function"==typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(e){Eu(n,t,e)}fl(e,t,n);break;case 21:fl(e,t,n);break;case 22:1&n.mode?(Za=(r=Za)||null!==n.memoizedState,fl(e,t,n),Za=r):fl(e,t,n);break;default:fl(e,t,n)}}function ml(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Qa),t.forEach((function(t){var r=Mu.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function gl(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var o=e,a=t,l=a;e:for(;null!==l;){switch(l.tag){case 5:hl=l.stateNode,dl=!1;break e;case 3:case 4:hl=l.stateNode.containerInfo,dl=!0;break e}l=l.return}if(null===hl)throw Error(s(160));pl(o,a,i),hl=null,dl=!1;var u=i.alternate;null!==u&&(u.return=null),i.return=null}catch(e){Eu(i,t,e)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)yl(t,e),t=t.sibling}function yl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(gl(t,e),vl(e),4&r){try{rl(3,e,e.return),il(3,e)}catch(t){Eu(e,e.return,t)}try{rl(5,e,e.return)}catch(t){Eu(e,e.return,t)}}break;case 1:gl(t,e),vl(e),512&r&&null!==n&&el(n,n.return);break;case 5:if(gl(t,e),vl(e),512&r&&null!==n&&el(n,n.return),32&e.flags){var i=e.stateNode;try{de(i,"")}catch(t){Eu(e,e.return,t)}}if(4&r&&null!=(i=e.stateNode)){var o=e.memoizedProps,a=null!==n?n.memoizedProps:o,l=e.type,u=e.updateQueue;if(e.updateQueue=null,null!==u)try{"input"===l&&"radio"===o.type&&null!=o.name&&Z(i,o),xe(l,a);var c=xe(l,o);for(a=0;a<u.length;a+=2){var h=u[a],d=u[a+1];"style"===h?ge(i,d):"dangerouslySetInnerHTML"===h?he(i,d):"children"===h?de(i,d):x(i,h,d,c)}switch(l){case"input":Q(i,o);break;case"textarea":se(i,o);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var p=o.value;null!=p?ne(i,!!o.multiple,p,!1):f!==!!o.multiple&&(null!=o.defaultValue?ne(i,!!o.multiple,o.defaultValue,!0):ne(i,!!o.multiple,o.multiple?[]:"",!1))}i[fi]=o}catch(t){Eu(e,e.return,t)}}break;case 6:if(gl(t,e),vl(e),4&r){if(null===e.stateNode)throw Error(s(162));i=e.stateNode,o=e.memoizedProps;try{i.nodeValue=o}catch(t){Eu(e,e.return,t)}}break;case 3:if(gl(t,e),vl(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Gt(t.containerInfo)}catch(t){Eu(e,e.return,t)}break;case 4:default:gl(t,e),vl(e);break;case 13:gl(t,e),vl(e),8192&(i=e.child).flags&&(o=null!==i.memoizedState,i.stateNode.isHidden=o,!o||null!==i.alternate&&null!==i.alternate.memoizedState||(Gl=Ze())),4&r&&ml(e);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&e.mode?(Za=(c=Za)||h,gl(t,e),Za=c):gl(t,e),vl(e),8192&r){if(c=null!==e.memoizedState,(e.stateNode.isHidden=c)&&!h&&1&e.mode)for(Ja=e,h=e.child;null!==h;){for(d=Ja=h;null!==Ja;){switch(p=(f=Ja).child,f.tag){case 0:case 11:case 14:case 15:rl(4,f,f.return);break;case 1:el(f,f.return);var m=f.stateNode;if("function"==typeof m.componentWillUnmount){r=f,n=f.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(e){Eu(r,n,e)}}break;case 5:el(f,f.return);break;case 22:if(null!==f.memoizedState){Sl(d);continue}}null!==p?(p.return=f,Ja=p):Sl(d)}h=h.sibling}e:for(h=null,d=e;;){if(5===d.tag){if(null===h){h=d;try{i=d.stateNode,c?"function"==typeof(o=i.style).setProperty?o.setProperty("display","none","important"):o.display="none":(l=d.stateNode,a=null!=(u=d.memoizedProps.style)&&u.hasOwnProperty("display")?u.display:null,l.style.display=me("display",a))}catch(t){Eu(e,e.return,t)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(t){Eu(e,e.return,t)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:gl(t,e),vl(e),4&r&&ml(e);case 21:}}function vl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(al(n)){var r=n;break e}n=n.return}throw Error(s(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(de(i,""),r.flags&=-33),cl(e,ll(e),i);break;case 3:case 4:var o=r.stateNode.containerInfo;ul(e,ll(e),o);break;default:throw Error(s(161))}}catch(t){Eu(e,e.return,t)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function xl(e,t,n){Ja=e,bl(e,t,n)}function bl(e,t,n){for(var r=!!(1&e.mode);null!==Ja;){var i=Ja,s=i.child;if(22===i.tag&&r){var o=null!==i.memoizedState||Ka;if(!o){var a=i.alternate,l=null!==a&&null!==a.memoizedState||Za;a=Ka;var u=Za;if(Ka=o,(Za=l)&&!u)for(Ja=i;null!==Ja;)l=(o=Ja).child,22===o.tag&&null!==o.memoizedState?_l(i):null!==l?(l.return=o,Ja=l):_l(i);for(;null!==s;)Ja=s,bl(s,t,n),s=s.sibling;Ja=i,Ka=a,Za=u}wl(e)}else 8772&i.subtreeFlags&&null!==s?(s.return=i,Ja=s):wl(e)}}function wl(e){for(;null!==Ja;){var t=Ja;if(8772&t.flags){var n=t.alternate;try{if(8772&t.flags)switch(t.tag){case 0:case 11:case 15:Za||il(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Za)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:gs(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Os(t,o,r);break;case 3:var a=t.updateQueue;if(null!==a){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Os(t,a,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var u=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var c=t.alternate;if(null!==c){var h=c.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&Gt(d)}}}break;default:throw Error(s(163))}Za||512&t.flags&&sl(t)}catch(e){Eu(t,t.return,e)}}if(t===e){Ja=null;break}if(null!==(n=t.sibling)){n.return=t.return,Ja=n;break}Ja=t.return}}function Sl(e){for(;null!==Ja;){var t=Ja;if(t===e){Ja=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Ja=n;break}Ja=t.return}}function _l(e){for(;null!==Ja;){var t=Ja;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{il(4,t)}catch(e){Eu(t,n,e)}break;case 1:var r=t.stateNode;if("function"==typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(e){Eu(t,i,e)}}var s=t.return;try{sl(t)}catch(e){Eu(t,s,e)}break;case 5:var o=t.return;try{sl(t)}catch(e){Eu(t,o,e)}}}catch(e){Eu(t,t.return,e)}if(t===e){Ja=null;break}var a=t.sibling;if(null!==a){a.return=t.return,Ja=a;break}Ja=t.return}}var Tl,El=Math.ceil,Cl=b.ReactCurrentDispatcher,kl=b.ReactCurrentOwner,Al=b.ReactCurrentBatchConfig,Ml=0,Pl=null,Rl=null,Il=0,Dl=0,Fl=Ti(0),Nl=0,Ll=null,Bl=0,Ol=0,zl=0,jl=null,Ul=null,Gl=0,Vl=1/0,Hl=null,Wl=!1,Xl=null,$l=null,Yl=!1,ql=null,Kl=0,Zl=0,Ql=null,Jl=-1,eu=0;function tu(){return 6&Ml?Ze():-1!==Jl?Jl:Jl=Ze()}function nu(e){return 1&e.mode?2&Ml&&0!==Il?Il&-Il:null!==ms.transition?(0===eu&&(eu=mt()),eu):0!==(e=xt)?e:e=void 0===(e=window.event)?16:Kt(e.type):1}function ru(e,t,n,r){if(50<Zl)throw Zl=0,Ql=null,Error(s(185));yt(e,n,r),2&Ml&&e===Pl||(e===Pl&&(!(2&Ml)&&(Ol|=n),4===Nl&&lu(e,Il)),iu(e,r),1===n&&0===Ml&&!(1&t.mode)&&(Vl=Ze()+500,zi&&Gi()))}function iu(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,s=e.pendingLanes;0<s;){var o=31-ot(s),a=1<<o,l=i[o];-1===l?a&n&&!(a&r)||(i[o]=ft(a,t)):l<=t&&(e.expiredLanes|=a),s&=~a}}(e,t);var r=dt(e,e===Pl?Il:0);if(0===r)null!==n&&Ye(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ye(n),1===t)0===e.tag?function(e){zi=!0,Ui(e)}(uu.bind(null,e)):Ui(uu.bind(null,e)),oi((function(){!(6&Ml)&&Gi()})),n=null;else{switch(bt(r)){case 1:n=Je;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Pu(n,su.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function su(e,t){if(Jl=-1,eu=0,6&Ml)throw Error(s(327));var n=e.callbackNode;if(_u()&&e.callbackNode!==n)return null;var r=dt(e,e===Pl?Il:0);if(0===r)return null;if(30&r||r&e.expiredLanes||t)t=yu(e,r);else{t=r;var i=Ml;Ml|=2;var o=mu();for(Pl===e&&Il===t||(Hl=null,Vl=Ze()+500,fu(e,t));;)try{xu();break}catch(t){pu(e,t)}ws(),Cl.current=o,Ml=i,null!==Rl?t=0:(Pl=null,Il=0,t=Nl)}if(0!==t){if(2===t&&0!==(i=pt(e))&&(r=i,t=ou(e,i)),1===t)throw n=Ll,fu(e,0),lu(e,r),iu(e,Ze()),n;if(6===t)lu(e,r);else{if(i=e.current.alternate,!(30&r||function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!ar(s(),i))return!1}catch(e){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)||(t=yu(e,r),2===t&&(o=pt(e),0!==o&&(r=o,t=ou(e,o))),1!==t)))throw n=Ll,fu(e,0),lu(e,r),iu(e,Ze()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(s(345));case 2:case 5:Su(e,Ul,Hl);break;case 3:if(lu(e,r),(130023424&r)===r&&10<(t=Gl+500-Ze())){if(0!==dt(e,0))break;if(((i=e.suspendedLanes)&r)!==r){tu(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(Su.bind(null,e,Ul,Hl),t);break}Su(e,Ul,Hl);break;case 4:if(lu(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var a=31-ot(r);o=1<<a,(a=t[a])>i&&(i=a),r&=~o}if(r=i,10<(r=(120>(r=Ze()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*El(r/1960))-r)){e.timeoutHandle=ri(Su.bind(null,e,Ul,Hl),r);break}Su(e,Ul,Hl);break;default:throw Error(s(329))}}}return iu(e,Ze()),e.callbackNode===n?su.bind(null,e):null}function ou(e,t){var n=jl;return e.current.memoizedState.isDehydrated&&(fu(e,t).flags|=256),2!==(e=yu(e,t))&&(t=Ul,Ul=n,null!==t&&au(t)),e}function au(e){null===Ul?Ul=e:Ul.push.apply(Ul,e)}function lu(e,t){for(t&=~zl,t&=~Ol,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ot(t),r=1<<n;e[n]=-1,t&=~r}}function uu(e){if(6&Ml)throw Error(s(327));_u();var t=dt(e,0);if(!(1&t))return iu(e,Ze()),null;var n=yu(e,t);if(0!==e.tag&&2===n){var r=pt(e);0!==r&&(t=r,n=ou(e,r))}if(1===n)throw n=Ll,fu(e,0),lu(e,t),iu(e,Ze()),n;if(6===n)throw Error(s(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Su(e,Ul,Hl),iu(e,Ze()),null}function cu(e,t){var n=Ml;Ml|=1;try{return e(t)}finally{0===(Ml=n)&&(Vl=Ze()+500,zi&&Gi())}}function hu(e){null!==ql&&0===ql.tag&&!(6&Ml)&&_u();var t=Ml;Ml|=1;var n=Al.transition,r=xt;try{if(Al.transition=null,xt=1,e)return e()}finally{xt=r,Al.transition=n,!(6&(Ml=t))&&Gi()}}function du(){Dl=Fl.current,Ei(Fl)}function fu(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ii(n)),null!==Rl)for(n=Rl.return;null!==n;){var r=n;switch(ts(r),r.tag){case 1:null!=(r=r.type.childContextTypes)&&Di();break;case 3:io(),Ei(Mi),Ei(Ai),co();break;case 5:oo(r);break;case 4:io();break;case 13:case 19:Ei(ao);break;case 10:Ss(r.type._context);break;case 22:case 23:du()}n=n.return}if(Pl=e,Rl=e=Fu(e.current,null),Il=Dl=t,Nl=0,Ll=null,zl=Ol=Bl=0,Ul=jl=null,null!==Cs){for(t=0;t<Cs.length;t++)if(null!==(r=(n=Cs[t]).interleaved)){n.interleaved=null;var i=r.next,s=n.pending;if(null!==s){var o=s.next;s.next=i,r.next=o}n.pending=r}Cs=null}return e}function pu(e,t){for(;;){var n=Rl;try{if(ws(),ho.current=oa,vo){for(var r=mo.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}vo=!1}if(po=0,yo=go=mo=null,xo=!1,bo=0,kl.current=null,null===n||null===n.return){Nl=1,Ll=t,Rl=null;break}e:{var o=e,a=n.return,l=n,u=t;if(t=Il,l.flags|=32768,null!==u&&"object"==typeof u&&"function"==typeof u.then){var c=u,h=l,d=h.tag;if(!(1&h.mode||0!==d&&11!==d&&15!==d)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=ya(a);if(null!==p){p.flags&=-257,va(p,a,l,0,t),1&p.mode&&ga(o,c,t),u=c;var m=(t=p).updateQueue;if(null===m){var g=new Set;g.add(u),t.updateQueue=g}else m.add(u);break e}if(!(1&t)){ga(o,c,t),gu();break e}u=Error(s(426))}else if(is&&1&l.mode){var y=ya(a);if(null!==y){!(65536&y.flags)&&(y.flags|=256),va(y,a,l,0,t),ps(ca(u,l));break e}}o=u=ca(u,l),4!==Nl&&(Nl=2),null===jl?jl=[o]:jl.push(o),o=a;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Ls(o,pa(0,u,t));break e;case 1:l=u;var v=o.type,x=o.stateNode;if(!(128&o.flags||"function"!=typeof v.getDerivedStateFromError&&(null===x||"function"!=typeof x.componentDidCatch||null!==$l&&$l.has(x)))){o.flags|=65536,t&=-t,o.lanes|=t,Ls(o,ma(o,l,t));break e}}o=o.return}while(null!==o)}wu(n)}catch(e){t=e,Rl===n&&null!==n&&(Rl=n=n.return);continue}break}}function mu(){var e=Cl.current;return Cl.current=oa,null===e?oa:e}function gu(){0!==Nl&&3!==Nl&&2!==Nl||(Nl=4),null===Pl||!(268435455&Bl)&&!(268435455&Ol)||lu(Pl,Il)}function yu(e,t){var n=Ml;Ml|=2;var r=mu();for(Pl===e&&Il===t||(Hl=null,fu(e,t));;)try{vu();break}catch(t){pu(e,t)}if(ws(),Ml=n,Cl.current=r,null!==Rl)throw Error(s(261));return Pl=null,Il=0,Nl}function vu(){for(;null!==Rl;)bu(Rl)}function xu(){for(;null!==Rl&&!qe();)bu(Rl)}function bu(e){var t=Tl(e.alternate,e,Dl);e.memoizedProps=e.pendingProps,null===t?wu(e):Rl=t,kl.current=null}function wu(e){var t=e;do{var n=t.alternate;if(e=t.return,32768&t.flags){if(null!==(n=qa(n,t)))return n.flags&=32767,void(Rl=n);if(null===e)return Nl=6,void(Rl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}else if(null!==(n=Ya(n,t,Dl)))return void(Rl=n);if(null!==(t=t.sibling))return void(Rl=t);Rl=t=e}while(null!==t);0===Nl&&(Nl=5)}function Su(e,t,n){var r=xt,i=Al.transition;try{Al.transition=null,xt=1,function(e,t,n,r){do{_u()}while(null!==ql);if(6&Ml)throw Error(s(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(s(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-ot(n),s=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~s}}(e,o),e===Pl&&(Rl=Pl=null,Il=0),!(2064&n.subtreeFlags)&&!(2064&n.flags)||Yl||(Yl=!0,Pu(tt,(function(){return _u(),null}))),o=!!(15990&n.flags),15990&n.subtreeFlags||o){o=Al.transition,Al.transition=null;var a=xt;xt=1;var l=Ml;Ml|=4,kl.current=null,function(e,t){if(ei=Ht,fr(e=dr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch(e){n=null;break e}var a=0,l=-1,u=-1,c=0,h=0,d=e,f=null;t:for(;;){for(var p;d!==n||0!==i&&3!==d.nodeType||(l=a+i),d!==o||0!==r&&3!==d.nodeType||(u=a+r),3===d.nodeType&&(a+=d.nodeValue.length),null!==(p=d.firstChild);)f=d,d=p;for(;;){if(d===e)break t;if(f===n&&++c===i&&(l=a),f===o&&++h===r&&(u=a),null!==(p=d.nextSibling))break;f=(d=f).parentNode}d=p}n=-1===l||-1===u?null:{start:l,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(ti={focusedElem:e,selectionRange:n},Ht=!1,Ja=t;null!==Ja;)if(e=(t=Ja).child,1028&t.subtreeFlags&&null!==e)e.return=t,Ja=e;else for(;null!==Ja;){t=Ja;try{var m=t.alternate;if(1024&t.flags)switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,y=m.memoizedState,v=t.stateNode,x=v.getSnapshotBeforeUpdate(t.elementType===t.type?g:gs(t.type,g),y);v.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var b=t.stateNode.containerInfo;1===b.nodeType?b.textContent="":9===b.nodeType&&b.documentElement&&b.removeChild(b.documentElement);break;default:throw Error(s(163))}}catch(e){Eu(t,t.return,e)}if(null!==(e=t.sibling)){e.return=t.return,Ja=e;break}Ja=t.return}m=nl,nl=!1}(e,n),yl(n,e),pr(ti),Ht=!!ei,ti=ei=null,e.current=n,xl(n,e,i),Ke(),Ml=l,xt=a,Al.transition=o}else e.current=n;if(Yl&&(Yl=!1,ql=e,Kl=i),0===(o=e.pendingLanes)&&($l=null),function(e){if(st&&"function"==typeof st.onCommitFiberRoot)try{st.onCommitFiberRoot(it,e,void 0,!(128&~e.current.flags))}catch(e){}}(n.stateNode),iu(e,Ze()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)r((i=t[n]).value,{componentStack:i.stack,digest:i.digest});if(Wl)throw Wl=!1,e=Xl,Xl=null,e;!!(1&Kl)&&0!==e.tag&&_u(),1&(o=e.pendingLanes)?e===Ql?Zl++:(Zl=0,Ql=e):Zl=0,Gi()}(e,t,n,r)}finally{Al.transition=i,xt=r}return null}function _u(){if(null!==ql){var e=bt(Kl),t=Al.transition,n=xt;try{if(Al.transition=null,xt=16>e?16:e,null===ql)var r=!1;else{if(e=ql,ql=null,Kl=0,6&Ml)throw Error(s(331));var i=Ml;for(Ml|=4,Ja=e.current;null!==Ja;){var o=Ja,a=o.child;if(16&Ja.flags){var l=o.deletions;if(null!==l){for(var u=0;u<l.length;u++){var c=l[u];for(Ja=c;null!==Ja;){var h=Ja;switch(h.tag){case 0:case 11:case 15:rl(8,h,o)}var d=h.child;if(null!==d)d.return=h,Ja=d;else for(;null!==Ja;){var f=(h=Ja).sibling,p=h.return;if(ol(h),h===c){Ja=null;break}if(null!==f){f.return=p,Ja=f;break}Ja=p}}}var m=o.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(null!==g)}}Ja=o}}if(2064&o.subtreeFlags&&null!==a)a.return=o,Ja=a;else e:for(;null!==Ja;){if(2048&(o=Ja).flags)switch(o.tag){case 0:case 11:case 15:rl(9,o,o.return)}var v=o.sibling;if(null!==v){v.return=o.return,Ja=v;break e}Ja=o.return}}var x=e.current;for(Ja=x;null!==Ja;){var b=(a=Ja).child;if(2064&a.subtreeFlags&&null!==b)b.return=a,Ja=b;else e:for(a=x;null!==Ja;){if(2048&(l=Ja).flags)try{switch(l.tag){case 0:case 11:case 15:il(9,l)}}catch(e){Eu(l,l.return,e)}if(l===a){Ja=null;break e}var w=l.sibling;if(null!==w){w.return=l.return,Ja=w;break e}Ja=l.return}}if(Ml=i,Gi(),st&&"function"==typeof st.onPostCommitFiberRoot)try{st.onPostCommitFiberRoot(it,e)}catch(e){}r=!0}return r}finally{xt=n,Al.transition=t}}return!1}function Tu(e,t,n){e=Fs(e,t=pa(0,t=ca(n,t),1),1),t=tu(),null!==e&&(yt(e,1,t),iu(e,t))}function Eu(e,t,n){if(3===e.tag)Tu(e,e,n);else for(;null!==t;){if(3===t.tag){Tu(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===$l||!$l.has(r))){t=Fs(t,e=ma(t,e=ca(n,e),1),1),e=tu(),null!==t&&(yt(t,1,e),iu(t,e));break}}t=t.return}}function Cu(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=tu(),e.pingedLanes|=e.suspendedLanes&n,Pl===e&&(Il&n)===n&&(4===Nl||3===Nl&&(130023424&Il)===Il&&500>Ze()-Gl?fu(e,0):zl|=n),iu(e,t)}function ku(e,t){0===t&&(1&e.mode?(t=ct,!(130023424&(ct<<=1))&&(ct=4194304)):t=1);var n=tu();null!==(e=Ms(e,t))&&(yt(e,t,n),iu(e,n))}function Au(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),ku(e,n)}function Mu(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(s(314))}null!==r&&r.delete(t),ku(e,n)}function Pu(e,t){return $e(e,t)}function Ru(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Iu(e,t,n,r){return new Ru(e,t,n,r)}function Du(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Fu(e,t){var n=e.alternate;return null===n?((n=Iu(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Nu(e,t,n,r,i,o){var a=2;if(r=e,"function"==typeof e)Du(e)&&(a=1);else if("string"==typeof e)a=5;else e:switch(e){case _:return Lu(n.children,i,o,t);case T:a=8,i|=8;break;case E:return(e=Iu(12,n,t,2|i)).elementType=E,e.lanes=o,e;case M:return(e=Iu(13,n,t,i)).elementType=M,e.lanes=o,e;case P:return(e=Iu(19,n,t,i)).elementType=P,e.lanes=o,e;case D:return Bu(n,i,o,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case C:a=10;break e;case k:a=9;break e;case A:a=11;break e;case R:a=14;break e;case I:a=16,r=null;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=Iu(a,n,t,i)).elementType=e,t.type=r,t.lanes=o,t}function Lu(e,t,n,r){return(e=Iu(7,e,r,t)).lanes=n,e}function Bu(e,t,n,r){return(e=Iu(22,e,r,t)).elementType=D,e.lanes=n,e.stateNode={isHidden:!1},e}function Ou(e,t,n){return(e=Iu(6,e,null,t)).lanes=n,e}function zu(e,t,n){return(t=Iu(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function ju(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Uu(e,t,n,r,i,s,o,a,l){return e=new ju(e,t,n,a,l),1===t?(t=1,!0===s&&(t|=8)):t=0,s=Iu(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Rs(s),e}function Gu(e){if(!e)return ki;e:{if(Ge(e=e._reactInternals)!==e||1!==e.tag)throw Error(s(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ii(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(s(171))}if(1===e.tag){var n=e.type;if(Ii(n))return Ni(e,n,t)}return t}function Vu(e,t,n,r,i,s,o,a,l){return(e=Uu(n,r,!0,e,0,s,0,a,l)).context=Gu(null),n=e.current,(s=Ds(r=tu(),i=nu(n))).callback=null!=t?t:null,Fs(n,s,i),e.current.lanes=i,yt(e,i,r),iu(e,r),e}function Hu(e,t,n,r){var i=t.current,s=tu(),o=nu(i);return n=Gu(n),null===t.context?t.context=n:t.pendingContext=n,(t=Ds(s,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Fs(i,t,o))&&(ru(e,i,o,s),Ns(e,i,o)),o}function Wu(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Xu(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function $u(e,t){Xu(e,t),(e=e.alternate)&&Xu(e,t)}Tl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Mi.current)ba=!0;else{if(!(e.lanes&n||128&t.flags))return ba=!1,function(e,t,n){switch(t.tag){case 3:Pa(t),fs();break;case 5:so(t);break;case 1:Ii(t.type)&&Li(t);break;case 4:ro(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Ci(ys,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ci(ao,1&ao.current),t.flags|=128,null):n&t.child.childLanes?Oa(e,t,n):(Ci(ao,1&ao.current),null!==(e=Wa(e,t,n))?e.sibling:null);Ci(ao,1&ao.current);break;case 19:if(r=!!(n&t.childLanes),128&e.flags){if(r)return Va(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ci(ao,ao.current),r)break;return null;case 22:case 23:return t.lanes=0,Ea(e,t,n)}return Wa(e,t,n)}(e,t,n);ba=!!(131072&e.flags)}else ba=!1,is&&1048576&t.flags&&Ji(t,Xi,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Ha(e,t),e=t.pendingProps;var i=Ri(t,Ai.current);Ts(t,n),i=To(null,t,r,e,i,n);var o=Eo();return t.flags|=1,"object"==typeof i&&null!==i&&"function"==typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ii(r)?(o=!0,Li(t)):o=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Rs(t),i.updater=Us,t.stateNode=i,i._reactInternals=t,Ws(t,r,e,n),t=Ma(null,t,r,!0,o,n)):(t.tag=0,is&&o&&es(t),wa(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Ha(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"==typeof e)return Du(e)?1:0;if(null!=e){if((e=e.$$typeof)===A)return 11;if(e===R)return 14}return 2}(r),e=gs(r,e),i){case 0:t=ka(null,t,r,e,n);break e;case 1:t=Aa(null,t,r,e,n);break e;case 11:t=Sa(null,t,r,e,n);break e;case 14:t=_a(null,t,r,gs(r.type,e),n);break e}throw Error(s(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,ka(e,t,r,i=t.elementType===r?i:gs(r,i),n);case 1:return r=t.type,i=t.pendingProps,Aa(e,t,r,i=t.elementType===r?i:gs(r,i),n);case 3:e:{if(Pa(t),null===e)throw Error(s(387));r=t.pendingProps,i=(o=t.memoizedState).element,Is(e,t),Bs(t,r,null,n);var a=t.memoizedState;if(r=a.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Ra(e,t,r,n,i=ca(Error(s(423)),t));break e}if(r!==i){t=Ra(e,t,r,n,i=ca(Error(s(424)),t));break e}for(rs=ui(t.stateNode.containerInfo.firstChild),ns=t,is=!0,ss=null,n=Zs(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fs(),r===i){t=Wa(e,t,n);break e}wa(e,t,r,n)}t=t.child}return t;case 5:return so(t),null===e&&us(t),r=t.type,i=t.pendingProps,o=null!==e?e.memoizedProps:null,a=i.children,ni(r,i)?a=null:null!==o&&ni(r,o)&&(t.flags|=32),Ca(e,t),wa(e,t,a,n),t.child;case 6:return null===e&&us(t),null;case 13:return Oa(e,t,n);case 4:return ro(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Ks(t,null,r,n):wa(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,Sa(e,t,r,i=t.elementType===r?i:gs(r,i),n);case 7:return wa(e,t,t.pendingProps,n),t.child;case 8:case 12:return wa(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,o=t.memoizedProps,a=i.value,Ci(ys,r._currentValue),r._currentValue=a,null!==o)if(ar(o.value,a)){if(o.children===i.children&&!Mi.current){t=Wa(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var l=o.dependencies;if(null!==l){a=o.child;for(var u=l.firstContext;null!==u;){if(u.context===r){if(1===o.tag){(u=Ds(-1,n&-n)).tag=2;var c=o.updateQueue;if(null!==c){var h=(c=c.shared).pending;null===h?u.next=u:(u.next=h.next,h.next=u),c.pending=u}}o.lanes|=n,null!==(u=o.alternate)&&(u.lanes|=n),_s(o.return,n,t),l.lanes|=n;break}u=u.next}}else if(10===o.tag)a=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(a=o.return))throw Error(s(341));a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),_s(a,n,t),a=o.sibling}else a=o.child;if(null!==a)a.return=o;else for(a=o;null!==a;){if(a===t){a=null;break}if(null!==(o=a.sibling)){o.return=a.return,a=o;break}a=a.return}o=a}wa(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,Ts(t,n),r=r(i=Es(i)),t.flags|=1,wa(e,t,r,n),t.child;case 14:return i=gs(r=t.type,t.pendingProps),_a(e,t,r,i=gs(r.type,i),n);case 15:return Ta(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:gs(r,i),Ha(e,t),t.tag=1,Ii(r)?(e=!0,Li(t)):e=!1,Ts(t,n),Vs(t,r,i),Ws(t,r,i,n),Ma(null,t,r,!0,e,n);case 19:return Va(e,t,n);case 22:return Ea(e,t,n)}throw Error(s(156,t.tag))};var Yu="function"==typeof reportError?reportError:function(e){console.error(e)};function qu(e){this._internalRoot=e}function Ku(e){this._internalRoot=e}function Zu(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Qu(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Ju(){}function ec(e,t,n,r,i){var s=n._reactRootContainer;if(s){var o=s;if("function"==typeof i){var a=i;i=function(){var e=Wu(o);a.call(e)}}Hu(t,o,e,i)}else o=function(e,t,n,r,i){if(i){if("function"==typeof r){var s=r;r=function(){var e=Wu(o);s.call(e)}}var o=Vu(t,r,e,0,null,!1,0,"",Ju);return e._reactRootContainer=o,e[pi]=o.current,Gr(8===e.nodeType?e.parentNode:e),hu(),o}for(;i=e.lastChild;)e.removeChild(i);if("function"==typeof r){var a=r;r=function(){var e=Wu(l);a.call(e)}}var l=Uu(e,0,!1,null,0,!1,0,"",Ju);return e._reactRootContainer=l,e[pi]=l.current,Gr(8===e.nodeType?e.parentNode:e),hu((function(){Hu(t,l,n,r)})),l}(n,t,e,i,r);return Wu(o)}Ku.prototype.render=qu.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));Hu(e,t,null,null)},Ku.prototype.unmount=qu.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;hu((function(){Hu(null,e,null,null)})),t[pi]=null}},Ku.prototype.unstable_scheduleHydration=function(e){if(e){var t=Tt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Dt.length&&0!==t&&t<Dt[n].priority;n++);Dt.splice(n,0,e),0===n&&Bt(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ht(t.pendingLanes);0!==n&&(vt(t,1|n),iu(t,Ze()),!(6&Ml)&&(Vl=Ze()+500,Gi()))}break;case 13:hu((function(){var t=Ms(e,1);if(null!==t){var n=tu();ru(t,e,1,n)}})),$u(e,1)}},St=function(e){if(13===e.tag){var t=Ms(e,134217728);null!==t&&ru(t,e,134217728,tu()),$u(e,134217728)}},_t=function(e){if(13===e.tag){var t=nu(e),n=Ms(e,t);null!==n&&ru(n,e,t,tu()),$u(e,t)}},Tt=function(){return xt},Et=function(e,t){var n=xt;try{return xt=e,t()}finally{xt=n}},Se=function(e,t,n){switch(t){case"input":if(Q(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=wi(r);if(!i)throw Error(s(90));$(r),Q(r,i)}}}break;case"textarea":se(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ae=cu,Me=hu;var tc={usingClientEntryPoint:!1,Events:[xi,bi,wi,Ce,ke,cu]},nc={findFiberByHostInstance:vi,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},rc={bundleType:nc.bundleType,version:nc.version,rendererPackageName:nc.rendererPackageName,rendererConfig:nc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=We(e))?null:e.stateNode},findFiberByHostInstance:nc.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ic=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ic.isDisabled&&ic.supportsFiber)try{it=ic.inject(rc),st=ic}catch(ce){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tc,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Zu(t))throw Error(s(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:S,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Zu(e))throw Error(s(299));var n=!1,r="",i=Yu;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=Uu(e,1,!1,null,0,n,0,r,i),e[pi]=t.current,Gr(8===e.nodeType?e.parentNode:e),new qu(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return null===(e=We(t))?null:e.stateNode},t.flushSync=function(e){return hu(e)},t.hydrate=function(e,t,n){if(!Qu(t))throw Error(s(200));return ec(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Zu(e))throw Error(s(405));var r=null!=n&&n.hydratedSources||null,i=!1,o="",a=Yu;if(null!=n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(a=n.onRecoverableError)),t=Vu(t,null,e,1,null!=n?n:null,i,0,o,a),e[pi]=t.current,Gr(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Ku(t)},t.render=function(e,t,n){if(!Qu(t))throw Error(s(200));return ec(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Qu(e))throw Error(s(40));return!!e._reactRootContainer&&(hu((function(){ec(null,null,e,!1,(function(){e._reactRootContainer=null,e[pi]=null}))})),!0)},t.unstable_batchedUpdates=cu,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Qu(n))throw Error(s(200));if(null==e||void 0===e._reactInternals)throw Error(s(38));return ec(e,t,n,!1,r)},t.version="18.2.0-next-9e3b772b8-20220608"},5338:(e,t,n)=>{"use strict";var r=n(961);t.H=r.createRoot,r.hydrateRoot},961:(e,t,n)=>{"use strict";!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(2551)},1020:(e,t,n)=>{"use strict";var r=n(6540),i=Symbol.for("react.element"),s=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function u(e,t,n){var r,s={},u=null,c=null;for(r in void 0!==n&&(u=""+n),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(c=t.ref),t)o.call(t,r)&&!l.hasOwnProperty(r)&&(s[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===s[r]&&(s[r]=t[r]);return{$$typeof:i,type:e,key:u,ref:c,props:s,_owner:a.current}}t.Fragment=s,t.jsx=u,t.jsxs=u},5287:(e,t)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator,p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}function v(){}function x(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=y.prototype;var b=x.prototype=new v;b.constructor=x,m(b,y.prototype),b.isPureReactComponent=!0;var w=Array.isArray,S=Object.prototype.hasOwnProperty,_={current:null},T={key:!0,ref:!0,__self:!0,__source:!0};function E(e,t,r){var i,s={},o=null,a=null;if(null!=t)for(i in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(o=""+t.key),t)S.call(t,i)&&!T.hasOwnProperty(i)&&(s[i]=t[i]);var l=arguments.length-2;if(1===l)s.children=r;else if(1<l){for(var u=Array(l),c=0;c<l;c++)u[c]=arguments[c+2];s.children=u}if(e&&e.defaultProps)for(i in l=e.defaultProps)void 0===s[i]&&(s[i]=l[i]);return{$$typeof:n,type:e,key:o,ref:a,props:s,_owner:_.current}}function C(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var k=/\/+/g;function A(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function M(e,t,i,s,o){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l=!1;if(null===e)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return o=o(l=e),e=""===s?"."+A(l,0):s,w(o)?(i="",null!=e&&(i=e.replace(k,"$&/")+"/"),M(o,t,i,"",(function(e){return e}))):null!=o&&(C(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,i+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(k,"$&/")+"/")+e)),t.push(o)),1;if(l=0,s=""===s?".":s+":",w(e))for(var u=0;u<e.length;u++){var c=s+A(a=e[u],u);l+=M(a,t,i,c,o)}else if(c=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"==typeof c)for(e=c.call(e),u=0;!(a=e.next()).done;)l+=M(a=a.value,t,i,c=s+A(a,u++),o);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function P(e,t,n){if(null==e)return e;var r=[],i=0;return M(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function R(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var I={current:null},D={transition:null},F={ReactCurrentDispatcher:I,ReactCurrentBatchConfig:D,ReactCurrentOwner:_};t.Children={map:P,forEach:function(e,t,n){P(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return P(e,(function(){t++})),t},toArray:function(e){return P(e,(function(e){return e}))||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=i,t.Profiler=o,t.PureComponent=x,t.StrictMode=s,t.Suspense=c,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=F,t.cloneElement=function(e,t,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=m({},e.props),s=e.key,o=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,a=_.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(u in t)S.call(t,u)&&!T.hasOwnProperty(u)&&(i[u]=void 0===t[u]&&void 0!==l?l[u]:t[u])}var u=arguments.length-2;if(1===u)i.children=r;else if(1<u){l=Array(u);for(var c=0;c<u;c++)l[c]=arguments[c+2];i.children=l}return{$$typeof:n,type:e.type,key:s,ref:o,props:i,_owner:a}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=E,t.createFactory=function(e){var t=E.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:u,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:R}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return I.current.useCallback(e,t)},t.useContext=function(e){return I.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return I.current.useDeferredValue(e)},t.useEffect=function(e,t){return I.current.useEffect(e,t)},t.useId=function(){return I.current.useId()},t.useImperativeHandle=function(e,t,n){return I.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return I.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return I.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return I.current.useMemo(e,t)},t.useReducer=function(e,t,n){return I.current.useReducer(e,t,n)},t.useRef=function(e){return I.current.useRef(e)},t.useState=function(e){return I.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return I.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return I.current.useTransition()},t.version="18.2.0"},6540:(e,t,n)=>{"use strict";e.exports=n(5287)},4848:(e,t,n)=>{"use strict";e.exports=n(1020)},7463:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<s(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,o=i>>>1;r<o;){var a=2*(r+1)-1,l=e[a],u=a+1,c=e[u];if(0>s(l,n))u<i&&0>s(c,l)?(e[r]=c,e[u]=n,r=u):(e[r]=l,e[a]=n,r=a);else{if(!(u<i&&0>s(c,n)))break e;e[r]=c,e[u]=n,r=u}}}return t}function s(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var u=[],c=[],h=1,d=null,f=3,p=!1,m=!1,g=!1,y="function"==typeof setTimeout?setTimeout:null,v="function"==typeof clearTimeout?clearTimeout:null,x="undefined"!=typeof setImmediate?setImmediate:null;function b(e){for(var t=r(c);null!==t;){if(null===t.callback)i(c);else{if(!(t.startTime<=e))break;i(c),t.sortIndex=t.expirationTime,n(u,t)}t=r(c)}}function w(e){if(g=!1,b(e),!m)if(null!==r(u))m=!0,D(S);else{var t=r(c);null!==t&&F(w,t.startTime-e)}}function S(e,n){m=!1,g&&(g=!1,v(C),C=-1),p=!0;var s=f;try{for(b(n),d=r(u);null!==d&&(!(d.expirationTime>n)||e&&!M());){var o=d.callback;if("function"==typeof o){d.callback=null,f=d.priorityLevel;var a=o(d.expirationTime<=n);n=t.unstable_now(),"function"==typeof a?d.callback=a:d===r(u)&&i(u),b(n)}else i(u);d=r(u)}if(null!==d)var l=!0;else{var h=r(c);null!==h&&F(w,h.startTime-n),l=!1}return l}finally{d=null,f=s,p=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var _,T=!1,E=null,C=-1,k=5,A=-1;function M(){return!(t.unstable_now()-A<k)}function P(){if(null!==E){var e=t.unstable_now();A=e;var n=!0;try{n=E(!0,e)}finally{n?_():(T=!1,E=null)}}else T=!1}if("function"==typeof x)_=function(){x(P)};else if("undefined"!=typeof MessageChannel){var R=new MessageChannel,I=R.port2;R.port1.onmessage=P,_=function(){I.postMessage(null)}}else _=function(){y(P,0)};function D(e){E=e,T||(T=!0,_())}function F(e,n){C=y((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,D(S))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return r(u)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,i,s){var o=t.unstable_now();switch(s="object"==typeof s&&null!==s&&"number"==typeof(s=s.delay)&&0<s?o+s:o,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:h++,callback:i,priorityLevel:e,startTime:s,expirationTime:a=s+a,sortIndex:-1},s>o?(e.sortIndex=s,n(c,e),null===r(u)&&e===r(c)&&(g?(v(C),C=-1):g=!0,F(w,s-o))):(e.sortIndex=a,n(u,e),m||p||(m=!0,D(S))),e},t.unstable_shouldYield=M,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},9982:(e,t,n)=>{"use strict";e.exports=n(7463)},5072:e=>{"use strict";var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var s={},o=[],a=0;a<e.length;a++){var l=e[a],u=r.base?l[0]+r.base:l[0],c=s[u]||0,h="".concat(u," ").concat(c);s[u]=c+1;var d=n(h),f={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==d)t[d].references++,t[d].updater(f);else{var p=i(f,r);r.byIndex=a,t.splice(a,0,{identifier:h,updater:p,references:1})}o.push(h)}return o}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var s=r(e=e||[],i=i||{});return function(e){e=e||[];for(var o=0;o<s.length;o++){var a=n(s[o]);t[a].references--}for(var l=r(e,i),u=0;u<s.length;u++){var c=n(s[u]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}s=l}}},40:e=>{"use strict";var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},540:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},5056:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},7825:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,i&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},1113:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},1270:function(e,t,n){var r;e=n.nmd(e),function(i){t&&t.nodeType,e&&e.nodeType;var s="object"==typeof n.g&&n.g;s.global!==s&&s.window!==s&&s.self;var o,a=2147483647,l=36,u=26,c=38,h=700,d=/^xn--/,f=/[^\x20-\x7E]/,p=/[\x2E\u3002\uFF0E\uFF61]/g,m={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},g=l-1,y=Math.floor,v=String.fromCharCode;function x(e){throw RangeError(m[e])}function b(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function w(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),r+b((e=e.replace(p,".")).split("."),t).join(".")}function S(e){for(var t,n,r=[],i=0,s=e.length;i<s;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<s?56320==(64512&(n=e.charCodeAt(i++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--):r.push(t);return r}function _(e){return b(e,(function(e){var t="";return e>65535&&(t+=v((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+v(e)})).join("")}function T(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function E(e,t,n){var r=0;for(e=n?y(e/h):e>>1,e+=y(e/t);e>g*u>>1;r+=l)e=y(e/g);return y(r+(g+1)*e/(e+c))}function C(e){var t,n,r,i,s,o,c,h,d,f,p,m=[],g=e.length,v=0,b=128,w=72;for((n=e.lastIndexOf("-"))<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&x("not-basic"),m.push(e.charCodeAt(r));for(i=n>0?n+1:0;i<g;){for(s=v,o=1,c=l;i>=g&&x("invalid-input"),((h=(p=e.charCodeAt(i++))-48<10?p-22:p-65<26?p-65:p-97<26?p-97:l)>=l||h>y((a-v)/o))&&x("overflow"),v+=h*o,!(h<(d=c<=w?1:c>=w+u?u:c-w));c+=l)o>y(a/(f=l-d))&&x("overflow"),o*=f;w=E(v-s,t=m.length+1,0==s),y(v/t)>a-b&&x("overflow"),b+=y(v/t),v%=t,m.splice(v++,0,b)}return _(m)}function k(e){var t,n,r,i,s,o,c,h,d,f,p,m,g,b,w,_=[];for(m=(e=S(e)).length,t=128,n=0,s=72,o=0;o<m;++o)(p=e[o])<128&&_.push(v(p));for(r=i=_.length,i&&_.push("-");r<m;){for(c=a,o=0;o<m;++o)(p=e[o])>=t&&p<c&&(c=p);for(c-t>y((a-n)/(g=r+1))&&x("overflow"),n+=(c-t)*g,t=c,o=0;o<m;++o)if((p=e[o])<t&&++n>a&&x("overflow"),p==t){for(h=n,d=l;!(h<(f=d<=s?1:d>=s+u?u:d-s));d+=l)w=h-f,b=l-f,_.push(v(T(f+w%b,0))),h=y(w/b);_.push(v(T(h,0))),s=E(n,g,r==i),n=0,++r}++n,++t}return _.join("")}o={version:"1.3.2",ucs2:{decode:S,encode:_},decode:C,encode:k,toASCII:function(e){return w(e,(function(e){return f.test(e)?"xn--"+k(e):e}))},toUnicode:function(e){return w(e,(function(e){return d.test(e)?C(e.slice(4).toLowerCase()):e}))}},void 0===(r=function(){return o}.call(t,n,t,e))||(e.exports=r)}()},8835:(e,t,n)=>{"use strict";var r=n(1270),i=n(2268);function s(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.qg=x,t.hd=function(e,t){return x(e,!1,!0).resolve(t)},t.GP=function(e){return i.isString(e)&&(e=x(e)),e instanceof s?e.format():s.prototype.format.call(e)};var o=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,u=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),c=["'"].concat(u),h=["%","/","?",";","#"].concat(c),d=["/","?","#"],f=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},v=n(7186);function x(e,t,n){if(e&&i.isObject(e)&&e instanceof s)return e;var r=new s;return r.parse(e,t,n),r}s.prototype.parse=function(e,t,n){if(!i.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var s=e.indexOf("?"),a=-1!==s&&s<e.indexOf("#")?"?":"#",u=e.split(a);u[0]=u[0].replace(/\\/g,"/");var x=e=u.join(a);if(x=x.trim(),!n&&1===e.split("#").length){var b=l.exec(x);if(b)return this.path=x,this.href=x,this.pathname=b[1],b[2]?(this.search=b[2],this.query=t?v.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var w=o.exec(x);if(w){var S=(w=w[0]).toLowerCase();this.protocol=S,x=x.substr(w.length)}if(n||w||x.match(/^\/\/[^@\/]+@[^@\/]+/)){var _="//"===x.substr(0,2);!_||w&&g[w]||(x=x.substr(2),this.slashes=!0)}if(!g[w]&&(_||w&&!y[w])){for(var T,E,C=-1,k=0;k<d.length;k++)-1!==(A=x.indexOf(d[k]))&&(-1===C||A<C)&&(C=A);for(-1!==(E=-1===C?x.lastIndexOf("@"):x.lastIndexOf("@",C))&&(T=x.slice(0,E),x=x.slice(E+1),this.auth=decodeURIComponent(T)),C=-1,k=0;k<h.length;k++){var A;-1!==(A=x.indexOf(h[k]))&&(-1===C||A<C)&&(C=A)}-1===C&&(C=x.length),this.host=x.slice(0,C),x=x.slice(C),this.parseHost(),this.hostname=this.hostname||"";var M="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!M)for(var P=this.hostname.split(/\./),R=(k=0,P.length);k<R;k++){var I=P[k];if(I&&!I.match(f)){for(var D="",F=0,N=I.length;F<N;F++)I.charCodeAt(F)>127?D+="x":D+=I[F];if(!D.match(f)){var L=P.slice(0,k),B=P.slice(k+1),O=I.match(p);O&&(L.push(O[1]),B.unshift(O[2])),B.length&&(x="/"+B.join(".")+x),this.hostname=L.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),M||(this.hostname=r.toASCII(this.hostname));var z=this.port?":"+this.port:"",j=this.hostname||"";this.host=j+z,this.href+=this.host,M&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==x[0]&&(x="/"+x))}if(!m[S])for(k=0,R=c.length;k<R;k++){var U=c[k];if(-1!==x.indexOf(U)){var G=encodeURIComponent(U);G===U&&(G=escape(U)),x=x.split(U).join(G)}}var V=x.indexOf("#");-1!==V&&(this.hash=x.substr(V),x=x.slice(0,V));var H=x.indexOf("?");if(-1!==H?(this.search=x.substr(H),this.query=x.substr(H+1),t&&(this.query=v.parse(this.query)),x=x.slice(0,H)):t&&(this.search="",this.query={}),x&&(this.pathname=x),y[S]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){z=this.pathname||"";var W=this.search||"";this.path=z+W}return this.href=this.format(),this},s.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",s=!1,o="";this.host?s=e+this.host:this.hostname&&(s=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(o=v.stringify(this.query));var a=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||y[t])&&!1!==s?(s="//"+(s||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):s||(s=""),r&&"#"!==r.charAt(0)&&(r="#"+r),a&&"?"!==a.charAt(0)&&(a="?"+a),t+s+(n=n.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(a=a.replace("#","%23"))+r},s.prototype.resolve=function(e){return this.resolveObject(x(e,!1,!0)).format()},s.prototype.resolveObject=function(e){if(i.isString(e)){var t=new s;t.parse(e,!1,!0),e=t}for(var n=new s,r=Object.keys(this),o=0;o<r.length;o++){var a=r[o];n[a]=this[a]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var l=Object.keys(e),u=0;u<l.length;u++){var c=l[u];"protocol"!==c&&(n[c]=e[c])}return y[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!y[e.protocol]){for(var h=Object.keys(e),d=0;d<h.length;d++){var f=h[d];n[f]=e[f]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||g[e.protocol])n.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),n.pathname=p.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var m=n.pathname||"",v=n.search||"";n.path=m+v}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var x=n.pathname&&"/"===n.pathname.charAt(0),b=e.host||e.pathname&&"/"===e.pathname.charAt(0),w=b||x||n.host&&e.pathname,S=w,_=n.pathname&&n.pathname.split("/")||[],T=(p=e.pathname&&e.pathname.split("/")||[],n.protocol&&!y[n.protocol]);if(T&&(n.hostname="",n.port=null,n.host&&(""===_[0]?_[0]=n.host:_.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),w=w&&(""===p[0]||""===_[0])),b)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,_=p;else if(p.length)_||(_=[]),_.pop(),_=_.concat(p),n.search=e.search,n.query=e.query;else if(!i.isNullOrUndefined(e.search))return T&&(n.hostname=n.host=_.shift(),(M=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=M.shift(),n.host=n.hostname=M.shift())),n.search=e.search,n.query=e.query,i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n;if(!_.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var E=_.slice(-1)[0],C=(n.host||e.host||_.length>1)&&("."===E||".."===E)||""===E,k=0,A=_.length;A>=0;A--)"."===(E=_[A])?_.splice(A,1):".."===E?(_.splice(A,1),k++):k&&(_.splice(A,1),k--);if(!w&&!S)for(;k--;k)_.unshift("..");!w||""===_[0]||_[0]&&"/"===_[0].charAt(0)||_.unshift(""),C&&"/"!==_.join("/").substr(-1)&&_.push("");var M,P=""===_[0]||_[0]&&"/"===_[0].charAt(0);return T&&(n.hostname=n.host=P?"":_.length?_.shift():"",(M=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=M.shift(),n.host=n.hostname=M.shift())),(w=w||n.host&&_.length)&&!P&&_.unshift(""),_.length?n.pathname=_.join("/"):(n.pathname=null,n.path=null),i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},s.prototype.parseHost=function(){var e=this.host,t=a.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},2268:e=>{"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},2797:(e,t,n)=>{"use strict";e.exports=n.p+"b78f3be6adabf73cde7f.ttf"},1316:(e,t,n)=>{"use strict";e.exports=n.p+"e0424c5771f87080b05e.ttf"}},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var s=r[e]={id:e,loaded:!1,exports:{}};return n[e].call(s.exports,s,s.exports,i),s.loaded=!0,s.exports}i.m=n,i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"==typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"==typeof n.then)return n}var s=Object.create(null);i.r(s);var o={};e=e||[null,t({}),t([]),t(t)];for(var a=2&r&&n;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>o[e]=()=>n[e]));return o.default=()=>n,i.d(s,o),s},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.u=e=>e+".bundle.js",i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=n[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e})(),i.b=document.baseURI||self.location.href,i.nc=void 0,(()=>{"use strict";const e={version:"0.0.5",playtest:!0,fps:60,lockFps:!1,chunkSize:40,cellSize:4,minimapSize:1600,gravity:.06*60*60,upflow:60*-.36,snapGridCellSize:4,startingResources:0,debug:{active:!1,showUnderlyingCellsInStructures:!0,drawChunks:!1,drawChunkFade:60,drawRulers:!1,showThreadLoad:!1,controls:!0,defaultBaseHue:35,brushSize:1,doNotDrawStructures:!1,stopOnDebugCellUpdate:!1,overrideLightSize:!1,overrideTerrainShadow:!1,lightSize:700,terrainShadowValue:.995,flashlight:{brightness:2,size:200,duration:100,color:[1,.5,0,1]}},conveyorDefaultSpeed:.05,useMultithreading:!0,useExperimentalRenderer:!1,obstacleBreakpoint:100,playerSize:{width:12,height:30},matrixCompression:{padding:100}};var t,n,r,s,o,a,l,u,c,h,d,f,p,m,g,y,v,x,b,w,S,_,T,E,C,k,A,M,P,R,I,D,F,N,L,B,O,z,j,U,G,V,H,W,X,$,Y;(Y=t||(t={}))[Y.Empty=0]="Empty",Y[Y.Element=1]="Element",Y[Y.SandSoil=2]="SandSoil",Y[Y.SporeSoil=3]="SporeSoil",Y[Y.Fog=4]="Fog",Y[Y.FogJetpackBlock=5]="FogJetpackBlock",Y[Y.FogWater=6]="FogWater",Y[Y.FreezingIceSoil=7]="FreezingIceSoil",Y[Y.Divider=8]="Divider",Y[Y.Grass=9]="Grass",Y[Y.Moss=10]="Moss",Y[Y.GoldSoil=11]="GoldSoil",Y[Y.Petal=12]="Petal",Y[Y.FogLava=13]="FogLava",Y[Y.Fluxite=14]="Fluxite",Y[Y.Block=15]="Block",Y[Y.SlidingBlock=16]="SlidingBlock",Y[Y.SlidingBlockLeft=17]="SlidingBlockLeft",Y[Y.SlidingBlockRight=18]="SlidingBlockRight",Y[Y.ConveyorLeft=19]="ConveyorLeft",Y[Y.ConveyorRight=20]="ConveyorRight",Y[Y.ShakerLeft=21]="ShakerLeft",Y[Y.ShakerRight=22]="ShakerRight",Y[Y.Bedrock=23]="Bedrock",Y[Y.VelocitySoaker=24]="VelocitySoaker",Y[Y.Ice=25]="Ice",Y[Y.Grower=26]="Grower",Y[Y.NascentWater=27]="NascentWater",Y[Y.SandiumSoil=28]="SandiumSoil",Y[Y.Obsidian=29]="Obsidian",Y[Y.Crackstone=30]="Crackstone",($=n||(n={}))[$.Sand=1]="Sand",$[$.Particle=2]="Particle",$[$.Water=3]="Water",$[$.WetSand=4]="WetSand",$[$.Sandium=5]="Sandium",$[$.Slag=6]="Slag",$[$.Gold=7]="Gold",$[$.Gloom=8]="Gloom",$[$.Shake=9]="Shake",$[$.Steam=10]="Steam",$[$.Fire=11]="Fire",$[$.FreezingIce=12]="FreezingIce",$[$.Flame=13]="Flame",$[$.BurntSlag=14]="BurntSlag",$[$.Spore=15]="Spore",$[$.WetSpore=16]="WetSpore",$[$.Seed=17]="Seed",$[$.Petalium=18]="Petalium",$[$.Lava=19]="Lava",$[$.Basalt=20]="Basalt",function(e){e[e.Clip=1]="Clip",e[e.Single=2]="Single",e[e.OverTime=3]="OverTime"}(r||(r={})),function(e){e[e.Bullet=1]="Bullet",e[e.Rocket=2]="Rocket",e[e.GrapplingHook=3]="GrapplingHook",e[e.Fire=4]="Fire",e[e.Bouncer=5]="Bouncer"}(s||(s={})),(X=o||(o={}))[X.Weapon=1]="Weapon",X[X.Building=2]="Building",X[X.Tool=3]="Tool",(W=a||(a={}))[W.Weapon=1]="Weapon",W[W.Tool=2]="Tool",W[W.Consumable=3]="Consumable",(H=l||(l={}))[H.Shovel=1]="Shovel",H[H.Grabber=2]="Grabber",H[H.Demolisher=3]="Demolisher",H[H.GrapplingHook=4]="GrapplingHook",H[H.Vacuum=5]="Vacuum",H[H.Gun=6]="Gun",H[H.Copier=7]="Copier",H[H.RocketLauncher=8]="RocketLauncher",H[H.Bouncer=9]="Bouncer",H[H.Shotgun=10]="Shotgun",H[H.Teleporter=11]="Teleporter",H[H.Flamethrower=12]="Flamethrower",H[H.PipeRemover=13]="PipeRemover",H[H.Hauler=14]="Hauler",H[H.Cryoblaster=15]="Cryoblaster",function(e){e[e.Start=1]="Start",e[e.Active=2]="Active",e[e.End=3]="End"}(u||(u={})),function(e){e[e.Dig=1]="Dig",e[e.Shoot=2]="Shoot",e[e.Spray=3]="Spray",e[e.Laser=4]="Laser"}(c||(c={})),function(e){e[e.Solid=1]="Solid",e[e.Liquid=2]="Liquid",e[e.Particle=3]="Particle",e[e.Gas=4]="Gas",e[e.Static=5]="Static",e[e.Slushy=6]="Slushy",e[e.Wisp=7]="Wisp"}(h||(h={})),(V=d||(d={}))[V.ConveyorLeft=1]="ConveyorLeft",V[V.ConveyorRight=2]="ConveyorRight",V[V.ShakerLeft=3]="ShakerLeft",V[V.ShakerRight=4]="ShakerRight",V[V.LauncherUp=5]="LauncherUp",V[V.LauncherLeft=6]="LauncherLeft",V[V.LauncherRight=7]="LauncherRight",V[V.SplitterLeft=8]="SplitterLeft",V[V.SplitterRight=9]="SplitterRight",V[V.Dropper=10]="Dropper",V[V.Foundation=11]="Foundation",V[V.FoundationAngledLeft=12]="FoundationAngledLeft",V[V.FoundationTriangleLeftDel=13]="FoundationTriangleLeftDel",V[V.FoundationAngledRight=14]="FoundationAngledRight",V[V.FoundationTriangleRightDel=15]="FoundationTriangleRightDel",V[V.Collector=16]="Collector",V[V.FilterLeft=17]="FilterLeft",V[V.FilterRight=18]="FilterRight",V[V.SlidingFoundation=19]="SlidingFoundation",V[V.VelocitySoaker=20]="VelocitySoaker",V[V.Grower=21]="Grower",V[V.SoundBox=22]="SoundBox",V[V.Pipe=23]="Pipe",V[V.Pump=24]="Pump",V[V.LiquidVent=25]="LiquidVent",V[V.Light=26]="Light",V[V.GloomEmitter=27]="GloomEmitter",(G=f||(f={}))[G.Init=1]="Init",G[G.RunUpdate=2]="RunUpdate",G[G.SetCell=3]="SetCell",G[G.Blast=4]="Blast",G[G.Dig=5]="Dig",G[G.Vacuum=6]="Vacuum",G[G.AddStructure=7]="AddStructure",G[G.RemoveStructuresBetween=8]="RemoveStructuresBetween",G[G.HandleGrabber=9]="HandleGrabber",G[G.SwapElement=10]="SwapElement",G[G.SetChunkActive=11]="SetChunkActive",G[G.Tally=12]="Tally",G[G.Ignite=13]="Ignite",G[G.StartFogReveal=14]="StartFogReveal",G[G.SetTutorialStep=15]="SetTutorialStep",G[G.FireProjectileHit=16]="FireProjectileHit",G[G.StartWaterFreeze=17]="StartWaterFreeze",G[G.StartMelt=18]="StartMelt",G[G.Burn=19]="Burn",G[G.Explode=20]="Explode",G[G.TriggerShockwaves=21]="TriggerShockwaves",G[G.RedrawSurroundingCells=22]="RedrawSurroundingCells",G[G.IncrementFluxite=23]="IncrementFluxite",G[G.SpawnFluxiteParticles=24]="SpawnFluxiteParticles",G[G.DebugCell=25]="DebugCell",G[G.StartLavaFreeze=26]="StartLavaFreeze",G[G.PingChunk=27]="PingChunk",G[G.QueueSetCell=28]="QueueSetCell",G[G.InitFinished=29]="InitFinished",G[G.UpdateFinished=30]="UpdateFinished",G[G.SetPixel=31]="SetPixel",G[G.Collector=32]="Collector",G[G.TutorialStep=33]="TutorialStep",G[G.PlaySound=34]="PlaySound",G[G.AddLight=35]="AddLight",G[G.MoveCamera=36]="MoveCamera",G[G.SpawnWorldItem=37]="SpawnWorldItem",G[G.ForceCompleteObjective=38]="ForceCompleteObjective",G[G.Save=39]="Save",G[G.RunConveyorBelts=40]="RunConveyorBelts",G[G.UpdateStructure=41]="UpdateStructure",G[G.SetPaused=42]="SetPaused",function(e){e[e.Main=1]="Main",e[e.Worker=2]="Worker",e[e.Manager=3]="Manager"}(p||(p={})),(U=m||(m={}))[U.Even=1]="Even",U[U.Odd=2]="Odd",U[U.Both=3]="Both",function(e){e.OpenBuildMenu="OpenBuildMenu",e.GrapplingHook="GrapplingHook",e.Escape="Escape",e.OpenTechTree="OpenTechTree",e.OpenInventory="OpenInventory",e.ReverseBuildDirection="ReverseBuildDirection",e.Marquee="Marquee",e.Pause="Pause",e.Copy="Copy",e.Delete="Delete",e.PauseCamera="PauseCamera",e.OpenUpgrades="OpenUpgrades",e.BuildMode="BuildMode",e.Demolish="Demolish",e.Jump="Jump",e.Ruler="Ruler",e.Left="Left",e.Right="Right",e.Boost="Boost",e.Descend="Descend"}(g||(g={})),function(e){e[e.Up=1]="Up",e[e.Down=2]="Down",e[e.Pressed=3]="Pressed",e[e.Released=4]="Released",e[e.All=5]="All"}(y||(y={})),(j=v||(v={}))[j.Building=1]="Building",j[j.Hotbar=2]="Hotbar",j[j.MainMenu=3]="MainMenu",j[j.TechTree=4]="TechTree",j[j.Research=5]="Research",j[j.InventoryItem=6]="InventoryItem",j[j.SubNavigation=7]="SubNavigation",j[j.FilterConfig=8]="FilterConfig",(z=x||(x={}))[z.MainMenu=1]="MainMenu",z[z.Intro=2]="Intro",z[z.Game=3]="Game",(O=b||(b={}))[O.Move=1]="Move",O[O.Dig=2]="Dig",O[O.Hotbar=3]="Hotbar",O[O.PickUpSand=4]="PickUpSand",O[O.WetSand=5]="WetSand",O[O.RefineWetSand=6]="RefineWetSand",O[O.SellGold=7]="SellGold",O[O.OpenTechTree=8]="OpenTechTree",O[O.UnlockRefining=9]="UnlockRefining",O[O.OpenBuildMenu=10]="OpenBuildMenu",O[O.BuildShaker=11]="BuildShaker",O[O.RefineGoldWithShaker=12]="RefineGoldWithShaker",O[O.UnlockLogistics=13]="UnlockLogistics",O[O.TutorialEnd=14]="TutorialEnd",(B=w||(w={}))[B.Refining1=1]="Refining1",B[B.Logistics1=2]="Logistics1",B[B.Guns1=3]="Guns1",B[B.Filters1=4]="Filters1",B[B.Tools1=5]="Tools1",B[B.Tools2=6]="Tools2",B[B.Refining2=7]="Refining2",B[B.Guns2=8]="Guns2",B[B.Drones1=9]="Drones1",B[B.Upgrading2=10]="Upgrading2",B[B.Filters2=11]="Filters2",B[B.Upgrading3=12]="Upgrading3",B[B.Upgrading4=13]="Upgrading4",B[B.Upgrading5=14]="Upgrading5",B[B.Upgrading6=15]="Upgrading6",B[B.Upgrading7=16]="Upgrading7",B[B.Upgrading8=17]="Upgrading8",B[B.Upgrading9=18]="Upgrading9",B[B.Upgrading10=19]="Upgrading10",B[B.Refining3=20]="Refining3",B[B.Refining4=21]="Refining4",B[B.Tools3=22]="Tools3",B[B.Pipes1=23]="Pipes1",B[B.Lights1=24]="Lights1",B[B.Drones2=25]="Drones2",B[B.Refining5=26]="Refining5",B[B.Tools4=27]="Tools4",B[B.Guns3=28]="Guns3",function(e){e[e.Available=0]="Available",e[e.Visible=1]="Visible",e[e.Researched=2]="Researched",e[e.Unknown=3]="Unknown",e[e.Hidden=4]="Hidden"}(S||(S={})),function(e){e[e.ConveyorBelts=1]="ConveyorBelts",e[e.Shakers=2]="Shakers",e[e.UpdateMachinery=3]="UpdateMachinery",e[e.SpawnMainMenuElements=4]="SpawnMainMenuElements",e[e.Autosave=5]="Autosave",e[e.Pump=6]="Pump",e[e.EmitGloom=7]="EmitGloom",e[e.PingPumpChunksFIX=8]="PingPumpChunksFIX"}(_||(_={})),function(e){e[e.Linear=1]="Linear",e[e.Rectangular=2]="Rectangular"}(T||(T={})),function(e){e[e.Above=1]="Above",e[e.TransitioningAbove=2]="TransitioningAbove",e[e.TransitioningBelow=3]="TransitioningBelow",e[e.Below=4]="Below"}(E||(E={})),function(e){e[e.Available=1]="Available",e[e.FullyBlocked=2]="FullyBlocked",e[e.PartiallyBlocked=3]="PartiallyBlocked"}(C||(C={})),(L=k||(k={}))[L.Hotbar=1]="Hotbar",L[L.SoundBoxConfig=2]="SoundBoxConfig",L[L.Debug=3]="Debug",L[L.Root=4]="Root",L[L.Menu=5]="Menu",L[L.Management=6]="Management",L[L.FilterConfig=7]="FilterConfig",L[L.Resources=8]="Resources",L[L.TechTree=9]="TechTree",L[L.Tutorial=10]="Tutorial",L[L.Loader=11]="Loader",L[L.Options=12]="Options",L[L.ShortcutHelper=13]="ShortcutHelper",L[L.Upgrades=14]="Upgrades",L[L.Tooltip=15]="Tooltip",L[L.Notifications=16]="Notifications",L[L.Objectives=17]="Objectives",function(e){e[e.Unselected=0]="Unselected",e[e.Selected=1]="Selected",e[e.Copying=2]="Copying",e[e.Moving=3]="Moving"}(A||(A={})),(N=M||(M={}))[N.None=0]="None",N[N.ObstacleStart=252]="ObstacleStart",N[N.Misc=253]="Misc",N[N.Darkness=254]="Darkness",function(e){e[e.NoJetpack=1]="NoJetpack",e[e.NoGrab=2]="NoGrab",e[e.NoBuild=3]="NoBuild",e[e.NoFlamethrower=4]="NoFlamethrower"}(P||(P={})),function(e){e[e.Artifact1=1]="Artifact1",e[e.Artifact2=2]="Artifact2"}(R||(R={})),function(e){e[e.Boss1=1]="Boss1"}(I||(I={})),function(e){e[e.Digger=1]="Digger",e[e.Hauler=2]="Hauler"}(D||(D={})),function(e){e[e.Artifact=1]="Artifact"}(F||(F={}));var q={iterateToAndGetLastPosFulfillingCondition:function(e,t,n){for(var r,i=e.x,s=e.y,o=i-t.x,a=s-t.y,l=Math.abs(o)>Math.abs(a),u=o<0?1:-1,c=a<0?1:-1,h=Math.max(Math.abs(o),Math.abs(a)),d=Math.min(Math.abs(o),Math.abs(a)),f=0==d||0==h?0:d/h,p=e.x,m=e.y,g=1;g<=h;g++){r=Math.round(g*f);var y=void 0,v=void 0;l?(v=g,y=r):(y=g,v=r);var x=s+y*c,b=i+v*u;if(!n(b,x,p,m))return{x:p,y:m};p=b,m=x}return{x:p,y:m}},getAllOverlappingCellsFulfillingConditionFromPixelDimensions:function(t,n,r,i,s){for(var o=t-t%e.cellSize,a=n-n%e.cellSize,l={x:o/e.cellSize,y:a/e.cellSize},u=t+r-1-(t+r-1)%e.cellSize,c=n+i-1-(n+i-1)%e.cellSize,h=u/e.cellSize,d=c/e.cellSize,f=[],p=l.y;p<=d;p+=1)for(var m=l.x;m<=h;m+=1)s(m,p)&&f.push({x:m,y:p});return f.sort((function(e,t){return e.x-t.x})),f},getCoordinatesBetweenPoints:function(e,t){for(var n=[],r=t.x-e.x,i=t.y-e.y,s=Math.max(Math.abs(r),Math.abs(i)),o=r/s,a=i/s,l=e.x,u=e.y,c=0;c<s;c++)l+=o,u+=a,n.push({x:Math.round(l),y:Math.round(u)});return n},getCoordinatesFromAngleAndDistance:function(e,t,n){for(var r=[],i=0;i<=n;i++){var s=Math.round(Math.cos(t*Math.PI/180)*i+e.x),o=Math.round(Math.sin(t*Math.PI/180)*i+e.y);r.push({x:s,y:o})}return r},getDistance:function(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)},getAngle:function(e,t){return 180*Math.atan2(t.y-e.y,t.x-e.x)/Math.PI},getPointFromAngleAndDistance:function(e,t,n){return{x:Math.floor(Math.cos(t*Math.PI/180)*n+e.x),y:Math.floor(Math.sin(t*Math.PI/180)*n+e.y)}},getVelocityFromAngle:function(e){return{x:Math.cos(e*Math.PI/180),y:Math.sin(e*Math.PI/180)}},getAngleFromVelocity:function(e){return 180*Math.atan2(e.y,e.x)/Math.PI},getRandomIntBetween:function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1)+e)},getRandomFloatBetween:function(e,t){var n=Math.random()*(t-e)+e;return parseFloat(n)},getArmAxis:function(t){return{x:t.x+2+1*e.cellSize,y:t.y+2+3*e.cellSize+2}},getGunArmAxis:function(t){return{x:t.x+2+1*e.cellSize,y:t.y+2+3*e.cellSize+2}},getImageDataFromImage:function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");return n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height)},HSLToRGBA:function(e,t,n){n/=100;var r=function(t){return(t+e/30)%12},i=(t/=100)*Math.min(n,1-n),s=function(e){return n-i*Math.max(-1,Math.min(r(e)-3,Math.min(9-r(e),1)))};return[Math.round(255*s(0)),Math.round(255*s(8)),Math.round(255*s(4)),255]},isChunkIndexInThread:function(e,t,n){return 2*Math.floor(e/2)%(2*n)==2*t},isCellXInThread:function(t,n,r){var i=Math.floor(t/e.chunkSize)*e.chunkSize/e.chunkSize;return q.isChunkIndexInThread(i,n,r)},getThreadIndexFromCellX:function(t,n){var r=2*e.chunkSize;return Math.floor(t/r)*r/r%n},isCellXAtThreadSeam:function(t){var n=2*e.chunkSize,r=Math.floor(t/n)*n;return t===r||t===r+n-1},getThreadColumnSize:function(){return 2*e.chunkSize},getNumberOfThreadColumns:function(e){return Math.floor(e.store.world.size.width/q.getThreadColumnSize())},getAllChunkIndexesInThread:function(t,n,r){for(var i=[],s=Math.floor(t.store.world.size.width/e.chunkSize),o=0;o<s;o+=1)q.isChunkIndexInThread(o,n,r)&&i.push(o);return i},doRectanglesOverlap:function(e,t){return!(e.x>=t.x+t.width||t.x>=e.x+e.width||e.y>=t.y+t.height||t.y>=e.y+e.height)},shuffleArray:function(e){for(var t,n=e.length-1;n>0;n--){var r=Math.floor(Math.random()*(n+1));t=[e[r],e[n]],e[n]=t[0],e[r]=t[1]}},getDirection:function(e,t){var n=t.x-e.x,r=t.y-e.y,i=Math.sqrt(n*n+r*r);return{x:i?n/i:0,y:i?r/i:0}}};const K=q;var Z=[t.Empty,t.Element],Q=(Object.keys(t).filter((function(e){return!Z.includes(t[e])})).map((function(e){return t[e]})),[t.SandSoil,t.SporeSoil,t.Fog,t.FogJetpackBlock,t.FreezingIceSoil,t.Divider,t.Grass,t.Moss,t.GoldSoil,t.Petal,t.Fluxite,t.SandiumSoil,t.Obsidian,t.Crackstone]),J=[t.Fog,t.FogJetpackBlock,t.FogWater,t.FogLava],ee=[t.ConveyorLeft,t.ConveyorRight,t.ShakerLeft,t.ShakerRight],te=[d.ConveyorLeft,d.ConveyorRight,d.ShakerLeft,d.ShakerRight,d.FilterLeft,d.FilterRight],ne=[n.Water,n.Steam,n.Lava],re=function(e,t){return{x:e,y:t,shouldUpdate:!0,shouldUpdateNextFrame:!0}},ie=function(e,t,r){var i=Ch(n.Particle,t.x,t.y,{element:t,velocity:r});return Ad(e,t.x,t.y,i),i},se={init:function(e,t,n){void 0===n&&(n=!1),se.setup(t,"structures",e.structures),n&&se.setup(t,"pipes",e.pipes)},setup:function(e,t,n){n.forEach((function(n){se.set(e,t,n.x,n.y,n)}))},get:function(e,t,n,r){if(!e.cache[t])throw new Error('Cache "'.concat(t,'" not found'));return e.cache[t][r]&&e.cache[t][r][n]||!1},set:function(e,t,n,r,i){if(!e.cache[t])throw new Error('Cache "'.concat(t,'" not found'));e.cache[t][r]||(e.cache[t][r]=[]),e.cache[t][r][n]=i},delete:function(e,t,n,r){if(!e.cache[t])throw new Error('Cache "'.concat(t,'" not found'));if(!e.cache[t][r])throw new Error('Cache "'.concat(t,'" at ').concat(r," not found when deleting"));delete e.cache[t][r][n]}};const oe=se;var ae=(e=>(e[e.WEBGL_LEGACY=0]="WEBGL_LEGACY",e[e.WEBGL=1]="WEBGL",e[e.WEBGL2=2]="WEBGL2",e))(ae||{}),le=(e=>(e[e.COLOR=16384]="COLOR",e[e.DEPTH=256]="DEPTH",e[e.STENCIL=1024]="STENCIL",e))(le||{}),ue=(e=>(e[e.NORMAL=0]="NORMAL",e[e.ADD=1]="ADD",e[e.MULTIPLY=2]="MULTIPLY",e[e.SCREEN=3]="SCREEN",e[e.OVERLAY=4]="OVERLAY",e[e.DARKEN=5]="DARKEN",e[e.LIGHTEN=6]="LIGHTEN",e[e.COLOR_DODGE=7]="COLOR_DODGE",e[e.COLOR_BURN=8]="COLOR_BURN",e[e.HARD_LIGHT=9]="HARD_LIGHT",e[e.SOFT_LIGHT=10]="SOFT_LIGHT",e[e.DIFFERENCE=11]="DIFFERENCE",e[e.EXCLUSION=12]="EXCLUSION",e[e.HUE=13]="HUE",e[e.SATURATION=14]="SATURATION",e[e.COLOR=15]="COLOR",e[e.LUMINOSITY=16]="LUMINOSITY",e[e.NORMAL_NPM=17]="NORMAL_NPM",e[e.ADD_NPM=18]="ADD_NPM",e[e.SCREEN_NPM=19]="SCREEN_NPM",e[e.NONE=20]="NONE",e[e.SRC_OVER=0]="SRC_OVER",e[e.SRC_IN=21]="SRC_IN",e[e.SRC_OUT=22]="SRC_OUT",e[e.SRC_ATOP=23]="SRC_ATOP",e[e.DST_OVER=24]="DST_OVER",e[e.DST_IN=25]="DST_IN",e[e.DST_OUT=26]="DST_OUT",e[e.DST_ATOP=27]="DST_ATOP",e[e.ERASE=26]="ERASE",e[e.SUBTRACT=28]="SUBTRACT",e[e.XOR=29]="XOR",e))(ue||{}),ce=(e=>(e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e))(ce||{}),he=(e=>(e[e.RGBA=6408]="RGBA",e[e.RGB=6407]="RGB",e[e.RG=33319]="RG",e[e.RED=6403]="RED",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.ALPHA=6406]="ALPHA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e))(he||{}),de=(e=>(e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e))(de||{}),fe=(e=>(e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.BYTE=5120]="BYTE",e[e.SHORT=5122]="SHORT",e[e.INT=5124]="INT",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.HALF_FLOAT=36193]="HALF_FLOAT",e))(fe||{}),pe=(e=>(e[e.FLOAT=0]="FLOAT",e[e.INT=1]="INT",e[e.UINT=2]="UINT",e))(pe||{}),me=(e=>(e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR",e))(me||{}),ge=(e=>(e[e.CLAMP=33071]="CLAMP",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e))(ge||{}),ye=(e=>(e[e.OFF=0]="OFF",e[e.POW2=1]="POW2",e[e.ON=2]="ON",e[e.ON_MANUAL=3]="ON_MANUAL",e))(ye||{}),ve=(e=>(e[e.NPM=0]="NPM",e[e.UNPACK=1]="UNPACK",e[e.PMA=2]="PMA",e[e.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",e[e.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",e[e.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",e))(ve||{}),xe=(e=>(e[e.NO=0]="NO",e[e.YES=1]="YES",e[e.AUTO=2]="AUTO",e[e.BLEND=0]="BLEND",e[e.CLEAR=1]="CLEAR",e[e.BLIT=2]="BLIT",e))(xe||{}),be=(e=>(e[e.AUTO=0]="AUTO",e[e.MANUAL=1]="MANUAL",e))(be||{}),we=(e=>(e.LOW="lowp",e.MEDIUM="mediump",e.HIGH="highp",e))(we||{}),Se=(e=>(e[e.NONE=0]="NONE",e[e.SCISSOR=1]="SCISSOR",e[e.STENCIL=2]="STENCIL",e[e.SPRITE=3]="SPRITE",e[e.COLOR=4]="COLOR",e))(Se||{}),_e=(e=>(e[e.NONE=0]="NONE",e[e.LOW=2]="LOW",e[e.MEDIUM=4]="MEDIUM",e[e.HIGH=8]="HIGH",e))(_e||{}),Te=(e=>(e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e))(Te||{});const Ee={createCanvas:(e,t)=>{const n=document.createElement("canvas");return n.width=e,n.height=t,n},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(e,t)=>fetch(e,t),parseXML:e=>(new DOMParser).parseFromString(e,"text/xml")},Ce={ADAPTER:Ee,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var ke=/iPhone/i,Ae=/iPod/i,Me=/iPad/i,Pe=/\biOS-universal(?:.+)Mac\b/i,Re=/\bAndroid(?:.+)Mobile\b/i,Ie=/Android/i,De=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Fe=/Silk/i,Ne=/Windows Phone/i,Le=/\bWindows(?:.+)ARM\b/i,Be=/BlackBerry/i,Oe=/BB10/i,ze=/Opera Mini/i,je=/\b(CriOS|Chrome)(?:.+)Mobile/i,Ue=/Mobile(?:.+)Firefox\b/i,Ge=function(e){return void 0!==e&&"MacIntel"===e.platform&&"number"==typeof e.maxTouchPoints&&e.maxTouchPoints>1&&"undefined"==typeof MSStream};const Ve=function(e){var t={userAgent:"",platform:"",maxTouchPoints:0};e||"undefined"==typeof navigator?"string"==typeof e?t.userAgent=e:e&&e.userAgent&&(t={userAgent:e.userAgent,platform:e.platform,maxTouchPoints:e.maxTouchPoints||0}):t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var n=t.userAgent,r=n.split("[FBAN");void 0!==r[1]&&(n=r[0]),void 0!==(r=n.split("Twitter"))[1]&&(n=r[0]);var i=function(e){return function(t){return t.test(e)}}(n),s={apple:{phone:i(ke)&&!i(Ne),ipod:i(Ae),tablet:!i(ke)&&(i(Me)||Ge(t))&&!i(Ne),universal:i(Pe),device:(i(ke)||i(Ae)||i(Me)||i(Pe)||Ge(t))&&!i(Ne)},amazon:{phone:i(De),tablet:!i(De)&&i(Fe),device:i(De)||i(Fe)},android:{phone:!i(Ne)&&i(De)||!i(Ne)&&i(Re),tablet:!i(Ne)&&!i(De)&&!i(Re)&&(i(Fe)||i(Ie)),device:!i(Ne)&&(i(De)||i(Fe)||i(Re)||i(Ie))||i(/\bokhttp\b/i)},windows:{phone:i(Ne),tablet:i(Le),device:i(Ne)||i(Le)},other:{blackberry:i(Be),blackberry10:i(Oe),opera:i(ze),firefox:i(Ue),chrome:i(je),device:i(Be)||i(Oe)||i(ze)||i(Ue)||i(je)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}(globalThis.navigator);Ce.RETINA_PREFIX=/@([0-9\.]+)x/,Ce.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var He=i(228),We=i(6570),Xe=i(8835);const $e={parse:Xe.qg,format:Xe.GP,resolve:Xe.hd};function Ye(e){if("string"!=typeof e)throw new TypeError(`Path must be a string. Received ${JSON.stringify(e)}`)}function qe(e){return e.split("?")[0].split("#")[0]}const Ke={toPosix:e=>("\\","/",e.replace(new RegExp("\\".replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),"/")),isUrl(e){return/^https?:/.test(this.toPosix(e))},isDataUrl:e=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(e),hasProtocol(e){return/^[^/:]+:\//.test(this.toPosix(e))},getProtocol(e){Ye(e),e=this.toPosix(e);let t="";const n=/^file:\/\/\//.exec(e),r=/^[^/:]+:\/\//.exec(e),i=/^[^/:]+:\//.exec(e);if(n||r||i){const s=n?.[0]||r?.[0]||i?.[0];t=s,e=e.slice(s.length)}return t},toAbsolute(e,t,n){if(this.isDataUrl(e))return e;const r=qe(this.toPosix(t??Ce.ADAPTER.getBaseUrl())),i=qe(this.toPosix(n??this.rootname(r)));return Ye(e),(e=this.toPosix(e)).startsWith("/")?Ke.join(i,e.slice(1)):this.isAbsolute(e)?e:this.join(r,e)},normalize(e){if(Ye(e=this.toPosix(e)),0===e.length)return".";let t="";const n=e.startsWith("/");this.hasProtocol(e)&&(t=this.rootname(e),e=e.slice(t.length));const r=e.endsWith("/");return e=function(e,t){let n="",r=0,i=-1,s=0,o=-1;for(let t=0;t<=e.length;++t){if(t<e.length)o=e.charCodeAt(t);else{if(47===o)break;o=47}if(47===o){if(i===t-1||1===s);else if(i!==t-1&&2===s){if(n.length<2||2!==r||46!==n.charCodeAt(n.length-1)||46!==n.charCodeAt(n.length-2))if(n.length>2){const e=n.lastIndexOf("/");if(e!==n.length-1){-1===e?(n="",r=0):(n=n.slice(0,e),r=n.length-1-n.lastIndexOf("/")),i=t,s=0;continue}}else if(2===n.length||1===n.length){n="",r=0,i=t,s=0;continue}}else n.length>0?n+=`/${e.slice(i+1,t)}`:n=e.slice(i+1,t),r=t-i-1;i=t,s=0}else 46===o&&-1!==s?++s:s=-1}return n}(e),e.length>0&&r&&(e+="/"),n?`/${e}`:t+e},isAbsolute(e){return Ye(e),e=this.toPosix(e),!!this.hasProtocol(e)||e.startsWith("/")},join(...e){if(0===e.length)return".";let t;for(let n=0;n<e.length;++n){const r=e[n];if(Ye(r),r.length>0)if(void 0===t)t=r;else{const i=e[n-1]??"";this.extname(i)?t+=`/../${r}`:t+=`/${r}`}}return void 0===t?".":this.normalize(t)},dirname(e){if(Ye(e),0===e.length)return".";let t=(e=this.toPosix(e)).charCodeAt(0);const n=47===t;let r=-1,i=!0;const s=this.getProtocol(e),o=e;for(let n=(e=e.slice(s.length)).length-1;n>=1;--n)if(t=e.charCodeAt(n),47===t){if(!i){r=n;break}}else i=!1;return-1===r?n?"/":this.isUrl(o)?s+e:s:n&&1===r?"//":s+e.slice(0,r)},rootname(e){Ye(e);let t="";if(t=(e=this.toPosix(e)).startsWith("/")?"/":this.getProtocol(e),this.isUrl(e)){const n=e.indexOf("/",t.length);t=-1!==n?e.slice(0,n):e,t.endsWith("/")||(t+="/")}return t},basename(e,t){Ye(e),t&&Ye(t),e=qe(this.toPosix(e));let n,r=0,i=-1,s=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let o=t.length-1,a=-1;for(n=e.length-1;n>=0;--n){const l=e.charCodeAt(n);if(47===l){if(!s){r=n+1;break}}else-1===a&&(s=!1,a=n+1),o>=0&&(l===t.charCodeAt(o)?-1==--o&&(i=n):(o=-1,i=a))}return r===i?i=a:-1===i&&(i=e.length),e.slice(r,i)}for(n=e.length-1;n>=0;--n)if(47===e.charCodeAt(n)){if(!s){r=n+1;break}}else-1===i&&(s=!1,i=n+1);return-1===i?"":e.slice(r,i)},extname(e){Ye(e);let t=-1,n=0,r=-1,i=!0,s=0;for(let o=(e=qe(this.toPosix(e))).length-1;o>=0;--o){const a=e.charCodeAt(o);if(47!==a)-1===r&&(i=!1,r=o+1),46===a?-1===t?t=o:1!==s&&(s=1):-1!==t&&(s=-1);else if(!i){n=o+1;break}}return-1===t||-1===r||0===s||1===s&&t===r-1&&t===n+1?"":e.slice(t,r)},parse(e){Ye(e);const t={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return t;let n=(e=qe(this.toPosix(e))).charCodeAt(0);const r=this.isAbsolute(e);let i;t.root=this.rootname(e),i=r||this.hasProtocol(e)?1:0;let s=-1,o=0,a=-1,l=!0,u=e.length-1,c=0;for(;u>=i;--u)if(n=e.charCodeAt(u),47!==n)-1===a&&(l=!1,a=u+1),46===n?-1===s?s=u:1!==c&&(c=1):-1!==s&&(c=-1);else if(!l){o=u+1;break}return-1===s||-1===a||0===c||1===c&&s===a-1&&s===o+1?-1!==a&&(t.base=t.name=0===o&&r?e.slice(1,a):e.slice(o,a)):(0===o&&r?(t.name=e.slice(1,s),t.base=e.slice(1,a)):(t.name=e.slice(o,s),t.base=e.slice(o,a)),t.ext=e.slice(s,a)),t.dir=this.dirname(e),t},sep:"/",delimiter:":"},Ze={};function Qe(e,t,n=3){if(Ze[t])return;let r=(new Error).stack;void 0===r?console.warn("PixiJS Deprecation Warning: ",`${t}\nDeprecated since v${e}`):(r=r.split("\n").splice(n).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}\nDeprecated since v${e}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}\nDeprecated since v${e}`),console.warn(r))),Ze[t]=!0}let Je;var et={grad:.9,turn:360,rad:360/(2*Math.PI)},tt=function(e){return"string"==typeof e?e.length>0:"number"==typeof e},nt=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=Math.pow(10,t)),Math.round(n*e)/n+0},rt=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=1),e>n?n:e>t?e:t},it=function(e){return(e=isFinite(e)?e%360:0)>0?e:e+360},st=function(e){return{r:rt(e.r,0,255),g:rt(e.g,0,255),b:rt(e.b,0,255),a:rt(e.a)}},ot=function(e){return{r:nt(e.r),g:nt(e.g),b:nt(e.b),a:nt(e.a,3)}},at=/^#([0-9a-f]{3,8})$/i,lt=function(e){var t=e.toString(16);return t.length<2?"0"+t:t},ut=function(e){var t=e.r,n=e.g,r=e.b,i=e.a,s=Math.max(t,n,r),o=s-Math.min(t,n,r),a=o?s===t?(n-r)/o:s===n?2+(r-t)/o:4+(t-n)/o:0;return{h:60*(a<0?a+6:a),s:s?o/s*100:0,v:s/255*100,a:i}},ct=function(e){var t=e.h,n=e.s,r=e.v,i=e.a;t=t/360*6,n/=100,r/=100;var s=Math.floor(t),o=r*(1-n),a=r*(1-(t-s)*n),l=r*(1-(1-t+s)*n),u=s%6;return{r:255*[r,a,o,o,l,r][u],g:255*[l,r,r,a,o,o][u],b:255*[o,o,l,r,r,a][u],a:i}},ht=function(e){return{h:it(e.h),s:rt(e.s,0,100),l:rt(e.l,0,100),a:rt(e.a)}},dt=function(e){return{h:nt(e.h),s:nt(e.s),l:nt(e.l),a:nt(e.a,3)}},ft=function(e){return ct((n=(t=e).s,{h:t.h,s:(n*=((r=t.l)<50?r:100-r)/100)>0?2*n/(r+n)*100:0,v:r+n,a:t.a}));var t,n,r},pt=function(e){return{h:(t=ut(e)).h,s:(i=(200-(n=t.s))*(r=t.v)/100)>0&&i<200?n*r/100/(i<=100?i:200-i)*100:0,l:i/2,a:t.a};var t,n,r,i},mt=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,gt=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,yt=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,vt=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,xt={string:[[function(e){var t=at.exec(e);return t?(e=t[1]).length<=4?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:4===e.length?nt(parseInt(e[3]+e[3],16)/255,2):1}:6===e.length||8===e.length?{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:8===e.length?nt(parseInt(e.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(e){var t=yt.exec(e)||vt.exec(e);return t?t[2]!==t[4]||t[4]!==t[6]?null:st({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:void 0===t[7]?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(e){var t=mt.exec(e)||gt.exec(e);if(!t)return null;var n,r,i=ht({h:(n=t[1],r=t[2],void 0===r&&(r="deg"),Number(n)*(et[r]||1)),s:Number(t[3]),l:Number(t[4]),a:void 0===t[5]?1:Number(t[5])/(t[6]?100:1)});return ft(i)},"hsl"]],object:[[function(e){var t=e.r,n=e.g,r=e.b,i=e.a,s=void 0===i?1:i;return tt(t)&&tt(n)&&tt(r)?st({r:Number(t),g:Number(n),b:Number(r),a:Number(s)}):null},"rgb"],[function(e){var t=e.h,n=e.s,r=e.l,i=e.a,s=void 0===i?1:i;if(!tt(t)||!tt(n)||!tt(r))return null;var o=ht({h:Number(t),s:Number(n),l:Number(r),a:Number(s)});return ft(o)},"hsl"],[function(e){var t=e.h,n=e.s,r=e.v,i=e.a,s=void 0===i?1:i;if(!tt(t)||!tt(n)||!tt(r))return null;var o=function(e){return{h:it(e.h),s:rt(e.s,0,100),v:rt(e.v,0,100),a:rt(e.a)}}({h:Number(t),s:Number(n),v:Number(r),a:Number(s)});return ct(o)},"hsv"]]},bt=function(e,t){for(var n=0;n<t.length;n++){var r=t[n][0](e);if(r)return[r,t[n][1]]}return[null,void 0]},wt=function(e,t){var n=pt(e);return{h:n.h,s:rt(n.s+100*t,0,100),l:n.l,a:n.a}},St=function(e){return(299*e.r+587*e.g+114*e.b)/1e3/255},_t=function(e,t){var n=pt(e);return{h:n.h,s:n.s,l:rt(n.l+100*t,0,100),a:n.a}},Tt=function(){function e(e){this.parsed=function(e){return"string"==typeof e?bt(e.trim(),xt.string):"object"==typeof e&&null!==e?bt(e,xt.object):[null,void 0]}(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return e.prototype.isValid=function(){return null!==this.parsed},e.prototype.brightness=function(){return nt(St(this.rgba),2)},e.prototype.isDark=function(){return St(this.rgba)<.5},e.prototype.isLight=function(){return St(this.rgba)>=.5},e.prototype.toHex=function(){return t=(e=ot(this.rgba)).r,n=e.g,r=e.b,s=(i=e.a)<1?lt(nt(255*i)):"","#"+lt(t)+lt(n)+lt(r)+s;var e,t,n,r,i,s},e.prototype.toRgb=function(){return ot(this.rgba)},e.prototype.toRgbString=function(){return t=(e=ot(this.rgba)).r,n=e.g,r=e.b,(i=e.a)<1?"rgba("+t+", "+n+", "+r+", "+i+")":"rgb("+t+", "+n+", "+r+")";var e,t,n,r,i},e.prototype.toHsl=function(){return dt(pt(this.rgba))},e.prototype.toHslString=function(){return t=(e=dt(pt(this.rgba))).h,n=e.s,r=e.l,(i=e.a)<1?"hsla("+t+", "+n+"%, "+r+"%, "+i+")":"hsl("+t+", "+n+"%, "+r+"%)";var e,t,n,r,i},e.prototype.toHsv=function(){return e=ut(this.rgba),{h:nt(e.h),s:nt(e.s),v:nt(e.v),a:nt(e.a,3)};var e},e.prototype.invert=function(){return Et({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},e.prototype.saturate=function(e){return void 0===e&&(e=.1),Et(wt(this.rgba,e))},e.prototype.desaturate=function(e){return void 0===e&&(e=.1),Et(wt(this.rgba,-e))},e.prototype.grayscale=function(){return Et(wt(this.rgba,-1))},e.prototype.lighten=function(e){return void 0===e&&(e=.1),Et(_t(this.rgba,e))},e.prototype.darken=function(e){return void 0===e&&(e=.1),Et(_t(this.rgba,-e))},e.prototype.rotate=function(e){return void 0===e&&(e=15),this.hue(this.hue()+e)},e.prototype.alpha=function(e){return"number"==typeof e?Et({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):nt(this.rgba.a,3);var t},e.prototype.hue=function(e){var t=pt(this.rgba);return"number"==typeof e?Et({h:e,s:t.s,l:t.l,a:t.a}):nt(t.h)},e.prototype.isEqual=function(e){return this.toHex()===Et(e).toHex()},e}(),Et=function(e){return e instanceof Tt?e:new Tt(e)},Ct=[];!function(e){e.forEach((function(e){Ct.indexOf(e)<0&&(e(Tt,xt),Ct.push(e))}))}([function(e,t){var n={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var i in n)r[n[i]]=i;var s={};e.prototype.toName=function(t){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var i,o,a=r[this.toHex()];if(a)return a;if(null==t?void 0:t.closest){var l=this.toRgb(),u=1/0,c="black";if(!s.length)for(var h in n)s[h]=new e(n[h]).toRgb();for(var d in n){var f=(i=l,o=s[d],Math.pow(i.r-o.r,2)+Math.pow(i.g-o.g,2)+Math.pow(i.b-o.b,2));f<u&&(u=f,c=d)}return c}},t.string.push([function(t){var r=t.toLowerCase(),i="transparent"===r?"#0000":n[r];return i?new e(i).toRgb():null},"name"])}]);const kt=class{constructor(e=16777215){this._components=new Float32Array(4),this._components.fill(1),this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(e){e instanceof kt?(this._value=e._value,this._int=e._int,this._components.set(e._components)):this._value!==e&&(this.normalize(e),this._value=e)}get value(){return this._value}toRgba(){const[e,t,n,r]=this._components;return{r:e,g:t,b:n,a:r}}toRgb(){const[e,t,n]=this._components;return{r:e,g:t,b:n}}toRgbaString(){const[e,t,n]=this.toUint8RgbArray();return`rgba(${e},${t},${n},${this.alpha})`}toUint8RgbArray(e){const[t,n,r]=this._components;return(e=e??[])[0]=Math.round(255*t),e[1]=Math.round(255*n),e[2]=Math.round(255*r),e}toRgbArray(e){e=e??[];const[t,n,r]=this._components;return e[0]=t,e[1]=n,e[2]=r,e}toNumber(){return this._int}toLittleEndianNumber(){const e=this._int;return(e>>16)+(65280&e)+((255&e)<<16)}multiply(e){const[t,n,r,i]=kt.temp.setValue(e)._components;return this._components[0]*=t,this._components[1]*=n,this._components[2]*=r,this._components[3]*=i,this.refreshInt(),this._value=null,this}premultiply(e,t=!0){return t&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this.refreshInt(),this._value=null,this}toPremultiplied(e){if(1===e)return(255*e<<24)+this._int;if(0===e)return 0;let t=this._int>>16&255,n=this._int>>8&255,r=255&this._int;return t=t*e+.5|0,n=n*e+.5|0,r=r*e+.5|0,(255*e<<24)+(t<<16)+(n<<8)+r}toHex(){const e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){const e=Math.round(255*this._components[3]).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(e){return this._components[3]=e,this}round(e){const[t,n,r]=this._components;return this._components.set([Math.min(255,t/e*e),Math.min(255,n/e*e),Math.min(255,r/e*e)]),this.refreshInt(),this._value=null,this}toArray(e){e=e??[];const[t,n,r,i]=this._components;return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e}normalize(e){let t;if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4&&e.every((e=>e<=1&&e>=0))){const[n,r,i,s=1]=e;t=[n,r,i,s]}else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4){const[n,r,i,s=255]=e;t=[n/255,r/255,i/255,s/255]}else if("string"==typeof e||"object"==typeof e){if("string"==typeof e){const t=kt.HEX_PATTERN.exec(e);t&&(e=`#${t[2]}`)}const n=Et(e);if(n.isValid()){const{r:e,g:r,b:i,a:s}=n.rgba;t=[e/255,r/255,i/255,s]}}else"number"==typeof e&&e>=0&&e<=16777215&&(t=[(e>>16&255)/255,(e>>8&255)/255,(255&e)/255,1]);if(!t)throw new Error(`Unable to convert color ${e}`);this._components.set(t),this.refreshInt()}refreshInt(){const[e,t,n]=this._components;this._int=(255*e<<16)+(255*t<<8)+(255*n|0)}};let At=kt;At.shared=new kt,At.temp=new kt,At.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;const Mt=function(){const e=[],t=[];for(let n=0;n<32;n++)e[n]=n,t[n]=n;e[ue.NORMAL_NPM]=ue.NORMAL,e[ue.ADD_NPM]=ue.ADD,e[ue.SCREEN_NPM]=ue.SCREEN,t[ue.NORMAL]=ue.NORMAL_NPM,t[ue.ADD]=ue.ADD_NPM,t[ue.SCREEN]=ue.SCREEN_NPM;const n=[];return n.push(t),n.push(e),n}();function Pt(e,t){return Mt[t?1:0][e]}function Rt(e){if(4===e.BYTES_PER_ELEMENT)return e instanceof Float32Array?"Float32Array":e instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===e.BYTES_PER_ELEMENT){if(e instanceof Uint16Array)return"Uint16Array"}else if(1===e.BYTES_PER_ELEMENT&&e instanceof Uint8Array)return"Uint8Array";return null}function It(e){return e+=0===e?1:0,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,1+(e|=e>>>16)}function Dt(e){return!(e&e-1||!e)}function Ft(e){let t=(e>65535?1:0)<<4,n=((e>>>=t)>255?1:0)<<3;return t|=n,n=((e>>>=n)>15?1:0)<<2,t|=n,n=((e>>>=n)>3?1:0)<<1,t|=n,t|(e>>>=n)>>1}function Nt(e,t,n){const r=e.length;let i;if(t>=r||0===n)return;const s=r-(n=t+n>r?r-t:n);for(i=t;i<s;++i)e[i]=e[i+n];e.length=s}function Lt(e){return 0===e?0:e<0?-1:1}Float32Array,Uint32Array,Int32Array,Uint8Array;let Bt=0;function Ot(){return++Bt}const zt=class{constructor(e,t,n,r){this.left=e,this.top=t,this.right=n,this.bottom=r}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};let jt=zt;jt.EMPTY=new zt(0,0,0,0);const Ut={},Gt=Object.create(null),Vt=Object.create(null);class Ht{constructor(e,t,n){this._canvas=Ce.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=n||Ce.RESOLUTION,this.resize(e,t)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(e,t){this._checkDestroyed(),this._canvas.width=Math.round(e*this.resolution),this._canvas.height=Math.round(t*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(e){this._checkDestroyed(),this._canvas.width=Math.round(e)}get height(){return this._checkDestroyed(),this._canvas.height}set height(e){this._checkDestroyed(),this._canvas.height=Math.round(e)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(null===this._canvas)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function Wt(e,t,n){for(let r=0,i=4*n*t;r<t;++r,i+=4)if(0!==e[i+3])return!1;return!0}function Xt(e,t,n,r,i){const s=4*t;for(let t=r,o=r*s+4*n;t<=i;++t,o+=s)if(0!==e[o+3])return!1;return!0}let $t;function Yt(e,t=1){const n=Ce.RETINA_PREFIX?.exec(e);return n?parseFloat(n[1]):t}var qt=(e=>(e.Renderer="renderer",e.Application="application",e.RendererSystem="renderer-webgl-system",e.RendererPlugin="renderer-webgl-plugin",e.CanvasRendererSystem="renderer-canvas-system",e.CanvasRendererPlugin="renderer-canvas-plugin",e.Asset="asset",e.LoadParser="load-parser",e.ResolveParser="resolve-parser",e.CacheParser="cache-parser",e.DetectionParser="detection-parser",e))(qt||{});const Kt=e=>{if("function"==typeof e||"object"==typeof e&&e.extension){if(!e.extension)throw new Error("Extension class must have an extension object");e={..."object"!=typeof e.extension?{type:e.extension}:e.extension,ref:e}}if("object"!=typeof e)throw new Error("Invalid extension type");return"string"==typeof(e={...e}).type&&(e.type=[e.type]),e},Zt=(e,t)=>Kt(e).priority??t,Qt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...e){return e.map(Kt).forEach((e=>{e.type.forEach((t=>this._removeHandlers[t]?.(e)))})),this},add(...e){return e.map(Kt).forEach((e=>{e.type.forEach((t=>{const n=this._addHandlers,r=this._queue;n[t]?n[t](e):(r[t]=r[t]||[],r[t].push(e))}))})),this},handle(e,t,n){const r=this._addHandlers,i=this._removeHandlers;if(r[e]||i[e])throw new Error(`Extension type ${e} already has a handler`);r[e]=t,i[e]=n;const s=this._queue;return s[e]&&(s[e].forEach((e=>t(e))),delete s[e]),this},handleByMap(e,t){return this.handle(e,(e=>{t[e.name]=e.ref}),(e=>{delete t[e.name]}))},handleByList(e,t,n=-1){return this.handle(e,(e=>{t.includes(e.ref)||(t.push(e.ref),t.sort(((e,t)=>Zt(t,n)-Zt(e,n))))}),(e=>{const n=t.indexOf(e.ref);-1!==n&&t.splice(n,1)}))}};class Jt{constructor(e){"number"==typeof e?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}}const en=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function tn(e){let t="";for(let n=0;n<e;++n)n>0&&(t+="\nelse "),n<e-1&&(t+=`if(test == ${n}.0){}`);return t}class nn{constructor(){this.data=0,this.blendMode=ue.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(e){!!(1&this.data)!==e&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(e){!!(2&this.data)!==e&&(this.data^=2)}get culling(){return!!(4&this.data)}set culling(e){!!(4&this.data)!==e&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(e){!!(8&this.data)!==e&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(e){!!(32&this.data)!==e&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(e){!!(16&this.data)!==e&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!==ue.NONE,this._blendMode=e}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const e=new nn;return e.depthTest=!1,e.blend=!0,e}}const rn=[];function sn(e,t){if(!e)return null;let n="";if("string"==typeof e){const t=/\.(\w{3,4})(?:$|\?|#)/i.exec(e);t&&(n=t[1].toLowerCase())}for(let r=rn.length-1;r>=0;--r){const i=rn[r];if(i.test&&i.test(e,n))return new i(e,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class on{constructor(e){this.items=[],this._name=e,this._aliasCount=0}emit(e,t,n,r,i,s,o,a){if(arguments.length>8)throw new Error("max arguments reached");const{name:l,items:u}=this;this._aliasCount++;for(let c=0,h=u.length;c<h;c++)u[c][l](e,t,n,r,i,s,o,a);return u===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this}remove(e){const t=this.items.indexOf(e);return-1!==t&&(this.ensureNonAliasedItems(),this.items.splice(t,1)),this}contains(e){return this.items.includes(e)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties(on.prototype,{dispatch:{value:on.prototype.emit},run:{value:on.prototype.emit}});class an{constructor(e=0,t=0){this._width=e,this._height=t,this.destroyed=!1,this.internal=!1,this.onResize=new on("setRealSize"),this.onUpdate=new on("update"),this.onError=new on("onError")}bind(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)}resize(e,t){e===this._width&&t===this._height||(this._width=e,this._height=t,this.onResize.emit(e,t))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(e,t,n){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(e,t){return!1}}class ln extends an{constructor(e,t){const{width:n,height:r}=t||{};if(!n||!r)throw new Error("BufferResource width or height invalid");super(n,r),this.data=e}upload(e,t,n){const r=e.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===ve.UNPACK);const i=t.realWidth,s=t.realHeight;return n.width===i&&n.height===s?r.texSubImage2D(t.target,0,0,0,i,s,t.format,n.type,this.data):(n.width=i,n.height=s,r.texImage2D(t.target,0,n.internalFormat,i,s,0,t.format,n.type,this.data)),!0}dispose(){this.data=null}static test(e){return e instanceof Float32Array||e instanceof Uint8Array||e instanceof Uint32Array}}const un={scaleMode:me.NEAREST,format:he.RGBA,alphaMode:ve.NPM},cn=class extends He{constructor(e=null,t=null){super(),t=Object.assign({},cn.defaultOptions,t);const{alphaMode:n,mipmap:r,anisotropicLevel:i,scaleMode:s,width:o,height:a,wrapMode:l,format:u,type:c,target:h,resolution:d,resourceOptions:f}=t;!e||e instanceof an||((e=sn(e,f)).internal=!0),this.resolution=d||Ce.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((a||0)*this.resolution)/this.resolution,this._mipmap=r,this.anisotropicLevel=i,this._wrapMode=l,this._scaleMode=s,this.format=u,this.type=c,this.target=h,this.alphaMode=n,this.uid=Ot(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&a>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(e)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,t){let n;return void 0!==e&&e!==this.scaleMode&&(this.scaleMode=e,n=!0),void 0!==t&&t!==this.mipmap&&(this.mipmap=t,n=!0),n&&this.dirtyStyleId++,this}setSize(e,t,n){return n=n||this.resolution,this.setRealSize(e*n,t*n,n)}setRealSize(e,t,n){return this.resolution=n||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Dt(this.realWidth)&&Dt(this.realHeight)}setResolution(e){const t=this.resolution;return t===e||(this.resolution=e,this.valid&&(this.width=Math.round(this.width*t)/e,this.height=Math.round(this.height*t)/e,this.emit("update",this)),this._refreshPOT()),this}setResource(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(e){this.emit("error",this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Vt[this.cacheId],delete Gt[this.cacheId],this.cacheId=null),this.dispose(),cn.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(e,t,n=Ce.STRICT_TEXTURE_CACHE){const r="string"==typeof e;let i=null;if(r)i=e;else{if(!e._pixiId){const n=t?.pixiIdPrefix||"pixiid";e._pixiId=`${n}_${Ot()}`}i=e._pixiId}let s=Vt[i];if(r&&n&&!s)throw new Error(`The cacheId "${i}" does not exist in BaseTextureCache.`);return s||(s=new cn(e,t),s.cacheId=i,cn.addToCache(s,i)),s}static fromBuffer(e,t,n,r){e=e||new Float32Array(t*n*4);const i=new ln(e,{width:t,height:n}),s=e instanceof Float32Array?fe.FLOAT:fe.UNSIGNED_BYTE;return new cn(i,Object.assign({},un,r||{width:t,height:n,type:s}))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),Vt[t]&&Vt[t]!==e&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),Vt[t]=e)}static removeFromCache(e){if("string"==typeof e){const t=Vt[e];if(t){const n=t.textureCacheIds.indexOf(e);return n>-1&&t.textureCacheIds.splice(n,1),delete Vt[e],t}}else if(e?.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)delete Vt[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}};let hn=cn;hn.defaultOptions={mipmap:ye.POW2,anisotropicLevel:0,scaleMode:me.LINEAR,wrapMode:ge.CLAMP,alphaMode:ve.UNPACK,target:de.TEXTURE_2D,format:he.RGBA,type:fe.UNSIGNED_BYTE},hn._globalBatch=0;class dn{constructor(){this.texArray=null,this.blend=0,this.type=ce.TRIANGLES,this.start=0,this.size=0,this.data=null}}let fn=0;class pn{constructor(e,t=!0,n=!1){this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=n,this.static=t,this.id=fn++,this.disposeRunner=new on("disposeBuffer")}update(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(e){this.type=e?Te.ELEMENT_ARRAY_BUFFER:Te.ARRAY_BUFFER}get index(){return this.type===Te.ELEMENT_ARRAY_BUFFER}static from(e){return e instanceof Array&&(e=new Float32Array(e)),new pn(e)}}class mn{constructor(e,t=0,n=!1,r=fe.FLOAT,i,s,o,a=1){this.buffer=e,this.size=t,this.normalized=n,this.type=r,this.stride=i,this.start=s,this.instance=o,this.divisor=a}destroy(){this.buffer=null}static from(e,t,n,r,i){return new mn(e,t,n,r,i)}}const gn={Float32Array,Uint32Array,Int32Array,Uint8Array},yn={5126:4,5123:2,5121:1};let vn=0;const xn={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class bn{constructor(e=[],t={}){this.buffers=e,this.indexBuffer=null,this.attributes=t,this.glVertexArrayObjects={},this.id=vn++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new on("disposeGeometry"),this.refCount=0}addAttribute(e,t,n=0,r=!1,i,s,o,a=!1){if(!t)throw new Error("You must pass a buffer when creating an attribute");t instanceof pn||(t instanceof Array&&(t=new Float32Array(t)),t=new pn(t));const l=e.split("|");if(l.length>1){for(let e=0;e<l.length;e++)this.addAttribute(l[e],t,n,r,i);return this}let u=this.buffers.indexOf(t);return-1===u&&(this.buffers.push(t),u=this.buffers.length-1),this.attributes[e]=new mn(u,n,r,i,s,o,a),this.instanced=this.instanced||a,this}getAttribute(e){return this.attributes[e]}getBuffer(e){return this.buffers[this.getAttribute(e).buffer]}addIndex(e){return e instanceof pn||(e instanceof Array&&(e=new Uint16Array(e)),e=new pn(e)),e.type=Te.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.includes(e)||this.buffers.push(e),this}getIndex(){return this.indexBuffer}interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;const e=[],t=[],n=new pn;let r;for(r in this.attributes){const n=this.attributes[r],i=this.buffers[n.buffer];e.push(i.data),t.push(n.size*yn[n.type]/4),n.buffer=0}for(n.data=function(e,t){let n=0,r=0;const i={};for(let i=0;i<e.length;i++)r+=t[i],n+=e[i].length;const s=new ArrayBuffer(4*n);let o=null,a=0;for(let n=0;n<e.length;n++){const l=t[n],u=e[n],c=Rt(u);i[c]||(i[c]=new gn[c](s)),o=i[c];for(let e=0;e<u.length;e++)o[(e/l|0)*r+a+e%l]=u[e];a+=l}return new Float32Array(s)}(e,t),r=0;r<this.buffers.length;r++)this.buffers[r]!==this.indexBuffer&&this.buffers[r].destroy();return this.buffers=[n],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const e in this.attributes){const t=this.attributes[e];return this.buffers[t.buffer].data.length/(t.stride/4||t.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const e=new bn;for(let t=0;t<this.buffers.length;t++)e.buffers[t]=new pn(this.buffers[t].data.slice(0));for(const t in this.attributes){const n=this.attributes[t];e.attributes[t]=new mn(n.buffer,n.size,n.normalized,n.type,n.stride,n.start,n.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=Te.ELEMENT_ARRAY_BUFFER),e}static merge(e){const t=new bn,n=[],r=[],i=[];let s;for(let t=0;t<e.length;t++){s=e[t];for(let e=0;e<s.buffers.length;e++)r[e]=r[e]||0,r[e]+=s.buffers[e].data.length,i[e]=0}for(let e=0;e<s.buffers.length;e++)n[e]=new(xn[Rt(s.buffers[e].data)])(r[e]),t.buffers[e]=new pn(n[e]);for(let t=0;t<e.length;t++){s=e[t];for(let e=0;e<s.buffers.length;e++)n[e].set(s.buffers[e].data,i[e]),i[e]+=s.buffers[e].data.length}if(t.attributes=s.attributes,s.indexBuffer){t.indexBuffer=t.buffers[s.buffers.indexOf(s.indexBuffer)],t.indexBuffer.type=Te.ELEMENT_ARRAY_BUFFER;let n=0,r=0,i=0,o=0;for(let e=0;e<s.buffers.length;e++)if(s.buffers[e]!==s.indexBuffer){o=e;break}for(const e in s.attributes){const t=s.attributes[e];(0|t.buffer)===o&&(r+=t.size*yn[t.type]/4)}for(let s=0;s<e.length;s++){const a=e[s].indexBuffer.data;for(let e=0;e<a.length;e++)t.indexBuffer.data[e+i]+=n;n+=e[s].buffers[o].data.length/r,i+=a.length}}return t}}class wn extends bn{constructor(e=!1){super(),this._buffer=new pn(null,e,!1),this._indexBuffer=new pn(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,fe.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,fe.FLOAT).addAttribute("aColor",this._buffer,4,!0,fe.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,fe.FLOAT).addIndex(this._indexBuffer)}}const Sn=2*Math.PI,_n=180/Math.PI,Tn=Math.PI/180;var En=(e=>(e[e.POLY=0]="POLY",e[e.RECT=1]="RECT",e[e.CIRC=2]="CIRC",e[e.ELIP=3]="ELIP",e[e.RREC=4]="RREC",e))(En||{});class Cn{constructor(e=0,t=0){this.x=0,this.y=0,this.x=e,this.y=t}clone(){return new Cn(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,t=e){return this.x=e,this.y=t,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const kn=[new Cn,new Cn,new Cn,new Cn];class An{constructor(e=0,t=0,n=0,r=0){this.x=Number(e),this.y=Number(t),this.width=Number(n),this.height=Number(r),this.type=En.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new An(0,0,0,0)}clone(){return new An(this.x,this.y,this.width,this.height)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}contains(e,t){return!(this.width<=0||this.height<=0)&&e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height}intersects(e,t){if(!t){const t=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=t)return!1;const n=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>n}const n=this.left,r=this.right,i=this.top,s=this.bottom;if(r<=n||s<=i)return!1;const o=kn[0].set(e.left,e.top),a=kn[1].set(e.left,e.bottom),l=kn[2].set(e.right,e.top),u=kn[3].set(e.right,e.bottom);if(l.x<=o.x||a.y<=o.y)return!1;const c=Math.sign(t.a*t.d-t.b*t.c);if(0===c)return!1;if(t.apply(o,o),t.apply(a,a),t.apply(l,l),t.apply(u,u),Math.max(o.x,a.x,l.x,u.x)<=n||Math.min(o.x,a.x,l.x,u.x)>=r||Math.max(o.y,a.y,l.y,u.y)<=i||Math.min(o.y,a.y,l.y,u.y)>=s)return!1;const h=c*(a.y-o.y),d=c*(o.x-a.x),f=h*n+d*i,p=h*r+d*i,m=h*n+d*s,g=h*r+d*s;if(Math.max(f,p,m,g)<=h*o.x+d*o.y||Math.min(f,p,m,g)>=h*u.x+d*u.y)return!1;const y=c*(o.y-l.y),v=c*(l.x-o.x),x=y*n+v*i,b=y*r+v*i,w=y*n+v*s,S=y*r+v*s;return!(Math.max(x,b,w,S)<=y*o.x+v*o.y||Math.min(x,b,w,S)>=y*u.x+v*u.y)}pad(e=0,t=e){return this.x-=e,this.y-=t,this.width+=2*e,this.height+=2*t,this}fit(e){const t=Math.max(this.x,e.x),n=Math.min(this.x+this.width,e.x+e.width),r=Math.max(this.y,e.y),i=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(n-t,0),this.y=r,this.height=Math.max(i-r,0),this}ceil(e=1,t=.001){const n=Math.ceil((this.x+this.width-t)*e)/e,r=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=n-this.x,this.height=r-this.y,this}enlarge(e){const t=Math.min(this.x,e.x),n=Math.max(this.x+this.width,e.x+e.width),r=Math.min(this.y,e.y),i=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=n-t,this.y=r,this.height=i-r,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Mn{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.radius=n,this.type=En.CIRC}clone(){return new Mn(this.x,this.y,this.radius)}contains(e,t){if(this.radius<=0)return!1;const n=this.radius*this.radius;let r=this.x-e,i=this.y-t;return r*=r,i*=i,r+i<=n}getBounds(){return new An(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Pn{constructor(e=0,t=0,n=0,r=0){this.x=e,this.y=t,this.width=n,this.height=r,this.type=En.ELIP}clone(){return new Pn(this.x,this.y,this.width,this.height)}contains(e,t){if(this.width<=0||this.height<=0)return!1;let n=(e-this.x)/this.width,r=(t-this.y)/this.height;return n*=n,r*=r,n+r<=1}getBounds(){return new An(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Rn{constructor(...e){let t=Array.isArray(e[0])?e[0]:e;if("number"!=typeof t[0]){const e=[];for(let n=0,r=t.length;n<r;n++)e.push(t[n].x,t[n].y);t=e}this.points=t,this.type=En.POLY,this.closeStroke=!0}clone(){const e=this.points.slice(),t=new Rn(e);return t.closeStroke=this.closeStroke,t}contains(e,t){let n=!1;const r=this.points.length/2;for(let i=0,s=r-1;i<r;s=i++){const r=this.points[2*i],o=this.points[2*i+1],a=this.points[2*s],l=this.points[2*s+1];o>t!=l>t&&e<(t-o)/(l-o)*(a-r)+r&&(n=!n)}return n}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce(((e,t)=>`${e}, ${t}`),"")}]`}}class In{constructor(e=0,t=0,n=0,r=0,i=20){this.x=e,this.y=t,this.width=n,this.height=r,this.radius=i,this.type=En.RREC}clone(){return new In(this.x,this.y,this.width,this.height,this.radius)}contains(e,t){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){const n=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(t>=this.y+n&&t<=this.y+this.height-n||e>=this.x+n&&e<=this.x+this.width-n)return!0;let r=e-(this.x+n),i=t-(this.y+n);const s=n*n;if(r*r+i*i<=s)return!0;if(r=e-(this.x+this.width-n),r*r+i*i<=s)return!0;if(i=t-(this.y+this.height-n),r*r+i*i<=s)return!0;if(r=e-(this.x+n),r*r+i*i<=s)return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class Dn{constructor(e=1,t=0,n=0,r=1,i=0,s=0){this.array=null,this.a=e,this.b=t,this.c=n,this.d=r,this.tx=i,this.ty=s}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,t,n,r,i,s){return this.a=e,this.b=t,this.c=n,this.d=r,this.tx=i,this.ty=s,this}toArray(e,t){this.array||(this.array=new Float32Array(9));const n=t||this.array;return e?(n[0]=this.a,n[1]=this.b,n[2]=0,n[3]=this.c,n[4]=this.d,n[5]=0,n[6]=this.tx,n[7]=this.ty,n[8]=1):(n[0]=this.a,n[1]=this.c,n[2]=this.tx,n[3]=this.b,n[4]=this.d,n[5]=this.ty,n[6]=0,n[7]=0,n[8]=1),n}apply(e,t){t=t||new Cn;const n=e.x,r=e.y;return t.x=this.a*n+this.c*r+this.tx,t.y=this.b*n+this.d*r+this.ty,t}applyInverse(e,t){t=t||new Cn;const n=1/(this.a*this.d+this.c*-this.b),r=e.x,i=e.y;return t.x=this.d*n*r+-this.c*n*i+(this.ty*this.c-this.tx*this.d)*n,t.y=this.a*n*i+-this.b*n*r+(-this.ty*this.a+this.tx*this.b)*n,t}translate(e,t){return this.tx+=e,this.ty+=t,this}scale(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),r=this.a,i=this.c,s=this.tx;return this.a=r*t-this.b*n,this.b=r*n+this.b*t,this.c=i*t-this.d*n,this.d=i*n+this.d*t,this.tx=s*t-this.ty*n,this.ty=s*n+this.ty*t,this}append(e){const t=this.a,n=this.b,r=this.c,i=this.d;return this.a=e.a*t+e.b*r,this.b=e.a*n+e.b*i,this.c=e.c*t+e.d*r,this.d=e.c*n+e.d*i,this.tx=e.tx*t+e.ty*r+this.tx,this.ty=e.tx*n+e.ty*i+this.ty,this}setTransform(e,t,n,r,i,s,o,a,l){return this.a=Math.cos(o+l)*i,this.b=Math.sin(o+l)*i,this.c=-Math.sin(o-a)*s,this.d=Math.cos(o-a)*s,this.tx=e-(n*this.a+r*this.c),this.ty=t-(n*this.b+r*this.d),this}prepend(e){const t=this.tx;if(1!==e.a||0!==e.b||0!==e.c||1!==e.d){const t=this.a,n=this.c;this.a=t*e.a+this.b*e.c,this.b=t*e.b+this.b*e.d,this.c=n*e.a+this.d*e.c,this.d=n*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this}decompose(e){const t=this.a,n=this.b,r=this.c,i=this.d,s=e.pivot,o=-Math.atan2(-r,i),a=Math.atan2(n,t),l=Math.abs(o+a);return l<1e-5||Math.abs(Sn-l)<1e-5?(e.rotation=a,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=o,e.skew.y=a),e.scale.x=Math.sqrt(t*t+n*n),e.scale.y=Math.sqrt(r*r+i*i),e.position.x=this.tx+(s.x*t+s.y*r),e.position.y=this.ty+(s.x*n+s.y*i),e}invert(){const e=this.a,t=this.b,n=this.c,r=this.d,i=this.tx,s=e*r-t*n;return this.a=r/s,this.b=-t/s,this.c=-n/s,this.d=e/s,this.tx=(n*this.ty-r*i)/s,this.ty=-(e*this.ty-t*i)/s,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const e=new Dn;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new Dn}static get TEMP_MATRIX(){return new Dn}}const Fn=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Nn=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Ln=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Bn=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],On=[],zn=[],jn=Math.sign;!function(){for(let e=0;e<16;e++){const t=[];On.push(t);for(let n=0;n<16;n++){const r=jn(Fn[e]*Fn[n]+Ln[e]*Nn[n]),i=jn(Nn[e]*Fn[n]+Bn[e]*Nn[n]),s=jn(Fn[e]*Ln[n]+Ln[e]*Bn[n]),o=jn(Nn[e]*Ln[n]+Bn[e]*Bn[n]);for(let e=0;e<16;e++)if(Fn[e]===r&&Nn[e]===i&&Ln[e]===s&&Bn[e]===o){t.push(e);break}}}for(let e=0;e<16;e++){const t=new Dn;t.set(Fn[e],Nn[e],Ln[e],Bn[e],0,0),zn.push(t)}}();const Un={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:e=>Fn[e],uY:e=>Nn[e],vX:e=>Ln[e],vY:e=>Bn[e],inv:e=>8&e?15&e:7&-e,add:(e,t)=>On[e][t],sub:(e,t)=>On[e][Un.inv(t)],rotate180:e=>4^e,isVertical:e=>2==(3&e),byDirection:(e,t)=>2*Math.abs(e)<=Math.abs(t)?t>=0?Un.S:Un.N:2*Math.abs(t)<=Math.abs(e)?e>0?Un.E:Un.W:t>0?e>0?Un.SE:Un.SW:e>0?Un.NE:Un.NW,matrixAppendRotationInv:(e,t,n=0,r=0)=>{const i=zn[Un.inv(t)];i.tx=n,i.ty=r,e.append(i)}};class Gn{constructor(e,t,n=0,r=0){this._x=n,this._y=r,this.cb=e,this.scope=t}clone(e=this.cb,t=this.scope){return new Gn(e,t,this._x,this._y)}set(e=0,t=e){return this._x===e&&this._y===t||(this._x=e,this._y=t,this.cb.call(this.scope)),this}copyFrom(e){return this._x===e.x&&this._y===e.y||(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}}const Vn=class{constructor(){this.worldTransform=new Dn,this.localTransform=new Dn,this.position=new Gn(this.onChange,this,0,0),this.scale=new Gn(this.onChange,this,1,1),this.pivot=new Gn(this.onChange,this,0,0),this.skew=new Gn(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(e){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){const n=e.worldTransform,r=this.worldTransform;r.a=t.a*n.a+t.b*n.c,r.b=t.a*n.b+t.b*n.d,r.c=t.c*n.a+t.d*n.c,r.d=t.c*n.b+t.d*n.d,r.tx=t.tx*n.a+t.ty*n.c+n.tx,r.ty=t.tx*n.b+t.ty*n.d+n.ty,this._parentID=e._worldID,this._worldID++}}setFromMatrix(e){e.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())}};let Hn=Vn;Hn.IDENTITY=new Vn;const Wn=[{test:e=>"float"===e.type&&1===e.size&&!e.isArray,code:e=>`\n            if(uv["${e}"] !== ud["${e}"].value)\n            {\n                ud["${e}"].value = uv["${e}"]\n                gl.uniform1f(ud["${e}"].location, uv["${e}"])\n            }\n            `},{test:(e,t)=>!("sampler2D"!==e.type&&"samplerCube"!==e.type&&"sampler2DArray"!==e.type||1!==e.size||e.isArray||null!=t&&void 0===t.castToBaseTexture),code:e=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv["${e}"], t);\n\n            if(ud["${e}"].value !== t)\n            {\n                ud["${e}"].value = t;\n                gl.uniform1i(ud["${e}"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(e,t)=>"mat3"===e.type&&1===e.size&&!e.isArray&&void 0!==t.a,code:e=>`\n            gl.uniformMatrix3fv(ud["${e}"].location, false, uv["${e}"].toArray(true));\n            `,codeUbo:e=>`\n                var ${e}_matrix = uv.${e}.toArray(true);\n\n                data[offset] = ${e}_matrix[0];\n                data[offset+1] = ${e}_matrix[1];\n                data[offset+2] = ${e}_matrix[2];\n        \n                data[offset + 4] = ${e}_matrix[3];\n                data[offset + 5] = ${e}_matrix[4];\n                data[offset + 6] = ${e}_matrix[5];\n        \n                data[offset + 8] = ${e}_matrix[6];\n                data[offset + 9] = ${e}_matrix[7];\n                data[offset + 10] = ${e}_matrix[8];\n            `},{test:(e,t)=>"vec2"===e.type&&1===e.size&&!e.isArray&&void 0!==t.x,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["${e}"].location, v.x, v.y);\n                }`,codeUbo:e=>`\n                v = uv.${e};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:e=>"vec2"===e.type&&1===e.size&&!e.isArray,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["${e}"].location, v[0], v[1]);\n                }\n            `},{test:(e,t)=>"vec4"===e.type&&1===e.size&&!e.isArray&&void 0!==t.width,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["${e}"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:e=>`\n                    v = uv.${e};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:(e,t)=>"vec4"===e.type&&1===e.size&&!e.isArray&&void 0!==t.red,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n                    cv[3] = v.alpha;\n                    gl.uniform4f(ud["${e}"].location, v.red, v.green, v.blue, v.alpha)\n                }`,codeUbo:e=>`\n                    v = uv.${e};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                    data[offset+3] = v.alpha;\n                `},{test:(e,t)=>"vec3"===e.type&&1===e.size&&!e.isArray&&void 0!==t.red,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n    \n                    gl.uniform3f(ud["${e}"].location, v.red, v.green, v.blue)\n                }`,codeUbo:e=>`\n                    v = uv.${e};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                `},{test:e=>"vec4"===e.type&&1===e.size&&!e.isArray,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["${e}"].location, v[0], v[1], v[2], v[3])\n                }`}],Xn={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"},$n={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"},Yn={};let qn,Kn=Yn;const Zn={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Qn(e){return Zn[e]}let Jn=null;const er={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function tr(e,t){if(!Jn){const t=Object.keys(er);Jn={};for(let n=0;n<t.length;++n){const r=t[n];Jn[e[r]]=er[r]}}return Jn[t]}function nr(e,t,n){if("precision"!==e.substring(0,9)){let r=t;return t===we.HIGH&&n!==we.HIGH&&(r=we.MEDIUM),`precision ${r} float;\n${e}`}return n!==we.HIGH&&"precision highp"===e.substring(0,15)?e.replace("precision highp","precision mediump"):e}let rr=0;const ir={},sr=class{constructor(e,t,n="pixi-shader",r={}){this.extra={},this.id=rr++,this.vertexSrc=e||sr.defaultVertexSrc,this.fragmentSrc=t||sr.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=r,"#version"!==this.vertexSrc.substring(0,8)&&(n=n.replace(/\s+/g,"-"),ir[n]?(ir[n]++,n+=`-${ir[n]}`):ir[n]=1,this.vertexSrc=`#define SHADER_NAME ${n}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${n}\n${this.fragmentSrc}`,this.vertexSrc=nr(this.vertexSrc,sr.defaultVertexPrecision,we.HIGH),this.fragmentSrc=nr(this.fragmentSrc,sr.defaultFragmentPrecision,function(){if(!qn){qn=we.MEDIUM;const e=function(){if(Kn===Yn||Kn?.isContextLost()){const e=Ce.ADAPTER.createCanvas();let t;Ce.PREFER_ENV>=ae.WEBGL2&&(t=e.getContext("webgl2",{})),t||(t=e.getContext("webgl",{})||e.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Kn=t}return Kn}();if(e&&e.getShaderPrecisionFormat){const t=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);qn=t.precision?we.HIGH:we.MEDIUM}}return qn}())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"}static from(e,t,n){const r=e+t;let i=Ut[r];return i||(Ut[r]=i=new sr(e,t,n)),i}};let or=sr;or.defaultVertexPrecision=we.HIGH,or.defaultFragmentPrecision=Ve.apple.device?we.HIGH:we.MEDIUM;let ar=0;class lr{constructor(e,t,n){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=ar++,this.static=!!t,this.ubo=!!n,e instanceof pn?(this.buffer=e,this.buffer.type=Te.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new pn(new Float32Array(1)),this.buffer.type=Te.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(e,t,n){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[e]=new lr(t,n)}static from(e,t,n){return new lr(e,t,n)}static uboFrom(e,t){return new lr(e,t??!0,!0)}}class ur{constructor(e,t){this.uniformBindCount=0,this.program=e,this.uniformGroup=t?t instanceof lr?t:new lr(t):new lr({}),this.disposeRunner=new on("disposeShader")}checkUniformExists(e,t){if(t.uniforms[e])return!0;for(const n in t.uniforms){const r=t.uniforms[n];if(r.group&&this.checkUniformExists(e,r))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(e,t,n){const r=or.from(e,t);return new ur(r,n)}}class cr{constructor(e,t){if(this.vertexSrc=e,this.fragTemplate=t,this.programCache={},this.defaultGroupCache={},!t.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!t.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(e){if(!this.programCache[e]){const t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=n;this.defaultGroupCache[e]=lr.from({uSamplers:t},!0);let n=this.fragTemplate;n=n.replace(/%count%/gi,`${e}`),n=n.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new or(this.vertexSrc,n)}const t={tint:new Float32Array([1,1,1,1]),translationMatrix:new Dn,default:this.defaultGroupCache[e]};return new ur(this.programCache[e],t)}generateSampleSrc(e){let t="";t+="\n",t+="\n";for(let n=0;n<e;n++)n>0&&(t+="\nelse "),n<e-1&&(t+=`if(vTextureId < ${n}.5)`),t+="\n{",t+=`\n\tcolor = texture2D(uSamplers[${n}], vTextureCoord);`,t+="\n}";return t+="\n",t+="\n",t}}class hr{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let e=0;e<this.count;e++)this.elements[e]=null;this.count=0}}class dr{constructor(e){this.renderer=e}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(e){}}const fr=class extends dr{constructor(e){super(e),this.setShaderGenerator(),this.geometryClass=wn,this.vertexSize=6,this.state=nn.for2d(),this.size=4*fr.defaultBatchSize,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??function(e){let t=!0;const n=Ce.ADAPTER.getNavigator();if(Ve.tablet||Ve.phone){if(Ve.apple.device){const e=n.userAgent.match(/OS (\d+)_(\d+)?/);e&&parseInt(e[1],10)<11&&(t=!1)}if(Ve.android.device){const e=n.userAgent.match(/Android\s([0-9.]*)/);e&&parseInt(e[1],10)<7&&(t=!1)}}return t?32:4}(),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??!Ve.apple.device,this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return Qe("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n"}static get defaultFragmentTemplate(){return"varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n"}setShaderGenerator({vertex:e=fr.defaultVertexSrc,fragment:t=fr.defaultFragmentTemplate}={}){this.shaderGenerator=new cr(e,t)}contextChange(){const e=this.renderer.gl;Ce.PREFER_ENV===ae.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),fr.defaultMaxTextures),this.maxTextures=function(e,t){if(0===e)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const n=t.createShader(t.FRAGMENT_SHADER);for(;;){const r=en.replace(/%forloop%/gi,tn(e));if(t.shaderSource(n,r),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS))break;e=e/2|0}return e}(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:e,_textureArrayPool:t}=fr,n=this.size/4,r=Math.floor(n/this.maxTextures)+1;for(;e.length<n;)e.push(new dn);for(;t.length<r;)t.push(new hr);for(let e=0;e<this.maxTextures;e++)this._tempBoundTextures[e]=null}onPrerender(){this._flushId=0}render(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){const{_bufferedTextures:e,maxTextures:t}=this,n=fr._textureArrayPool,r=this.renderer.batch,i=this._tempBoundTextures,s=this.renderer.textureGC.count;let o=++hn._globalBatch,a=0,l=n[0],u=0;r.copyBoundTextures(i,t);for(let c=0;c<this._bufferSize;++c){const h=e[c];e[c]=null,h._batchEnabled!==o&&(l.count>=t&&(r.boundArray(l,i,o,t),this.buildDrawCalls(l,u,c),u=c,l=n[++a],++o),h._batchEnabled=o,h.touched=s,l.elements[l.count++]=h)}l.count>0&&(r.boundArray(l,i,o,t),this.buildDrawCalls(l,u,this._bufferSize),++a,++o);for(let e=0;e<i.length;e++)i[e]=null;hn._globalBatch=o}buildDrawCalls(e,t,n){const{_bufferedElements:r,_attributeBuffer:i,_indexBuffer:s,vertexSize:o}=this,a=fr._drawCallPool;let l=this._dcIndex,u=this._aIndex,c=this._iIndex,h=a[l];h.start=this._iIndex,h.texArray=e;for(let d=t;d<n;++d){const n=r[d],f=n._texture.baseTexture,p=Mt[f.alphaMode?1:0][n.blendMode];r[d]=null,t<d&&h.blend!==p&&(h.size=c-h.start,t=d,h=a[++l],h.texArray=e,h.start=c),this.packInterleavedGeometry(n,i,s,u,c),u+=n.vertexData.length/2*o,c+=n.indices.length,h.blend=p}t<n&&(h.size=c-h.start,++l),this._dcIndex=l,this._aIndex=u,this._iIndex=c}bindAndClearTexArray(e){const t=this.renderer.texture;for(let n=0;n<e.count;n++)t.bind(e.elements[n],e.ids[n]),e.elements[n]=null;e.count=0}updateGeometry(){const{_packedGeometries:e,_attributeBuffer:t,_indexBuffer:n}=this;fr.canUploadSameBuffer?(e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(n),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(n),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const e=this._dcIndex,{gl:t,state:n}=this.renderer,r=fr._drawCallPool;let i=null;for(let s=0;s<e;s++){const{texArray:e,type:o,size:a,start:l,blend:u}=r[s];i!==e&&(i=e,this.bindAndClearTexArray(e)),this.state.blendMode=u,n.set(this.state),t.drawElements(o,a,t.UNSIGNED_SHORT,2*l)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),fr.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){const t=It(Math.ceil(e/8)),n=Ft(t),r=8*t;this._aBuffers.length<=n&&(this._iBuffers.length=n+1);let i=this._aBuffers[r];return i||(this._aBuffers[r]=i=new Jt(r*this.vertexSize*4)),i}getIndexBuffer(e){const t=It(Math.ceil(e/12)),n=Ft(t),r=12*t;this._iBuffers.length<=n&&(this._iBuffers.length=n+1);let i=this._iBuffers[n];return i||(this._iBuffers[n]=i=new Uint16Array(r)),i}packInterleavedGeometry(e,t,n,r,i){const{uint32View:s,float32View:o}=t,a=r/this.vertexSize,l=e.uvs,u=e.indices,c=e.vertexData,h=e._texture.baseTexture._batchLocation,d=Math.min(e.worldAlpha,1),f=At.shared.setValue(e._tintRGB).toPremultiplied(d);for(let e=0;e<c.length;e+=2)o[r++]=c[e],o[r++]=c[e+1],o[r++]=l[e],o[r++]=l[e+1],s[r++]=f,o[r++]=h;for(let e=0;e<u.length;e++)n[i++]=a+u[e]}};let pr=fr;pr.defaultBatchSize=4096,pr.extension={name:"batch",type:qt.RendererPlugin},pr._drawCallPool=[],pr._textureArrayPool=[],Qt.add(pr);const mr=class extends ur{constructor(e,t,n){super(or.from(e||mr.defaultVertexSrc,t||mr.defaultFragmentSrc),n),this.padding=0,this.resolution=mr.defaultResolution,this.multisample=mr.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new nn}apply(e,t,n,r,i){e.applyFilter(this,t,n,r)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"}};let gr=mr;gr.defaultResolution=1,gr.defaultMultisample=_e.NONE;class yr{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new At(0),this.alpha=1}init(e){this.clearBeforeRender=e.clearBeforeRender;const{backgroundColor:t,background:n,backgroundAlpha:r}=e,i=n??t;void 0!==i&&(this.color=i),this.alpha=r}get color(){return this._backgroundColor.value}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get backgroundColor(){return this._backgroundColor}destroy(){}}yr.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},yr.extension={type:[qt.RendererSystem,qt.CanvasRendererSystem],name:"background"},Qt.add(yr);class vr{constructor(e){this.renderer=e,this.emptyRenderer=new dr(e),this.currentRenderer=this.emptyRenderer}setObjectRenderer(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(e,t){const{boundTextures:n}=this.renderer.texture;for(let r=t-1;r>=0;--r)e[r]=n[r]||null,e[r]&&(e[r]._batchLocation=r)}boundArray(e,t,n,r){const{elements:i,ids:s,count:o}=e;let a=0;for(let e=0;e<o;e++){const o=i[e],l=o._batchLocation;if(l>=0&&l<r&&t[l]===o)s[e]=l;else for(;a<r;){const r=t[a];if(!r||r._batchEnabled!==n||r._batchLocation!==a){s[e]=a,o._batchLocation=a,t[a]=o;break}a++}}}destroy(){this.renderer=null}}vr.extension={type:qt.RendererSystem,name:"batch"},Qt.add(vr);let xr=0;class br{constructor(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=xr++}init(e){if(e.context)this.initFromContext(e.context);else{const t=this.renderer.background.alpha<1,n=e.premultipliedAlpha;this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.useContextAlpha=e.useContextAlpha,this.powerPreference=e.powerPreference,this.initFromOptions({alpha:t,premultipliedAlpha:n,antialias:e.antialias,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference})}}initFromContext(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=xr++,this.renderer.runners.contextChange.emit(e);const t=this.renderer.view;void 0!==t.addEventListener&&(t.addEventListener("webglcontextlost",this.handleContextLost,!1),t.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(e){const t=this.createContext(this.renderer.view,e);this.initFromContext(t)}createContext(e,t){let n;if(Ce.PREFER_ENV>=ae.WEBGL2&&(n=e.getContext("webgl2",t)),n)this.webGLVersion=2;else if(this.webGLVersion=1,n=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),!n)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=n,this.getExtensions(),this.gl}getExtensions(){const{gl:e}=this,t={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,t,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,t,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})}handleContextLost(e){e.preventDefault(),setTimeout((()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()}),0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const e=this.renderer.view;this.renderer=null,void 0!==e.removeEventListener&&(e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(e){const t=e.getContextAttributes(),n="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;n&&(this.webGLVersion=2),t&&!t.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const r=n||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=r,r||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}br.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},br.extension={type:qt.RendererSystem,name:"context"},Qt.add(br);class wr extends ln{upload(e,t,n){const r=e.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===ve.UNPACK);const i=t.realWidth,s=t.realHeight;return n.width===i&&n.height===s?r.texSubImage2D(t.target,0,0,0,i,s,t.format,n.type,this.data):(n.width=i,n.height=s,r.texImage2D(t.target,0,n.internalFormat,i,s,0,t.format,n.type,this.data)),!0}}class Sr{constructor(e,t){this.width=Math.round(e||100),this.height=Math.round(t||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new on("disposeFramebuffer"),this.multisample=_e.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(e=0,t){return this.colorTextures[e]=t||new hn(null,{scaleMode:me.NEAREST,resolution:1,mipmap:ye.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(e){return this.depthTexture=e||new hn(new wr(null,{width:this.width,height:this.height}),{scaleMode:me.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:ye.OFF,format:he.DEPTH_COMPONENT,type:fe.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(e,t){if(e=Math.round(e),t=Math.round(t),e!==this.width||t!==this.height){this.width=e,this.height=t,this.dirtyId++,this.dirtySize++;for(let n=0;n<this.colorTextures.length;n++){const r=this.colorTextures[n],i=r.resolution;r.setSize(e/i,t/i)}if(this.depthTexture){const n=this.depthTexture.resolution;this.depthTexture.setSize(e/n,t/n)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class _r extends hn{constructor(e={}){"number"==typeof e&&(e={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),e.width=e.width||100,e.height=e.height||100,e.multisample??(e.multisample=_e.NONE),super(null,e),this.mipmap=ye.OFF,this.valid=!0,this._clear=new At([0,0,0,0]),this.framebuffer=new Sr(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=e.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(e){this._clear.setValue(e)}get clearColor(){return this._clear.value}get clear(){return this._clear}resize(e,t){this.framebuffer.resize(e*this.resolution,t*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Tr extends an{constructor(e){const t=e;super(t.naturalWidth||t.videoWidth||t.width,t.naturalHeight||t.videoHeight||t.height),this.source=e,this.noSubImage=!1}static crossOrigin(e,t,n){void 0!==n||t.startsWith("data:")?!1!==n&&(e.crossOrigin="string"==typeof n?n:"anonymous"):e.crossOrigin=function(e,t=globalThis.location){if(e.startsWith("data:"))return"";t=t||globalThis.location,$t||($t=document.createElement("a")),$t.href=e;const n=$e.parse($t.href),r=!n.port&&""===t.port||n.port===t.port;return n.hostname===t.hostname&&r&&n.protocol===t.protocol?"":"anonymous"}(t)}upload(e,t,n,r){const i=e.gl,s=t.realWidth,o=t.realHeight;if(r=r||this.source,"undefined"!=typeof HTMLImageElement&&r instanceof HTMLImageElement){if(!r.complete||0===r.naturalWidth)return!1}else if("undefined"!=typeof HTMLVideoElement&&r instanceof HTMLVideoElement&&r.readyState<=1&&0===r.buffered.length)return!1;return i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===ve.UNPACK),this.noSubImage||t.target!==i.TEXTURE_2D||n.width!==s||n.height!==o?(n.width=s,n.height=o,i.texImage2D(t.target,0,n.internalFormat,t.format,n.type,r)):i.texSubImage2D(i.TEXTURE_2D,0,0,0,t.format,n.type,r),!0}update(){if(this.destroyed)return;const e=this.source,t=e.naturalWidth||e.videoWidth||e.width,n=e.naturalHeight||e.videoHeight||e.height;this.resize(t,n),super.update()}dispose(){this.source=null}}class Er extends Tr{constructor(e,t){if(t=t||{},"string"==typeof e){const n=new Image;Tr.crossOrigin(n,e,t.crossorigin),n.src=e,e=n}super(e),!e.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(t.createBitmap??Ce.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode="number"==typeof t.alphaMode?t.alphaMode:null,this.bitmap=null,this._load=null,!1!==t.autoLoad&&this.load()}load(e){return this._load||(void 0!==e&&(this.createBitmap=e),this._load=new Promise(((e,t)=>{const n=this.source;this.url=n.src;const r=()=>{this.destroyed||(n.onload=null,n.onerror=null,this.resize(n.width,n.height),this._load=null,this.createBitmap?e(this.process()):e(this))};n.complete&&n.src?r():(n.onload=r,n.onerror=e=>{t(e),this.onError.emit(e)})}))),this._load}process(){const e=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);const t=globalThis.createImageBitmap,n=!e.crossOrigin||"anonymous"===e.crossOrigin;return this._process=fetch(e.src,{mode:n?"cors":"no-cors"}).then((e=>e.blob())).then((n=>t(n,0,0,e.width,e.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===ve.UNPACK?"premultiply":"none"}))).then((e=>this.destroyed?Promise.reject():(this.bitmap=e,this.update(),this._process=null,Promise.resolve(this)))),this._process}upload(e,t,n){if("number"==typeof this.alphaMode&&(t.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(e,t,n);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(e,t,n,this.bitmap),!this.preserveBitmap){let e=!0;const r=t._glTextures;for(const i in r){const s=r[i];if(s!==n&&s.dirtyId!==t.dirtyId){e=!1;break}}e&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(e){return"undefined"!=typeof HTMLImageElement&&("string"==typeof e||e instanceof HTMLImageElement)}}class Cr{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,t,n){const r=t.width,i=t.height;if(n){const t=e.width/2/r,s=e.height/2/i,o=e.x/r+t,a=e.y/i+s;n=Un.add(n,Un.NW),this.x0=o+t*Un.uX(n),this.y0=a+s*Un.uY(n),n=Un.add(n,2),this.x1=o+t*Un.uX(n),this.y1=a+s*Un.uY(n),n=Un.add(n,2),this.x2=o+t*Un.uX(n),this.y2=a+s*Un.uY(n),n=Un.add(n,2),this.x3=o+t*Un.uX(n),this.y3=a+s*Un.uY(n)}else this.x0=e.x/r,this.y0=e.y/i,this.x1=(e.x+e.width)/r,this.y1=e.y/i,this.x2=(e.x+e.width)/r,this.y2=(e.y+e.height)/i,this.x3=e.x/r,this.y3=(e.y+e.height)/i;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const kr=new Cr;function Ar(e){e.destroy=function(){},e.on=function(){},e.once=function(){},e.emit=function(){}}class Mr extends He{constructor(e,t,n,r,i,s,o){if(super(),this.noFrame=!1,t||(this.noFrame=!0,t=new An(0,0,1,1)),e instanceof Mr&&(e=e.baseTexture),this.baseTexture=e,this._frame=t,this.trim=r,this.valid=!1,this._uvs=kr,this.uvMatrix=null,this.orig=n||t,this._rotate=Number(i||0),!0===i)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=s?new Cn(s.x,s.y):new Cn(0,0),this.defaultBorders=o,this._updateID=0,this.textureCacheIds=[],e.valid?this.noFrame?e.valid&&this.onBaseTextureUpdated(e):this.frame=t:e.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&e.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(e){if(this.baseTexture){if(e){const{resource:e}=this.baseTexture;e?.url&&Gt[e.url]&&Mr.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Mr.removeFromCache(this),this.textureCacheIds=null}clone(){const e=this._frame.clone(),t=this._frame===this.orig?e:this.orig.clone(),n=new Mr(this.baseTexture,!this.noFrame&&e,t,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(n._frame=e),n}updateUvs(){this._uvs===kr&&(this._uvs=new Cr),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(e,t={},n=Ce.STRICT_TEXTURE_CACHE){const r="string"==typeof e;let i=null;if(r)i=e;else if(e instanceof hn){if(!e.cacheId){const n=t?.pixiIdPrefix||"pixiid";e.cacheId=`${n}-${Ot()}`,hn.addToCache(e,e.cacheId)}i=e.cacheId}else{if(!e._pixiId){const n=t?.pixiIdPrefix||"pixiid";e._pixiId=`${n}_${Ot()}`}i=e._pixiId}let s=Gt[i];if(r&&n&&!s)throw new Error(`The cacheId "${i}" does not exist in TextureCache.`);return s||e instanceof hn?!s&&e instanceof hn&&(s=new Mr(e),Mr.addToCache(s,i)):(t.resolution||(t.resolution=Yt(e)),s=new Mr(new hn(e,t)),s.baseTexture.cacheId=i,hn.addToCache(s.baseTexture,i),Mr.addToCache(s,i)),s}static fromURL(e,t){const n=Object.assign({autoLoad:!1},t?.resourceOptions),r=Mr.from(e,Object.assign({resourceOptions:n},t),!1),i=r.baseTexture.resource;return r.baseTexture.valid?Promise.resolve(r):i.load().then((()=>Promise.resolve(r)))}static fromBuffer(e,t,n,r){return new Mr(hn.fromBuffer(e,t,n,r))}static fromLoader(e,t,n,r){const i=new hn(e,Object.assign({scaleMode:hn.defaultOptions.scaleMode,resolution:Yt(t)},r)),{resource:s}=i;s instanceof Er&&(s.url=t);const o=new Mr(i);return n||(n=t),hn.addToCache(o.baseTexture,n),Mr.addToCache(o,n),n!==t&&(hn.addToCache(o.baseTexture,t),Mr.addToCache(o,t)),o.baseTexture.valid?Promise.resolve(o):new Promise((e=>{o.baseTexture.once("loaded",(()=>e(o)))}))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),Gt[t]&&Gt[t]!==e&&console.warn(`Texture added to the cache with an id [${t}] that already had an entry`),Gt[t]=e)}static removeFromCache(e){if("string"==typeof e){const t=Gt[e];if(t){const n=t.textureCacheIds.indexOf(e);return n>-1&&t.textureCacheIds.splice(n,1),delete Gt[e],t}}else if(e?.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)Gt[e.textureCacheIds[t]]===e&&delete Gt[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(e){this._frame=e,this.noFrame=!1;const{x:t,y:n,width:r,height:i}=e,s=t+r>this.baseTexture.width,o=n+i>this.baseTexture.height;if(s||o){const e=s&&o?"and":"or",a=`X: ${t} + ${r} = ${t+r} > ${this.baseTexture.width}`,l=`Y: ${n} + ${i} = ${n+i} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${a} ${e} ${l}`)}this.valid=r&&i&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=e),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(e){this._rotate=e,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Mr._EMPTY||(Mr._EMPTY=new Mr(new hn),Ar(Mr._EMPTY),Ar(Mr._EMPTY.baseTexture)),Mr._EMPTY}static get WHITE(){if(!Mr._WHITE){const e=Ce.ADAPTER.createCanvas(16,16),t=e.getContext("2d");e.width=16,e.height=16,t.fillStyle="white",t.fillRect(0,0,16,16),Mr._WHITE=new Mr(hn.from(e)),Ar(Mr._WHITE),Ar(Mr._WHITE.baseTexture)}return Mr._WHITE}}class Pr extends Mr{constructor(e,t){super(e,t),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t,n=!0){const r=this.baseTexture.resolution,i=Math.round(e*r)/r,s=Math.round(t*r)/r;this.valid=i>0&&s>0,this._frame.width=this.orig.width=i,this._frame.height=this.orig.height=s,n&&this.baseTexture.resize(i,s),this.updateUvs()}setResolution(e){const{baseTexture:t}=this;t.resolution!==e&&(t.setResolution(e),this.resize(t.width,t.height,!1))}static create(e){return new Pr(new _r(e))}}class Rr{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,t,n=_e.NONE){const r=new _r(Object.assign({width:e,height:t,resolution:1,multisample:n},this.textureOptions));return new Pr(r)}getOptimalTexture(e,t,n=1,r=_e.NONE){let i;e=Math.ceil(e*n-1e-6),t=Math.ceil(t*n-1e-6),this.enableFullScreen&&e===this._pixelsWidth&&t===this._pixelsHeight?i=r>1?-r:-1:(i=((65535&(e=It(e)))<<16|65535&(t=It(t)))>>>0,r>1&&(i+=4294967296*r)),this.texturePool[i]||(this.texturePool[i]=[]);let s=this.texturePool[i].pop();return s||(s=this.createTexture(e,t,r)),s.filterPoolKey=i,s.setResolution(n),s}getFilterTexture(e,t,n){const r=this.getOptimalTexture(e.width,e.height,t||e.resolution,n||_e.NONE);return r.filterFrame=e.filterFrame,r}returnTexture(e){const t=e.filterPoolKey;e.filterFrame=null,this.texturePool[t].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=!1!==e)for(const e in this.texturePool){const t=this.texturePool[e];if(t)for(let e=0;e<t.length;e++)t[e].destroy(!0)}this.texturePool={}}setScreenSize(e){if(e.width!==this._pixelsWidth||e.height!==this._pixelsHeight){this.enableFullScreen=e.width>0&&e.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const t=this.texturePool[e];if(t)for(let e=0;e<t.length;e++)t[e].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}}Rr.SCREEN_KEY=-1;class Ir extends bn{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Dr extends bn{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new pn(this.vertices),this.uvBuffer=new pn(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(e,t){let n=0,r=0;return this.uvs[0]=n,this.uvs[1]=r,this.uvs[2]=n+t.width/e.width,this.uvs[3]=r,this.uvs[4]=n+t.width/e.width,this.uvs[5]=r+t.height/e.height,this.uvs[6]=n,this.uvs[7]=r+t.height/e.height,n=t.x,r=t.y,this.vertices[0]=n,this.vertices[1]=r,this.vertices[2]=n+t.width,this.vertices[3]=r,this.vertices[4]=n+t.width,this.vertices[5]=r+t.height,this.vertices[6]=n,this.vertices[7]=r+t.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class Fr{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=_e.NONE,this.sourceFrame=new An,this.destinationFrame=new An,this.bindingSourceFrame=new An,this.bindingDestinationFrame=new An,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Nr=[new Cn,new Cn,new Cn,new Cn],Lr=new Dn;class Br{constructor(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new Rr,this.statePool=[],this.quad=new Ir,this.quadUv=new Dr,this.tempRect=new An,this.activeState={},this.globalUniforms=new lr({outputFrame:new An,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(e,t){const n=this.renderer,r=this.defaultFilterStack,i=this.statePool.pop()||new Fr,s=this.renderer.renderTexture;let o=t[0].resolution,a=t[0].multisample,l=t[0].padding,u=t[0].autoFit,c=t[0].legacy??!0;for(let e=1;e<t.length;e++){const n=t[e];o=Math.min(o,n.resolution),a=Math.min(a,n.multisample),l=this.useMaxPadding?Math.max(l,n.padding):l+n.padding,u=u&&n.autoFit,c=c||(n.legacy??!0)}1===r.length&&(this.defaultFilterStack[0].renderTexture=s.current),r.push(i),i.resolution=o,i.multisample=a,i.legacy=c,i.target=e,i.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),i.sourceFrame.pad(l);const h=this.tempRect.copyFrom(s.sourceFrame);n.projection.transform&&this.transformAABB(Lr.copyFrom(n.projection.transform).invert(),h),u?(i.sourceFrame.fit(h),(i.sourceFrame.width<=0||i.sourceFrame.height<=0)&&(i.sourceFrame.width=0,i.sourceFrame.height=0)):i.sourceFrame.intersects(h)||(i.sourceFrame.width=0,i.sourceFrame.height=0),this.roundFrame(i.sourceFrame,s.current?s.current.resolution:n.resolution,s.sourceFrame,s.destinationFrame,n.projection.transform),i.renderTexture=this.getOptimalFilterTexture(i.sourceFrame.width,i.sourceFrame.height,o,a),i.filters=t,i.destinationFrame.width=i.renderTexture.width,i.destinationFrame.height=i.renderTexture.height;const d=this.tempRect;d.x=0,d.y=0,d.width=i.sourceFrame.width,d.height=i.sourceFrame.height,i.renderTexture.filterFrame=i.sourceFrame,i.bindingSourceFrame.copyFrom(s.sourceFrame),i.bindingDestinationFrame.copyFrom(s.destinationFrame),i.transform=n.projection.transform,n.projection.transform=null,s.bind(i.renderTexture,i.sourceFrame,d),n.framebuffer.clear(0,0,0,0)}pop(){const e=this.defaultFilterStack,t=e.pop(),n=t.filters;this.activeState=t;const r=this.globalUniforms.uniforms;r.outputFrame=t.sourceFrame,r.resolution=t.resolution;const i=r.inputSize,s=r.inputPixel,o=r.inputClamp;if(i[0]=t.destinationFrame.width,i[1]=t.destinationFrame.height,i[2]=1/i[0],i[3]=1/i[1],s[0]=Math.round(i[0]*t.resolution),s[1]=Math.round(i[1]*t.resolution),s[2]=1/s[0],s[3]=1/s[1],o[0]=.5*s[2],o[1]=.5*s[3],o[2]=t.sourceFrame.width*i[2]-.5*s[2],o[3]=t.sourceFrame.height*i[3]-.5*s[3],t.legacy){const e=r.filterArea;e[0]=t.destinationFrame.width,e[1]=t.destinationFrame.height,e[2]=t.sourceFrame.x,e[3]=t.sourceFrame.y,r.filterClamp=r.inputClamp}this.globalUniforms.update();const a=e[e.length-1];if(this.renderer.framebuffer.blit(),1===n.length)n[0].apply(this,t.renderTexture,a.renderTexture,xe.BLEND,t),this.returnFilterTexture(t.renderTexture);else{let e=t.renderTexture,r=this.getOptimalFilterTexture(e.width,e.height,t.resolution);r.filterFrame=e.filterFrame;let i=0;for(i=0;i<n.length-1;++i){1===i&&t.multisample>1&&(r=this.getOptimalFilterTexture(e.width,e.height,t.resolution),r.filterFrame=e.filterFrame),n[i].apply(this,e,r,xe.CLEAR,t);const s=e;e=r,r=s}n[i].apply(this,e,a.renderTexture,xe.BLEND,t),i>1&&t.multisample>1&&this.returnFilterTexture(t.renderTexture),this.returnFilterTexture(e),this.returnFilterTexture(r)}t.clear(),this.statePool.push(t)}bindAndClear(e,t=xe.CLEAR){const{renderTexture:n,state:r}=this.renderer;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e?.filterFrame){const t=this.tempRect;t.x=0,t.y=0,t.width=e.filterFrame.width,t.height=e.filterFrame.height,n.bind(e,e.filterFrame,t)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?n.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const i=1&r.stateId||this.forceClear;(t===xe.CLEAR||t===xe.BLIT&&i)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(e,t,n,r){const i=this.renderer;i.state.set(e.state),this.bindAndClear(n,r),e.uniforms.uSampler=t,e.uniforms.filterGlobals=this.globalUniforms,i.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(t._frame,t.filterFrame),i.geometry.bind(this.quadUv),i.geometry.draw(ce.TRIANGLES)):(i.geometry.bind(this.quad),i.geometry.draw(ce.TRIANGLE_STRIP))}calculateSpriteMatrix(e,t){const{sourceFrame:n,destinationFrame:r}=this.activeState,{orig:i}=t._texture,s=e.set(r.width,0,0,r.height,n.x,n.y),o=t.worldTransform.copyTo(Dn.TEMP_MATRIX);return o.invert(),s.prepend(o),s.scale(1/i.width,1/i.height),s.translate(t.anchor.x,t.anchor.y),s}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(e,t,n=1,r=_e.NONE){return this.texturePool.getOptimalTexture(e,t,n,r)}getFilterTexture(e,t,n){if("number"==typeof e){const n=e;e=t,t=n}e=e||this.activeState.renderTexture;const r=this.texturePool.getOptimalTexture(e.width,e.height,t||e.resolution,n||_e.NONE);return r.filterFrame=e.filterFrame,r}returnFilterTexture(e){this.texturePool.returnTexture(e)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(e,t){const n=Nr[0],r=Nr[1],i=Nr[2],s=Nr[3];n.set(t.left,t.top),r.set(t.left,t.bottom),i.set(t.right,t.top),s.set(t.right,t.bottom),e.apply(n,n),e.apply(r,r),e.apply(i,i),e.apply(s,s);const o=Math.min(n.x,r.x,i.x,s.x),a=Math.min(n.y,r.y,i.y,s.y),l=Math.max(n.x,r.x,i.x,s.x),u=Math.max(n.y,r.y,i.y,s.y);t.x=o,t.y=a,t.width=l-o,t.height=u-a}roundFrame(e,t,n,r,i){if(!(e.width<=0||e.height<=0||n.width<=0||n.height<=0)){if(i){const{a:e,b:t,c:n,d:r}=i;if((Math.abs(t)>1e-4||Math.abs(n)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(r)>1e-4))return}(i=i?Lr.copyFrom(i):Lr.identity()).translate(-n.x,-n.y).scale(r.width/n.width,r.height/n.height).translate(r.x,r.y),this.transformAABB(i,e),e.ceil(t),this.transformAABB(i.invert(),e)}}}Br.extension={type:qt.RendererSystem,name:"filter"},Qt.add(Br);class Or{constructor(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=_e.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const zr=new An;class jr{constructor(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new Sr(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new An,this.hasMRT=!0,this.writeDepthTexture=!0,1===this.renderer.context.webGLVersion){let t=this.renderer.context.extensions.drawBuffers,n=this.renderer.context.extensions.depthTexture;Ce.PREFER_ENV===ae.WEBGL_LEGACY&&(t=null,n=null),t?e.drawBuffers=e=>t.drawBuffersWEBGL(e):(this.hasMRT=!1,e.drawBuffers=()=>{}),n||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(e,t,n=0){const{gl:r}=this;if(e){const i=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,r.bindFramebuffer(r.FRAMEBUFFER,i.framebuffer)),i.mipLevel!==n&&(e.dirtyId++,e.dirtyFormat++,i.mipLevel=n),i.dirtyId!==e.dirtyId&&(i.dirtyId=e.dirtyId,i.dirtyFormat!==e.dirtyFormat?(i.dirtyFormat=e.dirtyFormat,i.dirtySize=e.dirtySize,this.updateFramebuffer(e,n)):i.dirtySize!==e.dirtySize&&(i.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(let t=0;t<e.colorTextures.length;t++){const n=e.colorTextures[t];this.renderer.texture.unbind(n.parentTextureArray||n)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),t){const e=t.width>>n,r=t.height>>n,i=e/t.width;this.setViewport(t.x*i,t.y*i,e,r)}else{const t=e.width>>n,r=e.height>>n;this.setViewport(0,0,t,r)}}else this.current&&(this.current=null,r.bindFramebuffer(r.FRAMEBUFFER,null)),t?this.setViewport(t.x,t.y,t.width,t.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(e,t,n,r){const i=this.viewport;e=Math.round(e),t=Math.round(t),n=Math.round(n),r=Math.round(r),i.width===n&&i.height===r&&i.x===e&&i.y===t||(i.x=e,i.y=t,i.width=n,i.height=r,this.gl.viewport(e,t,n,r))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(e,t,n,r,i=le.COLOR|le.DEPTH){const{gl:s}=this;s.clearColor(e,t,n,r),s.clear(i)}initFramebuffer(e){const{gl:t}=this,n=new Or(t.createFramebuffer());return n.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=n,this.managedFramebuffers.push(e),e.disposeRunner.add(this),n}resizeFramebuffer(e){const{gl:t}=this,n=e.glFramebuffers[this.CONTEXT_UID];n.stencil&&(t.bindRenderbuffer(t.RENDERBUFFER,n.stencil),n.msaaBuffer?t.renderbufferStorageMultisample(t.RENDERBUFFER,n.multisample,t.DEPTH24_STENCIL8,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e.width,e.height));const r=e.colorTextures;let i=r.length;t.drawBuffers||(i=Math.min(i,1));for(let s=0;s<i;s++){const i=r[s],o=i.parentTextureArray||i;this.renderer.texture.bind(o,0),0===s&&n.msaaBuffer&&(t.bindRenderbuffer(t.RENDERBUFFER,n.msaaBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,n.multisample,o._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height))}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)}updateFramebuffer(e,t){const{gl:n}=this,r=e.glFramebuffers[this.CONTEXT_UID],i=e.colorTextures;let s=i.length;n.drawBuffers||(s=Math.min(s,1)),r.multisample>1&&this.canMultisampleFramebuffer(e)?r.msaaBuffer=r.msaaBuffer||n.createRenderbuffer():r.msaaBuffer&&(n.deleteRenderbuffer(r.msaaBuffer),r.msaaBuffer=null,r.blitFramebuffer&&(r.blitFramebuffer.dispose(),r.blitFramebuffer=null));const o=[];for(let a=0;a<s;a++){const s=i[a],l=s.parentTextureArray||s;this.renderer.texture.bind(l,0),0===a&&r.msaaBuffer?(n.bindRenderbuffer(n.RENDERBUFFER,r.msaaBuffer),n.renderbufferStorageMultisample(n.RENDERBUFFER,r.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,r.msaaBuffer)):(n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+a,s.target,l._glTextures[this.CONTEXT_UID].texture,t),o.push(n.COLOR_ATTACHMENT0+a))}if(o.length>1&&n.drawBuffers(o),e.depthTexture&&this.writeDepthTexture){const r=e.depthTexture;this.renderer.texture.bind(r,0),n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,r._glTextures[this.CONTEXT_UID].texture,t)}!e.stencil&&!e.depth||e.depthTexture&&this.writeDepthTexture?r.stencil&&(n.deleteRenderbuffer(r.stencil),r.stencil=null):(r.stencil=r.stencil||n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,r.stencil),r.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,r.multisample,n.DEPTH24_STENCIL8,e.width,e.height):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,e.width,e.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,r.stencil))}canMultisampleFramebuffer(e){return 1!==this.renderer.context.webGLVersion&&e.colorTextures.length<=1&&!e.depthTexture}detectSamples(e){const{msaaSamples:t}=this;let n=_e.NONE;if(e<=1||null===t)return n;for(let r=0;r<t.length;r++)if(t[r]<=e){n=t[r];break}return 1===n&&(n=_e.NONE),n}blit(e,t,n){const{current:r,renderer:i,gl:s,CONTEXT_UID:o}=this;if(2!==i.context.webGLVersion)return;if(!r)return;const a=r.glFramebuffers[o];if(!a)return;if(!e){if(!a.msaaBuffer)return;const t=r.colorTextures[0];if(!t)return;a.blitFramebuffer||(a.blitFramebuffer=new Sr(r.width,r.height),a.blitFramebuffer.addColorTexture(0,t)),(e=a.blitFramebuffer).colorTextures[0]!==t&&(e.colorTextures[0]=t,e.dirtyId++,e.dirtyFormat++),e.width===r.width&&e.height===r.height||(e.width=r.width,e.height=r.height,e.dirtyId++,e.dirtySize++)}t||((t=zr).width=r.width,t.height=r.height),n||(n=t);const l=t.width===n.width&&t.height===n.height;this.bind(e),s.bindFramebuffer(s.READ_FRAMEBUFFER,a.framebuffer),s.blitFramebuffer(t.left,t.top,t.right,t.bottom,n.left,n.top,n.right,n.bottom,s.COLOR_BUFFER_BIT,l?s.NEAREST:s.LINEAR)}disposeFramebuffer(e,t){const n=e.glFramebuffers[this.CONTEXT_UID],r=this.gl;if(!n)return;delete e.glFramebuffers[this.CONTEXT_UID];const i=this.managedFramebuffers.indexOf(e);i>=0&&this.managedFramebuffers.splice(i,1),e.disposeRunner.remove(this),t||(r.deleteFramebuffer(n.framebuffer),n.msaaBuffer&&r.deleteRenderbuffer(n.msaaBuffer),n.stencil&&r.deleteRenderbuffer(n.stencil)),n.blitFramebuffer&&n.blitFramebuffer.dispose()}disposeAll(e){const t=this.managedFramebuffers;this.managedFramebuffers=[];for(let n=0;n<t.length;n++)this.disposeFramebuffer(t[n],e)}forceStencil(){const e=this.current;if(!e)return;const t=e.glFramebuffers[this.CONTEXT_UID];if(!t||t.stencil)return;e.stencil=!0;const n=e.width,r=e.height,i=this.gl,s=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,s),t.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,t.multisample,i.DEPTH24_STENCIL8,n,r):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,n,r),t.stencil=s,i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,s)}reset(){this.current=this.unknownFramebuffer,this.viewport=new An}destroy(){this.renderer=null}}jr.extension={type:qt.RendererSystem,name:"framebuffer"},Qt.add(jr);const Ur={5126:4,5123:2,5121:1};class Gr{constructor(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl,t=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==t.webGLVersion){let t=this.renderer.context.extensions.vertexArrayObject;Ce.PREFER_ENV===ae.WEBGL_LEGACY&&(t=null),t?(e.createVertexArray=()=>t.createVertexArrayOES(),e.bindVertexArray=e=>t.bindVertexArrayOES(e),e.deleteVertexArray=e=>t.deleteVertexArrayOES(e)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(2!==t.webGLVersion){const t=e.getExtension("ANGLE_instanced_arrays");t?(e.vertexAttribDivisor=(e,n)=>t.vertexAttribDivisorANGLE(e,n),e.drawElementsInstanced=(e,n,r,i,s)=>t.drawElementsInstancedANGLE(e,n,r,i,s),e.drawArraysInstanced=(e,n,r,i)=>t.drawArraysInstancedANGLE(e,n,r,i)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===t.webGLVersion||!!t.extensions.uint32ElementIndex}bind(e,t){t=t||this.renderer.shader.shader;const{gl:n}=this;let r=e.glVertexArrayObjects[this.CONTEXT_UID],i=!1;r||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=r={},i=!0);const s=r[t.program.id]||this.initGeometryVao(e,t,i);this._activeGeometry=e,this._activeVao!==s&&(this._activeVao=s,this.hasVao?n.bindVertexArray(s):this.activateVao(e,t.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const e=this._activeGeometry,t=this.renderer.buffer;for(let n=0;n<e.buffers.length;n++){const r=e.buffers[n];t.update(r)}}checkCompatibility(e,t){const n=e.attributes,r=t.attributeData;for(const e in r)if(!n[e])throw new Error(`shader and geometry incompatible, geometry missing the "${e}" attribute`)}getSignature(e,t){const n=e.attributes,r=t.attributeData,i=["g",e.id];for(const e in n)r[e]&&i.push(e,r[e].location);return i.join("-")}initGeometryVao(e,t,n=!0){const r=this.gl,i=this.CONTEXT_UID,s=this.renderer.buffer,o=t.program;o.glPrograms[i]||this.renderer.shader.generateProgram(t),this.checkCompatibility(e,o);const a=this.getSignature(e,o),l=e.glVertexArrayObjects[this.CONTEXT_UID];let u=l[a];if(u)return l[o.id]=u,u;const c=e.buffers,h=e.attributes,d={},f={};for(const e in c)d[e]=0,f[e]=0;for(const e in h)!h[e].size&&o.attributeData[e]?h[e].size=o.attributeData[e].size:h[e].size||console.warn(`PIXI Geometry attribute '${e}' size cannot be determined (likely the bound shader does not have the attribute)`),d[h[e].buffer]+=h[e].size*Ur[h[e].type];for(const e in h){const t=h[e],n=t.size;void 0===t.stride&&(d[t.buffer]===n*Ur[t.type]?t.stride=0:t.stride=d[t.buffer]),void 0===t.start&&(t.start=f[t.buffer],f[t.buffer]+=n*Ur[t.type])}u=r.createVertexArray(),r.bindVertexArray(u);for(let e=0;e<c.length;e++){const t=c[e];s.bind(t),n&&t._glBuffers[i].refCount++}return this.activateVao(e,o),l[o.id]=u,l[a]=u,r.bindVertexArray(null),s.unbind(Te.ARRAY_BUFFER),u}disposeGeometry(e,t){if(!this.managedGeometries[e.id])return;delete this.managedGeometries[e.id];const n=e.glVertexArrayObjects[this.CONTEXT_UID],r=this.gl,i=e.buffers,s=this.renderer?.buffer;if(e.disposeRunner.remove(this),n){if(s)for(let e=0;e<i.length;e++){const n=i[e]._glBuffers[this.CONTEXT_UID];n&&(n.refCount--,0!==n.refCount||t||s.dispose(i[e],t))}if(!t)for(const e in n)if("g"===e[0]){const t=n[e];this._activeVao===t&&this.unbind(),r.deleteVertexArray(t)}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(e){const t=Object.keys(this.managedGeometries);for(let n=0;n<t.length;n++)this.disposeGeometry(this.managedGeometries[t[n]],e)}activateVao(e,t){const n=this.gl,r=this.CONTEXT_UID,i=this.renderer.buffer,s=e.buffers,o=e.attributes;e.indexBuffer&&i.bind(e.indexBuffer);let a=null;for(const e in o){const l=o[e],u=s[l.buffer],c=u._glBuffers[r];if(t.attributeData[e]){a!==c&&(i.bind(u),a=c);const r=t.attributeData[e].location;if(n.enableVertexAttribArray(r),n.vertexAttribPointer(r,l.size,l.type||n.FLOAT,l.normalized,l.stride,l.start),l.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");n.vertexAttribDivisor(r,l.divisor)}}}}draw(e,t,n,r){const{gl:i}=this,s=this._activeGeometry;if(s.indexBuffer){const o=s.indexBuffer.data.BYTES_PER_ELEMENT,a=2===o?i.UNSIGNED_SHORT:i.UNSIGNED_INT;2===o||4===o&&this.canUseUInt32ElementIndex?s.instanced?i.drawElementsInstanced(e,t||s.indexBuffer.data.length,a,(n||0)*o,r||1):i.drawElements(e,t||s.indexBuffer.data.length,a,(n||0)*o):console.warn("unsupported index buffer type: uint32")}else s.instanced?i.drawArraysInstanced(e,n,t||s.getSize(),r||1):i.drawArrays(e,n,t||s.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Gr.extension={type:qt.RendererSystem,name:"geometry"},Qt.add(Gr);const Vr=new Dn;class Hr{constructor(e,t){this._texture=e,this.mapCoord=new Dn,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===t?.5:t,this.isSimple=!1}get texture(){return this._texture}set texture(e){this._texture=e,this._textureID=-1}multiplyUvs(e,t){void 0===t&&(t=e);const n=this.mapCoord;for(let r=0;r<e.length;r+=2){const i=e[r],s=e[r+1];t[r]=i*n.a+s*n.c+n.tx,t[r+1]=i*n.b+s*n.d+n.ty}return t}update(e){const t=this._texture;if(!t||!t.valid)return!1;if(!e&&this._textureID===t._updateID)return!1;this._textureID=t._updateID,this._updateID++;const n=t._uvs;this.mapCoord.set(n.x1-n.x0,n.y1-n.y0,n.x3-n.x0,n.y3-n.y0,n.x0,n.y0);const r=t.orig,i=t.trim;i&&(Vr.set(r.width/i.width,0,0,r.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(Vr));const s=t.baseTexture,o=this.uClampFrame,a=this.clampMargin/s.resolution,l=this.clampOffset;return o[0]=(t._frame.x+a+l)/s.width,o[1]=(t._frame.y+a+l)/s.height,o[2]=(t._frame.x+t._frame.width-a+l)/s.width,o[3]=(t._frame.y+t._frame.height-a+l)/s.height,this.uClampOffset[0]=l/s.realWidth,this.uClampOffset[1]=l/s.realHeight,this.isSimple=t._frame.width===s.width&&t._frame.height===s.height&&0===t.rotate,!0}}class Wr extends gr{constructor(e,t,n){let r=null;"string"!=typeof e&&void 0===t&&void 0===n&&(r=e,e=void 0,t=void 0,n=void 0),super(e||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",t||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",n),this.maskSprite=r,this.maskMatrix=new Dn}get maskSprite(){return this._maskSprite}set maskSprite(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(e,t,n,r){const i=this._maskSprite,s=i._texture;s.valid&&(s.uvMatrix||(s.uvMatrix=new Hr(s,0)),s.uvMatrix.update(),this.uniforms.npmAlpha=s.baseTexture.alphaMode?0:1,this.uniforms.mask=s,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,i).prepend(s.uvMatrix.mapCoord),this.uniforms.alpha=i.worldAlpha,this.uniforms.maskClamp=s.uvMatrix.uClampFrame,e.applyFilter(this,t,n,r))}}class Xr{constructor(e=null){this.type=Se.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=gr.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=Se.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class $r{constructor(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)}push(e,t){let n=t;if(!n.isMaskData){const e=this.maskDataPool.pop()||new Xr;e.pooled=!0,e.maskObject=t,n=e}const r=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(n.copyCountersOrReset(r),n._colorMask=r?r._colorMask:15,n.autoDetect&&this.detect(n),n._target=e,n.type!==Se.SPRITE&&this.maskStack.push(n),n.enabled)switch(n.type){case Se.SCISSOR:this.renderer.scissor.push(n);break;case Se.STENCIL:this.renderer.stencil.push(n);break;case Se.SPRITE:n.copyCountersOrReset(null),this.pushSpriteMask(n);break;case Se.COLOR:this.pushColorMask(n)}n.type===Se.SPRITE&&this.maskStack.push(n)}pop(e){const t=this.maskStack.pop();if(t&&t._target===e){if(t.enabled)switch(t.type){case Se.SCISSOR:this.renderer.scissor.pop(t);break;case Se.STENCIL:this.renderer.stencil.pop(t.maskObject);break;case Se.SPRITE:this.popSpriteMask(t);break;case Se.COLOR:this.popColorMask(t)}if(t.reset(),t.pooled&&this.maskDataPool.push(t),0!==this.maskStack.length){const e=this.maskStack[this.maskStack.length-1];e.type===Se.SPRITE&&e._filters&&(e._filters[0].maskSprite=e.maskObject)}}}detect(e){const t=e.maskObject;t?t.isSprite?e.type=Se.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=Se.SCISSOR:e.type=Se.STENCIL:e.type=Se.COLOR}pushSpriteMask(e){const{maskObject:t}=e,n=e._target;let r=e._filters;r||(r=this.alphaMaskPool[this.alphaMaskIndex],r||(r=this.alphaMaskPool[this.alphaMaskIndex]=[new Wr]));const i=this.renderer,s=i.renderTexture;let o,a;if(s.current){const t=s.current;o=e.resolution||t.resolution,a=e.multisample??t.multisample}else o=e.resolution||i.resolution,a=e.multisample??i.multisample;r[0].resolution=o,r[0].multisample=a,r[0].maskSprite=t;const l=n.filterArea;n.filterArea=t.getBounds(!0),i.filter.push(n,r),n.filterArea=l,e._filters||this.alphaMaskIndex++}popSpriteMask(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(e){const t=e._colorMask,n=e._colorMask=t&e.colorMask;n!==t&&this.renderer.gl.colorMask(!!(1&n),!!(2&n),!!(4&n),!!(8&n))}popColorMask(e){const t=e._colorMask,n=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;n!==t&&this.renderer.gl.colorMask(!!(1&n),!!(2&n),!!(4&n),!!(8&n))}destroy(){this.renderer=null}}$r.extension={type:qt.RendererSystem,name:"mask"},Qt.add($r);class Yr{constructor(e){this.renderer=e,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(e){const{gl:t}=this.renderer,n=this.getStackLength();this.maskStack=e;const r=this.getStackLength();r!==n&&(0===r?t.disable(this.glConst):(t.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const qr=new Dn,Kr=[],Zr=class extends Yr{constructor(e){super(e),this.glConst=Ce.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){if(e._scissorRectLocal)return;const t=e._scissorRect,{maskObject:n}=e,{renderer:r}=this,i=r.renderTexture,s=n.getBounds(!0,Kr.pop()??new An);this.roundFrameToPixels(s,i.current?i.current.resolution:r.resolution,i.sourceFrame,i.destinationFrame,r.projection.transform),t&&s.fit(t),e._scissorRectLocal=s}static isMatrixRotated(e){if(!e)return!1;const{a:t,b:n,c:r,d:i}=e;return(Math.abs(n)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(i)>1e-4)}testScissor(e){const{maskObject:t}=e;if(!t.isFastRect||!t.isFastRect())return!1;if(Zr.isMatrixRotated(t.worldTransform))return!1;if(Zr.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);const n=e._scissorRectLocal;return n.width>0&&n.height>0}roundFrameToPixels(e,t,n,r,i){Zr.isMatrixRotated(i)||((i=i?qr.copyFrom(i):qr.identity()).translate(-n.x,-n.y).scale(r.width/n.width,r.height/n.height).translate(r.x,r.y),this.renderer.filter.transformAABB(i,e),e.fit(r),e.x=Math.round(e.x*t),e.y=Math.round(e.y*t),e.width=Math.round(e.width*t),e.height=Math.round(e.height*t))}push(e){e._scissorRectLocal||this.calcScissorRect(e);const{gl:t}=this.renderer;e._scissorRect||t.enable(t.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){const{gl:t}=this.renderer;e&&Kr.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const e=this.maskStack[this.maskStack.length-1]._scissorRect;let t;t=this.renderer.renderTexture.current?e.y:this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)}};let Qr=Zr;Qr.extension={type:qt.RendererSystem,name:"scissor"},Qt.add(Qr);class Jr extends Yr{constructor(e){super(e),this.glConst=Ce.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0}push(e){const t=e.maskObject,{gl:n}=this.renderer,r=e._stencilCounter;0===r&&(this.renderer.framebuffer.forceStencil(),n.clearStencil(0),n.clear(n.STENCIL_BUFFER_BIT),n.enable(n.STENCIL_TEST)),e._stencilCounter++;const i=e._colorMask;0!==i&&(e._colorMask=0,n.colorMask(!1,!1,!1,!1)),n.stencilFunc(n.EQUAL,r,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.INCR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,0!==i&&(e._colorMask=i,n.colorMask(!!(1&i),!!(2&i),!!(4&i),!!(8&i))),this._useCurrent()}pop(e){const t=this.renderer.gl;if(0===this.getStackLength())t.disable(t.STENCIL_TEST);else{const n=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,r=n?n._colorMask:15;0!==r&&(n._colorMask=0,t.colorMask(!1,!1,!1,!1)),t.stencilOp(t.KEEP,t.KEEP,t.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==r&&(n._colorMask=r,t.colorMask(!!(1&r),!!(2&r),!!(4&r),!!(8&r))),this._useCurrent()}}_useCurrent(){const e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}}Jr.extension={type:qt.RendererSystem,name:"stencil"},Qt.add(Jr);class ei{constructor(e){this.renderer=e,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get:()=>(Qe("7.0.0","renderer.plugins.extract has moved to renderer.extract"),e.extract)},prepare:{enumerable:!1,get:()=>(Qe("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),e.prepare)},interaction:{enumerable:!1,get:()=>(Qe("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),e.events)}})}init(){const e=this.rendererPlugins;for(const t in e)this.plugins[t]=new e[t](this.renderer)}destroy(){for(const e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null}}ei.extension={type:[qt.RendererSystem,qt.CanvasRendererSystem],name:"_plugin"},Qt.add(ei);class ti{constructor(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Dn,this.transform=null}update(e,t,n,r){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=t||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,n,r),this.transform&&this.projectionMatrix.append(this.transform);const i=this.renderer;i.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,i.globalUniforms.update(),i.shader.shader&&i.shader.syncUniformGroup(i.shader.shader.uniforms.globals)}calculateProjection(e,t,n,r){const i=this.projectionMatrix,s=r?-1:1;i.identity(),i.a=1/t.width*2,i.d=s*(1/t.height*2),i.tx=-1-t.x*i.a,i.ty=-s-t.y*i.d}setTransform(e){}destroy(){this.renderer=null}}ti.extension={type:qt.RendererSystem,name:"projection"},Qt.add(ti);const ni=new Hn;class ri{constructor(e){this.renderer=e,this._tempMatrix=new Dn}generateTexture(e,t){const{region:n,...r}=t||{},i=n||e.getLocalBounds(null,!0);0===i.width&&(i.width=1),0===i.height&&(i.height=1);const s=Pr.create({width:i.width,height:i.height,...r});this._tempMatrix.tx=-i.x,this._tempMatrix.ty=-i.y;const o=e.transform;return e.transform=ni,this.renderer.render(e,{renderTexture:s,transform:this._tempMatrix,skipUpdateTransform:!!e.parent,blit:!0}),e.transform=o,s}destroy(){}}ri.extension={type:[qt.RendererSystem,qt.CanvasRendererSystem],name:"textureGenerator"},Qt.add(ri);const ii=new An,si=new An;class oi{constructor(e){this.renderer=e,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new An,this.destinationFrame=new An,this.viewportFrame=new An}bind(e=null,t,n){const r=this.renderer;let i,s,o;this.current=e,e?(i=e.baseTexture,o=i.resolution,t||(ii.width=e.frame.width,ii.height=e.frame.height,t=ii),n||(si.x=e.frame.x,si.y=e.frame.y,si.width=t.width,si.height=t.height,n=si),s=i.framebuffer):(o=r.resolution,t||(ii.width=r._view.screen.width,ii.height=r._view.screen.height,t=ii),n||((n=ii).width=t.width,n.height=t.height));const a=this.viewportFrame;a.x=n.x*o,a.y=n.y*o,a.width=n.width*o,a.height=n.height*o,e||(a.y=r.view.height-(a.y+a.height)),a.ceil(),this.renderer.framebuffer.bind(s,a),this.renderer.projection.update(n,t,o,!s),e?this.renderer.mask.setMaskStack(i.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(t),this.destinationFrame.copyFrom(n)}clear(e,t){const n=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,r=e?At.shared.setValue(e):n,i=this.destinationFrame,s=this.current?this.current.baseTexture:this.renderer._view.screen,o=i.width!==s.width||i.height!==s.height;if(o){let{x:e,y:t,width:n,height:r}=this.viewportFrame;e=Math.round(e),t=Math.round(t),n=Math.round(n),r=Math.round(r),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(e,t,n,r)}this.renderer.framebuffer.clear(r.red,r.green,r.blue,r.alpha,t),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}oi.extension={type:qt.RendererSystem,name:"renderTexture"},Qt.add(oi);class ai{constructor(e,t){this.program=e,this.uniformData=t,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function li(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}function ui(e){const t=new Array(e);for(let e=0;e<t.length;e++)t[e]=!1;return t}function ci(e,t){switch(e){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return ui(2*t);case"bvec3":return ui(3*t);case"bvec4":return ui(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function hi(e,t){const n=e.getShaderSource(t).split("\n").map(((e,t)=>`${t}: ${e}`)),r=e.getShaderInfoLog(t),i=r.split("\n"),s={},o=i.map((e=>parseFloat(e.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1")))).filter((e=>!(!e||s[e]||(s[e]=!0,0)))),a=[""];o.forEach((e=>{n[e-1]=`%c${n[e-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));const l=n.join("\n");a[0]=l,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function di(e,t,n,r,i){n.buffer.update(i)}const fi={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},pi={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};let mi,gi=0;const yi={textureCount:0,uboCount:0};class vi{constructor(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=gi++}systemCheck(){if(!function(){if("boolean"==typeof mi)return mi;try{const e=new Function("param1","param2","param3","return param1[param2] === param3;");mi=!0===e({a:"b"},"a","b")}catch(e){mi=!1}return mi}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(e){this.gl=e,this.reset()}bind(e,t){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;const n=e.program,r=n.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==n&&(this.program=n,this.gl.useProgram(r.program)),t||(yi.textureCount=0,yi.uboCount=0,this.syncUniformGroup(e.uniformGroup,yi)),r}setUniforms(e){const t=this.shader.program,n=t.glPrograms[this.renderer.CONTEXT_UID];t.syncUniforms(n.uniformData,e,this.renderer)}syncUniformGroup(e,t){const n=this.getGlProgram();e.static&&e.dirtyId===n.uniformDirtyGroups[e.id]||(n.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,n,t))}syncUniforms(e,t,n){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(t.uniformData,e.uniforms,this.renderer,n)}createSyncGroups(e){const t=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[t]||(this.cache[t]=function(e,t){const n=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(const r in e.uniforms){const i=t[r];if(!i){e.uniforms[r]?.group&&(e.uniforms[r].ubo?n.push(`\n                        renderer.shader.syncUniformBufferGroup(uv.${r}, '${r}');\n                    `):n.push(`\n                        renderer.shader.syncUniformGroup(uv.${r}, syncData);\n                    `));continue}const s=e.uniforms[r];let o=!1;for(let e=0;e<Wn.length;e++)if(Wn[e].test(i,s)){n.push(Wn[e].code(r,s)),o=!0;break}if(!o){const e=(1!==i.size||i.isArray?$n:Xn)[i.type].replace("location",`ud["${r}"].location`);n.push(`\n            cu = ud["${r}"];\n            cv = cu.value;\n            v = uv["${r}"];\n            ${e};`)}}return new Function("ud","uv","renderer","syncData",n.join("\n"))}(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[t],e.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(e,t){const n=this.getGlProgram();if(!e.static||0!==e.dirtyId||!n.uniformGroups[e.id]){e.dirtyId=0;const r=n.uniformGroups[e.id]||this.createSyncBufferGroup(e,n,t);e.buffer.update(),r(n.uniformData,e.uniforms,this.renderer,yi,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,n.uniformBufferBindings[t])}createSyncBufferGroup(e,t,n){const{gl:r}=this.renderer;this.renderer.buffer.bind(e.buffer);const i=this.gl.getUniformBlockIndex(t.program,n);t.uniformBufferBindings[n]=this.shader.uniformBindCount,r.uniformBlockBinding(t.program,i,this.shader.uniformBindCount),this.shader.uniformBindCount++;const s=this.getSignature(e,this.shader.program.uniformData,"ubo");let o=this._uboCache[s];if(o||(o=this._uboCache[s]=function(e,t){if(!e.autoManage)return{size:0,syncFunc:di};const n=function(e,t){const n=[];for(const r in e)t[r]&&n.push(t[r]);return n.sort(((e,t)=>e.index-t.index)),n}(e.uniforms,t),{uboElements:r,size:i}=function(e){const t=e.map((e=>({data:e,offset:0,dataLen:0,dirty:0})));let n=0,r=0,i=0;for(let e=0;e<t.length;e++){const s=t[e];if(n=pi[s.data.type],s.data.size>1&&(n=Math.max(n,16)*s.data.size),s.dataLen=n,r%n!=0&&r<16){const e=r%n%16;r+=e,i+=e}r+n>16?(i=16*Math.ceil(i/16),s.offset=i,i+=n,r=n):(s.offset=i,r+=n,i+=n)}return i=16*Math.ceil(i/16),{uboElements:t,size:i}}(n),s=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(let t=0;t<r.length;t++){const n=r[t],i=e.uniforms[n.data.name],o=n.data.name;let a=!1;for(let e=0;e<Wn.length;e++){const t=Wn[e];if(t.codeUbo&&t.test(n.data,i)){s.push(`offset = ${n.offset/4};`,Wn[e].codeUbo(n.data.name,i)),a=!0;break}}if(!a)if(n.data.size>1){const e=Qn(n.data.type),t=Math.max(pi[n.data.type]/16,1),r=e/t,i=(4-r%4)%4;s.push(`\n                cv = ud.${o}.value;\n                v = uv.${o};\n                offset = ${n.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${n.data.size*t}; i++)\n                {\n                    for(var j = 0; j < ${r}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${i};\n                }\n\n                `)}else{const e=fi[n.data.type];s.push(`\n                cv = ud.${o}.value;\n                v = uv.${o};\n                offset = ${n.offset/4};\n                ${e};\n                `)}}return s.push("\n       renderer.buffer.update(buffer);\n    "),{size:i,syncFunc:new Function("ud","uv","renderer","syncData","buffer",s.join("\n"))}}(e,this.shader.program.uniformData)),e.autoManage){const t=new Float32Array(o.size/4);e.buffer.update(t)}return t.uniformGroups[e.id]=o.syncFunc,t.uniformGroups[e.id]}getSignature(e,t,n){const r=e.uniforms,i=[`${n}-`];for(const e in r)i.push(e),t[e]&&i.push(t[e].type);return i.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(e){const t=this.gl,n=e.program,r=function(e,t){const n=li(e,e.VERTEX_SHADER,t.vertexSrc),r=li(e,e.FRAGMENT_SHADER,t.fragmentSrc),i=e.createProgram();e.attachShader(i,n),e.attachShader(i,r);const s=t.extra?.transformFeedbackVaryings;if(s&&("function"!=typeof e.transformFeedbackVaryings?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):e.transformFeedbackVaryings(i,s.names,"separate"===s.bufferMode?e.SEPARATE_ATTRIBS:e.INTERLEAVED_ATTRIBS)),e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS)||function(e,t,n,r){e.getProgramParameter(t,e.LINK_STATUS)||(e.getShaderParameter(n,e.COMPILE_STATUS)||hi(e,n),e.getShaderParameter(r,e.COMPILE_STATUS)||hi(e,r),console.error("PixiJS Error: Could not initialize shader."),""!==e.getProgramInfoLog(t)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(t)))}(e,i,n,r),t.attributeData=function(e,t){const n={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const r=t.getActiveAttrib(e,i);if(r.name.startsWith("gl_"))continue;const s=tr(t,r.type),o={type:s,name:r.name,size:Qn(s),location:t.getAttribLocation(e,r.name)};n[r.name]=o}return n}(i,e),t.uniformData=function(e,t){const n={},r=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let i=0;i<r;i++){const r=t.getActiveUniform(e,i),s=r.name.replace(/\[.*?\]$/,""),o=!!r.name.match(/\[.*?\]$/),a=tr(t,r.type);n[s]={name:s,index:i,type:a,size:r.size,isArray:o,value:ci(a,r.size)}}return n}(i,e),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const n=Object.keys(t.attributeData);n.sort(((e,t)=>e>t?1:-1));for(let r=0;r<n.length;r++)t.attributeData[n[r]].location=r,e.bindAttribLocation(i,r,n[r]);e.linkProgram(i)}e.deleteShader(n),e.deleteShader(r);const o={};for(const n in t.uniformData){const r=t.uniformData[n];o[n]={location:e.getUniformLocation(i,n),value:ci(r.type,r.size)}}return new ai(i,o)}(t,n);return n.glPrograms[this.renderer.CONTEXT_UID]=r,r}reset(){this.program=null,this.shader=null}disposeShader(e){this.shader===e&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}vi.extension={type:qt.RendererSystem,name:"shader"},Qt.add(vi);class xi{constructor(e){this.renderer=e}run(e){const{renderer:t}=this;t.runners.init.emit(t.options),e.hello&&console.log(`PixiJS 7.2.0-beta - ${t.rendererLogId} - https://pixijs.com`),t.resize(t.screen.width,t.screen.height)}destroy(){}}xi.defaultOptions={hello:!1},xi.extension={type:[qt.RendererSystem,qt.CanvasRendererSystem],name:"startup"},Qt.add(xi);const bi=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=ue.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new nn,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=function(e,t=[]){return t[ue.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ue.ADD]=[e.ONE,e.ONE],t[ue.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ue.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ue.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ue.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ue.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ue.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ue.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ue.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ue.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ue.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ue.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ue.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ue.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ue.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ue.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ue.NONE]=[0,0],t[ue.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ue.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],t[ue.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ue.SRC_IN]=[e.DST_ALPHA,e.ZERO],t[ue.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],t[ue.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[ue.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],t[ue.DST_IN]=[e.ZERO,e.SRC_ALPHA],t[ue.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],t[ue.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],t[ue.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[ue.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],t}(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let t=this.stateId^e.data,n=0;for(;t;)1&t&&this.map[n].call(this,!!(e.data&1<<n)),t>>=1,n++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e=e||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(e){this.updateCheck(bi.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this.updateCheck(bi.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;const t=this.blendModes[e],n=this.gl;2===t.length?n.blendFunc(t[0],t[1]):n.blendFuncSeparate(t[0],t[1],t[2],t[3]),6===t.length?(this._blendEq=!0,n.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,t){const n=this.checks.indexOf(e);t&&-1===n?this.checks.push(e):t||-1===n||this.checks.splice(n,1)}static checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};let wi=bi;wi.extension={type:qt.RendererSystem,name:"state"},Qt.add(wi);class Si extends He{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(e){this.addRunners(...e.runners);const t=(e.priority??[]).filter((t=>e.systems[t])),n=[...t,...Object.keys(e.systems).filter((e=>!t.includes(e)))];for(const t of n)this.addSystem(e.systems[t],t)}addRunners(...e){e.forEach((e=>{this.runners[e]=new on(e)}))}addSystem(e,t){const n=new e(this);if(this[t])throw new Error(`Whoops! The name "${t}" is already in use`);this[t]=n,this._systemsHash[t]=n;for(const e in this.runners)this.runners[e].add(n);return this}emitWithCustomOptions(e,t){const n=Object.keys(this._systemsHash);e.items.forEach((r=>{const i=n.find((e=>this._systemsHash[e]===r));r[e.name](t[i])}))}destroy(){Object.values(this.runners).forEach((e=>{e.destroy()})),this._systemsHash={}}}const _i=class{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=_i.defaultMaxIdle,this.checkCountMax=_i.defaultCheckCountMax,this.mode=_i.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==be.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this.renderer.texture,t=e.managedTextures;let n=!1;for(let r=0;r<t.length;r++){const i=t[r];!i.framebuffer&&this.count-i.touched>this.maxIdle&&(e.destroyTexture(i,!0),t[r]=null,n=!0)}if(n){let e=0;for(let n=0;n<t.length;n++)null!==t[n]&&(t[e++]=t[n]);t.length=e}}unload(e){const t=this.renderer.texture,n=e._texture;n&&!n.framebuffer&&t.destroyTexture(n);for(let t=e.children.length-1;t>=0;t--)this.unload(e.children[t])}destroy(){this.renderer=null}};let Ti=_i;Ti.defaultMode=be.AUTO,Ti.defaultMaxIdle=3600,Ti.defaultCheckCountMax=600,Ti.extension={type:qt.RendererSystem,name:"textureGC"},Qt.add(Ti);class Ei{constructor(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=fe.UNSIGNED_BYTE,this.internalFormat=he.RGBA,this.samplerType=0}}class Ci{constructor(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new hn,this.hasIntegerTextures=!1}contextChange(){const e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function(e){let t;return t="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext?{[fe.UNSIGNED_BYTE]:{[he.RGBA]:e.RGBA8,[he.RGB]:e.RGB8,[he.RG]:e.RG8,[he.RED]:e.R8,[he.RGBA_INTEGER]:e.RGBA8UI,[he.RGB_INTEGER]:e.RGB8UI,[he.RG_INTEGER]:e.RG8UI,[he.RED_INTEGER]:e.R8UI,[he.ALPHA]:e.ALPHA,[he.LUMINANCE]:e.LUMINANCE,[he.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[fe.BYTE]:{[he.RGBA]:e.RGBA8_SNORM,[he.RGB]:e.RGB8_SNORM,[he.RG]:e.RG8_SNORM,[he.RED]:e.R8_SNORM,[he.RGBA_INTEGER]:e.RGBA8I,[he.RGB_INTEGER]:e.RGB8I,[he.RG_INTEGER]:e.RG8I,[he.RED_INTEGER]:e.R8I},[fe.UNSIGNED_SHORT]:{[he.RGBA_INTEGER]:e.RGBA16UI,[he.RGB_INTEGER]:e.RGB16UI,[he.RG_INTEGER]:e.RG16UI,[he.RED_INTEGER]:e.R16UI,[he.DEPTH_COMPONENT]:e.DEPTH_COMPONENT16},[fe.SHORT]:{[he.RGBA_INTEGER]:e.RGBA16I,[he.RGB_INTEGER]:e.RGB16I,[he.RG_INTEGER]:e.RG16I,[he.RED_INTEGER]:e.R16I},[fe.UNSIGNED_INT]:{[he.RGBA_INTEGER]:e.RGBA32UI,[he.RGB_INTEGER]:e.RGB32UI,[he.RG_INTEGER]:e.RG32UI,[he.RED_INTEGER]:e.R32UI,[he.DEPTH_COMPONENT]:e.DEPTH_COMPONENT24},[fe.INT]:{[he.RGBA_INTEGER]:e.RGBA32I,[he.RGB_INTEGER]:e.RGB32I,[he.RG_INTEGER]:e.RG32I,[he.RED_INTEGER]:e.R32I},[fe.FLOAT]:{[he.RGBA]:e.RGBA32F,[he.RGB]:e.RGB32F,[he.RG]:e.RG32F,[he.RED]:e.R32F,[he.DEPTH_COMPONENT]:e.DEPTH_COMPONENT32F},[fe.HALF_FLOAT]:{[he.RGBA]:e.RGBA16F,[he.RGB]:e.RGB16F,[he.RG]:e.RG16F,[he.RED]:e.R16F},[fe.UNSIGNED_SHORT_5_6_5]:{[he.RGB]:e.RGB565},[fe.UNSIGNED_SHORT_4_4_4_4]:{[he.RGBA]:e.RGBA4},[fe.UNSIGNED_SHORT_5_5_5_1]:{[he.RGBA]:e.RGB5_A1},[fe.UNSIGNED_INT_2_10_10_10_REV]:{[he.RGBA]:e.RGB10_A2,[he.RGBA_INTEGER]:e.RGB10_A2UI},[fe.UNSIGNED_INT_10F_11F_11F_REV]:{[he.RGB]:e.R11F_G11F_B10F},[fe.UNSIGNED_INT_5_9_9_9_REV]:{[he.RGB]:e.RGB9_E5},[fe.UNSIGNED_INT_24_8]:{[he.DEPTH_STENCIL]:e.DEPTH24_STENCIL8},[fe.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[he.DEPTH_STENCIL]:e.DEPTH32F_STENCIL8}}:{[fe.UNSIGNED_BYTE]:{[he.RGBA]:e.RGBA,[he.RGB]:e.RGB,[he.ALPHA]:e.ALPHA,[he.LUMINANCE]:e.LUMINANCE,[he.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[fe.UNSIGNED_SHORT_5_6_5]:{[he.RGB]:e.RGB},[fe.UNSIGNED_SHORT_4_4_4_4]:{[he.RGBA]:e.RGBA},[fe.UNSIGNED_SHORT_5_5_5_1]:{[he.RGBA]:e.RGBA}},t}(e);const t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=t;for(let e=0;e<t;e++)this.boundTextures[e]=null;this.emptyTextures={};const n=new Ei(e.createTexture());e.bindTexture(e.TEXTURE_2D,n.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=n,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new Ei(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(let t=0;t<6;t++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(let e=0;e<this.boundTextures.length;e++)this.bind(null,e)}bind(e,t=0){const{gl:n}=this;if(e=e?.castToBaseTexture(),e?.valid&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;const r=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[t]!==e&&(this.currentLocation!==t&&(this.currentLocation=t,n.activeTexture(n.TEXTURE0+t)),n.bindTexture(e.target,r.texture)),r.dirtyId!==e.dirtyId?(this.currentLocation!==t&&(this.currentLocation=t,n.activeTexture(n.TEXTURE0+t)),this.updateTexture(e)):r.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[t]=e}else this.currentLocation!==t&&(this.currentLocation=t,n.activeTexture(n.TEXTURE0+t)),n.bindTexture(n.TEXTURE_2D,this.emptyTextures[n.TEXTURE_2D].texture),this.boundTextures[t]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture}unbind(e){const{gl:t,boundTextures:n}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let e=0;e<n.length;e++)n[e]===this.unknownTexture&&this.bind(null,e)}for(let r=0;r<n.length;r++)n[r]===e&&(this.currentLocation!==r&&(t.activeTexture(t.TEXTURE0+r),this.currentLocation=r),t.bindTexture(e.target,this.emptyTextures[e.target].texture),n[r]=null)}ensureSamplerType(e){const{boundTextures:t,hasIntegerTextures:n,CONTEXT_UID:r}=this;if(n)for(let n=e-1;n>=0;--n){const e=t[n];e&&e._glTextures[r].samplerType!==pe.FLOAT&&this.renderer.texture.unbind(e)}}initTexture(e){const t=new Ei(this.gl.createTexture());return t.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=t,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),t}initTextureType(e,t){t.internalFormat=this.internalFormats[e.type]?.[e.format]??e.format,2===this.webGLVersion&&e.type===fe.HALF_FLOAT?t.type=this.gl.HALF_FLOAT:t.type=e.type}updateTexture(e){const t=e._glTextures[this.CONTEXT_UID];if(!t)return;const n=this.renderer;if(this.initTextureType(e,t),e.resource?.upload(n,e,t))t.samplerType!==pe.FLOAT&&(this.hasIntegerTextures=!0);else{const r=e.realWidth,i=e.realHeight,s=n.gl;(t.width!==r||t.height!==i||t.dirtyId<0)&&(t.width=r,t.height=i,s.texImage2D(e.target,0,t.internalFormat,r,i,0,e.format,t.type,null))}e.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(e),t.dirtyId=e.dirtyId}destroyTexture(e,t){const{gl:n}=this;if((e=e.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(e),n.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!t)){const t=this.managedTextures.indexOf(e);-1!==t&&Nt(this.managedTextures,t,1)}}updateTextureStyle(e){const t=e._glTextures[this.CONTEXT_UID];t&&(e.mipmap!==ye.POW2&&2===this.webGLVersion||e.isPowerOfTwo?t.mipmap=e.mipmap>=1:t.mipmap=!1,2===this.webGLVersion||e.isPowerOfTwo?t.wrapMode=e.wrapMode:t.wrapMode=ge.CLAMP,e.resource?.style(this.renderer,e,t)||this.setStyle(e,t),t.dirtyStyleId=e.dirtyStyleId)}setStyle(e,t){const n=this.gl;if(t.mipmap&&e.mipmap!==ye.ON_MANUAL&&n.generateMipmap(e.target),n.texParameteri(e.target,n.TEXTURE_WRAP_S,t.wrapMode),n.texParameteri(e.target,n.TEXTURE_WRAP_T,t.wrapMode),t.mipmap){n.texParameteri(e.target,n.TEXTURE_MIN_FILTER,e.scaleMode===me.LINEAR?n.LINEAR_MIPMAP_LINEAR:n.NEAREST_MIPMAP_NEAREST);const t=this.renderer.context.extensions.anisotropicFiltering;if(t&&e.anisotropicLevel>0&&e.scaleMode===me.LINEAR){const r=Math.min(e.anisotropicLevel,n.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT));n.texParameterf(e.target,t.TEXTURE_MAX_ANISOTROPY_EXT,r)}}else n.texParameteri(e.target,n.TEXTURE_MIN_FILTER,e.scaleMode===me.LINEAR?n.LINEAR:n.NEAREST);n.texParameteri(e.target,n.TEXTURE_MAG_FILTER,e.scaleMode===me.LINEAR?n.LINEAR:n.NEAREST)}destroy(){this.renderer=null}}Ci.extension={type:qt.RendererSystem,name:"texture"},Qt.add(Ci);class ki{constructor(e){this.renderer=e}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:n}=this,r=e._glTransformFeedbacks[n]||this.createGLTransformFeedback(e);t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,r)}unbind(){const{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(e,t){const{gl:n,renderer:r}=this;t&&r.shader.bind(t),n.beginTransformFeedback(e)}endTransformFeedback(){const{gl:e}=this;e.endTransformFeedback()}createGLTransformFeedback(e){const{gl:t,renderer:n,CONTEXT_UID:r}=this,i=t.createTransformFeedback();e._glTransformFeedbacks[r]=i,t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,i);for(let i=0;i<e.buffers.length;i++){const s=e.buffers[i];s&&(n.buffer.update(s),s._glBuffers[r].refCount++,t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,i,s._glBuffers[r].buffer||null))}return t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null),e.disposeRunner.add(this),i}disposeTransformFeedback(e,t){const n=e._glTransformFeedbacks[this.CONTEXT_UID],r=this.gl;e.disposeRunner.remove(this);const i=this.renderer.buffer;if(i)for(let n=0;n<e.buffers.length;n++){const r=e.buffers[n];if(!r)continue;const s=r._glBuffers[this.CONTEXT_UID];s&&(s.refCount--,0!==s.refCount||t||i.dispose(r,t))}n&&(t||r.deleteTransformFeedback(n),delete e._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}ki.extension={type:qt.RendererSystem,name:"transformFeedback"},Qt.add(ki);class Ai{constructor(e){this.renderer=e}init(e){this.screen=new An(0,0,e.width,e.height),this.element=e.view||Ce.ADAPTER.createCanvas(),this.resolution=e.resolution||Ce.RESOLUTION,this.autoDensity=!!e.autoDensity}resizeView(e,t){this.element.width=Math.round(e*this.resolution),this.element.height=Math.round(t*this.resolution);const n=this.element.width/this.resolution,r=this.element.height/this.resolution;this.screen.width=n,this.screen.height=r,this.autoDensity&&(this.element.style.width=`${n}px`,this.element.style.height=`${r}px`),this.renderer.emit("resize",n,r),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(e){e&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}Ai.defaultOptions={width:800,height:600,resolution:Ce.RESOLUTION,autoDensity:!1},Ai.extension={type:[qt.RendererSystem,qt.CanvasRendererSystem],name:"_view"},Qt.add(Ai),Ce.PREFER_ENV=ae.WEBGL2,Ce.STRICT_TEXTURE_CACHE=!1,Ce.RENDER_OPTIONS={...br.defaultOptions,...yr.defaultOptions,...Ai.defaultOptions,...xi.defaultOptions},Object.defineProperties(Ce,{WRAP_MODE:{get:()=>hn.defaultOptions.wrapMode,set(e){Qe("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),hn.defaultOptions.wrapMode=e}},SCALE_MODE:{get:()=>hn.defaultOptions.scaleMode,set(e){Qe("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),hn.defaultOptions.scaleMode=e}},MIPMAP_TEXTURES:{get:()=>hn.defaultOptions.mipmap,set(e){Qe("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),hn.defaultOptions.mipmap=e}},ANISOTROPIC_LEVEL:{get:()=>hn.defaultOptions.anisotropicLevel,set(e){Qe("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),hn.defaultOptions.anisotropicLevel=e}},FILTER_RESOLUTION:{get:()=>(Qe("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),gr.defaultResolution),set(e){gr.defaultResolution=e}},FILTER_MULTISAMPLE:{get:()=>(Qe("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),gr.defaultMultisample),set(e){gr.defaultMultisample=e}},SPRITE_MAX_TEXTURES:{get:()=>pr.defaultMaxTextures,set(e){Qe("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),pr.defaultMaxTextures=e}},SPRITE_BATCH_SIZE:{get:()=>pr.defaultBatchSize,set(e){Qe("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),pr.defaultBatchSize=e}},CAN_UPLOAD_SAME_BUFFER:{get:()=>pr.canUploadSameBuffer,set(e){Qe("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),pr.canUploadSameBuffer=e}},GC_MODE:{get:()=>Ti.defaultMode,set(e){Qe("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Ti.defaultMode=e}},GC_MAX_IDLE:{get:()=>Ti.defaultMaxIdle,set(e){Qe("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Ti.defaultMaxIdle=e}},GC_MAX_CHECK_COUNT:{get:()=>Ti.defaultCheckCountMax,set(e){Qe("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Ti.defaultCheckCountMax=e}},PRECISION_VERTEX:{get:()=>or.defaultVertexPrecision,set(e){Qe("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),or.defaultVertexPrecision=e}},PRECISION_FRAGMENT:{get:()=>or.defaultFragmentPrecision,set(e){Qe("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),or.defaultFragmentPrecision=e}}});var Mi=(e=>(e[e.INTERACTION=50]="INTERACTION",e[e.HIGH=25]="HIGH",e[e.NORMAL=0]="NORMAL",e[e.LOW=-25]="LOW",e[e.UTILITY=-50]="UTILITY",e))(Mi||{});class Pi{constructor(e,t=null,n=0,r=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=t,this.priority=n,this.once=r}match(e,t=null){return this.fn===e&&this.context===t}emit(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));const t=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),t}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const t=this.next;return this.next=e?null:t,this.previous=null,t}}const Ri=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Pi(null,null,1/0),this.deltaMS=1/Ri.targetFPMS,this.elapsedMS=1/Ri.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,n=Mi.NORMAL){return this._addListener(new Pi(e,t,n))}addOnce(e,t,n=Mi.NORMAL){return this._addListener(new Pi(e,t,n,!0))}_addListener(e){let t=this._head.next,n=this._head;if(t){for(;t;){if(e.priority>t.priority){e.connect(n);break}n=t,t=t.next}e.previous||e.connect(n)}else e.connect(n);return this._startIfPossible(),this}remove(e,t){let n=this._head.next;for(;n;)n=n.match(e,t)?n.destroy():n.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const t=e-this._lastFrame|0;if(t<this._minElapsedMS)return;this._lastFrame=e-t%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*Ri.targetFPMS;const n=this._head;let r=n.next;for(;r;)r=r.emit(this.deltaTime);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const t=Math.min(this.maxFPS,e),n=Math.min(Math.max(0,t)/1e3,Ri.targetFPMS);this._maxElapsedMS=1/n}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(0===e)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!Ri._shared){const e=Ri._shared=new Ri;e.autoStart=!0,e._protected=!0}return Ri._shared}static get system(){if(!Ri._system){const e=Ri._system=new Ri;e.autoStart=!0,e._protected=!0}return Ri._system}};let Ii=Ri;Ii.targetFPMS=.06,Object.defineProperties(Ce,{TARGET_FPMS:{get:()=>Ii.targetFPMS,set(e){Qe("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Ii.targetFPMS=e}}});class Di{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,Mi.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?Ii.shared:new Ii,e.autoStart&&this.start()}static destroy(){if(this._ticker){const e=this._ticker;this.ticker=null,e.destroy()}}}Di.extension=qt.Application,Qt.add(Di);const Fi=[];Qt.handleByList(qt.Renderer,Fi);const Ni="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";class Li{constructor(e){this.renderer=e}contextChange(e){let t;if(1===this.renderer.context.webGLVersion){const n=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,n)}else{const n=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,n)}t>=_e.HIGH?this.multisample=_e.HIGH:t>=_e.MEDIUM?this.multisample=_e.MEDIUM:t>=_e.LOW?this.multisample=_e.LOW:this.multisample=_e.NONE}destroy(){}}Li.extension={type:qt.RendererSystem,name:"_multisample"},Qt.add(Li);class Bi{constructor(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Oi{constructor(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:n}=this,r=e._glBuffers[n]||this.createGLBuffer(e);t.bindBuffer(e.type,r.buffer)}unbind(e){const{gl:t}=this;t.bindBuffer(e,null)}bindBufferBase(e,t){const{gl:n,CONTEXT_UID:r}=this;if(this.boundBufferBases[t]!==e){const i=e._glBuffers[r]||this.createGLBuffer(e);this.boundBufferBases[t]=e,n.bindBufferBase(n.UNIFORM_BUFFER,t,i.buffer)}}bindBufferRange(e,t,n){const{gl:r,CONTEXT_UID:i}=this;n=n||0;const s=e._glBuffers[i]||this.createGLBuffer(e);r.bindBufferRange(r.UNIFORM_BUFFER,t||0,s.buffer,256*n,256)}update(e){const{gl:t,CONTEXT_UID:n}=this,r=e._glBuffers[n]||this.createGLBuffer(e);if(e._updateID!==r.updateID)if(r.updateID=e._updateID,t.bindBuffer(e.type,r.buffer),r.byteLength>=e.data.byteLength)t.bufferSubData(e.type,0,e.data);else{const n=e.static?t.STATIC_DRAW:t.DYNAMIC_DRAW;r.byteLength=e.data.byteLength,t.bufferData(e.type,e.data,n)}}dispose(e,t){if(!this.managedBuffers[e.id])return;delete this.managedBuffers[e.id];const n=e._glBuffers[this.CONTEXT_UID],r=this.gl;e.disposeRunner.remove(this),n&&(t||r.deleteBuffer(n.buffer),delete e._glBuffers[this.CONTEXT_UID])}disposeAll(e){const t=Object.keys(this.managedBuffers);for(let n=0;n<t.length;n++)this.dispose(this.managedBuffers[t[n]],e)}createGLBuffer(e){const{CONTEXT_UID:t,gl:n}=this;return e._glBuffers[t]=new Bi(n.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[t]}}Oi.extension={type:qt.RendererSystem,name:"buffer"},Qt.add(Oi);class zi{constructor(e){this.renderer=e}render(e,t){const n=this.renderer;let r,i,s,o;if(t&&(r=t.renderTexture,i=t.clear,s=t.transform,o=t.skipUpdateTransform),this.renderingToScreen=!r,n.runners.prerender.emit(),n.emit("prerender"),n.projection.transform=s,!n.context.isLost){if(r||(this.lastObjectRendered=e),!o){const t=e.enableTempParent();e.updateTransform(),e.disableTempParent(t)}n.renderTexture.bind(r),n.batch.currentRenderer.start(),(i??n.background.clearBeforeRender)&&n.renderTexture.clear(),e.render(n),n.batch.currentRenderer.flush(),r&&(t.blit&&n.framebuffer.blit(),r.baseTexture.update()),n.runners.postrender.emit(),n.projection.transform=null,n.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}zi.extension={type:qt.RendererSystem,name:"objectRenderer"},Qt.add(zi);const ji=class extends Si{constructor(e){super(),e=Object.assign({},Ce.RENDER_OPTIONS,e),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new lr({projectionMatrix:new Dn},!0);const t={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:ji.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t),"useContextAlpha"in e&&(Qe("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),e.premultipliedAlpha=e.useContextAlpha&&"notMultiplied"!==e.useContextAlpha,e.backgroundAlpha=!1===e.useContextAlpha?1:e.backgroundAlpha),this._plugin.rendererPlugins=ji.__plugins,this.options=e,this.startup.run(this.options)}static test(e){return!e?.forceCanvas&&(void 0===Je&&(Je=function(){const e={stencil:!0,failIfMajorPerformanceCaveat:Ce.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!Ce.ADAPTER.getWebGLRenderingContext())return!1;const t=Ce.ADAPTER.createCanvas();let n=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);const r=!!n?.getContextAttributes()?.stencil;if(n){const e=n.getExtension("WEBGL_lose_context");e&&e.loseContext()}return n=null,r}catch(e){return!1}}()),Je)}render(e,t){this.objectRenderer.render(e,t)}resize(e,t){this._view.resizeView(e,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(e=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return Qe("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return Qe("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return Qe("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return Qe("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){Qe("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return Qe("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(e){Qe("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get powerPreference(){return Qe("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(e,t){return this.textureGenerator.generateTexture(e,t)}};let Ui=ji;Ui.extension={type:qt.Renderer,priority:1},Ui.__plugins={},Ui.__systems={},Qt.handleByMap(qt.RendererPlugin,Ui.__plugins),Qt.handleByMap(qt.RendererSystem,Ui.__systems),Qt.add(Ui);class Gi extends an{constructor(e,t){const{width:n,height:r}=t||{};super(n,r),this.items=[],this.itemDirtyIds=[];for(let t=0;t<e;t++){const e=new hn;this.items.push(e),this.itemDirtyIds.push(-2)}this.length=e,this._load=null,this.baseTexture=null}initFromArray(e,t){for(let n=0;n<this.length;n++)e[n]&&(e[n].castToBaseTexture?this.addBaseTextureAt(e[n].castToBaseTexture(),n):e[n]instanceof an?this.addResourceAt(e[n],n):this.addResourceAt(sn(e[n],t),n))}dispose(){for(let e=0,t=this.length;e<t;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(e,t){if(!this.items[t])throw new Error(`Index ${t} is out of bounds`);return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[t].setResource(e),this}bind(e){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");super.bind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=e,this.items[t].on("update",e.update,e)}unbind(e){super.unbind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=null,this.items[t].off("update",e.update,e)}load(){if(this._load)return this._load;const e=this.items.map((e=>e.resource)).filter((e=>e)).map((e=>e.load()));return this._load=Promise.all(e).then((()=>{const{realWidth:e,realHeight:t}=this.items[0];return this.resize(e,t),Promise.resolve(this)})),this._load}}const Vi=class extends Gi{constructor(e,t){const{width:n,height:r,autoLoad:i,linkBaseTexture:s}=t||{};if(e&&e.length!==Vi.SIDES)throw new Error(`Invalid length. Got ${e.length}, expected 6`);super(6,{width:n,height:r});for(let e=0;e<Vi.SIDES;e++)this.items[e].target=de.TEXTURE_CUBE_MAP_POSITIVE_X+e;this.linkBaseTexture=!1!==s,e&&this.initFromArray(e,t),!1!==i&&this.load()}bind(e){super.bind(e),e.target=de.TEXTURE_CUBE_MAP}addBaseTextureAt(e,t,n){if(void 0===n&&(n=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0){if(!e.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(e.resource,t)}else e.target=de.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this}upload(e,t,n){const r=this.itemDirtyIds;for(let i=0;i<Vi.SIDES;i++){const s=this.items[i];(r[i]<s.dirtyId||n.dirtyId<t.dirtyId)&&(s.valid&&s.resource?(s.resource.upload(e,s,n),r[i]=s.dirtyId):r[i]<-1&&(e.gl.texImage2D(s.target,0,n.internalFormat,t.realWidth,t.realHeight,0,t.format,n.type,null),r[i]=-1))}return!0}static test(e){return Array.isArray(e)&&e.length===Vi.SIDES}};let Hi=Vi;Hi.SIDES=6;class Wi extends Tr{constructor(e,t){let n,r;t=t||{},"string"==typeof e?(n=Wi.EMPTY,r=e):(n=e,r=null),super(n),this.url=r,this.crossOrigin=t.crossOrigin??!0,this.alphaMode="number"==typeof t.alphaMode?t.alphaMode:null,this._load=null,!1!==t.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((async(e,t)=>{if(null!==this.url)try{const t=await Ce.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const n=await t.blob();if(this.destroyed)return;const r=await createImageBitmap(n,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===ve.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=r,this.update(),e(this)}catch(e){if(this.destroyed)return;t(e),this.onError.emit(e)}else e(this)}))),this._load}upload(e,t,n){return this.source instanceof ImageBitmap?("number"==typeof this.alphaMode&&(t.alphaMode=this.alphaMode),super.upload(e,t,n)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(e){return!!globalThis.createImageBitmap&&"undefined"!=typeof ImageBitmap&&("string"==typeof e||e instanceof ImageBitmap)}static get EMPTY(){return Wi._EMPTY=Wi._EMPTY??Ce.ADAPTER.createCanvas(0,0),Wi._EMPTY}}const Xi=class extends Tr{constructor(e,t){t=t||{},super(Ce.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,!1!==t.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((e=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),e(this)},Xi.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}))),this._load}_loadSvg(){const e=new Image;Tr.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=t=>{this._resolve&&(e.onerror=null,this.onError.emit(t))},e.onload=()=>{if(!this._resolve)return;const t=e.width,n=e.height;if(!t||!n)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let r=t*this.scale,i=n*this.scale;(this._overrideWidth||this._overrideHeight)&&(r=this._overrideWidth||this._overrideHeight/n*t,i=this._overrideHeight||this._overrideWidth/t*n),r=Math.round(r),i=Math.round(i);const s=this.source;s.width=r,s.height=i,s._pixiId=`canvas_${Ot()}`,s.getContext("2d").drawImage(e,0,0,t,n,0,0,r,i),this._resolve(),this._resolve=null}}static getSize(e){const t=Xi.SVG_SIZE.exec(e),n={};return t&&(n[t[1]]=Math.round(parseFloat(t[3])),n[t[5]]=Math.round(parseFloat(t[7]))),n}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(e,t){return"svg"===t||"string"==typeof e&&e.startsWith("data:image/svg+xml")||"string"==typeof e&&Xi.SVG_XML.test(e)}};let $i=Xi;$i.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,$i.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const Yi=class extends Tr{constructor(e,t){if(t=t||{},!(e instanceof HTMLVideoElement)){const n=document.createElement("video");n.setAttribute("preload","auto"),n.setAttribute("webkit-playsinline",""),n.setAttribute("playsinline",""),"string"==typeof e&&(e=[e]);const r=e[0].src||e[0];Tr.crossOrigin(n,r,t.crossorigin);for(let t=0;t<e.length;++t){const r=document.createElement("source");let{src:i,mime:s}=e[t];i=i||e[t];const o=i.split("?").shift().toLowerCase(),a=o.slice(o.lastIndexOf(".")+1);s=s||Yi.MIME_TYPES[a]||`video/${a}`,r.src=i,r.type=s,n.appendChild(r)}e=n}super(e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==t.autoPlay,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),!1!==t.autoLoad&&this.load()}update(e=0){if(!this.destroyed){const e=Ii.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart.bind(this)),e.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise((t=>{this.valid?t(this):(this._resolve=t,e.load())})),this._load}_onError(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e)}_isSourcePlaying(){const e=this.source;return!e.paused&&!e.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Ii.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(Ii.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this.resize(e.videoWidth,e.videoHeight),!t&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._isConnectedToTicker&&(Ii.shared.remove(this.update,this),this._isConnectedToTicker=!1);const e=this.source;e&&(e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(Ii.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Ii.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e)}static test(e,t){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||Yi.TYPES.includes(t)}};let qi=Yi;qi.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],qi.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},rn.push(Wi,Er,class extends Tr{constructor(e){super(e)}static test(e){const{OffscreenCanvas:t}=globalThis;return!!(t&&e instanceof t)||globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement}},qi,$i,ln,Hi,class extends Gi{constructor(e,t){const{width:n,height:r}=t||{};let i,s;Array.isArray(e)?(i=e,s=e.length):s=e,super(s,{width:n,height:r}),i&&this.initFromArray(i,t)}addBaseTextureAt(e,t){if(!e.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(e.resource,t),this}bind(e){super.bind(e),e.target=de.TEXTURE_2D_ARRAY}upload(e,t,n){const{length:r,itemDirtyIds:i,items:s}=this,{gl:o}=e;n.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,n.internalFormat,this._width,this._height,r,0,t.format,n.type,null);for(let e=0;e<r;e++){const r=s[e];i[e]<r.dirtyId&&(i[e]=r.dirtyId,r.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,e,r.resource.width,r.resource.height,1,t.format,n.type,r.resource.source))}return!0}});class Ki{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(e){return this.minX>this.maxX||this.minY>this.maxY?An.EMPTY:((e=e||new An(0,0,1,1)).x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)}addPoint(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)}addPointMatrix(e,t){const{a:n,b:r,c:i,d:s,tx:o,ty:a}=e,l=n*t.x+i*t.y+o,u=r*t.x+s*t.y+a;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,u),this.maxY=Math.max(this.maxY,u)}addQuad(e){let t=this.minX,n=this.minY,r=this.maxX,i=this.maxY,s=e[0],o=e[1];t=s<t?s:t,n=o<n?o:n,r=s>r?s:r,i=o>i?o:i,s=e[2],o=e[3],t=s<t?s:t,n=o<n?o:n,r=s>r?s:r,i=o>i?o:i,s=e[4],o=e[5],t=s<t?s:t,n=o<n?o:n,r=s>r?s:r,i=o>i?o:i,s=e[6],o=e[7],t=s<t?s:t,n=o<n?o:n,r=s>r?s:r,i=o>i?o:i,this.minX=t,this.minY=n,this.maxX=r,this.maxY=i}addFrame(e,t,n,r,i){this.addFrameMatrix(e.worldTransform,t,n,r,i)}addFrameMatrix(e,t,n,r,i){const s=e.a,o=e.b,a=e.c,l=e.d,u=e.tx,c=e.ty;let h=this.minX,d=this.minY,f=this.maxX,p=this.maxY,m=s*t+a*n+u,g=o*t+l*n+c;h=m<h?m:h,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,m=s*r+a*n+u,g=o*r+l*n+c,h=m<h?m:h,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,m=s*t+a*i+u,g=o*t+l*i+c,h=m<h?m:h,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,m=s*r+a*i+u,g=o*r+l*i+c,h=m<h?m:h,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,this.minX=h,this.minY=d,this.maxX=f,this.maxY=p}addVertexData(e,t,n){let r=this.minX,i=this.minY,s=this.maxX,o=this.maxY;for(let a=t;a<n;a+=2){const t=e[a],n=e[a+1];r=t<r?t:r,i=n<i?n:i,s=t>s?t:s,o=n>o?n:o}this.minX=r,this.minY=i,this.maxX=s,this.maxY=o}addVertices(e,t,n,r){this.addVerticesMatrix(e.worldTransform,t,n,r)}addVerticesMatrix(e,t,n,r,i=0,s=i){const o=e.a,a=e.b,l=e.c,u=e.d,c=e.tx,h=e.ty;let d=this.minX,f=this.minY,p=this.maxX,m=this.maxY;for(let e=n;e<r;e+=2){const n=t[e],r=t[e+1],g=o*n+l*r+c,y=u*r+a*n+h;d=Math.min(d,g-i),p=Math.max(p,g+i),f=Math.min(f,y-s),m=Math.max(m,y+s)}this.minX=d,this.minY=f,this.maxX=p,this.maxY=m}addBounds(e){const t=this.minX,n=this.minY,r=this.maxX,i=this.maxY;this.minX=e.minX<t?e.minX:t,this.minY=e.minY<n?e.minY:n,this.maxX=e.maxX>r?e.maxX:r,this.maxY=e.maxY>i?e.maxY:i}addBoundsMask(e,t){const n=e.minX>t.minX?e.minX:t.minX,r=e.minY>t.minY?e.minY:t.minY,i=e.maxX<t.maxX?e.maxX:t.maxX,s=e.maxY<t.maxY?e.maxY:t.maxY;if(n<=i&&r<=s){const e=this.minX,t=this.minY,o=this.maxX,a=this.maxY;this.minX=n<e?n:e,this.minY=r<t?r:t,this.maxX=i>o?i:o,this.maxY=s>a?s:a}}addBoundsMatrix(e,t){this.addFrameMatrix(t,e.minX,e.minY,e.maxX,e.maxY)}addBoundsArea(e,t){const n=e.minX>t.x?e.minX:t.x,r=e.minY>t.y?e.minY:t.y,i=e.maxX<t.x+t.width?e.maxX:t.x+t.width,s=e.maxY<t.y+t.height?e.maxY:t.y+t.height;if(n<=i&&r<=s){const e=this.minX,t=this.minY,o=this.maxX,a=this.maxY;this.minX=n<e?n:e,this.minY=r<t?r:t,this.maxX=i>o?i:o,this.maxY=s>a?s:a}}pad(e=0,t=e){this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t)}addFramePad(e,t,n,r,i,s){e-=i,t-=s,n+=i,r+=s,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>n?this.maxX:n,this.minY=this.minY<t?this.minY:t,this.maxY=this.maxY>r?this.maxY:r}}class Zi extends He{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Hn,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Ki,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(e){const t=Object.keys(e);for(let n=0;n<t.length;++n){const r=t[n];Object.defineProperty(Zi.prototype,r,Object.getOwnPropertyDescriptor(e,r))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(e,t){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),t||(this._boundsRect||(this._boundsRect=new An),t=this._boundsRect),this._bounds.getRectangle(t)}getLocalBounds(e){e||(this._localBoundsRect||(this._localBoundsRect=new An),e=this._localBoundsRect),this._localBounds||(this._localBounds=new Ki);const t=this.transform,n=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const r=this._bounds,i=this._boundsID;this._bounds=this._localBounds;const s=this.getBounds(!1,e);return this.parent=n,this.transform=t,this._bounds=r,this._bounds.updateID+=this._boundsID-i,s}toGlobal(e,t,n=!1){return n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,t)}toLocal(e,t,n,r){return t&&(e=t.toGlobal(e,n,r)),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,n)}setParent(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e}removeFromParent(){this.parent?.removeChild(this)}setTransform(e=0,t=0,n=1,r=1,i=0,s=0,o=0,a=0,l=0){return this.position.x=e,this.position.y=t,this.scale.x=n||1,this.scale.y=r||1,this.rotation=i,this.skew.x=s,this.skew.y=o,this.pivot.x=a,this.pivot.y=l,this}destroy(e){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new Qi),this.tempDisplayObjectParent}enableTempParent(){const e=this.parent;return this.parent=this._tempDisplayObjectParent,e}disableTempParent(e){this.parent=e}get x(){return this.position.x}set x(e){this.transform.position.x=e}get y(){return this.position.y}set y(e){this.transform.position.y=e}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(e){this.transform.position.copyFrom(e)}get scale(){return this.transform.scale}set scale(e){this.transform.scale.copyFrom(e)}get pivot(){return this.transform.pivot}set pivot(e){this.transform.pivot.copyFrom(e)}get skew(){return this.transform.skew}set skew(e){this.transform.skew.copyFrom(e)}get rotation(){return this.transform.rotation}set rotation(e){this.transform.rotation=e}get angle(){return this.transform.rotation*_n}set angle(e){this.transform.rotation=e*Tn}get zIndex(){return this._zIndex}set zIndex(e){this._zIndex=e,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}get mask(){return this._mask}set mask(e){if(this._mask!==e){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,0===e._maskRefCount&&(e.renderable=!0,e.isMask=!1))}if(this._mask=e,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(0===e._maskRefCount&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class Qi extends Zi{constructor(){super(...arguments),this.sortDirty=null}}Zi.prototype.displayObjectUpdateTransform=Zi.prototype.updateTransform;const Ji=new Dn;function es(e,t){return e.zIndex===t.zIndex?e._lastSortedIndex-t._lastSortedIndex:e.zIndex-t.zIndex}const ts=class extends Zi{constructor(){super(),this.children=[],this.sortableChildren=ts.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(e){}addChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.addChild(e[t]);else{const t=e[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return e[0]}addChildAt(e,t){if(t<0||t>this.children.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e}swapChildren(e,t){if(e===t)return;const n=this.getChildIndex(e),r=this.getChildIndex(t);this.children[n]=t,this.children[r]=e,this.onChildrenChange(n<r?n:r)}getChildIndex(e){const t=this.children.indexOf(e);if(-1===t)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const n=this.getChildIndex(e);Nt(this.children,n,1),this.children.splice(t,0,e),this.onChildrenChange(t)}getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.removeChild(e[t]);else{const t=e[0],n=this.children.indexOf(t);if(-1===n)return null;t.parent=null,t.transform._parentID=-1,Nt(this.children,n,1),this._boundsID++,this.onChildrenChange(n),t.emit("removed",this),this.emit("childRemoved",t,this,n)}return e[0]}removeChildAt(e){const t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,Nt(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t}removeChildren(e=0,t=this.children.length){const n=e,r=t-n;let i;if(r>0&&r<=t){i=this.children.splice(n,r);for(let e=0;e<i.length;++e)i[e].parent=null,i[e].transform&&(i[e].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let e=0;e<i.length;++e)i[e].emit("removed",this),this.emit("childRemoved",i[e],this,e);return i}if(0===r&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let e=!1;for(let t=0,n=this.children.length;t<n;++t){const n=this.children[t];n._lastSortedIndex=t,e||0===n.zIndex||(e=!0)}e&&this.children.length>1&&this.children.sort(es),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,t=this.children.length;e<t;++e){const t=this.children[e];t.visible&&t.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let e=0;e<this.children.length;e++){const t=this.children[e];if(t.visible&&t.renderable)if(t.calculateBounds(),t._mask){const e=t._mask.isMaskData?t._mask.maskObject:t._mask;e?(e.calculateBounds(),this._bounds.addBoundsMask(t._bounds,e._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(e,t=!1){const n=super.getLocalBounds(e);if(!t)for(let e=0,t=this.children.length;e<t;++e){const t=this.children[e];t.visible&&t.updateTransform()}return n}_calculateBounds(){}_renderWithCulling(e){const t=e.renderTexture.sourceFrame;if(!(t.width>0&&t.height>0))return;let n,r;this.cullArea?(n=this.cullArea,r=this.worldTransform):this._render!==ts.prototype._render&&(n=this.getBounds(!0));const i=e.projection.transform;if(i&&(r?(r=Ji.copyFrom(r),r.prepend(i)):r=i),n&&t.intersects(n,r))this._render(e);else if(this.cullArea)return;for(let t=0,n=this.children.length;t<n;++t){const n=this.children[t],r=n.cullable;n.cullable=r||!this.cullArea,n.render(e),n.cullable=r}}render(e){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters?.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let t=0,n=this.children.length;t<n;++t)this.children[t].render(e)}}renderAdvanced(e){const t=this.filters,n=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let e=0;e<t.length;e++)t[e].enabled&&this._enabledFilters.push(t[e])}const r=t&&this._enabledFilters?.length||n&&(!n.isMaskData||n.enabled&&(n.autoDetect||n.type!==Se.NONE));if(r&&e.batch.flush(),t&&this._enabledFilters?.length&&e.filter.push(this,this._enabledFilters),n&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let t=0,n=this.children.length;t<n;++t)this.children[t].render(e)}r&&e.batch.flush(),n&&e.mask.pop(this),t&&this._enabledFilters?.length&&e.filter.pop()}_render(e){}destroy(e){super.destroy(),this.sortDirty=!1;const t="boolean"==typeof e?e:e?.children,n=this.removeChildren(0,this.children.length);if(t)for(let t=0;t<n.length;++t)n[t].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){const t=this.getLocalBounds().width;this.scale.x=0!==t?e/t:1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){const t=this.getLocalBounds().height;this.scale.y=0!==t?e/t:1,this._height=e}};let ns=ts;ns.defaultSortableChildren=!1,ns.prototype.containerUpdateTransform=ns.prototype.updateTransform,Object.defineProperties(Ce,{SORTABLE_CHILDREN:{get:()=>ns.defaultSortableChildren,set(e){Qe("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),ns.defaultSortableChildren=e}}});const rs=new Cn,is=new Uint16Array([0,1,2,0,2,3]);class ss extends ns{constructor(e){super(),this._anchor=new Gn(this._onAnchorUpdate,this,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=ue.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=e||Mr.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=is,this.pluginName="batch",this.isSprite=!0,this._roundPixels=Ce.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Lt(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Lt(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const e=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===e._updateID)return;this._textureID!==e._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=e._updateID;const t=this.transform.worldTransform,n=t.a,r=t.b,i=t.c,s=t.d,o=t.tx,a=t.ty,l=this.vertexData,u=e.trim,c=e.orig,h=this._anchor;let d=0,f=0,p=0,m=0;if(u?(f=u.x-h._x*c.width,d=f+u.width,m=u.y-h._y*c.height,p=m+u.height):(f=-h._x*c.width,d=f+c.width,m=-h._y*c.height,p=m+c.height),l[0]=n*f+i*m+o,l[1]=s*m+r*f+a,l[2]=n*d+i*m+o,l[3]=s*m+r*d+a,l[4]=n*d+i*p+o,l[5]=s*p+r*d+a,l[6]=n*f+i*p+o,l[7]=s*p+r*f+a,this._roundPixels){const e=Ce.RESOLUTION;for(let t=0;t<l.length;++t)l[t]=Math.round(l[t]*e)/e}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const e=this._texture,t=this.vertexTrimmedData,n=e.orig,r=this._anchor,i=this.transform.worldTransform,s=i.a,o=i.b,a=i.c,l=i.d,u=i.tx,c=i.ty,h=-r._x*n.width,d=h+n.width,f=-r._y*n.height,p=f+n.height;t[0]=s*h+a*f+u,t[1]=l*f+o*h+c,t[2]=s*d+a*f+u,t[3]=l*f+o*d+c,t[4]=s*d+a*p+u,t[5]=l*p+o*d+c,t[6]=s*h+a*p+u,t[7]=l*p+o*h+c}_render(e){this.calculateVertices(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)}_calculateBounds(){const e=this._texture.trim,t=this._texture.orig;!e||e.width===t.width&&e.height===t.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(e){return 0===this.children.length?(this._localBounds||(this._localBounds=new Ki),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new An),e=this._localBoundsRect),this._localBounds.getRectangle(e)):super.getLocalBounds.call(this,e)}containsPoint(e){this.worldTransform.applyInverse(e,rs);const t=this._texture.orig.width,n=this._texture.orig.height,r=-t*this.anchor.x;let i=0;return rs.x>=r&&rs.x<r+t&&(i=-n*this.anchor.y,rs.y>=i&&rs.y<i+n)}destroy(e){if(super.destroy(e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof e?e:e?.texture){const t="boolean"==typeof e?e:e?.baseTexture;this._texture.destroy(!!t)}this._texture=null}static from(e,t){const n=e instanceof Mr?e:Mr.from(e,t);return new ss(n)}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){const t=Lt(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){const t=Lt(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get anchor(){return this._anchor}set anchor(e){this._anchor.copyFrom(e)}get tint(){return this._tint}set tint(e){this._tint=e,this._tintRGB=At.shared.setValue(e).toLittleEndianNumber()}get texture(){return this._texture}set texture(e){this._texture!==e&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=e||Mr.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,e&&(e.baseTexture.valid?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))}}const os=new Dn;Zi.prototype._cacheAsBitmap=!1,Zi.prototype._cacheData=null,Zi.prototype._cacheAsBitmapResolution=null,Zi.prototype._cacheAsBitmapMultisample=null;class as{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Zi.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(e){e!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(e){e!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(e){if(this._cacheAsBitmap===e)return;let t;this._cacheAsBitmap=e,e?(this._cacheData||(this._cacheData=new as),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}}),Zi.prototype._renderCached=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(e),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(e))},Zi.prototype._initCachedDisplayObject=function(e){if(this._cacheData?.sprite)return;const t=this.alpha;this.alpha=1,e.batch.flush();const n=this.getLocalBounds(null,!0).clone();if(this.filters?.length){const e=this.filters[0].padding;n.pad(e)}n.ceil(Ce.RESOLUTION);const r=e.renderTexture.current,i=e.renderTexture.sourceFrame.clone(),s=e.renderTexture.destinationFrame.clone(),o=e.projection.transform,a=Pr.create({width:n.width,height:n.height,resolution:this.cacheAsBitmapResolution||e.resolution,multisample:this.cacheAsBitmapMultisample??e.multisample}),l=`cacheAsBitmap_${Ot()}`;this._cacheData.textureCacheId=l,hn.addToCache(a.baseTexture,l),Mr.addToCache(a,l);const u=this.transform.localTransform.copyTo(os).invert().translate(-n.x,-n.y);this.render=this._cacheData.originalRender,e.render(this,{renderTexture:a,clear:!0,transform:u,skipUpdateTransform:!1}),e.framebuffer.blit(),e.projection.transform=o,e.renderTexture.bind(r,i,s),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;const c=new ss(a);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-n.x/n.width,c.anchor.y=-n.y/n.height,c.alpha=t,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=c.containsPoint.bind(c)},Zi.prototype._renderCachedCanvas=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(e),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(e))},Zi.prototype._initCachedDisplayObjectCanvas=function(e){if(this._cacheData?.sprite)return;const t=this.getLocalBounds(null,!0),n=this.alpha;this.alpha=1;const r=e.canvasContext.activeContext,i=e._projTransform;t.ceil(Ce.RESOLUTION);const s=Pr.create({width:t.width,height:t.height}),o=`cacheAsBitmap_${Ot()}`;this._cacheData.textureCacheId=o,hn.addToCache(s.baseTexture,o),Mr.addToCache(s,o);const a=os;this.transform.localTransform.copyTo(a),a.invert(),a.tx-=t.x,a.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,e.render(this,{renderTexture:s,clear:!0,transform:a,skipUpdateTransform:!1}),e.canvasContext.activeContext=r,e._projTransform=i,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=n;const l=new ss(s);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-t.x/t.width,l.anchor.y=-t.y/t.height,l.alpha=n,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=e._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)},Zi.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},Zi.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},Zi.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,hn.removeFromCache(this._cacheData.textureCacheId),Mr.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},Zi.prototype._cacheAsBitmapDestroy=function(e){this.cacheAsBitmap=!1,this.destroy(e)},Zi.prototype.name=null,ns.prototype.getChildByName=function(e,t){for(let t=0,n=this.children.length;t<n;t++)if(this.children[t].name===e)return this.children[t];if(t)for(let t=0,n=this.children.length;t<n;t++){const n=this.children[t];if(!n.getChildByName)continue;const r=n.getChildByName(e,!0);if(r)return r}return null},Zi.prototype.getGlobalPosition=function(e=new Cn,t=!1){return this.parent?this.parent.toGlobal(this.position,e,t):(e.x=this.position.x,e.y=this.position.y),e};const ls={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},us=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");class cs extends gr{constructor(e,t=8,n=4,r=gr.defaultResolution,i=5){const s=function(e,t){const n=Math.ceil(e/2);let r,i="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",s="";r=t?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let t=0;t<e;t++){let e=r.replace("%index%",t.toString());e=e.replace("%sampleIndex%",t-(n-1)+".0"),s+=e,s+="\n"}return i=i.replace("%blur%",s),i=i.replace("%size%",e.toString()),i}(i,e),o=function(e){const t=ls[e],n=t.length;let r,i=us,s="";for(let i=0;i<e;i++){let o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",i.toString());r=i,i>=n&&(r=e-i-1),o=o.replace("%value%",t[r].toString()),s+=o,s+="\n"}return i=i.replace("%blur%",s),i=i.replace("%size%",e.toString()),i}(i);super(s,o),this.horizontal=e,this.resolution=r,this._quality=0,this.quality=n,this.blur=t}apply(e,t,n,r){if(n?this.horizontal?this.uniforms.strength=1/n.width*(n.width/t.width):this.uniforms.strength=1/n.height*(n.height/t.height):this.horizontal?this.uniforms.strength=1/e.renderer.width*(e.renderer.width/t.width):this.uniforms.strength=1/e.renderer.height*(e.renderer.height/t.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)e.applyFilter(this,t,n,r);else{const i=e.getFilterTexture(),s=e.renderer;let o=t,a=i;this.state.blend=!1,e.applyFilter(this,o,a,xe.CLEAR);for(let t=1;t<this.passes-1;t++){e.bindAndClear(o,xe.BLIT),this.uniforms.uSampler=a;const t=a;a=o,o=t,s.shader.bind(this),s.geometry.draw(5)}this.state.blend=!0,e.applyFilter(this,a,n,r),e.returnFilterTexture(i)}}get blur(){return this.strength}set blur(e){this.padding=1+2*Math.abs(e),this.strength=e}get quality(){return this._quality}set quality(e){this._quality=e,this.passes=e}}class hs extends gr{constructor(){const e={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Ni,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",e),this.alpha=1}_loadMatrix(e,t=!1){let n=e;t&&(this._multiply(n,this.uniforms.m,e),n=this._colorMatrix(n)),this.uniforms.m=n}_multiply(e,t,n){return e[0]=t[0]*n[0]+t[1]*n[5]+t[2]*n[10]+t[3]*n[15],e[1]=t[0]*n[1]+t[1]*n[6]+t[2]*n[11]+t[3]*n[16],e[2]=t[0]*n[2]+t[1]*n[7]+t[2]*n[12]+t[3]*n[17],e[3]=t[0]*n[3]+t[1]*n[8]+t[2]*n[13]+t[3]*n[18],e[4]=t[0]*n[4]+t[1]*n[9]+t[2]*n[14]+t[3]*n[19]+t[4],e[5]=t[5]*n[0]+t[6]*n[5]+t[7]*n[10]+t[8]*n[15],e[6]=t[5]*n[1]+t[6]*n[6]+t[7]*n[11]+t[8]*n[16],e[7]=t[5]*n[2]+t[6]*n[7]+t[7]*n[12]+t[8]*n[17],e[8]=t[5]*n[3]+t[6]*n[8]+t[7]*n[13]+t[8]*n[18],e[9]=t[5]*n[4]+t[6]*n[9]+t[7]*n[14]+t[8]*n[19]+t[9],e[10]=t[10]*n[0]+t[11]*n[5]+t[12]*n[10]+t[13]*n[15],e[11]=t[10]*n[1]+t[11]*n[6]+t[12]*n[11]+t[13]*n[16],e[12]=t[10]*n[2]+t[11]*n[7]+t[12]*n[12]+t[13]*n[17],e[13]=t[10]*n[3]+t[11]*n[8]+t[12]*n[13]+t[13]*n[18],e[14]=t[10]*n[4]+t[11]*n[9]+t[12]*n[14]+t[13]*n[19]+t[14],e[15]=t[15]*n[0]+t[16]*n[5]+t[17]*n[10]+t[18]*n[15],e[16]=t[15]*n[1]+t[16]*n[6]+t[17]*n[11]+t[18]*n[16],e[17]=t[15]*n[2]+t[16]*n[7]+t[17]*n[12]+t[18]*n[17],e[18]=t[15]*n[3]+t[16]*n[8]+t[17]*n[13]+t[18]*n[18],e[19]=t[15]*n[4]+t[16]*n[9]+t[17]*n[14]+t[18]*n[19]+t[19],e}_colorMatrix(e){const t=new Float32Array(e);return t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255,t}brightness(e,t){const n=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(n,t)}tint(e,t){const[n,r,i]=At.shared.setValue(e).toArray(),s=[n,0,0,0,0,0,r,0,0,0,0,0,i,0,0,0,0,0,1,0];this._loadMatrix(s,t)}greyscale(e,t){const n=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(n,t)}blackAndWhite(e){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],e)}hue(e,t){e=(e||0)/180*Math.PI;const n=Math.cos(e),r=Math.sin(e),i=1/3,s=(0,Math.sqrt)(i),o=[n+(1-n)*i,i*(1-n)-s*r,i*(1-n)+s*r,0,0,i*(1-n)+s*r,n+i*(1-n),i*(1-n)-s*r,0,0,i*(1-n)-s*r,i*(1-n)+s*r,n+i*(1-n),0,0,0,0,0,1,0];this._loadMatrix(o,t)}contrast(e,t){const n=(e||0)+1,r=-.5*(n-1),i=[n,0,0,0,r,0,n,0,0,r,0,0,n,0,r,0,0,0,1,0];this._loadMatrix(i,t)}saturate(e=0,t){const n=2*e/3+1,r=-.5*(n-1),i=[n,r,r,0,0,r,n,r,0,0,r,r,n,0,0,0,0,0,1,0];this._loadMatrix(i,t)}desaturate(){this.saturate(-1)}negative(e){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],e)}sepia(e){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],e)}technicolor(e){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],e)}polaroid(e){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],e)}toBGR(e){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],e)}kodachrome(e){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],e)}browni(e){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],e)}vintage(e){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],e)}colorTone(e,t,n,r,i){e=e||.2,t=t||.15,n=n||16770432,r=r||3375104;const s=At.shared,[o,a,l]=s.setValue(n).toArray(),[u,c,h]=s.setValue(r).toArray(),d=[.3,.59,.11,0,0,o,a,l,e,0,u,c,h,t,0,o-u,a-c,l-h,0,0];this._loadMatrix(d,i)}night(e,t){const n=[-2*(e=e||.1),-e,0,0,0,-e,0,e,0,0,0,e,2*e,0,0,0,0,0,1,0];this._loadMatrix(n,t)}predator(e,t){const n=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(n,t)}lsd(e){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],e)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(e){this.uniforms.m=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}}hs.prototype.grayscale=hs.prototype.greyscale;const ds={AlphaFilter:class extends gr{constructor(e=1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1}),this.alpha=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}},BlurFilter:class extends gr{constructor(e=8,t=4,n=gr.defaultResolution,r=5){super(),this.blurXFilter=new cs(!0,e,t,n,r),this.blurYFilter=new cs(!1,e,t,n,r),this.resolution=n,this.quality=t,this.blur=e,this.repeatEdgePixels=!1}apply(e,t,n,r){const i=Math.abs(this.blurXFilter.strength),s=Math.abs(this.blurYFilter.strength);if(i&&s){const i=e.getFilterTexture();this.blurXFilter.apply(e,t,i,xe.CLEAR),this.blurYFilter.apply(e,i,n,r),e.returnFilterTexture(i)}else s?this.blurYFilter.apply(e,t,n,r):this.blurXFilter.apply(e,t,n,r)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}get blur(){return this.blurXFilter.blur}set blur(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(e){this.blurXFilter.quality=this.blurYFilter.quality=e}get blurX(){return this.blurXFilter.blur}set blurX(e){this.blurXFilter.blur=e,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(e){this.blurYFilter.blur=e,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(e){this.blurYFilter.blendMode=e}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(e){this._repeatEdgePixels=e,this.updatePadding()}},BlurFilterPass:cs,ColorMatrixFilter:hs,DisplacementFilter:class extends gr{constructor(e,t){const n=new Dn;e.renderable=!1,super("attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:e._texture,filterMatrix:n,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=e,this.maskMatrix=n,null==t&&(t=20),this.scale=new Cn(t,t)}apply(e,t,n,r){this.uniforms.filterMatrix=e.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const i=this.maskSprite.worldTransform,s=Math.sqrt(i.a*i.a+i.b*i.b),o=Math.sqrt(i.c*i.c+i.d*i.d);0!==s&&0!==o&&(this.uniforms.rotation[0]=i.a/s,this.uniforms.rotation[1]=i.b/s,this.uniforms.rotation[2]=i.c/o,this.uniforms.rotation[3]=i.d/o),e.applyFilter(this,t,n,r)}get map(){return this.uniforms.mapSampler}set map(e){this.uniforms.mapSampler=e}},FXAAFilter:class extends gr{constructor(){super("\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')}},NoiseFilter:class extends gr{constructor(e=.5,t=Math.random()){super(Ni,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0}),this.noise=e,this.seed=t}get noise(){return this.uniforms.uNoise}set noise(e){this.uniforms.uNoise=e}get seed(){return this.uniforms.uSeed}set seed(e){this.uniforms.uSeed=e}}};Object.entries(ds).forEach((([e,t])=>{Object.defineProperty(ds,e,{get:()=>(Qe("7.1.0",`filters.${e} has moved to ${e}`),t)})}));const fs=new class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(e){this.removeTickerListener(),this.events=e,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(e){this._pauseUpdate=e}addTickerListener(){!this.tickerAdded&&this.domElement&&(Ii.system.add(this.tickerUpdate,this,Mi.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Ii.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove)return void(this._didMove=!1);const e=this.events.rootPointerEvent;this.events.supportsTouchEvents&&"touch"===e.pointerType||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:e.clientX,clientY:e.clientY}))}tickerUpdate(e){this._deltaTime+=e,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this.update())}};class ps{constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=ps.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Cn,this.page=new Cn,this.AT_TARGET=1,this.BUBBLING_PHASE=2,this.CAPTURING_PHASE=3,this.NONE=0,this.manager=e}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(e,t,n){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(e,t,n,r,i){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class ms extends ps{constructor(){super(...arguments),this.client=new Cn,this.movement=new Cn,this.offset=new Cn,this.global=new Cn,this.screen=new Cn}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(e,t,n){return e.worldTransform.applyInverse(n||this.global,t)}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,t,n,r,i,s,o,a,l,u,c,h,d,f,p){throw new Error("Method not implemented.")}}class gs extends ms{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class ys extends ms{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}ys.DOM_DELTA_PIXEL=0,ys.DOM_DELTA_LINE=1,ys.DOM_DELTA_PAGE=2;const vs=new Cn,xs=new Cn;class bs{constructor(e){this.dispatch=new He,this.moveOnAll=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(e,t){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:t,priority:0}),this.mappingTable[e].sort(((e,t)=>e.priority-t.priority))}dispatchEvent(e,t){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,t),this.dispatch.emit(t||e.type,e)}mapEvent(e){if(!this.rootTarget)return;const t=this.mappingTable[e.type];if(t)for(let n=0,r=t.length;n<r;n++)t[n].fn(e);else console.warn(`[EventBoundary]: Event mapping not defined for ${e.type}`)}hitTest(e,t){fs.pauseUpdate=!0;const n=this.hitTestRecursive(this.rootTarget,this.rootTarget.eventMode,vs.set(e,t),this.hitTestFn,this.hitPruneFn);return n&&n[0]}propagate(e,t){if(!e.target)return;const n=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let r=0,i=n.length-1;r<i;r++)if(e.currentTarget=n[r],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,t),!e.propagationStopped&&!e.propagationImmediatelyStopped){e.eventPhase=e.BUBBLING_PHASE;for(let r=n.length-2;r>=0;r--)if(e.currentTarget=n[r],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return}}all(e,t,n=this.rootTarget){e.eventPhase=e.BUBBLING_PHASE;const r=n.children,i="none"===n.eventMode,s="passive"===n.eventMode&&!n.interactiveChildren,o=n.interactiveChildren,a=!i&&o&&!s;if(r&&r.length>0&&a)for(let n=0;n<r.length;n++)this.all(e,t,r[n]);e.currentTarget=n,this.notifyTarget(e,t)}propagationPath(e){const t=[e];for(let n=0;n<2048&&e!==this.rootTarget;n++){if(!e.parent)throw new Error("Cannot find propagation path to disconnected target");t.push(e.parent),e=e.parent}return t.reverse(),t}hitTestRecursive(e,t,n,r,i){if(!e||!e.visible)return null;if(i(e,n))return null;if("dynamic"!==e.eventMode&&"dynamic"!==t||(fs.pauseUpdate=!1),e.interactiveChildren&&e.children){const s=e.children;for(let o=s.length-1;o>=0;o--){const a=s[o],l=this.hitTestRecursive(a,this._isInteractive(t)?t:a.eventMode,n,r,i);if(l){if(l.length>0&&!l[l.length-1].parent)continue;return(l.length>0||e.isInteractive())&&l.push(e),l}}}return this._isInteractive(t)&&r(e,n)?e.isInteractive()?[e]:[]:null}_isInteractive(e){return"static"===e||"dynamic"===e}hitPruneFn(e,t){if("none"===e.eventMode)return!0;if("passive"===e.eventMode&&!e.interactiveChildren)return!0;if(e.isMask)return!0;if(e.hitArea&&(e.worldTransform.applyInverse(t,xs),!e.hitArea.contains(xs.x,xs.y)))return!0;if(e._mask){const n=e._mask.isMaskData?e._mask.maskObject:e._mask;if(n&&!n.containsPoint?.(t))return!0}return!1}hitTestFn(e,t){return"passive"!==e.eventMode&&(!!e.hitArea||!!e.containsPoint&&e.containsPoint(t))}notifyTarget(e,t){const n=`on${t=t??e.type}`;e.currentTarget[n]?.(e);const r=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${t}capture`:t;this.notifyListeners(e,r),e.eventPhase===e.AT_TARGET&&this.notifyListeners(e,t)}mapPointerDown(e){if(!(e instanceof gs))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const t=this.createPointerEvent(e);if(this.dispatchEvent(t,"pointerdown"),"touch"===t.pointerType)this.dispatchEvent(t,"touchstart");else if("mouse"===t.pointerType||"pen"===t.pointerType){const e=2===t.button;this.dispatchEvent(t,e?"rightdown":"mousedown")}this.trackingData(e.pointerId).pressTargetsByButton[e.button]=t.composedPath(),this.freeEvent(t)}mapPointerMove(e){if(!(e instanceof gs))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const t=this.createPointerEvent(e),n="mouse"===t.pointerType||"pen"===t.pointerType,r=this.trackingData(e.pointerId),i=this.findMountedTarget(r.overTargets);if(r.overTargets?.length>0&&i!==t.target){const r="mousemove"===e.type?"mouseout":"pointerout",s=this.createPointerEvent(e,r,i);if(this.dispatchEvent(s,"pointerout"),n&&this.dispatchEvent(s,"mouseout"),!t.composedPath().includes(i)){const r=this.createPointerEvent(e,"pointerleave",i);for(r.eventPhase=r.AT_TARGET;r.target&&!t.composedPath().includes(r.target);)r.currentTarget=r.target,this.notifyTarget(r),n&&this.notifyTarget(r,"mouseleave"),r.target=r.target.parent;this.freeEvent(r)}this.freeEvent(s)}if(i!==t.target){const r="mousemove"===e.type?"mouseover":"pointerover",s=this.clonePointerEvent(t,r);this.dispatchEvent(s,"pointerover"),n&&this.dispatchEvent(s,"mouseover");let o=i?.parent;for(;o&&o!==this.rootTarget.parent&&o!==t.target;)o=o.parent;if(!o||o===this.rootTarget.parent){const e=this.clonePointerEvent(t,"pointerenter");for(e.eventPhase=e.AT_TARGET;e.target&&e.target!==i&&e.target!==this.rootTarget.parent;)e.currentTarget=e.target,this.notifyTarget(e),n&&this.notifyTarget(e,"mouseenter"),e.target=e.target.parent;this.freeEvent(e)}this.freeEvent(s)}const s=this.moveOnAll?"all":"dispatchEvent";this[s](t,"pointermove"),this.all(t,"globalpointermove"),"touch"===t.pointerType&&(this[s](t,"touchmove"),this.all(t,"globaltouchmove")),n&&(this[s](t,"mousemove"),this.all(t,"globalmousemove"),this.cursor=t.target?.cursor),r.overTargets=t.composedPath(),this.freeEvent(t)}mapPointerOver(e){if(!(e instanceof gs))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const t=this.trackingData(e.pointerId),n=this.createPointerEvent(e),r="mouse"===n.pointerType||"pen"===n.pointerType;this.dispatchEvent(n,"pointerover"),r&&this.dispatchEvent(n,"mouseover"),"mouse"===n.pointerType&&(this.cursor=n.target?.cursor);const i=this.clonePointerEvent(n,"pointerenter");for(i.eventPhase=i.AT_TARGET;i.target&&i.target!==this.rootTarget.parent;)i.currentTarget=i.target,this.notifyTarget(i),r&&this.notifyTarget(i,"mouseenter"),i.target=i.target.parent;t.overTargets=n.composedPath(),this.freeEvent(n),this.freeEvent(i)}mapPointerOut(e){if(!(e instanceof gs))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const t=this.trackingData(e.pointerId);if(t.overTargets){const n="mouse"===e.pointerType||"pen"===e.pointerType,r=this.findMountedTarget(t.overTargets),i=this.createPointerEvent(e,"pointerout",r);this.dispatchEvent(i),n&&this.dispatchEvent(i,"mouseout");const s=this.createPointerEvent(e,"pointerleave",r);for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),n&&this.notifyTarget(s,"mouseleave"),s.target=s.target.parent;t.overTargets=null,this.freeEvent(i),this.freeEvent(s)}this.cursor=null}mapPointerUp(e){if(!(e instanceof gs))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const t=performance.now(),n=this.createPointerEvent(e);if(this.dispatchEvent(n,"pointerup"),"touch"===n.pointerType)this.dispatchEvent(n,"touchend");else if("mouse"===n.pointerType||"pen"===n.pointerType){const e=2===n.button;this.dispatchEvent(n,e?"rightup":"mouseup")}const r=this.trackingData(e.pointerId),i=this.findMountedTarget(r.pressTargetsByButton[e.button]);let s=i;if(i&&!n.composedPath().includes(i)){let t=i;for(;t&&!n.composedPath().includes(t);){if(n.currentTarget=t,this.notifyTarget(n,"pointerupoutside"),"touch"===n.pointerType)this.notifyTarget(n,"touchendoutside");else if("mouse"===n.pointerType||"pen"===n.pointerType){const e=2===n.button;this.notifyTarget(n,e?"rightupoutside":"mouseupoutside")}t=t.parent}delete r.pressTargetsByButton[e.button],s=t}if(s){const i=this.clonePointerEvent(n,"click");i.target=s,i.path=null,r.clicksByButton[e.button]||(r.clicksByButton[e.button]={clickCount:0,target:i.target,timeStamp:t});const o=r.clicksByButton[e.button];o.target===i.target&&t-o.timeStamp<200?++o.clickCount:o.clickCount=1,o.target=i.target,o.timeStamp=t,i.detail=o.clickCount,"mouse"===i.pointerType?this.dispatchEvent(i,"click"):"touch"===i.pointerType&&this.dispatchEvent(i,"tap"),this.dispatchEvent(i,"pointertap"),this.freeEvent(i)}this.freeEvent(n)}mapPointerUpOutside(e){if(!(e instanceof gs))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const t=this.trackingData(e.pointerId),n=this.findMountedTarget(t.pressTargetsByButton[e.button]),r=this.createPointerEvent(e);if(n){let i=n;for(;i;)r.currentTarget=i,this.notifyTarget(r,"pointerupoutside"),"touch"===r.pointerType?this.notifyTarget(r,"touchendoutside"):"mouse"!==r.pointerType&&"pen"!==r.pointerType||this.notifyTarget(r,2===r.button?"rightupoutside":"mouseupoutside"),i=i.parent;delete t.pressTargetsByButton[e.button]}this.freeEvent(r)}mapWheel(e){if(!(e instanceof ys))return void console.warn("EventBoundary cannot map a non-wheel event as a wheel event");const t=this.createWheelEvent(e);this.dispatchEvent(t),this.freeEvent(t)}findMountedTarget(e){if(!e)return null;let t=e[0];for(let n=1;n<e.length&&e[n].parent===t;n++)t=e[n];return t}createPointerEvent(e,t,n){const r=this.allocateEvent(gs);return this.copyPointerData(e,r),this.copyMouseData(e,r),this.copyData(e,r),r.nativeEvent=e.nativeEvent,r.originalEvent=e,r.target=n??this.hitTest(r.global.x,r.global.y),"string"==typeof t&&(r.type=t),r}createWheelEvent(e){const t=this.allocateEvent(ys);return this.copyWheelData(e,t),this.copyMouseData(e,t),this.copyData(e,t),t.nativeEvent=e.nativeEvent,t.originalEvent=e,t.target=this.hitTest(t.global.x,t.global.y),t}clonePointerEvent(e,t){const n=this.allocateEvent(gs);return n.nativeEvent=e.nativeEvent,n.originalEvent=e.originalEvent,this.copyPointerData(e,n),this.copyMouseData(e,n),this.copyData(e,n),n.target=e.target,n.path=e.composedPath().slice(),n.type=t??n.type,n}copyWheelData(e,t){t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ}copyPointerData(e,t){e instanceof gs&&t instanceof gs&&(t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist)}copyMouseData(e,t){e instanceof ms&&t instanceof ms&&(t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.copyFrom(e.client),t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.copyFrom(e.movement),t.screen.copyFrom(e.screen),t.global.copyFrom(e.global))}copyData(e,t){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.detail=e.detail,t.view=e.view,t.which=e.which,t.layer.copyFrom(e.layer),t.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);const t=this.eventPool.get(e).pop()||new e(this);return t.eventPhase=t.NONE,t.currentTarget=null,t.path=null,t.target=null,t}freeEvent(e){if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const t=e.constructor;this.eventPool.has(t)||this.eventPool.set(t,[]),this.eventPool.get(t).push(e)}notifyListeners(e,t){const n=e.currentTarget._events[t];if(n&&e.currentTarget.isInteractive())if("fn"in n)n.fn.call(n.context,e);else for(let t=0,r=n.length;t<r&&!e.propagationImmediatelyStopped;t++)n[t].fn.call(n[t].context,e)}}const ws={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Ss=class{constructor(e){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=e,this.rootBoundary=new bs(null),fs.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new gs(null),this.rootWheelEvent=new ys(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(e){const{view:t,resolution:n}=this.renderer;this.setTargetElement(t),this.resolution=n,Ss._defaultEventMode=e.eventMode??"auto"}resolutionChange(e){this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(e){e=e||"default";let t=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(t=!1),this.currentCursor===e)return;this.currentCursor=e;const n=this.cursorStyles[e];if(n)switch(typeof n){case"string":t&&(this.domElement.style.cursor=n);break;case"function":n(e);break;case"object":t&&Object.assign(this.domElement.style,n)}else t&&"string"==typeof e&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.domElement.style.cursor=e)}onPointerDown(e){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===e.pointerType)return;const t=this.normalizeToPointerData(e);this.autoPreventDefault&&t[0].isNormalized&&(e.cancelable||!("cancelable"in e))&&e.preventDefault();for(let e=0,n=t.length;e<n;e++){const n=t[e],r=this.bootstrapEvent(this.rootPointerEvent,n);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(e){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===e.pointerType)return;fs.pointerMoved();const t=this.normalizeToPointerData(e);for(let e=0,n=t.length;e<n;e++){const n=this.bootstrapEvent(this.rootPointerEvent,t[e]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(e){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===e.pointerType)return;let t=e.target;e.composedPath&&e.composedPath().length>0&&(t=e.composedPath()[0]);const n=t!==this.domElement?"outside":"",r=this.normalizeToPointerData(e);for(let e=0,t=r.length;e<t;e++){const t=this.bootstrapEvent(this.rootPointerEvent,r[e]);t.type+=n,this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(e){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===e.pointerType)return;const t=this.normalizeToPointerData(e);for(let e=0,n=t.length;e<n;e++){const n=this.bootstrapEvent(this.rootPointerEvent,t[e]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onWheel(e){const t=this.normalizeWheelEvent(e);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(t)}setTargetElement(e){this.removeEvents(),this.domElement=e,fs.domElement=e,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;fs.addTickerListener();const e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;fs.removeTickerListener();const e=this.domElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(e,t,n){let r;r=this.domElement.parentElement?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const i=1/this.resolution;e.x=(t-r.left)*(this.domElement.width/r.width)*i,e.y=(n-r.top)*(this.domElement.height/r.height)*i}normalizeToPointerData(e){const t=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(let n=0,r=e.changedTouches.length;n<r;n++){const r=e.changedTouches[n];void 0===r.button&&(r.button=0),void 0===r.buttons&&(r.buttons=1),void 0===r.isPrimary&&(r.isPrimary=1===e.touches.length&&"touchstart"===e.type),void 0===r.width&&(r.width=r.radiusX||1),void 0===r.height&&(r.height=r.radiusY||1),void 0===r.tiltX&&(r.tiltX=0),void 0===r.tiltY&&(r.tiltY=0),void 0===r.pointerType&&(r.pointerType="touch"),void 0===r.pointerId&&(r.pointerId=r.identifier||0),void 0===r.pressure&&(r.pressure=r.force||.5),void 0===r.twist&&(r.twist=0),void 0===r.tangentialPressure&&(r.tangentialPressure=0),void 0===r.layerX&&(r.layerX=r.offsetX=r.clientX),void 0===r.layerY&&(r.layerY=r.offsetY=r.clientY),r.isNormalized=!0,r.type=e.type,t.push(r)}else if(!globalThis.MouseEvent||e instanceof MouseEvent&&!(this.supportsPointerEvents&&e instanceof globalThis.PointerEvent)){const n=e;void 0===n.isPrimary&&(n.isPrimary=!0),void 0===n.width&&(n.width=1),void 0===n.height&&(n.height=1),void 0===n.tiltX&&(n.tiltX=0),void 0===n.tiltY&&(n.tiltY=0),void 0===n.pointerType&&(n.pointerType="mouse"),void 0===n.pointerId&&(n.pointerId=1),void 0===n.pressure&&(n.pressure=.5),void 0===n.twist&&(n.twist=0),void 0===n.tangentialPressure&&(n.tangentialPressure=0),n.isNormalized=!0,t.push(n)}else t.push(e);return t}normalizeWheelEvent(e){const t=this.rootWheelEvent;return this.transferMouseData(t,e),t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ,t.deltaMode=e.deltaMode,this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=e,t.type=e.type,t}bootstrapEvent(e,t){return e.originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t),this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.isTrusted=t.isTrusted,"pointerleave"===e.type&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=ws[e.type]||e.type),e}transferMouseData(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.relatedTarget=null,e.shiftKey=t.shiftKey}};let _s=Ss;function Ts(e){return"dynamic"===e||"static"===e}_s.extension={name:"events",type:[qt.RendererSystem,qt.CanvasRendererSystem]},Qt.add(_s);const Es={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??Ts(_s.defaultEventMode)},set interactive(e){Qe("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=e,this.eventMode=e?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??_s.defaultEventMode},set eventMode(e){this._internalInteractive=Ts(e),this._internalEventMode=e},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(e,t,n){const r="function"==typeof t?void 0:t;e="boolean"==typeof n&&n||"object"==typeof n&&n.capture?`${e}capture`:e,t="function"==typeof t?t:t.handleEvent,this.on(e,t,r)},removeEventListener(e,t,n){const r="function"==typeof t?void 0:t;e="boolean"==typeof n&&n||"object"==typeof n&&n.capture?`${e}capture`:e,t="function"==typeof t?t:t.handleEvent,this.off(e,t,r)},dispatchEvent(e){if(!(e instanceof ps))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return e.defaultPrevented=!1,e.path=null,e.target=this,e.manager.dispatchEvent(e),!e.defaultPrevented}};Zi.mixin(Es),Zi.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1});class Cs{constructor(e){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(Ve.tablet||Ve.phone)&&this.createTouchHook();const t=document.createElement("div");t.style.width="100px",t.style.height="100px",t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.zIndex=2..toString(),this.div=t,this.renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const e=document.createElement("button");e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.zIndex=2..toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",(()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()})),document.body.appendChild(e),this._hookDiv=e}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){this._isActive&&!this._isMobileAccessibility&&(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(e){if(!e.visible||!e.accessibleChildren)return;e.accessible&&e.isInteractive()&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);const t=e.children;if(t)for(let e=0;e<t.length;e++)this.updateAccessibleObjects(t[e])}update(){const e=performance.now();if(Ve.android.device&&e<this.androidUpdateCount)return;if(this.androidUpdateCount=e+this.androidUpdateFrequency,!this.renderer.renderingToScreen)return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:t,y:n,width:r,height:i}=this.renderer.view.getBoundingClientRect(),{width:s,height:o,resolution:a}=this.renderer,l=r/s*a,u=i/o*a;let c=this.div;c.style.left=`${t}px`,c.style.top=`${n}px`,c.style.width=`${s}px`,c.style.height=`${o}px`;for(let e=0;e<this.children.length;e++){const t=this.children[e];if(t.renderId!==this.renderId)t._accessibleActive=!1,Nt(this.children,e,1),this.div.removeChild(t._accessibleDiv),this.pool.push(t._accessibleDiv),t._accessibleDiv=null,e--;else{c=t._accessibleDiv;let e=t.hitArea;const n=t.worldTransform;t.hitArea?(c.style.left=(n.tx+e.x*n.a)*l+"px",c.style.top=(n.ty+e.y*n.d)*u+"px",c.style.width=e.width*n.a*l+"px",c.style.height=e.height*n.d*u+"px"):(e=t.getBounds(),this.capHitArea(e),c.style.left=e.x*l+"px",c.style.top=e.y*u+"px",c.style.width=e.width*l+"px",c.style.height=e.height*u+"px",c.title!==t.accessibleTitle&&null!==t.accessibleTitle&&(c.title=t.accessibleTitle),c.getAttribute("aria-label")!==t.accessibleHint&&null!==t.accessibleHint&&c.setAttribute("aria-label",t.accessibleHint)),t.accessibleTitle===c.title&&t.tabIndex===c.tabIndex||(c.title=t.accessibleTitle,c.tabIndex=t.tabIndex,this.debug&&this.updateDebugHTML(c))}}this.renderId++}updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: ${e.tabIndex}`}capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);const{width:t,height:n}=this.renderer;e.x+e.width>t&&(e.width=t-e.x),e.y+e.height>n&&(e.height=n-e.y)}addChild(e){let t=this.pool.pop();t||(t=document.createElement("button"),t.style.width="100px",t.style.height="100px",t.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=2..toString(),t.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?t.setAttribute("aria-live","off"):t.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute("aria-relevant","additions"):t.setAttribute("aria-relevant","text"),t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),t.style.pointerEvents=e.accessiblePointerEvents,t.type=e.accessibleType,e.accessibleTitle&&null!==e.accessibleTitle?t.title=e.accessibleTitle:e.accessibleHint&&null!==e.accessibleHint||(t.title=`displayObject ${e.tabIndex}`),e.accessibleHint&&null!==e.accessibleHint&&t.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(t),e._accessibleActive=!0,e._accessibleDiv=t,t.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex}_dispatchEvent(e,t){const{displayObject:n}=e.target,r=this.renderer.events.rootBoundary,i=Object.assign(new ps(r),{target:n});r.rootTarget=this.renderer.lastObjectRendered,t.forEach((e=>r.dispatchEvent(i,e)))}_onClick(e){this._dispatchEvent(e,["click","pointertap","tap"])}_onFocus(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e,["mouseover"])}_onFocusOut(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite"),this._dispatchEvent(e,["mouseout"])}_onKeyDown(e){9===e.keyCode&&this.activate()}_onMouseMove(e){0===e.movementX&&0===e.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Cs.extension={name:"accessibility",type:[qt.RendererPlugin,qt.CanvasRendererPlugin]},Qt.add(Cs);const ks=class{constructor(e){this.stage=new ns,e=Object.assign({forceCanvas:!1},e),this.renderer=function(e){for(const t of Fi)if(t.test(e))return new t(e);throw new Error("Unable to auto-detect a suitable renderer.")}(e),ks._plugins.forEach((t=>{t.init.call(this,e)}))}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(e,t){const n=ks._plugins.slice(0);n.reverse(),n.forEach((e=>{e.destroy.call(this)})),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null}};let As=ks;As._plugins=[],Qt.handleByList(qt.Application,As._plugins);class Ms{static init(e){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame((()=>this.resize())))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let e,t;if(this.cancelResize(),this._resizeTo===globalThis.window)e=globalThis.innerWidth,t=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:r}=this._resizeTo;e=n,t=r}this.renderer.resize(e,t),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Ms.extension=qt.Application,Qt.add(Ms);const Ps={loader:qt.LoadParser,resolver:qt.ResolveParser,cache:qt.CacheParser,detection:qt.DetectionParser};Qt.handle(qt.Asset,(e=>{const t=e.ref;Object.entries(Ps).filter((([e])=>!!t[e])).forEach((([e,n])=>Qt.add(Object.assign(t[e],{extension:t[e].extension??n}))))}),(e=>{const t=e.ref;Object.keys(Ps).filter((e=>!!t[e])).forEach((e=>Qt.remove(t[e])))}));class Rs{constructor(e,t=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=t}add(e){e.forEach((e=>{this._assetList.push(e)})),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const e=[],t=Math.min(this._assetList.length,this._maxConcurrent);for(let n=0;n<t;n++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}}function Is(e,t){const n=e.split("?")[0],r=Ke.extname(n).toLowerCase();return Array.isArray(t)?t.includes(r):r===t}const Ds=(e,t)=>(Array.isArray(e)||(e=[e]),t?e.map((e=>"string"==typeof e?t(e):e)):e),Fs=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){const t=this._cache.get(e);return t||console.warn(`[Assets] Asset id ${e} was not found in the Cache`),t}set(e,t){const n=Ds(e);let r;for(let e=0;e<this.parsers.length;e++){const i=this.parsers[e];if(i.test(t)){r=i.getCacheableAssets(n,t);break}}r||(r={},n.forEach((e=>{r[e]=t})));const i=Object.keys(r),s={cacheKeys:i,keys:n};if(n.forEach((e=>{this._cacheMap.set(e,s)})),i.forEach((e=>{this._cache.has(e)&&this._cache.get(e)!==t&&console.warn("[Cache] already has key:",e),this._cache.set(e,r[e])})),t instanceof Mr){const e=t;n.forEach((t=>{e.baseTexture!==Mr.EMPTY.baseTexture&&hn.addToCache(e.baseTexture,t),Mr.addToCache(e,t)}))}}remove(e){if(this._cacheMap.get(e),!this._cacheMap.has(e))return void console.warn(`[Assets] Asset id ${e} was not found in the Cache`);const t=this._cacheMap.get(e);t.cacheKeys.forEach((e=>{this._cache.delete(e)})),t.keys.forEach((e=>{this._cacheMap.delete(e)}))}get parsers(){return this._parsers}},Ns=e=>!Array.isArray(e);class Ls{constructor(){this._parsers=[],this.promiseCache={}}reset(){this.promiseCache={}}_getLoadPromiseAndParser(e,t){const n={promise:null,parser:null};return n.promise=(async()=>{let r=null;for(let i=0;i<this.parsers.length;i++){const s=this.parsers[i];if(s.load&&s.test?.(e,t,this)){r=await s.load(e,t,this),n.parser=s;break}}if(!n.parser)return console.warn(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has being added`),null;for(let e=0;e<this.parsers.length;e++){const i=this.parsers[e];i.parse&&i.parse&&await(i.testParse?.(r,t,this))&&(r=await i.parse(r,t,this)||r,n.parser=i)}return r})(),n}async load(e,t){let n=0;const r={},i=Ns(e),s=Ds(e,(e=>({src:e}))),o=s.length,a=s.map((async e=>{const i=Ke.toAbsolute(e.src);if(!r[e.src])try{this.promiseCache[i]||(this.promiseCache[i]=this._getLoadPromiseAndParser(i,e)),r[e.src]=await this.promiseCache[i].promise,t&&t(++n/o)}catch(t){throw delete this.promiseCache[i],delete r[e.src],new Error(`[Loader.load] Failed to load ${i}.\n${t}`)}}));return await Promise.all(a),i?r[s[0].src]:r}async unload(e){const t=Ds(e,(e=>({src:e}))).map((async e=>{const t=Ke.toAbsolute(e.src),n=this.promiseCache[t];if(n){const r=await n.promise;n.parser?.unload?.(r,e,this),delete this.promiseCache[t]}}));await Promise.all(t)}get parsers(){return this._parsers}}var Bs=(e=>(e[e.Low=0]="Low",e[e.Normal=1]="Normal",e[e.High=2]="High",e))(Bs||{});const Os={extension:{type:qt.LoadParser,priority:Bs.Low},test:e=>".json"===Ke.extname(e).toLowerCase(),async load(e){const t=await Ce.ADAPTER.fetch(e);return await t.json()}};Qt.add(Os);const zs={extension:{type:qt.LoadParser,priority:Bs.Low},test:e=>".txt"===Ke.extname(e).toLowerCase(),async load(e){const t=await Ce.ADAPTER.fetch(e);return await t.text()}};function js(e,t){if(Array.isArray(t)){for(const n of t)if(e.startsWith(`data:${n}`))return!0;return!1}return e.startsWith(`data:${t}`)}Qt.add(zs);const Us=["normal","bold","100","200","300","400","500","600","700","800","900"],Gs=[".ttf",".otf",".woff",".woff2"],Vs=["font/ttf","font/otf","font/woff","font/woff2"],Hs={extension:{type:qt.LoadParser,priority:Bs.Low},test:e=>js(e,Vs)||Is(e,Gs),async load(e,t){const n=Ce.ADAPTER.getFontFaceSet();if(n){const r=[],i=t.data?.family??function(e){const t=Ke.extname(e);return Ke.basename(e,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" ")}(e),s=t.data?.weights?.filter((e=>Us.includes(e)))??["normal"],o=t.data??{};for(let t=0;t<s.length;t++){const a=s[t],l=new FontFace(i,`url(${encodeURI(e)})`,{...o,weight:a});await l.load(),n.add(l),r.push(l)}return 1===r.length?r[0]:r}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(e){(Array.isArray(e)?e:[e]).forEach((e=>Ce.ADAPTER.getFontFaceSet().delete(e)))}};Qt.add(Hs);let Ws,Xs=0;const $s="\n    async function checkImageBitmap()\n    {\n        try\n        {\n            if (typeof createImageBitmap !== 'function') return false;\n\n            const response = await fetch('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=');\n            const imageBlob =  await response.blob();\n            const imageBitmap = await createImageBitmap(imageBlob);\n\n            return imageBitmap.width === 1 && imageBitmap.height === 1;\n        }\n        catch (e)\n        {\n            return false;\n        }\n    }\n    checkImageBitmap().then((result) => { self.postMessage(result); });\n    ",Ys="\n    async function loadImageBitmap(url)\n    {\n        const response = await fetch(url);\n\n        if (!response.ok)\n        {\n            throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: `\n                + `${response.status} ${response.statusText}`);\n        }\n\n        const imageBlob =  await response.blob();\n        const imageBitmap = await createImageBitmap(imageBlob);\n\n        return imageBitmap;\n    }\n    self.onmessage = async (event) =>\n    {\n        try\n        {\n            const imageBitmap = await loadImageBitmap(event.data.data[0]);\n\n            self.postMessage({\n                data: imageBitmap,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            }, [imageBitmap]);\n        }\n        catch(e)\n        {\n            self.postMessage({\n                error: e,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            });\n        }\n    };";let qs;const Ks=new class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise((e=>{const t=URL.createObjectURL(new Blob([$s],{type:"application/javascript"})),n=new Worker(t);n.addEventListener("message",(r=>{n.terminate(),URL.revokeObjectURL(t),e(r.data)}))}))),this._isImageBitmapSupported}loadImageBitmap(e){return this._run("loadImageBitmap",[e])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){void 0===Ws&&(Ws=navigator.hardwareConcurrency||4);let e=this.workerPool.pop();return!e&&this._createdWorkers<Ws&&(qs||(qs=URL.createObjectURL(new Blob([Ys],{type:"application/javascript"}))),this._createdWorkers++,e=new Worker(qs),e.addEventListener("message",(e=>{this.complete(e.data),this.returnWorker(e.target),this.next()}))),e}returnWorker(e){this.workerPool.push(e)}complete(e){void 0!==e.error?this.resolveHash[e.uuid].reject(e.error):this.resolveHash[e.uuid].resolve(e.data),this.resolveHash[e.uuid]=null}async _run(e,t){await this._initWorkers();const n=new Promise(((n,r)=>{this.queue.push({id:e,arguments:t,resolve:n,reject:r})}));return this.next(),n}next(){if(!this.queue.length)return;const e=this.getWorker();if(!e)return;const t=this.queue.pop(),n=t.id;this.resolveHash[Xs]={resolve:t.resolve,reject:t.reject},e.postMessage({data:t.arguments,uuid:Xs++,id:n})}};function Zs(e,t,n){const r=new Mr(e);return r.baseTexture.on("dispose",(()=>{delete t.promiseCache[n]})),r}const Qs=[".jpeg",".jpg",".png",".webp",".avif"],Js=["image/jpeg","image/png","image/webp","image/avif"],eo={extension:{type:qt.LoadParser,priority:Bs.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test:e=>js(e,Js)||Is(e,Qs),async load(e,t,n){let r=null;r=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await Ks.isImageBitmapSupported()?await Ks.loadImageBitmap(e):await async function(e){const t=await Ce.ADAPTER.fetch(e);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${e}: ${t.status} ${t.statusText}`);const n=await t.blob();return await createImageBitmap(n)}(e):await new Promise((t=>{r=new Image,r.crossOrigin=this.config.crossOrigin,r.src=e,r.complete?t(r):r.onload=()=>{t(r)}}));const i=new hn(r,{resolution:Yt(e),...t.data});return i.resource.src=e,Zs(i,n,e)},unload(e){e.destroy(!0)}};Qt.add(eo);const to={extension:{type:qt.LoadParser,priority:Bs.High},test:e=>".svg"===Ke.extname(e).toLowerCase(),testParse:async e=>$i.test(e),async parse(e,t,n){const r=new $i(e,t?.data?.resourceOptions),i=new hn(r,{resolution:Yt(e),...t?.data});i.resource.src=e;const s=Zs(i,n,e);return t?.data?.resourceOptions?.autoLoad||await r.load(),s},load:async(e,t)=>(await Ce.ADAPTER.fetch(e)).text(),unload:eo.unload};function no(e,t,n,r,i){const s=t[n];for(let o=0;o<s.length;o++){const a=s[o];n<t.length-1?no(e.replace(r[n],a),t,n+1,r,i):i.push(e.replace(r[n],a))}}function ro(e){const t=e.match(/\{(.*?)\}/g),n=[];if(t){const r=[];t.forEach((e=>{const t=e.substring(1,e.length-1).split(",");r.push(t)})),no(e,r,0,t,n)}else n.push(e);return n}Qt.add(to);class io{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,t)=>`${e}${this._bundleIdConnector}${t}`,extractAssetIdFromBundle:(e,t)=>t.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach((e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))})),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if("string"==typeof e)this._defaultSearchParams=e;else{const t=e;this._defaultSearchParams=Object.keys(t).map((e=>`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`)).join("&")}}addManifest(e){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach((e=>{this.addBundle(e.name,e.assets)}))}addBundle(e,t){const n=[];Array.isArray(t)?t.forEach((t=>{if("string"==typeof t.name){const r=this._createBundleAssetId(e,t.name);n.push(r),this.add([t.name,r],t.srcs,t.data)}else{const r=t.name.map((t=>this._createBundleAssetId(e,t)));r.forEach((e=>{n.push(e)})),this.add([...t.name,...r],t.srcs)}})):Object.keys(t).forEach((r=>{n.push(this._createBundleAssetId(e,r)),this.add([r,this._createBundleAssetId(e,r)],t[r])})),this._bundles[e]=n}add(e,t,n){const r=Ds(e);r.forEach((e=>{this.hasKey(e)&&console.warn(`[Resolver] already has key: ${e} overwriting`)})),Array.isArray(t)||(t="string"==typeof t?ro(t):[t]);const i=t.map((e=>{let t=e;if("string"==typeof e){let n=!1;for(let r=0;r<this._parsers.length;r++){const i=this._parsers[r];if(i.test(e)){t=i.parse(e),n=!0;break}}n||(t={src:e})}return t.format||(t.format=t.src.split(".").pop()),t.alias||(t.alias=r),(this._basePath||this._rootPath)&&(t.src=Ke.toAbsolute(t.src,this._basePath,this._rootPath)),t.src=this._appendDefaultSearchParams(t.src),t.data=t.data??n,t}));r.forEach((e=>{this._assetMap[e]=i}))}resolveBundle(e){const t=Ns(e);e=Ds(e);const n={};return e.forEach((e=>{const t=this._bundles[e];if(t){const r=this.resolve(t),i={};for(const t in r){const n=r[t];i[this._extractAssetIdFromBundle(e,t)]=n}n[e]=i}})),t?n[e[0]]:n}resolveUrl(e){const t=this.resolve(e);if("string"!=typeof e){const e={};for(const n in t)e[n]=t[n].src;return e}return t.src}resolve(e){const t=Ns(e);e=Ds(e);const n={};return e.forEach((e=>{if(!this._resolverHash[e])if(this._assetMap[e]){let t=this._assetMap[e];const n=this._getPreferredOrder(t),r=t[0];n?.priority.forEach((e=>{n.params[e].forEach((n=>{const r=t.filter((t=>!!t[e]&&t[e]===n));r.length&&(t=r)}))})),this._resolverHash[e]=t[0]??r}else{let t=e;(this._basePath||this._rootPath)&&(t=Ke.toAbsolute(t,this._basePath,this._rootPath)),t=this._appendDefaultSearchParams(t),this._resolverHash[e]={src:t}}n[e]=this._resolverHash[e]})),t?n[e[0]]:n}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let t=0;t<e.length;t++){const t=e[0],n=this._preferredOrder.find((e=>e.params.format.includes(t.format)));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(e){return this._defaultSearchParams?`${e}${/\?/.test(e)?"&":"?"}${this._defaultSearchParams}`:e}}const so=new class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new io,this.loader=new Ls,this.cache=Fs,this._backgroundLoader=new Rs(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){if(this._initialized)return void console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let t=e.manifest;"string"==typeof t&&(t=await this.load(t)),this.resolver.addManifest(t)}const t=e.texturePreference?.resolution??1,n="number"==typeof t?[t]:t;let r=[];if(e.texturePreference?.format){const t=e.texturePreference?.format;r="string"==typeof t?[t]:t;for(const e of this._detections)await e.test()||(r=await e.remove(r))}else for(const e of this._detections)await e.test()&&(r=await e.add(r));this.resolver.prefer({params:{format:r,resolution:n}})}add(e,t,n){this.resolver.add(e,t,n)}async load(e,t){this._initialized||await this.init();const n=Ns(e),r=Ds(e).map((e=>"string"!=typeof e?(this.resolver.add(e.src,e),e.src):(this.resolver.hasKey(e)||this.resolver.add(e,e),e))),i=this.resolver.resolve(r),s=await this._mapLoadToResolve(i,t);return n?s[r[0]]:s}addBundle(e,t){this.resolver.addBundle(e,t)}async loadBundle(e,t){this._initialized||await this.init();let n=!1;"string"==typeof e&&(n=!0,e=[e]);const r=this.resolver.resolveBundle(e),i={},s=Object.keys(r);let o=0,a=0;const l=()=>{t?.(++o/a)},u=s.map((e=>{const t=r[e];return a+=Object.keys(t).length,this._mapLoadToResolve(t,l).then((t=>{i[e]=t}))}));return await Promise.all(u),n?i[e[0]]:i}async backgroundLoad(e){this._initialized||await this.init(),"string"==typeof e&&(e=[e]);const t=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(t))}async backgroundLoadBundle(e){this._initialized||await this.init(),"string"==typeof e&&(e=[e]);const t=this.resolver.resolveBundle(e);Object.values(t).forEach((e=>{this._backgroundLoader.add(Object.values(e))}))}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if("string"==typeof e)return Fs.get(e);const t={};for(let n=0;n<e.length;n++)t[n]=Fs.get(e[n]);return t}async _mapLoadToResolve(e,t){const n=Object.values(e),r=Object.keys(e);this._backgroundLoader.active=!1;const i=await this.loader.load(n,t);this._backgroundLoader.active=!0;const s={};return n.forEach(((e,t)=>{const n=i[e.src],o=[e.src];e.alias&&o.push(...e.alias),s[r[t]]=n,Fs.set(o,n)})),s}async unload(e){this._initialized||await this.init();const t=Ds(e).map((e=>"string"!=typeof e?e.src:e)),n=this.resolver.resolve(t);await this._unloadFromResolved(n)}async unloadBundle(e){this._initialized||await this.init(),e=Ds(e);const t=this.resolver.resolveBundle(e),n=Object.keys(t).map((e=>this._unloadFromResolved(t[e])));await Promise.all(n)}async _unloadFromResolved(e){const t=Object.values(e);t.forEach((e=>{Fs.remove(e.src)})),await this.loader.unload(t)}get detections(){return this._detections}get preferWorkers(){return eo.config.preferWorkers}set preferWorkers(e){eo.config.preferWorkers=e}};Qt.handleByList(qt.LoadParser,so.loader.parsers).handleByList(qt.ResolveParser,so.resolver.parsers).handleByList(qt.CacheParser,so.cache.parsers).handleByList(qt.DetectionParser,so.detections);const oo={extension:qt.CacheParser,test:e=>Array.isArray(e)&&e.every((e=>e instanceof Mr)),getCacheableAssets:(e,t)=>{const n={};return e.forEach((e=>{t.forEach(((t,r)=>{n[e+(0===r?"":r+1)]=t}))})),n}};Qt.add(oo);const ao={extension:{type:qt.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const e=await Ce.ADAPTER.fetch("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=").then((e=>e.blob()));return createImageBitmap(e).then((()=>!0),(()=>!1))},add:async e=>[...e,"avif"],remove:async e=>e.filter((e=>"avif"!==e))};Qt.add(ao);const lo={extension:{type:qt.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const e=await Ce.ADAPTER.fetch("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=").then((e=>e.blob()));return createImageBitmap(e).then((()=>!0),(()=>!1))},add:async e=>[...e,"webp"],remove:async e=>e.filter((e=>"webp"!==e))};Qt.add(lo);const uo=["png","jpg","jpeg"],co={extension:{type:qt.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async e=>[...e,...uo],remove:async e=>e.filter((e=>!uo.includes(e)))};Qt.add(co);const ho={extension:qt.ResolveParser,test:eo.test,parse:e=>({resolution:parseFloat(Ce.RETINA_PREFIX.exec(e)?.[1]??"1"),format:e.split(".").pop(),src:e})};Qt.add(ho);const fo=(e,t)=>{const n=t.split("?")[1];return n&&(e+=`?${n}`),e};var po=(e=>(e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e))(po||{});const mo={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let go,yo;function vo(){yo={s3tc:go.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:go.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:go.getExtension("WEBGL_compressed_texture_etc"),etc1:go.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:go.getExtension("WEBGL_compressed_texture_pvrtc")||go.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:go.getExtension("WEBGL_compressed_texture_atc"),astc:go.getExtension("WEBGL_compressed_texture_astc")}}const xo={extension:{type:qt.DetectionParser,priority:2},test:async()=>{const e=Ce.ADAPTER.createCanvas().getContext("webgl");return e?(go=e,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async e=>{yo||vo();const t=[];for(const e in yo)yo[e]&&t.push(e);return[...t,...e]},remove:async e=>(yo||vo(),e.filter((e=>!(e in yo))))};Qt.add(xo);class bo extends ln{constructor(e,t={width:1,height:1,autoLoad:!0}){let n,r;"string"==typeof e?(n=e,r=new Uint8Array):(n=null,r=e),super(r,t),this.origin=n,this.buffer=r?new Jt(r):null,this.origin&&!1!==t.autoLoad&&this.load(),r?.length&&(this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(e){}async load(){const e=await fetch(this.origin),t=await e.blob(),n=await t.arrayBuffer();return this.data=new Uint32Array(n),this.buffer=new Jt(n),this.loaded=!0,this.onBlobLoaded(n),this.update(),this}}class wo extends bo{constructor(e,t){super(e,t),this.format=t.format,this.levels=t.levels||1,this._width=t.width,this._height=t.height,this._extension=wo._formatToExtension(this.format),(t.levelBuffers||this.buffer)&&(this._levelBuffers=t.levelBuffers||wo._createLevelBuffers(e instanceof Uint8Array?e:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(e,t,n){const r=e.gl;if(!e.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let e=0,t=this.levels;e<t;e++){const{levelID:t,levelWidth:n,levelHeight:i,levelBuffer:s}=this._levelBuffers[e];r.compressedTexImage2D(r.TEXTURE_2D,t,this.format,n,i,0,s)}return!0}onBlobLoaded(){this._levelBuffers=wo._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(e){if(e>=33776&&e<=33779)return"s3tc";if(e>=37488&&e<=37497)return"etc";if(e>=35840&&e<=35843)return"pvrtc";if(e>=36196)return"etc1";if(e>=35986&&e<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(e,t,n,r,i,s,o){const a=new Array(n);let l=e.byteOffset,u=s,c=o,h=u+r-1&~(r-1),d=c+i-1&~(i-1),f=h*d*mo[t];for(let s=0;s<n;s++)a[s]={levelID:s,levelWidth:n>1?u:h,levelHeight:n>1?c:d,levelBuffer:new Uint8Array(e.buffer,l,f)},l+=f,u=u>>1||1,c=c>>1||1,h=u+r-1&~(r-1),d=c+i-1&~(i-1),f=h*d*mo[t];return a}}const So=827611204,_o=861165636,To=894720068,Eo={[So]:po.COMPRESSED_RGBA_S3TC_DXT1_EXT,[_o]:po.COMPRESSED_RGBA_S3TC_DXT3_EXT,[To]:po.COMPRESSED_RGBA_S3TC_DXT5_EXT},Co={70:po.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:po.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:po.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:po.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:po.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:po.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:po.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:po.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:po.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT},ko=[171,75,84,88,32,49,49,187,13,10,26,10],Ao={[fe.UNSIGNED_BYTE]:1,[fe.UNSIGNED_SHORT]:2,[fe.INT]:4,[fe.UNSIGNED_INT]:4,[fe.FLOAT]:4,[fe.HALF_FLOAT]:8},Mo={[he.RGBA]:4,[he.RGB]:3,[he.RG]:2,[he.RED]:1,[he.LUMINANCE]:1,[he.LUMINANCE_ALPHA]:2,[he.ALPHA]:1},Po={[fe.UNSIGNED_SHORT_4_4_4_4]:2,[fe.UNSIGNED_SHORT_5_5_5_1]:2,[fe.UNSIGNED_SHORT_5_6_5]:2};function Ro(e){switch(e){case he.RGBA:return he.RGBA_INTEGER;case he.RGB:return he.RGB_INTEGER;case he.RG:return he.RG_INTEGER;case he.RED:return he.RED_INTEGER;default:return e}}const Io={extension:{type:qt.LoadParser,priority:Bs.High},test:e=>Is(e,".dds"),async load(e,t,n){const r=await Ce.ADAPTER.fetch(e),i=function(e){const t=new Uint32Array(e);if(542327876!==t[0])throw new Error("Invalid DDS file magic word");const n=new Uint32Array(e,0,124/Uint32Array.BYTES_PER_ELEMENT),r=n[3],i=n[4],s=n[7],o=new Uint32Array(e,19*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),a=o[1];if(4&a){const n=o[2];if(808540228!==n){const t=Eo[n],o=new Uint8Array(e,128);return[new wo(o,{format:t,width:i,height:r,levels:s})]}const a=128,l=new Uint32Array(t.buffer,a,20/Uint32Array.BYTES_PER_ELEMENT),u=l[0],c=l[1],h=l[2],d=l[3],f=Co[u];if(void 0===f)throw new Error(`DDSParser cannot parse texture data with DXGI format ${u}`);if(4===h)throw new Error("DDSParser does not support cubemap textures");if(6===c)throw new Error("DDSParser does not supported 3D texture data");const p=new Array,m=148;if(1===d)p.push(new Uint8Array(e,m));else{const t=mo[f];let n=0,o=i,a=r;for(let e=0;e<s;e++)n+=Math.max(1,o+3&-4)*Math.max(1,a+3&-4)*t,o>>>=1,a>>>=1;let l=m;for(let t=0;t<d;t++)p.push(new Uint8Array(e,l,n)),l+=n}return p.map((e=>new wo(e,{format:f,width:i,height:r,levels:s})))}if(64&a)throw new Error("DDSParser does not support uncompressed texture data.");if(512&a)throw new Error("DDSParser does not supported YUV uncompressed texture data.");if(131072&a)throw new Error("DDSParser does not support single-channel (lumninance) texture data!");if(2&a)throw new Error("DDSParser does not support single-channel (alpha) texture data!");throw new Error("DDSParser failed to load a texture file due to an unknown reason!")}(await r.arrayBuffer()),s=i.map((r=>Zs(new hn(r,{mipmap:ye.OFF,alphaMode:ve.NO_PREMULTIPLIED_ALPHA,resolution:Yt(e),...t.data}),n,e)));return 1===s.length?s[0]:s},unload(e){Array.isArray(e)?e.forEach((e=>e.destroy(!0))):e.destroy(!0)}};Qt.add(Io);const Do={extension:{type:qt.LoadParser,priority:Bs.High},test:e=>Is(e,".ktx"),async load(e,t,n){const r=await Ce.ADAPTER.fetch(e),i=await r.arrayBuffer(),{compressed:s,uncompressed:o,kvData:a}=function(e,t,n=!1){const r=new DataView(t);if(!function(e,t){for(let n=0;n<ko.length;n++)if(t.getUint8(n)!==ko[n])return console.error(`${e} is not a valid *.ktx file!`),!1;return!0}(e,r))return null;const i=67305985===r.getUint32(12,!0),s=r.getUint32(16,i),o=r.getUint32(24,i),a=r.getUint32(28,i),l=r.getUint32(36,i),u=r.getUint32(40,i)||1,c=r.getUint32(44,i)||1,h=r.getUint32(48,i)||1,d=r.getUint32(52,i),f=r.getUint32(56,i),p=r.getUint32(60,i);if(0===u||1!==c)throw new Error("Only 2D textures are supported");if(1!==d)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==h)throw new Error("WebGL does not support array textures");const m=l+3&-4,g=u+3&-4,y=new Array(h);let v,x=l*u;if(0===s&&(x=m*g),v=0!==s?Ao[s]?Ao[s]*Mo[o]:Po[s]:mo[a],void 0===v)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const b=n?function(e,t,n){const r=new Map;let i=0;for(;i<t;){const s=e.getUint32(64+i,n),o=64+i+4,a=3-(s+3)%4;if(0===s||s>t-i){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let l=0;for(;l<s&&0!==e.getUint8(o+l);l++);if(-1===l){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const u=(new TextDecoder).decode(new Uint8Array(e.buffer,o,l)),c=new DataView(e.buffer,o+l+1,s-l-1);r.set(u,c),i+=4+s+a}return r}(r,p,i):null;let w=x*v,S=l,_=u,T=m,E=g,C=64+p;for(let e=0;e<f;e++){const n=r.getUint32(C,i);let o=C+4;for(let n=0;n<h;n++){let r=y[n];r||(r=y[n]=new Array(f)),r[e]={levelID:e,levelWidth:f>1||0!==s?S:T,levelHeight:f>1||0!==s?_:E,levelBuffer:new Uint8Array(t,o,w)},o+=w}C+=n+4,C=C%4!=0?C+4-C%4:C,S=S>>1||1,_=_>>1||1,T=S+4-1&-4,E=_+4-1&-4,w=T*E*v}return 0!==s?{uncompressed:y.map((e=>{let t=e[0].levelBuffer,n=!1;return s===fe.FLOAT?t=new Float32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4):s===fe.UNSIGNED_INT?(n=!0,t=new Uint32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4)):s===fe.INT&&(n=!0,t=new Int32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4)),{resource:new ln(t,{width:e[0].levelWidth,height:e[0].levelHeight}),type:s,format:n?Ro(o):o}})),kvData:b}:{compressed:y.map((e=>new wo(null,{format:a,width:l,height:u,levels:f,levelBuffers:e}))),kvData:b}}(e,i),l=s??o,u={mipmap:ye.OFF,alphaMode:ve.NO_PREMULTIPLIED_ALPHA,resolution:Yt(e),...t.data},c=l.map((t=>{l===o&&Object.assign(u,{type:t.type,format:t.format});const r=new hn(t,u);return r.ktxKeyValueData=a,Zs(r,n,e)}));return 1===c.length?c[0]:c},unload(e){Array.isArray(e)?e.forEach((e=>e.destroy(!0))):e.destroy(!0)}};Qt.add(Do);const Fo={extension:qt.ResolveParser,test:e=>{const t=e.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(t)},parse:e=>{if("ktx"===e.split("?")[0].split(".").pop()){const t=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(t.some((t=>e.endsWith(t))))return{resolution:parseFloat(Ce.RETINA_PREFIX.exec(e)?.[1]??"1"),format:t.find((t=>e.endsWith(t))),src:e}}return{resolution:parseFloat(Ce.RETINA_PREFIX.exec(e)?.[1]??"1"),format:e.split(".").pop(),src:e}}};Qt.add(Fo);const No=new An,Lo=class{constructor(e){this.renderer=e}async image(e,t,n){const r=new Image;return r.src=await this.base64(e,t,n),r}async base64(e,t,n){const r=this.canvas(e);if(void 0!==r.toDataURL)return r.toDataURL(t,n);if(void 0!==r.convertToBlob){const e=await r.convertToBlob({type:t,quality:n});return await new Promise((t=>{const n=new FileReader;n.onload=()=>t(n.result),n.readAsDataURL(e)}))}throw new Error("Extract.base64() requires ICanvas.toDataURL or ICanvas.convertToBlob to be implemented")}canvas(e,t){const{pixels:n,width:r,height:i,flipY:s}=this._rawPixels(e,t);let o=new Ht(r,i,1);const a=o.context.getImageData(0,0,r,i);if(Lo.arrayPostDivide(n,a.data),o.context.putImageData(a,0,0),s){const e=new Ht(o.width,o.height,1);e.context.scale(1,-1),e.context.drawImage(o.canvas,0,-i),o.destroy(),o=e}return o.canvas}pixels(e,t){const{pixels:n}=this._rawPixels(e,t);return Lo.arrayPostDivide(n,n),n}_rawPixels(e,t){const n=this.renderer;let r,i,s=!1,o=!1;if(e)if(e instanceof Pr)i=e;else{const t=n.context.webGLVersion>=2?n.multisample:_e.NONE;if(i=this.renderer.generateTexture(e,{multisample:t}),t!==_e.NONE){const e=Pr.create({width:i.width,height:i.height});n.framebuffer.bind(i.framebuffer),n.framebuffer.blit(e.framebuffer),n.framebuffer.bind(null),i.destroy(!0),i=e}o=!0}i?(r=i.baseTexture.resolution,t=t??i.frame,s=!1,n.renderTexture.bind(i)):(r=n.resolution,t||((t=No).width=n.width,t.height=n.height),s=!0,n.renderTexture.bind(null));const a=Math.round(t.width*r),l=Math.round(t.height*r),u=new Uint8Array(4*a*l),c=n.gl;return c.readPixels(Math.round(t.x*r),Math.round(t.y*r),a,l,c.RGBA,c.UNSIGNED_BYTE,u),o&&i.destroy(!0),{pixels:u,width:a,height:l,flipY:s}}destroy(){this.renderer=null}static arrayPostDivide(e,t){for(let n=0;n<e.length;n+=4){const r=t[n+3]=e[n+3];0!==r?(t[n]=Math.round(Math.min(255*e[n]/r,255)),t[n+1]=Math.round(Math.min(255*e[n+1]/r,255)),t[n+2]=Math.round(Math.min(255*e[n+2]/r,255))):(t[n]=e[n],t[n+1]=e[n+1],t[n+2]=e[n+2])}}};let Bo=Lo;Bo.extension={name:"extract",type:qt.RendererSystem},Qt.add(Bo);const Oo={build(e){const t=e.points;let n,r,i,s,o,a;if(e.type===En.CIRC){const t=e.shape;n=t.x,r=t.y,o=a=t.radius,i=s=0}else if(e.type===En.ELIP){const t=e.shape;n=t.x,r=t.y,o=t.width,a=t.height,i=s=0}else{const t=e.shape,l=t.width/2,u=t.height/2;n=t.x+l,r=t.y+u,o=a=Math.max(0,Math.min(t.radius,Math.min(l,u))),i=l-o,s=u-a}if(!(o>=0&&a>=0&&i>=0&&s>=0))return void(t.length=0);const l=Math.ceil(2.3*Math.sqrt(o+a)),u=8*l+(i?4:0)+(s?4:0);if(t.length=u,0===u)return;if(0===l)return t.length=8,t[0]=t[6]=n+i,t[1]=t[3]=r+s,t[2]=t[4]=n-i,void(t[5]=t[7]=r-s);let c=0,h=4*l+(i?2:0)+2,d=h,f=u;{const e=i+o,a=s,l=n+e,u=n-e,p=r+a;if(t[c++]=l,t[c++]=p,t[--h]=p,t[--h]=u,s){const e=r-a;t[d++]=u,t[d++]=e,t[--f]=e,t[--f]=l}}for(let e=1;e<l;e++){const u=Math.PI/2*(e/l),p=i+Math.cos(u)*o,m=s+Math.sin(u)*a,g=n+p,y=n-p,v=r+m,x=r-m;t[c++]=g,t[c++]=v,t[--h]=v,t[--h]=y,t[d++]=y,t[d++]=x,t[--f]=x,t[--f]=g}{const e=s+a,o=n+i,l=n-i,u=r+e,h=r-e;t[c++]=o,t[c++]=u,t[--f]=h,t[--f]=o,i&&(t[c++]=l,t[c++]=u,t[--f]=h,t[--f]=l)}},triangulate(e,t){const n=e.points,r=t.points,i=t.indices;if(0===n.length)return;let s=r.length/2;const o=s;let a,l;if(e.type!==En.RREC){const t=e.shape;a=t.x,l=t.y}else{const t=e.shape;a=t.x+t.width/2,l=t.y+t.height/2}const u=e.matrix;r.push(e.matrix?u.a*a+u.c*l+u.tx:a,e.matrix?u.b*a+u.d*l+u.ty:l),s++,r.push(n[0],n[1]);for(let e=2;e<n.length;e+=2)r.push(n[e],n[e+1]),i.push(s++,o,s);i.push(o+1,o,s)}};function zo(e,t=!1){const n=e.length;if(n<6)return;let r=0;for(let t=0,i=e[n-2],s=e[n-1];t<n;t+=2){const n=e[t],o=e[t+1];r+=(n-i)*(o+s),i=n,s=o}if(!t&&r>0||t&&r<=0){const t=n/2;for(let r=t+t%2;r<n;r+=2){const t=n-r-2,i=n-r-1,s=r,o=r+1;[e[t],e[s]]=[e[s],e[t]],[e[i],e[o]]=[e[o],e[i]]}}}const jo={build(e){e.points=e.shape.points.slice()},triangulate(e,t){let n=e.points;const r=e.holes,i=t.points,s=t.indices;if(n.length>=6){zo(n,!1);const e=[];for(let t=0;t<r.length;t++){const i=r[t];zo(i.points,!0),e.push(n.length/2),n=n.concat(i.points)}const t=We(n,e,2);if(!t)return;const o=i.length/2;for(let e=0;e<t.length;e+=3)s.push(t[e]+o),s.push(t[e+1]+o),s.push(t[e+2]+o);for(let e=0;e<n.length;e++)i.push(n[e])}}},Uo={build(e){const t=e.shape,n=t.x,r=t.y,i=t.width,s=t.height,o=e.points;o.length=0,i>=0&&s>=0&&o.push(n,r,n+i,r,n+i,r+s,n,r+s)},triangulate(e,t){const n=e.points,r=t.points;if(0===n.length)return;const i=r.length/2;r.push(n[0],n[1],n[2],n[3],n[6],n[7],n[4],n[5]),t.indices.push(i,i+1,i+2,i+1,i+2,i+3)}},Go={build(e){Oo.build(e)},triangulate(e,t){Oo.triangulate(e,t)}};var Vo=(e=>(e.MITER="miter",e.BEVEL="bevel",e.ROUND="round",e))(Vo||{}),Ho=(e=>(e.BUTT="butt",e.ROUND="round",e.SQUARE="square",e))(Ho||{});const Wo={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(e,t=20){if(!this.adaptive||!e||isNaN(e))return t;let n=Math.ceil(e/this.maxLength);return n<this.minSegments?n=this.minSegments:n>this.maxSegments&&(n=this.maxSegments),n}};class Xo{static curveTo(e,t,n,r,i,s){const o=s[s.length-2],a=s[s.length-1]-t,l=o-e,u=r-t,c=n-e,h=Math.abs(a*c-l*u);if(h<1e-8||0===i)return s[s.length-2]===e&&s[s.length-1]===t||s.push(e,t),null;const d=a*a+l*l,f=u*u+c*c,p=a*u+l*c,m=i*Math.sqrt(d)/h,g=i*Math.sqrt(f)/h,y=m*p/d,v=g*p/f,x=m*c+g*l,b=m*u+g*a,w=l*(g+y),S=a*(g+y),_=c*(m+v),T=u*(m+v);return{cx:x+e,cy:b+t,radius:i,startAngle:Math.atan2(S-b,w-x),endAngle:Math.atan2(T-b,_-x),anticlockwise:l*u>c*a}}static arc(e,t,n,r,i,s,o,a,l){const u=o-s,c=Wo._segmentsCount(Math.abs(u)*i,40*Math.ceil(Math.abs(u)/Sn)),h=u/(2*c),d=2*h,f=Math.cos(h),p=Math.sin(h),m=c-1,g=m%1/m;for(let e=0;e<=m;++e){const t=h+s+d*(e+g*e),o=Math.cos(t),a=-Math.sin(t);l.push((f*o+p*a)*i+n,(f*-a+p*o)*i+r)}}}class $o{static curveLength(e,t,n,r,i,s,o,a){let l=0,u=0,c=0,h=0,d=0,f=0,p=0,m=0,g=0,y=0,v=0,x=e,b=t;for(let w=1;w<=10;++w)u=w/10,c=u*u,h=c*u,d=1-u,f=d*d,p=f*d,m=p*e+3*f*u*n+3*d*c*i+h*o,g=p*t+3*f*u*r+3*d*c*s+h*a,y=x-m,v=b-g,x=m,b=g,l+=Math.sqrt(y*y+v*v);return l}static curveTo(e,t,n,r,i,s,o){const a=o[o.length-2],l=o[o.length-1];o.length-=2;const u=Wo._segmentsCount($o.curveLength(a,l,e,t,n,r,i,s));let c=0,h=0,d=0,f=0,p=0;o.push(a,l);for(let m=1,g=0;m<=u;++m)g=m/u,c=1-g,h=c*c,d=h*c,f=g*g,p=f*g,o.push(d*a+3*h*g*e+3*c*f*n+p*i,d*l+3*h*g*t+3*c*f*r+p*s)}}function Yo(e,t,n,r,i,s,o,a){let l,u;o?(l=r,u=-n):(l=-r,u=n);const c=e-n*i+l,h=t-r*i+u,d=e+n*s+l,f=t+r*s+u;return a.push(c,h),a.push(d,f),2}function qo(e,t,n,r,i,s,o,a){const l=n-e,u=r-t;let c=Math.atan2(l,u),h=Math.atan2(i-e,s-t);a&&c<h?c+=2*Math.PI:!a&&c>h&&(h+=2*Math.PI);let d=c;const f=h-c,p=Math.abs(f),m=Math.sqrt(l*l+u*u),g=1+(15*p*Math.sqrt(m)/Math.PI|0),y=f/g;if(d+=y,a){o.push(e,t),o.push(n,r);for(let n=1,r=d;n<g;n++,r+=y)o.push(e,t),o.push(e+Math.sin(r)*m,t+Math.cos(r)*m);o.push(e,t),o.push(i,s)}else{o.push(n,r),o.push(e,t);for(let n=1,r=d;n<g;n++,r+=y)o.push(e+Math.sin(r)*m,t+Math.cos(r)*m),o.push(e,t);o.push(i,s),o.push(e,t)}return 2*g}function Ko(e,t){e.lineStyle.native?function(e,t){let n=0;const r=e.shape,i=e.points||r.points,s=r.type!==En.POLY||r.closeStroke;if(0===i.length)return;const o=t.points,a=t.indices,l=i.length/2,u=o.length/2;let c=u;for(o.push(i[0],i[1]),n=1;n<l;n++)o.push(i[2*n],i[2*n+1]),a.push(c,c+1),c++;s&&a.push(c,u)}(e,t):function(e,t){const n=e.shape;let r=e.points||n.points.slice();const i=t.closePointEps;if(0===r.length)return;const s=e.lineStyle,o=new Cn(r[0],r[1]),a=new Cn(r[r.length-2],r[r.length-1]),l=n.type!==En.POLY||n.closeStroke,u=Math.abs(o.x-a.x)<i&&Math.abs(o.y-a.y)<i;if(l){r=r.slice(),u&&(r.pop(),r.pop(),a.set(r[r.length-2],r[r.length-1]));const e=.5*(o.x+a.x),t=.5*(a.y+o.y);r.unshift(e,t),r.push(e,t)}const c=t.points,h=r.length/2;let d=r.length;const f=c.length/2,p=s.width/2,m=p*p,g=s.miterLimit*s.miterLimit;let y=r[0],v=r[1],x=r[2],b=r[3],w=0,S=0,_=-(v-b),T=y-x,E=0,C=0,k=Math.sqrt(_*_+T*T);_/=k,T/=k,_*=p,T*=p;const A=s.alignment,M=2*(1-A),P=2*A;l||(s.cap===Ho.ROUND?d+=qo(y-_*(M-P)*.5,v-T*(M-P)*.5,y-_*M,v-T*M,y+_*P,v+T*P,c,!0)+2:s.cap===Ho.SQUARE&&(d+=Yo(y,v,_,T,M,P,!0,c))),c.push(y-_*M,v-T*M),c.push(y+_*P,v+T*P);for(let e=1;e<h-1;++e){y=r[2*(e-1)],v=r[2*(e-1)+1],x=r[2*e],b=r[2*e+1],w=r[2*(e+1)],S=r[2*(e+1)+1],_=-(v-b),T=y-x,k=Math.sqrt(_*_+T*T),_/=k,T/=k,_*=p,T*=p,E=-(b-S),C=x-w,k=Math.sqrt(E*E+C*C),E/=k,C/=k,E*=p,C*=p;const t=x-y,n=v-b,i=x-w,o=S-b,a=t*i+n*o,l=n*i-o*t,u=l<0;if(Math.abs(l)<.001*Math.abs(a)){c.push(x-_*M,b-T*M),c.push(x+_*P,b+T*P),a>=0&&(s.join===Vo.ROUND?d+=qo(x,b,x-_*M,b-T*M,x-E*M,b-C*M,c,!1)+4:d+=2,c.push(x-E*P,b-C*P),c.push(x+E*M,b+C*M));continue}const h=(-_+y)*(-T+b)-(-_+x)*(-T+v),f=(-E+w)*(-C+b)-(-E+x)*(-C+S),A=(t*f-i*h)/l,R=(o*h-n*f)/l,I=(A-x)*(A-x)+(R-b)*(R-b),D=x+(A-x)*M,F=b+(R-b)*M,N=x-(A-x)*P,L=b-(R-b)*P,B=u?M:P;I<=Math.min(t*t+n*n,i*i+o*o)+B*B*m?s.join===Vo.BEVEL||I/m>g?(u?(c.push(D,F),c.push(x+_*P,b+T*P),c.push(D,F),c.push(x+E*P,b+C*P)):(c.push(x-_*M,b-T*M),c.push(N,L),c.push(x-E*M,b-C*M),c.push(N,L)),d+=2):s.join===Vo.ROUND?u?(c.push(D,F),c.push(x+_*P,b+T*P),d+=qo(x,b,x+_*P,b+T*P,x+E*P,b+C*P,c,!0)+4,c.push(D,F),c.push(x+E*P,b+C*P)):(c.push(x-_*M,b-T*M),c.push(N,L),d+=qo(x,b,x-_*M,b-T*M,x-E*M,b-C*M,c,!1)+4,c.push(x-E*M,b-C*M),c.push(N,L)):(c.push(D,F),c.push(N,L)):(c.push(x-_*M,b-T*M),c.push(x+_*P,b+T*P),s.join===Vo.ROUND?d+=u?qo(x,b,x+_*P,b+T*P,x+E*P,b+C*P,c,!0)+2:qo(x,b,x-_*M,b-T*M,x-E*M,b-C*M,c,!1)+2:s.join===Vo.MITER&&I/m<=g&&(u?(c.push(N,L),c.push(N,L)):(c.push(D,F),c.push(D,F)),d+=2),c.push(x-E*M,b-C*M),c.push(x+E*P,b+C*P),d+=2)}y=r[2*(h-2)],v=r[2*(h-2)+1],x=r[2*(h-1)],b=r[2*(h-1)+1],_=-(v-b),T=y-x,k=Math.sqrt(_*_+T*T),_/=k,T/=k,_*=p,T*=p,c.push(x-_*M,b-T*M),c.push(x+_*P,b+T*P),l||(s.cap===Ho.ROUND?d+=qo(x-_*(M-P)*.5,b-T*(M-P)*.5,x-_*M,b-T*M,x+_*P,b+T*P,c,!1)+2:s.cap===Ho.SQUARE&&(d+=Yo(x,b,_,T,M,P,!1,c)));const R=t.indices,I=Wo.epsilon*Wo.epsilon;for(let e=f;e<d+f-2;++e)y=c[2*e],v=c[2*e+1],x=c[2*(e+1)],b=c[2*(e+1)+1],w=c[2*(e+2)],S=c[2*(e+2)+1],Math.abs(y*(b-S)+x*(S-v)+w*(v-b))<I||R.push(e,e+1,e+2)}(e,t)}class Zo{static curveLength(e,t,n,r,i,s){const o=e-2*n+i,a=t-2*r+s,l=2*n-2*e,u=2*r-2*t,c=4*(o*o+a*a),h=4*(o*l+a*u),d=l*l+u*u,f=2*Math.sqrt(c+h+d),p=Math.sqrt(c),m=2*c*p,g=2*Math.sqrt(d),y=h/p;return(m*f+p*h*(f-g)+(4*d*c-h*h)*Math.log((2*p+y+f)/(y+g)))/(4*m)}static curveTo(e,t,n,r,i){const s=i[i.length-2],o=i[i.length-1],a=Wo._segmentsCount(Zo.curveLength(s,o,e,t,n,r));let l=0,u=0;for(let c=1;c<=a;++c){const h=c/a;l=s+(e-s)*h,u=o+(t-o)*h,i.push(l+(e+(n-e)*h-l)*h,u+(t+(r-t)*h-u)*h)}}}const Qo={[En.POLY]:jo,[En.CIRC]:Oo,[En.ELIP]:Oo,[En.RECT]:Uo,[En.RREC]:Go},Jo=[],ea=[];class ta{constructor(e,t=null,n=null,r=null){this.points=[],this.holes=[],this.shape=e,this.lineStyle=n,this.fillStyle=t,this.matrix=r,this.type=e.type}clone(){return new ta(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}class na{constructor(){this.reset()}begin(e,t,n){this.reset(),this.style=e,this.start=t,this.attribStart=n}end(e,t){this.attribSize=t-this.attribStart,this.size=e-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const ra=new Cn,ia=class extends wn{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Ki,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),ea.push(this.drawCalls[e]);this.drawCalls.length=0;for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t.reset(),Jo.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(e,t=null,n=null,r=null){const i=new ta(e,t,n,r);return this.graphicsData.push(i),this.dirty++,this}drawHole(e,t=null){if(!this.graphicsData.length)return null;const n=new ta(e,null,null,t),r=this.graphicsData[this.graphicsData.length-1];return n.lineStyle=r.lineStyle,r.holes.push(n),this.dirty++,this}destroy(){super.destroy();for(let e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(e){const t=this.graphicsData;for(let n=0;n<t.length;++n){const r=t[n];if(r.fillStyle.visible&&r.shape&&(r.matrix?r.matrix.applyInverse(e,ra):ra.copyFrom(e),r.shape.contains(ra.x,ra.y))){let e=!1;if(r.holes)for(let t=0;t<r.holes.length;t++)if(r.holes[t].shape.contains(ra.x,ra.y)){e=!0;break}if(!e)return!0}}return!1}updateBatches(){if(!this.graphicsData.length)return void(this.batchable=!0);if(!this.validateBatching())return;this.cacheDirty=this.dirty;const e=this.uvs,t=this.graphicsData;let n=null,r=null;this.batches.length>0&&(n=this.batches[this.batches.length-1],r=n.style);for(let i=this.shapeIndex;i<t.length;i++){this.shapeIndex++;const s=t[i],o=s.fillStyle,a=s.lineStyle;Qo[s.type].build(s),s.matrix&&this.transformPoints(s.points,s.matrix),(o.visible||a.visible)&&this.processHoles(s.holes);for(let t=0;t<2;t++){const i=0===t?o:a;if(!i.visible)continue;const l=i.texture.baseTexture,u=this.indices.length,c=this.points.length/2;l.wrapMode=ge.REPEAT,0===t?this.processFill(s):this.processLine(s);const h=this.points.length/2-c;0!==h&&(n&&!this._compareStyles(r,i)&&(n.end(u,c),n=null),n||(n=Jo.pop()||new na,n.begin(i,u,c),this.batches.push(n),r=i),this.addUvs(this.points,e,i.texture,c,h,i.matrix))}}const i=this.indices.length,s=this.points.length/2;if(n&&n.end(i,s),0===this.batches.length)return void(this.batchable=!0);const o=s>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(e,t){return!(!e||!t)&&e.texture.baseTexture===t.texture.baseTexture&&e.color+e.alpha===t.color+t.alpha&&!!e.native==!!t.native}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let e=0,t=this.graphicsData.length;e<t;e++){const t=this.graphicsData[e],n=t.fillStyle,r=t.lineStyle;if(n&&!n.texture.baseTexture.valid)return!1;if(r&&!r.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const e=this.batches;for(let t=0,n=e.length;t<n;t++){const n=e[t];for(let e=0;e<n.size;e++){const t=n.start+e;this.indicesUint16[t]=this.indicesUint16[t]-n.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const e=this.batches;for(let t=0;t<e.length;t++)if(e[t].style.native)return!1;return this.points.length<2*ia.BATCHABLE_SIZE}buildDrawCalls(){let e=++hn._globalBatch;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),ea.push(this.drawCalls[e]);this.drawCalls.length=0;const t=this.colors,n=this.textureIds;let r=ea.pop();r||(r=new dn,r.texArray=new hr),r.texArray.count=0,r.start=0,r.size=0,r.type=ce.TRIANGLES;let i=0,s=null,o=0,a=!1,l=ce.TRIANGLES,u=0;this.drawCalls.push(r);for(let c=0;c<this.batches.length;c++){const h=this.batches[c],d=8,f=h.style,p=f.texture.baseTexture;a!==!!f.native&&(a=!!f.native,l=a?ce.LINES:ce.TRIANGLES,s=null,i=d,e++),s!==p&&(s=p,p._batchEnabled!==e&&(i===d&&(e++,i=0,r.size>0&&(r=ea.pop(),r||(r=new dn,r.texArray=new hr),this.drawCalls.push(r)),r.start=u,r.size=0,r.texArray.count=0,r.type=l),p.touched=1,p._batchEnabled=e,p._batchLocation=i,p.wrapMode=ge.REPEAT,r.texArray.elements[r.texArray.count++]=p,i++)),r.size+=h.size,u+=h.size,o=p._batchLocation,this.addColors(t,f.color,f.alpha,h.attribSize,h.attribStart),this.addTextureIds(n,o,h.attribSize,h.attribStart)}hn._globalBatch=e,this.packAttributes()}packAttributes(){const e=this.points,t=this.uvs,n=this.colors,r=this.textureIds,i=new ArrayBuffer(3*e.length*4),s=new Float32Array(i),o=new Uint32Array(i);let a=0;for(let i=0;i<e.length/2;i++)s[a++]=e[2*i],s[a++]=e[2*i+1],s[a++]=t[2*i],s[a++]=t[2*i+1],o[a++]=n[i],s[a++]=r[i];this._buffer.update(i),this._indexBuffer.update(this.indicesUint16)}processFill(e){e.holes.length?jo.triangulate(e,this):Qo[e.type].triangulate(e,this)}processLine(e){Ko(e,this);for(let t=0;t<e.holes.length;t++)Ko(e.holes[t],this)}processHoles(e){for(let t=0;t<e.length;t++){const n=e[t];Qo[n.type].build(n),n.matrix&&this.transformPoints(n.points,n.matrix)}}calculateBounds(){const e=this._bounds;e.clear(),e.addVertexData(this.points,0,this.points.length),e.pad(this.boundsPadding,this.boundsPadding)}transformPoints(e,t){for(let n=0;n<e.length/2;n++){const r=e[2*n],i=e[2*n+1];e[2*n]=t.a*r+t.c*i+t.tx,e[2*n+1]=t.b*r+t.d*i+t.ty}}addColors(e,t,n,r,i=0){const s=At.shared.setValue(t).toLittleEndianNumber(),o=At.shared.setValue(s).toPremultiplied(n);e.length=Math.max(e.length,i+r);for(let t=0;t<r;t++)e[i+t]=o}addTextureIds(e,t,n,r=0){e.length=Math.max(e.length,r+n);for(let i=0;i<n;i++)e[r+i]=t}addUvs(e,t,n,r,i,s=null){let o=0;const a=t.length,l=n.frame;for(;o<i;){let n=e[2*(r+o)],i=e[2*(r+o)+1];if(s){const e=s.a*n+s.c*i+s.tx;i=s.b*n+s.d*i+s.ty,n=e}o++,t.push(n/l.width,i/l.height)}const u=n.baseTexture;(l.width<u.width||l.height<u.height)&&this.adjustUvs(t,n,a,i)}adjustUvs(e,t,n,r){const i=t.baseTexture,s=1e-6,o=n+2*r,a=t.frame,l=a.width/i.width,u=a.height/i.height;let c=a.x/a.width,h=a.y/a.height,d=Math.floor(e[n]+s),f=Math.floor(e[n+1]+s);for(let t=n+2;t<o;t+=2)d=Math.min(d,Math.floor(e[t]+s)),f=Math.min(f,Math.floor(e[t+1]+s));c-=d,h-=f;for(let t=n;t<o;t+=2)e[t]=(e[t]+c)*l,e[t+1]=(e[t+1]+h)*u}};let sa=ia;sa.BATCHABLE_SIZE=100;class oa{constructor(){this.color=16777215,this.alpha=1,this.texture=Mr.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const e=new oa;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e}reset(){this.color=16777215,this.alpha=1,this.texture=Mr.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class aa extends oa{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Ho.BUTT,this.join=Vo.MITER,this.miterLimit=10}clone(){const e=new aa;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e.width=this.width,e.alignment=this.alignment,e.native=this.native,e.cap=this.cap,e.join=this.join,e.miterLimit=this.miterLimit,e}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const la=new Float32Array(3),ua={},ca=class extends ns{constructor(e=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new oa,this._lineStyle=new aa,this._matrix=null,this._holeMode=!1,this.state=nn.for2d(),this._geometry=e||new sa,this._geometry.refCount++,this._transformID=-1,this.tint=16777215,this.blendMode=ue.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new ca(this._geometry)}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}get tint(){return this._tint}set tint(e){this._tint=e}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(e=null,t=0,n,r=.5,i=!1){return"number"==typeof e&&(e={width:e,color:t,alpha:n,alignment:r,native:i}),this.lineTextureStyle(e)}lineTextureStyle(e){const t={width:0,texture:Mr.WHITE,color:e?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:Ho.BUTT,join:Vo.MITER,miterLimit:10};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const n=e.width>0&&e.alpha>0;return n?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:n},e)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const e=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new Rn,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[t-2],e[t-1]))}else this.currentPath=new Rn,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(e,t){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=t,this}lineTo(e,t){this.currentPath||this.moveTo(0,0);const n=this.currentPath.points,r=n[n.length-2],i=n[n.length-1];return r===e&&i===t||n.push(e,t),this}_initCurve(e=0,t=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[e,t]):this.moveTo(e,t)}quadraticCurveTo(e,t,n,r){this._initCurve();const i=this.currentPath.points;return 0===i.length&&this.moveTo(0,0),Zo.curveTo(e,t,n,r,i),this}bezierCurveTo(e,t,n,r,i,s){return this._initCurve(),$o.curveTo(e,t,n,r,i,s,this.currentPath.points),this}arcTo(e,t,n,r,i){this._initCurve(e,t);const s=this.currentPath.points,o=Xo.curveTo(e,t,n,r,i,s);if(o){const{cx:e,cy:t,radius:n,startAngle:r,endAngle:i,anticlockwise:s}=o;this.arc(e,t,n,r,i,s)}return this}arc(e,t,n,r,i,s=!1){if(r===i)return this;if(!s&&i<=r?i+=Sn:s&&r<=i&&(r+=Sn),0==i-r)return this;const o=e+Math.cos(r)*n,a=t+Math.sin(r)*n,l=this._geometry.closePointEps;let u=this.currentPath?this.currentPath.points:null;if(u){const e=Math.abs(u[u.length-2]-o),t=Math.abs(u[u.length-1]-a);e<l&&t<l||u.push(o,a)}else this.moveTo(o,a),u=this.currentPath.points;return Xo.arc(o,a,e,t,n,r,i,s,u),this}beginFill(e=0,t){return this.beginTextureFill({texture:Mr.WHITE,color:e,alpha:t})}normalizeColor(e){const t=At.shared.setValue(e.color??0);e.color=t.toNumber(),e.alpha??(e.alpha=t.alpha)}beginTextureFill(e){const t={texture:Mr.WHITE,color:16777215,matrix:null};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const n=e.alpha>0;return n?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:n},e)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(e,t,n,r){return this.drawShape(new An(e,t,n,r))}drawRoundedRect(e,t,n,r,i){return this.drawShape(new In(e,t,n,r,i))}drawCircle(e,t,n){return this.drawShape(new Mn(e,t,n))}drawEllipse(e,t,n,r){return this.drawShape(new Pn(e,t,n,r))}drawPolygon(...e){let t,n=!0;const r=e[0];r.points?(n=r.closeStroke,t=r.points):t=Array.isArray(e[0])?e[0]:e;const i=new Rn(t);return i.closeStroke=n,this.drawShape(i),this}drawShape(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const e=this._geometry.graphicsData;return!(1!==e.length||e[0].shape.type!==En.RECT||e[0].matrix||e[0].holes.length||e[0].lineStyle.visible&&e[0].lineStyle.width)}_render(e){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))}_populateBatches(){const e=this._geometry,t=this.blendMode,n=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=n,this.vertexData=new Float32Array(e.points);for(let r=0;r<n;r++){const n=e.batches[r],i=n.style.color,s=new Float32Array(this.vertexData.buffer,4*n.attribStart*2,2*n.attribSize),o=new Float32Array(e.uvsFloat32.buffer,4*n.attribStart*2,2*n.attribSize),a={vertexData:s,blendMode:t,indices:new Uint16Array(e.indicesUint16.buffer,2*n.start,n.size),uvs:o,_batchRGB:At.shared.setValue(i).toRgbArray(),_tintRGB:i,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[r]=a}}_renderBatched(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,n=this.batches.length;t<n;t++){const n=this.batches[t];n.worldAlpha=this.worldAlpha*n.alpha,e.plugins[this.pluginName].render(n)}}}_renderDirect(e){const t=this._resolveDirectShader(e),n=this._geometry,r=this.tint,i=this.worldAlpha,s=t.uniforms,o=n.drawCalls;s.translationMatrix=this.transform.worldTransform,At.shared.setValue(r).multiply([i,i,i]).setAlpha(i).toArray(s.tint),e.shader.bind(t),e.geometry.bind(n,t),e.state.set(this.state);for(let t=0,r=o.length;t<r;t++)this._renderDrawCallDirect(e,n.drawCalls[t])}_renderDrawCallDirect(e,t){const{texArray:n,type:r,size:i,start:s}=t,o=n.count;for(let t=0;t<o;t++)e.texture.bind(n.elements[t],t);e.geometry.draw(r,i,s)}_resolveDirectShader(e){let t=this.shader;const n=this.pluginName;if(!t){if(!ua[n]){const{maxTextures:t}=e.plugins[n],r=new Int32Array(t);for(let e=0;e<t;e++)r[e]=e;const i={tint:new Float32Array([1,1,1,1]),translationMatrix:new Dn,default:lr.from({uSamplers:r},!0)},s=e.plugins[n]._shader.program;ua[n]=new ur(s,i)}t=ua[n]}return t}_calculateBounds(){this.finishPoly();const e=this._geometry;if(!e.graphicsData.length)return;const{minX:t,minY:n,maxX:r,maxY:i}=e.bounds;this._bounds.addFrame(this.transform,t,n,r,i)}containsPoint(e){return this.worldTransform.applyInverse(e,ca._TEMP_POINT),this._geometry.containsPoint(ca._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this.tint;const e=At.shared.setValue(this.tint).toRgbArray(la);for(let t=0;t<this.batches.length;t++){const n=this.batches[t];n._tintRGB=At.shared.setValue(e).multiply(n._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const e=this.transform._worldID;if(this._transformID===e)return;this._transformID=e;const t=this.transform.worldTransform,n=t.a,r=t.b,i=t.c,s=t.d,o=t.tx,a=t.ty,l=this._geometry.points,u=this.vertexData;let c=0;for(let e=0;e<l.length;e+=2){const t=l[e],h=l[e+1];u[c++]=n*t+i*h+o,u[c++]=s*h+r*t+a}}closePath(){const e=this.currentPath;return e&&(e.closeStroke=!0,this.finishPoly()),this}setMatrix(e){return this._matrix=e,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(e){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(e)}};let ha=ca;ha.curves=Wo,ha._TEMP_POINT=new Cn;class da{constructor(e,t){this.uvBuffer=e,this.uvMatrix=t,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(e){if(!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const t=this.uvBuffer.data;this.data&&this.data.length===t.length||(this.data=new Float32Array(t.length)),this.uvMatrix.multiplyUvs(t,this.data),this._updateID++}}const fa=new Cn,pa=new Rn,ma=class extends ns{constructor(e,t,n,r=ce.TRIANGLES){super(),this.geometry=e,this.shader=t,this.state=n||nn.for2d(),this.drawMode=r,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=Ce.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=e,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(e){this.shader=e}get material(){return this.shader}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(e){this.shader.tint=e}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(e){this.shader.texture=e}_render(e){const t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===ce.TRIANGLES&&t.length<2*ma.BATCHABLE_SIZE?this._renderToBatch(e):this._renderDefault(e)}_renderDefault(e){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),e.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),e.shader.bind(t),e.state.set(this.state),e.geometry.bind(this.geometry,t),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(e){const t=this.geometry,n=this.shader;n.uvMatrix&&(n.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=n._tintRGB,this._texture=n.texture;const r=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[r]),e.plugins[r].render(this)}calculateVertices(){const e=this.geometry.buffers[0],t=e.data,n=e._updateID;if(n===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==t.length&&(this.vertexData=new Float32Array(t.length));const r=this.transform.worldTransform,i=r.a,s=r.b,o=r.c,a=r.d,l=r.tx,u=r.ty,c=this.vertexData;for(let e=0;e<c.length/2;e++){const n=t[2*e],r=t[2*e+1];c[2*e]=i*n+o*r+l,c[2*e+1]=s*n+a*r+u}if(this._roundPixels){const e=Ce.RESOLUTION;for(let t=0;t<c.length;++t)c[t]=Math.round(c[t]*e)/e}this.vertexDirty=n}calculateUvs(){const e=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new da(e,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,fa);const t=this.geometry.getBuffer("aVertexPosition").data,n=pa.points,r=this.geometry.getIndex().data,i=r.length,s=4===this.drawMode?3:1;for(let e=0;e+2<i;e+=s){const i=2*r[e],s=2*r[e+1],o=2*r[e+2];if(n[0]=t[i],n[1]=t[i+1],n[2]=t[s],n[3]=t[s+1],n[4]=t[o],n[5]=t[o+1],pa.contains(fa.x,fa.y))return!0}return!1}destroy(e){super.destroy(e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let ga=ma;ga.BATCHABLE_SIZE=100;class ya extends bn{constructor(e,t,n){super();const r=new pn(e),i=new pn(t,!0),s=new pn(n,!0,!0);this.addAttribute("aVertexPosition",r,2,!1,fe.FLOAT).addAttribute("aTextureCoord",i,2,!1,fe.FLOAT).addIndex(s),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class va extends ur{constructor(e,t){const n={uSampler:e,alpha:1,uTextureMatrix:Dn.IDENTITY,uColor:new Float32Array([1,1,1,1])};(t=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},t)).uniforms&&Object.assign(n,t.uniforms),super(t.program||or.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),n),this._colorDirty=!1,this.uvMatrix=new Hr(e),this.batchable=void 0===t.program,this.pluginName=t.pluginName,this.tint=t.tint,this.alpha=t.alpha}get texture(){return this.uniforms.uSampler}set texture(e){this.uniforms.uSampler!==e&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!e.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=e,this.uvMatrix.texture=e)}set alpha(e){e!==this._alpha&&(this._alpha=e,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(e){e!==this._tint&&(this._tint=e,this._tintRGB=At.shared.setValue(e).toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tint}update(){if(this._colorDirty){this._colorDirty=!1;const e=this.texture.baseTexture.alphaMode;At.shared.setValue(this._tint).premultiply(this._alpha,e).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class xa{constructor(e,t,n){this.geometry=new bn,this.indexBuffer=null,this.size=n,this.dynamicProperties=[],this.staticProperties=[];for(let n=0;n<e.length;++n){let r=e[n];r={attributeName:r.attributeName,size:r.size,uploadFunction:r.uploadFunction,type:r.type||fe.FLOAT,offset:r.offset},t[n]?this.dynamicProperties.push(r):this.staticProperties.push(r)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const e=this.geometry;let t=0;this.indexBuffer=new pn(function(e,t=null){const n=6*e;if((t=t||new Uint16Array(n)).length!==n)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${n}`);for(let e=0,r=0;e<n;e+=6,r+=4)t[e+0]=r+0,t[e+1]=r+1,t[e+2]=r+2,t[e+3]=r+0,t[e+4]=r+2,t[e+5]=r+3;return t}(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(let e=0;e<this.dynamicProperties.length;++e){const n=this.dynamicProperties[e];n.offset=t,t+=n.size,this.dynamicStride+=n.size}const n=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(n),this.dynamicDataUint32=new Uint32Array(n),this.dynamicBuffer=new pn(this.dynamicData,!1,!1);let r=0;this.staticStride=0;for(let e=0;e<this.staticProperties.length;++e){const t=this.staticProperties[e];t.offset=r,r+=t.size,this.staticStride+=t.size}const i=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(i),this.staticDataUint32=new Uint32Array(i),this.staticBuffer=new pn(this.staticData,!0,!1);for(let t=0;t<this.dynamicProperties.length;++t){const n=this.dynamicProperties[t];e.addAttribute(n.attributeName,this.dynamicBuffer,0,n.type===fe.UNSIGNED_BYTE,n.type,4*this.dynamicStride,4*n.offset)}for(let t=0;t<this.staticProperties.length;++t){const n=this.staticProperties[t];e.addAttribute(n.attributeName,this.staticBuffer,0,n.type===fe.UNSIGNED_BYTE,n.type,4*this.staticStride,4*n.offset)}}uploadDynamic(e,t,n){for(let r=0;r<this.dynamicProperties.length;r++){const i=this.dynamicProperties[r];i.uploadFunction(e,t,n,i.type===fe.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,i.offset)}this.dynamicBuffer._updateID++}uploadStatic(e,t,n){for(let r=0;r<this.staticProperties.length;r++){const i=this.staticProperties[r];i.uploadFunction(e,t,n,i.type===fe.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,i.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}class ba extends dr{constructor(e){super(e),this.shader=null,this.properties=null,this.tempMatrix=new Dn,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:fe.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=ur.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),this.state=nn.for2d()}render(e){const t=e.children,n=e._maxSize,r=e._batchSize,i=this.renderer;let s=t.length;if(0===s)return;s>n&&!e.autoResize&&(s=n);let o=e._buffers;o||(o=e._buffers=this.generateBuffers(e));const a=t[0]._texture.baseTexture,l=a.alphaMode>0;this.state.blendMode=Pt(e.blendMode,l),i.state.set(this.state);const u=i.gl,c=e.worldTransform.copyTo(this.tempMatrix);c.prepend(i.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=c.toArray(!0),this.shader.uniforms.uColor=At.shared.setValue(e.tintRgb).premultiply(e.worldAlpha,l).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=a,this.renderer.shader.bind(this.shader);let h=!1;for(let n=0,a=0;n<s;n+=r,a+=1){let l=s-n;l>r&&(l=r),a>=o.length&&o.push(this._generateOneMoreBuffer(e));const c=o[a];c.uploadDynamic(t,n,l);const d=e._bufferUpdateIDs[a]||0;h=h||c._updateID<d,h&&(c._updateID=e._updateID,c.uploadStatic(t,n,l)),i.geometry.bind(c.geometry),u.drawElements(u.TRIANGLES,6*l,u.UNSIGNED_SHORT,0)}}generateBuffers(e){const t=[],n=e._maxSize,r=e._batchSize,i=e._properties;for(let e=0;e<n;e+=r)t.push(new xa(this.properties,i,r));return t}_generateOneMoreBuffer(e){const t=e._batchSize,n=e._properties;return new xa(this.properties,n,t)}uploadVertices(e,t,n,r,i,s){let o=0,a=0,l=0,u=0;for(let c=0;c<n;++c){const n=e[t+c],h=n._texture,d=n.scale.x,f=n.scale.y,p=h.trim,m=h.orig;p?(a=p.x-n.anchor.x*m.width,o=a+p.width,u=p.y-n.anchor.y*m.height,l=u+p.height):(o=m.width*(1-n.anchor.x),a=m.width*-n.anchor.x,l=m.height*(1-n.anchor.y),u=m.height*-n.anchor.y),r[s]=a*d,r[s+1]=u*f,r[s+i]=o*d,r[s+i+1]=u*f,r[s+2*i]=o*d,r[s+2*i+1]=l*f,r[s+3*i]=a*d,r[s+3*i+1]=l*f,s+=4*i}}uploadPosition(e,t,n,r,i,s){for(let o=0;o<n;o++){const n=e[t+o].position;r[s]=n.x,r[s+1]=n.y,r[s+i]=n.x,r[s+i+1]=n.y,r[s+2*i]=n.x,r[s+2*i+1]=n.y,r[s+3*i]=n.x,r[s+3*i+1]=n.y,s+=4*i}}uploadRotation(e,t,n,r,i,s){for(let o=0;o<n;o++){const n=e[t+o].rotation;r[s]=n,r[s+i]=n,r[s+2*i]=n,r[s+3*i]=n,s+=4*i}}uploadUvs(e,t,n,r,i,s){for(let o=0;o<n;++o){const n=e[t+o]._texture._uvs;n?(r[s]=n.x0,r[s+1]=n.y0,r[s+i]=n.x1,r[s+i+1]=n.y1,r[s+2*i]=n.x2,r[s+2*i+1]=n.y2,r[s+3*i]=n.x3,r[s+3*i+1]=n.y3,s+=4*i):(r[s]=0,r[s+1]=0,r[s+i]=0,r[s+i+1]=0,r[s+2*i]=0,r[s+2*i+1]=0,r[s+3*i]=0,r[s+3*i+1]=0,s+=4*i)}}uploadTint(e,t,n,r,i,s){for(let o=0;o<n;++o){const n=e[t+o],a=At.shared.setValue(n._tintRGB).toPremultiplied(n.alpha);r[s]=a,r[s+i]=a,r[s+2*i]=a,r[s+3*i]=a,s+=4*i}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}ba.extension={name:"particle",type:qt.RendererPlugin},Qt.add(ba);var wa=(e=>(e[e.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",e[e.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",e))(wa||{});const Sa={willReadFrequently:!0},_a=class{static get experimentalLetterSpacingSupported(){let e=_a._experimentalLetterSpacingSupported;if(void 0!==e){const t=Ce.ADAPTER.getCanvasRenderingContext2D().prototype;e=_a._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return e}constructor(e,t,n,r,i,s,o,a,l){this.text=e,this.style=t,this.width=n,this.height=r,this.lines=i,this.lineWidths=s,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=l}static measureText(e,t,n,r=_a._canvas){n=null==n?t.wordWrap:n;const i=t.toFontString(),s=_a.measureFont(i);0===s.fontSize&&(s.fontSize=t.fontSize,s.ascent=t.fontSize);const o=r.getContext("2d",Sa);o.font=i;const a=(n?_a.wordWrap(e,t,r):e).split(/(?:\r\n|\r|\n)/),l=new Array(a.length);let u=0;for(let e=0;e<a.length;e++){const n=_a._measureText(a[e],t.letterSpacing,o);l[e]=n,u=Math.max(u,n)}let c=u+t.strokeThickness;t.dropShadow&&(c+=t.dropShadowDistance);const h=t.lineHeight||s.fontSize+t.strokeThickness;let d=Math.max(h,s.fontSize+2*t.strokeThickness)+(a.length-1)*(h+t.leading);return t.dropShadow&&(d+=t.dropShadowDistance),new _a(e,t,c,d,a,l,h+t.leading,u,s)}static _measureText(e,t,n){let r=!1;_a.experimentalLetterSpacingSupported&&(_a.experimentalLetterSpacing?(n.letterSpacing=`${t}px`,n.textLetterSpacing=`${t}px`,r=!0):(n.letterSpacing="0px",n.textLetterSpacing="0px"));let i=n.measureText(e).width;return i>0&&(r?i-=t:i+=(_a.graphemeSegmenter(e).length-1)*t),i}static wordWrap(e,t,n=_a._canvas){const r=n.getContext("2d",Sa);let i=0,s="",o="";const a=Object.create(null),{letterSpacing:l,whiteSpace:u}=t,c=_a.collapseSpaces(u),h=_a.collapseNewlines(u);let d=!c;const f=t.wordWrapWidth+l,p=_a.tokenize(e);for(let e=0;e<p.length;e++){let n=p[e];if(_a.isNewline(n)){if(!h){o+=_a.addLine(s),d=!c,s="",i=0;continue}n=" "}if(c){const e=_a.isBreakingSpace(n),t=_a.isBreakingSpace(s[s.length-1]);if(e&&t)continue}const u=_a.getFromCache(n,l,a,r);if(u>f)if(""!==s&&(o+=_a.addLine(s),s="",i=0),_a.canBreakWords(n,t.breakWords)){const e=_a.wordWrapSplit(n);for(let u=0;u<e.length;u++){let c=e[u],h=c,p=1;for(;e[u+p];){const r=e[u+p];if(_a.canBreakChars(h,r,n,u,t.breakWords))break;c+=r,h=r,p++}u+=p-1;const m=_a.getFromCache(c,l,a,r);m+i>f&&(o+=_a.addLine(s),d=!1,s="",i=0),s+=c,i+=m}}else{s.length>0&&(o+=_a.addLine(s),s="",i=0);const t=e===p.length-1;o+=_a.addLine(n,!t),d=!1,s="",i=0}else u+i>f&&(d=!1,o+=_a.addLine(s),s="",i=0),(s.length>0||!_a.isBreakingSpace(n)||d)&&(s+=n,i+=u)}return o+=_a.addLine(s,!1),o}static addLine(e,t=!0){return e=_a.trimRight(e),t?`${e}\n`:e}static getFromCache(e,t,n,r){let i=n[e];return"number"!=typeof i&&(i=_a._measureText(e,t,r)+t,n[e]=i),i}static collapseSpaces(e){return"normal"===e||"pre-line"===e}static collapseNewlines(e){return"normal"===e}static trimRight(e){if("string"!=typeof e)return"";for(let t=e.length-1;t>=0;t--){const n=e[t];if(!_a.isBreakingSpace(n))break;e=e.slice(0,-1)}return e}static isNewline(e){return"string"==typeof e&&_a._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,t){return"string"==typeof e&&_a._breakingSpaces.includes(e.charCodeAt(0))}static tokenize(e){const t=[];let n="";if("string"!=typeof e)return t;for(let r=0;r<e.length;r++){const i=e[r],s=e[r+1];_a.isBreakingSpace(i,s)||_a.isNewline(i)?(""!==n&&(t.push(n),n=""),t.push(i)):n+=i}return""!==n&&t.push(n),t}static canBreakWords(e,t){return t}static canBreakChars(e,t,n,r,i){return!0}static wordWrapSplit(e){return _a.graphemeSegmenter(e)}static measureFont(e){if(_a._fonts[e])return _a._fonts[e];const t={ascent:0,descent:0,fontSize:0},n=_a._canvas,r=_a._context;r.font=e;const i=_a.METRICS_STRING+_a.BASELINE_SYMBOL,s=Math.ceil(r.measureText(i).width);let o=Math.ceil(r.measureText(_a.BASELINE_SYMBOL).width);const a=Math.ceil(_a.HEIGHT_MULTIPLIER*o);if(o=o*_a.BASELINE_MULTIPLIER|0,0===s||0===a)return _a._fonts[e]=t,t;n.width=s,n.height=a,r.fillStyle="#f00",r.fillRect(0,0,s,a),r.font=e,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(i,0,o);const l=r.getImageData(0,0,s,a).data,u=l.length,c=4*s;let h=0,d=0,f=!1;for(h=0;h<o;++h){for(let e=0;e<c;e+=4)if(255!==l[d+e]){f=!0;break}if(f)break;d+=c}for(t.ascent=o-h,d=u-c,f=!1,h=a;h>o;--h){for(let e=0;e<c;e+=4)if(255!==l[d+e]){f=!0;break}if(f)break;d-=c}return t.descent=h-o,t.fontSize=t.ascent+t.descent,_a._fonts[e]=t,t}static clearMetrics(e=""){e?delete _a._fonts[e]:_a._fonts={}}static get _canvas(){if(!_a.__canvas){let e;try{const t=new OffscreenCanvas(0,0),n=t.getContext("2d",Sa);if(n?.measureText)return _a.__canvas=t,t;e=Ce.ADAPTER.createCanvas()}catch(t){e=Ce.ADAPTER.createCanvas()}e.width=e.height=10,_a.__canvas=e}return _a.__canvas}static get _context(){return _a.__context||(_a.__context=_a._canvas.getContext("2d",Sa)),_a.__context}};let Ta=_a;Ta.METRICS_STRING="|ÉqÅ",Ta.BASELINE_SYMBOL="M",Ta.BASELINE_MULTIPLIER=1.4,Ta.HEIGHT_MULTIPLIER=2,Ta.graphemeSegmenter=(()=>{if("function"==typeof Intl?.Segmenter){const e=new Intl.Segmenter;return t=>[...e.segment(t)].map((e=>e.segment))}return e=>[...e]})(),Ta.experimentalLetterSpacing=!1,Ta._fonts={},Ta._newlines=[10,13],Ta._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const Ea=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Ca=class{constructor(e){this.styleID=0,this.reset(),Ma(this,e,e)}clone(){const e={};return Ma(e,this,Ca.defaultStyle),new Ca(e)}reset(){Ma(this,Ca.defaultStyle,Ca.defaultStyle)}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(e){const t=Aa(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}get fill(){return this._fill}set fill(e){const t=Aa(e);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(e){(function(e,t){if(!Array.isArray(e)||!Array.isArray(t))return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0})(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}get leading(){return this._leading}set leading(e){this._leading!==e&&(this._leading=e,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}get padding(){return this._padding}set padding(e){this._padding!==e&&(this._padding=e,this.styleID++)}get stroke(){return this._stroke}set stroke(e){const t=Aa(e);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}get trim(){return this._trim}set trim(e){this._trim!==e&&(this._trim=e,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}toFontString(){const e="number"==typeof this.fontSize?`${this.fontSize}px`:this.fontSize;let t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let e=t.length-1;e>=0;e--){let n=t[e].trim();/([\"\'])[^\'\"]+\1/.test(n)||Ea.includes(n)||(n=`"${n}"`),t[e]=n}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${e} ${t.join(",")}`}};let ka=Ca;function Aa(e){const t=At.shared;return Array.isArray(e)?e.map((e=>t.setValue(e).toHex())):t.setValue(e).toHex()}function Ma(e,t,n){for(const r in n)Array.isArray(t[r])?e[r]=t[r].slice():e[r]=t[r]}ka.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:wa.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};const Pa={texture:!0,children:!1,baseTexture:!0},Ra=class extends ss{constructor(e,t,n){let r=!1;n||(n=Ce.ADAPTER.createCanvas(),r=!0),n.width=3,n.height=3;const i=Mr.from(n);i.orig=new An,i.trim=new An,super(i),this._ownCanvas=r,this.canvas=n,this.context=n.getContext("2d",{willReadFrequently:!0}),this._resolution=Ra.defaultResolution??Ce.RESOLUTION,this._autoResolution=Ra.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=t,this.localStyleID=-1}static get experimentalLetterSpacing(){return Ta.experimentalLetterSpacing}static set experimentalLetterSpacing(e){Qe("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Ta.experimentalLetterSpacing=e}updateText(e){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;this._font=this._style.toFontString();const n=this.context,r=Ta.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),i=r.width,s=r.height,o=r.lines,a=r.lineHeight,l=r.lineWidths,u=r.maxLineWidth,c=r.fontProperties;let h,d;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,i)+2*t.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,s)+2*t.padding)*this._resolution),n.scale(this._resolution,this._resolution),n.clearRect(0,0,this.canvas.width,this.canvas.height),n.font=this._font,n.lineWidth=t.strokeThickness,n.textBaseline=t.textBaseline,n.lineJoin=t.lineJoin,n.miterLimit=t.miterLimit;const f=t.dropShadow?2:1;for(let e=0;e<f;++e){const i=t.dropShadow&&0===e,f=i?Math.ceil(Math.max(1,s)+2*t.padding):0,p=f*this._resolution;if(i){n.fillStyle="black",n.strokeStyle="black";const e=t.dropShadowColor,r=t.dropShadowBlur*this._resolution,i=t.dropShadowDistance*this._resolution;n.shadowColor=At.shared.setValue(e).setAlpha(t.dropShadowAlpha).toRgbaString(),n.shadowBlur=r,n.shadowOffsetX=Math.cos(t.dropShadowAngle)*i,n.shadowOffsetY=Math.sin(t.dropShadowAngle)*i+p}else n.fillStyle=this._generateFillStyle(t,o,r),n.strokeStyle=t.stroke,n.shadowColor="black",n.shadowBlur=0,n.shadowOffsetX=0,n.shadowOffsetY=0;let m=(a-c.fontSize)/2;a-c.fontSize<0&&(m=0);for(let e=0;e<o.length;e++)h=t.strokeThickness/2,d=t.strokeThickness/2+e*a+c.ascent+m,"right"===t.align?h+=u-l[e]:"center"===t.align&&(h+=(u-l[e])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(o[e],h+t.padding,d+t.padding-f,!0),t.fill&&this.drawLetterSpacing(o[e],h+t.padding,d+t.padding-f)}this.updateTexture()}drawLetterSpacing(e,t,n,r=!1){const i=this._style.letterSpacing;let s=!1;if(Ta.experimentalLetterSpacingSupported&&(Ta.experimentalLetterSpacing?(this.context.letterSpacing=`${i}px`,this.context.textLetterSpacing=`${i}px`,s=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),0===i||s)return void(r?this.context.strokeText(e,t,n):this.context.fillText(e,t,n));let o=t;const a=Ta.graphemeSegmenter(e);let l=this.context.measureText(e).width,u=0;for(let e=0;e<a.length;++e){const t=a[e];r?this.context.strokeText(t,o,n):this.context.fillText(t,o,n);let s="";for(let t=e+1;t<a.length;++t)s+=a[t];u=this.context.measureText(s).width,o+=l-u+i,l=u}}updateTexture(){const e=this.canvas;if(this._style.trim){const t=function(e){const t=function(e){const{width:t,height:n}=e,r=e.getContext("2d",{willReadFrequently:!0});if(null===r)throw new TypeError("Failed to get canvas 2D context");const i=r.getImageData(0,0,t,n).data;let s=0,o=0,a=t-1,l=n-1;for(;o<n&&Wt(i,t,o);)++o;if(o===n)return jt.EMPTY;for(;Wt(i,t,l);)--l;for(;Xt(i,t,s,o,l);)++s;for(;Xt(i,t,a,o,l);)--a;return++a,++l,new jt(s,o,a,l)}(e),{width:n,height:r}=t;let i=null;if(!t.isEmpty()){const s=e.getContext("2d");if(null===s)throw new TypeError("Failed to get canvas 2D context");i=s.getImageData(t.left,t.top,n,r)}return{width:n,height:r,data:i}}(e);t.data&&(e.width=t.width,e.height=t.height,this.context.putImageData(t.data,0,0))}const t=this._texture,n=this._style,r=n.trim?0:n.padding,i=t.baseTexture;t.trim.width=t._frame.width=e.width/this._resolution,t.trim.height=t._frame.height=e.height/this._resolution,t.trim.x=-r,t.trim.y=-r,t.orig.width=t._frame.width-2*r,t.orig.height=t._frame.height-2*r,this._onTextureUpdate(),i.setRealSize(e.width,e.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(e,t){return this.updateText(!0),-1===this._textureID&&(e=!1),super.getBounds(e,t)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds.call(this,e)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(e,t,n){const r=e.fill;if(!Array.isArray(r))return r;if(1===r.length)return r[0];let i;const s=e.dropShadow?e.dropShadowDistance:0,o=e.padding||0,a=this.canvas.width/this._resolution-s-2*o,l=this.canvas.height/this._resolution-s-2*o,u=r.slice(),c=e.fillGradientStops.slice();if(!c.length){const e=u.length+1;for(let t=1;t<e;++t)c.push(t/e)}if(u.unshift(r[0]),c.unshift(0),u.push(r[r.length-1]),c.push(1),e.fillGradientType===wa.LINEAR_VERTICAL){i=this.context.createLinearGradient(a/2,o,a/2,l+o);const r=n.fontProperties.fontSize+e.strokeThickness;for(let e=0;e<t.length;e++){const s=n.lineHeight*(e-1)+r,o=n.lineHeight*e;let a=o;e>0&&s>o&&(a=(o+s)/2);const h=o+r,d=n.lineHeight*(e+1);let f=h;e+1<t.length&&d<h&&(f=(h+d)/2);const p=(f-a)/l;for(let e=0;e<u.length;e++){let t=0;t="number"==typeof c[e]?c[e]:e/u.length;let n=Math.min(1,Math.max(0,a/l+t*p));n=Number(n.toFixed(5)),i.addColorStop(n,u[e])}}}else{i=this.context.createLinearGradient(o,l/2,a+o,l/2);const e=u.length+1;let t=1;for(let n=0;n<u.length;n++){let r;r="number"==typeof c[n]?c[n]:t/e,i.addColorStop(r,u[n]),t++}}return i}destroy(e){"boolean"==typeof e&&(e={children:e}),e=Object.assign({},Pa,e),super.destroy(e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this.updateText(!0);const t=Lt(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this.updateText(!0);const t=Lt(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get style(){return this._style}set style(e){e=e||{},this._style=e instanceof ka?e:new ka(e),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(e){e=String(null==e?"":e),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}};let Ia=Ra;Ia.defaultAutoResolution=!0;class Da{constructor(e){this.maxItemsPerFrame=e,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function Fa(e,t){let n=!1;if(e?._textures?.length)for(let r=0;r<e._textures.length;r++)if(e._textures[r]instanceof Mr){const i=e._textures[r].baseTexture;t.includes(i)||(t.push(i),n=!0)}return n}function Na(e,t){if(e.baseTexture instanceof hn){const n=e.baseTexture;return t.includes(n)||t.push(n),!0}return!1}function La(e,t){if(e._texture&&e._texture instanceof Mr){const n=e._texture.baseTexture;return t.includes(n)||t.push(n),!0}return!1}function Ba(e,t){return t instanceof Ia&&(t.updateText(!0),!0)}function Oa(e,t){if(t instanceof ka){const e=t.toFontString();return Ta.measureFont(e),!0}return!1}function za(e,t){if(e instanceof Ia){t.includes(e.style)||t.push(e.style),t.includes(e)||t.push(e);const n=e._texture.baseTexture;return t.includes(n)||t.push(n),!0}return!1}function ja(e,t){return e instanceof ka&&(t.includes(e)||t.push(e),!0)}const Ua=class{constructor(e){this.limiter=new Da(Ua.uploadsPerFrame),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(za),this.registerFindHook(ja),this.registerFindHook(Fa),this.registerFindHook(Na),this.registerFindHook(La),this.registerUploadHook(Ba),this.registerUploadHook(Oa)}upload(e){return new Promise((t=>{e&&this.add(e),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,Ii.system.addOnce(this.tick,this,Mi.UTILITY))):t()}))}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const e=this.queue[0];let t=!1;if(e&&!e._destroyed)for(let n=0,r=this.uploadHooks.length;n<r;n++)if(this.uploadHooks[n](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}t||this.queue.shift()}if(this.queue.length)Ii.system.addOnce(this.tick,this,Mi.UTILITY);else{this.ticking=!1;const e=this.completes.slice(0);this.completes.length=0;for(let t=0,n=e.length;t<n;t++)e[t]()}}registerFindHook(e){return e&&this.addHooks.push(e),this}registerUploadHook(e){return e&&this.uploadHooks.push(e),this}add(e){for(let t=0,n=this.addHooks.length;t<n&&!this.addHooks[t](e,this.queue);t++);if(e instanceof ns)for(let t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this}destroy(){this.ticking&&Ii.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};let Ga=Ua;function Va(e,t){return t instanceof hn&&(t._glTextures[e.CONTEXT_UID]||e.texture.bind(t),!0)}function Ha(e,t){if(!(t instanceof ha))return!1;const{geometry:n}=t;t.finishPoly(),n.updateBatches();const{batches:r}=n;for(let t=0;t<r.length;t++){const{texture:n}=r[t].style;n&&Va(e,n.baseTexture)}return n.batchable||e.geometry.bind(n,t._resolveDirectShader(e)),!0}function Wa(e,t){return e instanceof ha&&(t.push(e),!0)}Ga.uploadsPerFrame=4,Object.defineProperties(Ce,{UPLOADS_PER_FRAME:{get:()=>Ga.uploadsPerFrame,set(e){Qe("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Ga.uploadsPerFrame=e}}});class Xa extends Ga{constructor(e){super(e),this.uploadHookHelper=this.renderer,this.registerFindHook(Wa),this.registerUploadHook(Va),this.registerUploadHook(Ha)}}Xa.extension={name:"prepare",type:qt.RendererSystem},Qt.add(Xa);class $a extends ss{constructor(e,t=!0){super(e[0]instanceof Mr?e[0]:e[0].texture),this._textures=null,this._durations=null,this._autoUpdate=t,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=e}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Ii.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Ii.shared.add(this.update,this,Mi.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(e){this.stop(),this.currentFrame=e}gotoAndPlay(e){this.currentFrame=e,this.play()}update(e){if(!this._playing)return;const t=this.animationSpeed*e,n=this.currentFrame;if(null!==this._durations){let n=this._currentTime%1*this._durations[this.currentFrame];for(n+=t/60*1e3;n<0;)this._currentTime--,n+=this._durations[this.currentFrame];const r=Math.sign(this.animationSpeed*e);for(this._currentTime=Math.floor(this._currentTime);n>=this._durations[this.currentFrame];)n-=this._durations[this.currentFrame]*r,this._currentTime+=r;this._currentTime+=n/this._durations[this.currentFrame]}else this._currentTime+=t;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):n!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<n||this.animationSpeed<0&&this.currentFrame>n)&&this.onLoop(),this.updateTexture())}updateTexture(){const e=this.currentFrame;this._previousFrame!==e&&(this._previousFrame=e,this._texture=this._textures[e],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(e){this.stop(),super.destroy(e),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(e){const t=[];for(let n=0;n<e.length;++n)t.push(Mr.from(e[n]));return new $a(t)}static fromImages(e){const t=[];for(let n=0;n<e.length;++n)t.push(Mr.from(e[n]));return new $a(t)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(e){if(e[0]instanceof Mr)this._textures=e,this._durations=null;else{this._textures=[],this._durations=[];for(let t=0;t<e.length;t++)this._textures.push(e[t].texture),this._durations.push(e[t].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let e=Math.floor(this._currentTime)%this._textures.length;return e<0&&(e+=this._textures.length),e}set currentFrame(e){if(e<0||e>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${e}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const t=this.currentFrame;this._currentTime=e,t!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(Ii.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Ii.shared.add(this.update,this),this._isConnectedToTicker=!0))}}const Ya=new Cn;class qa extends ss{constructor(e,t=100,n=100){super(e),this.tileTransform=new Hn,this._width=t,this._height=n,this.uvMatrix=this.texture.uvMatrix||new Hr(e),this.pluginName="tilingSprite",this.uvRespectAnchor=!1}get clampMargin(){return this.uvMatrix.clampMargin}set clampMargin(e){this.uvMatrix.clampMargin=e,this.uvMatrix.update(!0)}get tileScale(){return this.tileTransform.scale}set tileScale(e){this.tileTransform.scale.copyFrom(e)}get tilePosition(){return this.tileTransform.position}set tilePosition(e){this.tileTransform.position.copyFrom(e)}_onTextureUpdate(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215}_render(e){const t=this._texture;t&&t.valid&&(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this))}_calculateBounds(){const e=this._width*-this._anchor._x,t=this._height*-this._anchor._y,n=this._width*(1-this._anchor._x),r=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,e,t,n,r)}getLocalBounds(e){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new An),e=this._localBoundsRect),this._bounds.getRectangle(e)):super.getLocalBounds.call(this,e)}containsPoint(e){this.worldTransform.applyInverse(e,Ya);const t=this._width,n=this._height,r=-t*this.anchor._x;if(Ya.x>=r&&Ya.x<r+t){const e=-n*this.anchor._y;if(Ya.y>=e&&Ya.y<e+n)return!0}return!1}destroy(e){super.destroy(e),this.tileTransform=null,this.uvMatrix=null}static from(e,t){const n=e instanceof Mr?e:Mr.from(e,t);return new qa(n,t.width,t.height)}get width(){return this._width}set width(e){this._width=e}get height(){return this._height}set height(e){this._height=e}}var Ka="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";const Za=new Dn;class Qa extends dr{constructor(e){super(e),e.runners.contextChange.add(this),this.quad=new Dr,this.state=nn.for2d()}contextChange(){const e=this.renderer,t={globals:e.globalUniforms};this.simpleShader=ur.from(Ka,"#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",t),this.shader=e.context.webGLVersion>1?ur.from("#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",t):ur.from(Ka,"#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",t)}render(e){const t=this.renderer,n=this.quad;let r=n.vertices;r[0]=r[6]=e._width*-e.anchor.x,r[1]=r[3]=e._height*-e.anchor.y,r[2]=r[4]=e._width*(1-e.anchor.x),r[5]=r[7]=e._height*(1-e.anchor.y);const i=e.uvRespectAnchor?e.anchor.x:0,s=e.uvRespectAnchor?e.anchor.y:0;r=n.uvs,r[0]=r[6]=-i,r[1]=r[3]=-s,r[2]=r[4]=1-i,r[5]=r[7]=1-s,n.invalidate();const o=e._texture,a=o.baseTexture,l=a.alphaMode>0,u=e.tileTransform.localTransform,c=e.uvMatrix;let h=a.isPowerOfTwo&&o.frame.width===a.width&&o.frame.height===a.height;h&&(a._glTextures[t.CONTEXT_UID]?h=a.wrapMode!==ge.CLAMP:a.wrapMode===ge.CLAMP&&(a.wrapMode=ge.REPEAT));const d=h?this.simpleShader:this.shader,f=o.width,p=o.height,m=e._width,g=e._height;Za.set(u.a*f/m,u.b*f/g,u.c*p/m,u.d*p/g,u.tx/m,u.ty/g),Za.invert(),h?Za.prepend(c.mapCoord):(d.uniforms.uMapCoord=c.mapCoord.toArray(!0),d.uniforms.uClampFrame=c.uClampFrame,d.uniforms.uClampOffset=c.uClampOffset),d.uniforms.uTransform=Za.toArray(!0),d.uniforms.uColor=At.shared.setValue(e.tint).premultiply(e.worldAlpha,l).toArray(d.uniforms.uColor),d.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),d.uniforms.uSampler=o,t.shader.bind(d),t.geometry.bind(n),this.state.blendMode=Pt(e.blendMode,l),t.state.set(this.state),t.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Qa.extension={name:"tilingSprite",type:qt.RendererPlugin},Qt.add(Qa);const Ja=class{constructor(e,t,n=null){this.linkedSheets=[],this._texture=e instanceof Mr?e:null,this.baseTexture=e instanceof hn?e:this._texture.baseTexture,this.textures={},this.animations={},this.data=t;const r=this.baseTexture.resource;this.resolution=this._updateResolution(n||(r?r.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(e=null){const{scale:t}=this.data.meta;let n=Yt(e,null);return null===n&&(n=parseFloat(t??"1")),1!==n&&this.baseTexture.setResolution(n),n}parse(){return new Promise((e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=Ja.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()}))}_processFrames(e){let t=e;const n=Ja.BATCH_SIZE;for(;t-e<n&&t<this._frameKeys.length;){const e=this._frameKeys[t],n=this._frames[e],r=n.frame;if(r){let t=null,i=null;const s=!1!==n.trimmed&&n.sourceSize?n.sourceSize:n.frame,o=new An(0,0,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution);t=n.rotated?new An(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.h)/this.resolution,Math.floor(r.w)/this.resolution):new An(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution),!1!==n.trimmed&&n.spriteSourceSize&&(i=new An(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution)),this.textures[e]=new Mr(this.baseTexture,t,o,i,n.rotated?2:0,n.anchor,n.borders),Mr.addToCache(this.textures[e],e)}t++}}_processAnimations(){const e=this.data.animations||{};for(const t in e){this.animations[t]=[];for(let n=0;n<e[t].length;n++){const r=e[t][n];this.animations[t].push(this.textures[r])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Ja.BATCH_SIZE),this._batchIndex++,setTimeout((()=>{this._batchIndex*Ja.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())}),0)}destroy(e=!1){for(const e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let el=Ja;el.BATCH_SIZE=1e3;const tl=["jpg","png","jpeg","avif","webp"];function nl(e,t,n){const r={};if(e.forEach((e=>{r[e]=t})),Object.keys(t.textures).forEach((e=>{r[e]=t.textures[e]})),!n){const n=Ke.dirname(e[0]);t.linkedSheets.forEach(((e,i)=>{const s=nl([`${n}/${t.data.meta.related_multi_packs[i]}`],e,!0);Object.assign(r,s)}))}return r}const rl={extension:qt.Asset,cache:{test:e=>e instanceof el,getCacheableAssets:(e,t)=>nl(e,t,!1)},resolver:{test:e=>{const t=e.split("?")[0].split("."),n=t.pop(),r=t.pop();return"json"===n&&tl.includes(r)},parse:e=>{const t=e.split(".");return{resolution:parseFloat(Ce.RETINA_PREFIX.exec(e)?.[1]??"1"),format:t[t.length-2],src:e}}},loader:{extension:{type:qt.LoadParser,priority:Bs.Normal},testParse:async(e,t)=>".json"===Ke.extname(t.src).toLowerCase()&&!!e.frames,async parse(e,t,n){let r=Ke.dirname(t.src);r&&r.lastIndexOf("/")!==r.length-1&&(r+="/");let i=r+e.meta.image;i=fo(i,t.src);const s=(await n.load([i]))[i],o=new el(s.baseTexture,e,t.src);await o.parse();const a=e?.meta?.related_multi_packs;if(Array.isArray(a)){const e=[];for(const i of a){if("string"!=typeof i)continue;let s=r+i;t.data?.ignoreMultiPack||(s=fo(s,t.src),e.push(n.load({src:s,data:{ignoreMultiPack:!0}})))}const i=await Promise.all(e);o.linkedSheets=i,i.forEach((e=>{e.linkedSheets=[o].concat(o.linkedSheets.filter((t=>t!==e)))}))}return o},unload(e){e.destroy(!0)}}};Qt.add(rl);class il{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class sl{static test(e){return"string"==typeof e&&e.startsWith("info face=")}static parse(e){const t=e.match(/^[a-z]+\s+.+$/gm),n={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const e in t){const r=t[e].match(/^[a-z]+/gm)[0],i=t[e].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),s={};for(const e in i){const t=i[e].split("="),n=t[0],r=t[1].replace(/"/gm,""),o=parseFloat(r),a=isNaN(o)?r:o;s[n]=a}n[r].push(s)}const r=new il;return n.info.forEach((e=>r.info.push({face:e.face,size:parseInt(e.size,10)}))),n.common.forEach((e=>r.common.push({lineHeight:parseInt(e.lineHeight,10)}))),n.page.forEach((e=>r.page.push({id:parseInt(e.id,10),file:e.file}))),n.char.forEach((e=>r.char.push({id:parseInt(e.id,10),page:parseInt(e.page,10),x:parseInt(e.x,10),y:parseInt(e.y,10),width:parseInt(e.width,10),height:parseInt(e.height,10),xoffset:parseInt(e.xoffset,10),yoffset:parseInt(e.yoffset,10),xadvance:parseInt(e.xadvance,10)}))),n.kerning.forEach((e=>r.kerning.push({first:parseInt(e.first,10),second:parseInt(e.second,10),amount:parseInt(e.amount,10)}))),n.distanceField.forEach((e=>r.distanceField.push({distanceRange:parseInt(e.distanceRange,10),fieldType:e.fieldType}))),r}}class ol{static test(e){const t=e;return"getElementsByTagName"in t&&t.getElementsByTagName("page").length&&null!==t.getElementsByTagName("info")[0].getAttribute("face")}static parse(e){const t=new il,n=e.getElementsByTagName("info"),r=e.getElementsByTagName("common"),i=e.getElementsByTagName("page"),s=e.getElementsByTagName("char"),o=e.getElementsByTagName("kerning"),a=e.getElementsByTagName("distanceField");for(let e=0;e<n.length;e++)t.info.push({face:n[e].getAttribute("face"),size:parseInt(n[e].getAttribute("size"),10)});for(let e=0;e<r.length;e++)t.common.push({lineHeight:parseInt(r[e].getAttribute("lineHeight"),10)});for(let e=0;e<i.length;e++)t.page.push({id:parseInt(i[e].getAttribute("id"),10)||0,file:i[e].getAttribute("file")});for(let e=0;e<s.length;e++){const n=s[e];t.char.push({id:parseInt(n.getAttribute("id"),10),page:parseInt(n.getAttribute("page"),10)||0,x:parseInt(n.getAttribute("x"),10),y:parseInt(n.getAttribute("y"),10),width:parseInt(n.getAttribute("width"),10),height:parseInt(n.getAttribute("height"),10),xoffset:parseInt(n.getAttribute("xoffset"),10),yoffset:parseInt(n.getAttribute("yoffset"),10),xadvance:parseInt(n.getAttribute("xadvance"),10)})}for(let e=0;e<o.length;e++)t.kerning.push({first:parseInt(o[e].getAttribute("first"),10),second:parseInt(o[e].getAttribute("second"),10),amount:parseInt(o[e].getAttribute("amount"),10)});for(let e=0;e<a.length;e++)t.distanceField.push({fieldType:a[e].getAttribute("fieldType"),distanceRange:parseInt(a[e].getAttribute("distanceRange"),10)});return t}}class al{static test(e){return!("string"!=typeof e||!e.includes("<font>"))&&ol.test(Ce.ADAPTER.parseXML(e))}static parse(e){return ol.parse(Ce.ADAPTER.parseXML(e))}}const ll=[sl,ol,al];function ul(e,t,n,r,i,s,o){const a=n.text,l=n.fontProperties;t.translate(r,i),t.scale(s,s);const u=o.strokeThickness/2,c=-o.strokeThickness/2;if(t.font=o.toFontString(),t.lineWidth=o.strokeThickness,t.textBaseline=o.textBaseline,t.lineJoin=o.lineJoin,t.miterLimit=o.miterLimit,t.fillStyle=function(e,t,n,r,i,s){const o=n.fill;if(!Array.isArray(o))return o;if(1===o.length)return o[0];let a;const l=n.dropShadow?n.dropShadowDistance:0,u=n.padding||0,c=e.width/r-l-2*u,h=e.height/r-l-2*u,d=o.slice(),f=n.fillGradientStops.slice();if(!f.length){const e=d.length+1;for(let t=1;t<e;++t)f.push(t/e)}if(d.unshift(o[0]),f.unshift(0),d.push(o[o.length-1]),f.push(1),n.fillGradientType===wa.LINEAR_VERTICAL){a=t.createLinearGradient(c/2,u,c/2,h+u);let e=0;const r=(s.fontProperties.fontSize+n.strokeThickness)/h;for(let t=0;t<i.length;t++){const n=s.lineHeight*t;for(let t=0;t<d.length;t++){let i=0;i="number"==typeof f[t]?f[t]:t/d.length;const s=n/h+i*r;let o=Math.max(e,s);o=Math.min(o,1),a.addColorStop(o,d[t]),e=o}}}else{a=t.createLinearGradient(u,h/2,c+u,h/2);const e=d.length+1;let n=1;for(let t=0;t<d.length;t++){let r;r="number"==typeof f[t]?f[t]:n/e,a.addColorStop(r,d[t]),n++}}return a}(e,t,o,s,[a],n),t.strokeStyle=o.stroke,o.dropShadow){const e=o.dropShadowColor,n=o.dropShadowBlur*s,r=o.dropShadowDistance*s;t.shadowColor=At.shared.setValue(e).setAlpha(o.dropShadowAlpha).toRgbaString(),t.shadowBlur=n,t.shadowOffsetX=Math.cos(o.dropShadowAngle)*r,t.shadowOffsetY=Math.sin(o.dropShadowAngle)*r}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;o.stroke&&o.strokeThickness&&t.strokeText(a,u,c+n.lineHeight-l.descent),o.fill&&t.fillText(a,u,c+n.lineHeight-l.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function cl(e){return Array.from?Array.from(e):e.split("")}function hl(e){return e.codePointAt?e.codePointAt(0):e.charCodeAt(0)}const dl=class{constructor(e,t,n){const[r]=e.info,[i]=e.common,[s]=e.page,[o]=e.distanceField,a=Yt(s.file),l={};this._ownsTextures=n,this.font=r.face,this.size=r.size,this.lineHeight=i.lineHeight/a,this.chars={},this.pageTextures=l;for(let n=0;n<e.page.length;n++){const{id:r,file:i}=e.page[n];l[r]=t instanceof Array?t[n]:t[i],o?.fieldType&&"none"!==o.fieldType&&(l[r].baseTexture.alphaMode=ve.NO_PREMULTIPLIED_ALPHA,l[r].baseTexture.mipmap=ye.OFF)}for(let t=0;t<e.char.length;t++){const{id:n,page:r}=e.char[t];let{x:i,y:s,width:o,height:u,xoffset:c,yoffset:h,xadvance:d}=e.char[t];i/=a,s/=a,o/=a,u/=a,c/=a,h/=a,d/=a;const f=new An(i+l[r].frame.x/a,s+l[r].frame.y/a,o,u);this.chars[n]={xOffset:c,yOffset:h,xAdvance:d,kerning:{},texture:new Mr(l[r].baseTexture,f),page:r}}for(let t=0;t<e.kerning.length;t++){let{first:n,second:r,amount:i}=e.kerning[t];n/=a,r/=a,i/=a,this.chars[r]&&(this.chars[r].kerning[n]=i)}this.distanceFieldRange=o?.distanceRange,this.distanceFieldType=o?.fieldType?.toLowerCase()??"none"}destroy(){for(const e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(const e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null}static install(e,t,n){let r;if(e instanceof il)r=e;else{const t=function(e){for(let t=0;t<ll.length;t++)if(ll[t].test(e))return ll[t];return null}(e);if(!t)throw new Error("Unrecognized data format for font.");r=t.parse(e)}t instanceof Mr&&(t=[t]);const i=new dl(r,t,n);return dl.available[i.font]=i,i}static uninstall(e){const t=dl.available[e];if(!t)throw new Error(`No font found named '${e}'`);t.destroy(),delete dl.available[e]}static from(e,t,n){if(!e)throw new Error("[BitmapFont] Property `name` is required.");const{chars:r,padding:i,resolution:s,textureWidth:o,textureHeight:a,...l}=Object.assign({},dl.defaultOptions,n),u=function(e){"string"==typeof e&&(e=[e]);const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];if(Array.isArray(r)){if(2!==r.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${r.length}.`);const e=r[0].charCodeAt(0),n=r[1].charCodeAt(0);if(n<e)throw new Error("[BitmapFont]: Invalid character range.");for(let r=e,i=n;r<=i;r++)t.push(String.fromCharCode(r))}else t.push(...cl(r))}if(0===t.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}(r),c=t instanceof ka?t:new ka(t),h=o,d=new il;d.info[0]={face:c.fontFamily,size:c.fontSize},d.common[0]={lineHeight:c.fontSize};let f,p,m,g=0,y=0,v=0;const x=[],b=[];for(let e=0;e<u.length;e++){f||(f=Ce.ADAPTER.createCanvas(),f.width=o,f.height=a,p=f.getContext("2d"),m=new hn(f,{resolution:s,...l}),x.push(m),b.push(new Mr(m)),d.page.push({id:b.length-1,file:""}));const t=u[e],n=Ta.measureText(t,c,!1,f),r=n.width,w=Math.ceil(n.height),S=Math.ceil(("italic"===c.fontStyle?2:1)*r);if(y>=a-w*s){if(0===y)throw new Error(`[BitmapFont] textureHeight ${a}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${t}')`);--e,f=null,p=null,m=null,y=0,g=0,v=0;continue}if(v=Math.max(w+n.fontProperties.descent,v),S*s+g>=h){if(0===g)throw new Error(`[BitmapFont] textureWidth ${o}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${t}')`);--e,y+=v*s,y=Math.ceil(y),g=0,v=0;continue}ul(f,p,n,g,y,s,c);const _=hl(n.text);d.char.push({id:_,page:b.length-1,x:g/s,y:y/s,width:S,height:w,xoffset:0,yoffset:0,xadvance:r-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0)}),g+=(S+2*i)*s,g=Math.ceil(g)}for(let e=0,t=u.length;e<t;e++){const n=u[e];for(let e=0;e<t;e++){const t=u[e],r=p.measureText(n).width,i=p.measureText(t).width,s=p.measureText(n+t).width-(r+i);s&&d.kerning.push({first:hl(n),second:hl(t),amount:s})}}const w=new dl(d,b,!0);return void 0!==dl.available[e]&&dl.uninstall(e),dl.available[e]=w,w}};let fl=dl;fl.ALPHA=[["a","z"],["A","Z"]," "],fl.NUMERIC=[["0","9"]],fl.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],fl.ASCII=[[" ","~"]],fl.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:dl.ALPHANUMERIC},fl.available={};const pl=[],ml=[],gl=[],yl=class extends ns{constructor(e,t={}){super(),this._tint=16777215;const{align:n,tint:r,maxWidth:i,letterSpacing:s,fontName:o,fontSize:a}=Object.assign({},yl.styleDefaults,t);if(!fl.available[o])throw new Error(`Missing BitmapFont "${o}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=n,this._tint=r,this._font=void 0,this._fontName=o,this._fontSize=a,this.text=e,this._maxWidth=i,this._maxLineHeight=0,this._letterSpacing=s,this._anchor=new Gn((()=>{this.dirty=!0}),this,0,0),this._roundPixels=Ce.ROUND_PIXELS,this.dirty=!0,this._resolution=Ce.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const e=fl.available[this._fontName],t=this.fontSize,n=t/e.size,r=new Cn,i=[],s=[],o=[],a=cl(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),l=this._maxWidth*e.size/t,u="none"===e.distanceFieldType?pl:ml;let c=null,h=0,d=0,f=0,p=-1,m=0,g=0,y=0,v=0;for(let t=0;t<a.length;t++){const n=a[t],u=hl(n);if(/(?:\s)/.test(n)&&(p=t,m=h,v++),"\r"===n||"\n"===n){s.push(h),o.push(-1),d=Math.max(d,h),++f,++g,r.x=0,r.y+=e.lineHeight,c=null,v=0;continue}const x=e.chars[u];if(!x)continue;c&&x.kerning[c]&&(r.x+=x.kerning[c]);const b=gl.pop()||{texture:Mr.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Cn};b.texture=x.texture,b.line=f,b.charCode=u,b.position.x=Math.round(r.x+x.xOffset+this._letterSpacing/2),b.position.y=Math.round(r.y+x.yOffset),b.prevSpaces=v,i.push(b),h=b.position.x+Math.max(x.xAdvance-x.xOffset,x.texture.orig.width),r.x+=x.xAdvance+this._letterSpacing,y=Math.max(y,x.yOffset+x.texture.height),c=u,-1!==p&&l>0&&r.x>l&&(++g,Nt(i,1+p-g,1+t-p),t=p,p=-1,s.push(m),o.push(i.length>0?i[i.length-1].prevSpaces:0),d=Math.max(d,m),f++,r.x=0,r.y+=e.lineHeight,c=null,v=0)}const x=a[a.length-1];"\r"!==x&&"\n"!==x&&(/(?:\s)/.test(x)&&(h=m),s.push(h),d=Math.max(d,h),o.push(-1));const b=[];for(let e=0;e<=f;e++){let t=0;"right"===this._align?t=d-s[e]:"center"===this._align?t=(d-s[e])/2:"justify"===this._align&&(t=o[e]<0?0:(d-s[e])/o[e]),b.push(t)}const w=i.length,S={},_=[],T=this._activePagesMeshData;u.push(...T);for(let t=0;t<w;t++){const n=i[t].texture,r=n.baseTexture.uid;if(!S[r]){let t=u.pop();if(!t){const n=new ya;let r,i;"none"===e.distanceFieldType?(r=new va(Mr.EMPTY),i=ue.NORMAL):(r=new va(Mr.EMPTY,{program:or.from("// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r\n\r\n}\r\n"),uniforms:{uFWidth:0}}),i=ue.NORMAL_NPM);const s=new ga(n,r);s.blendMode=i,t={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:s,vertices:null,uvs:null,indices:null}}t.index=0,t.indexCount=0,t.vertexCount=0,t.uvsCount=0,t.total=0;const{_textureCache:i}=this;i[r]=i[r]||new Mr(n.baseTexture),t.mesh.texture=i[r],t.mesh.tint=this._tint,_.push(t),S[r]=t}S[r].total++}for(let e=0;e<T.length;e++)_.includes(T[e])||this.removeChild(T[e].mesh);for(let e=0;e<_.length;e++)_[e].mesh.parent!==this&&this.addChild(_[e].mesh);this._activePagesMeshData=_;for(const e in S){const t=S[e],n=t.total;if(!(t.indices?.length>6*n)||t.vertices.length<2*ga.BATCHABLE_SIZE)t.vertices=new Float32Array(8*n),t.uvs=new Float32Array(8*n),t.indices=new Uint16Array(6*n);else{const e=t.total,n=t.vertices;for(let t=4*e*2;t<n.length;t++)n[t]=0}t.mesh.size=6*n}for(let e=0;e<w;e++){const t=i[e];let r=t.position.x+b[t.line]*("justify"===this._align?t.prevSpaces:1);this._roundPixels&&(r=Math.round(r));const s=r*n,o=t.position.y*n,a=t.texture,l=S[a.baseTexture.uid],u=a.frame,c=a._uvs,h=l.index++;l.indices[6*h+0]=0+4*h,l.indices[6*h+1]=1+4*h,l.indices[6*h+2]=2+4*h,l.indices[6*h+3]=0+4*h,l.indices[6*h+4]=2+4*h,l.indices[6*h+5]=3+4*h,l.vertices[8*h+0]=s,l.vertices[8*h+1]=o,l.vertices[8*h+2]=s+u.width*n,l.vertices[8*h+3]=o,l.vertices[8*h+4]=s+u.width*n,l.vertices[8*h+5]=o+u.height*n,l.vertices[8*h+6]=s,l.vertices[8*h+7]=o+u.height*n,l.uvs[8*h+0]=c.x0,l.uvs[8*h+1]=c.y0,l.uvs[8*h+2]=c.x1,l.uvs[8*h+3]=c.y1,l.uvs[8*h+4]=c.x2,l.uvs[8*h+5]=c.y2,l.uvs[8*h+6]=c.x3,l.uvs[8*h+7]=c.y3}this._textWidth=d*n,this._textHeight=(r.y+e.lineHeight)*n;for(const e in S){const t=S[e];if(0!==this.anchor.x||0!==this.anchor.y){let e=0;const n=this._textWidth*this.anchor.x,r=this._textHeight*this.anchor.y;for(let i=0;i<t.total;i++)t.vertices[e++]-=n,t.vertices[e++]-=r,t.vertices[e++]-=n,t.vertices[e++]-=r,t.vertices[e++]-=n,t.vertices[e++]-=r,t.vertices[e++]-=n,t.vertices[e++]-=r}this._maxLineHeight=y*n;const r=t.mesh.geometry.getBuffer("aVertexPosition"),i=t.mesh.geometry.getBuffer("aTextureCoord"),s=t.mesh.geometry.getIndex();r.data=t.vertices,i.data=t.uvs,s.data=t.indices,r.update(),i.update(),s.update()}for(let e=0;e<i.length;e++)gl.push(i[e]);this._font=e,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:n,size:r}=fl.available[this._fontName];if("none"!==n){const{a:n,b:i,c:s,d:o}=this.worldTransform,a=Math.sqrt(n*n+i*i),l=Math.sqrt(s*s+o*o),u=(Math.abs(a)+Math.abs(l))/2,c=this.fontSize/r,h=e._view.resolution;for(const e of this._activePagesMeshData)e.mesh.shader.uniforms.uFWidth=u*t*c*h}super._render(e)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const e=fl.available[this._fontName];if(!e)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==e&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tint}set tint(e){if(this._tint!==e){this._tint=e;for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=e}}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.dirty=!0)}get fontName(){return this._fontName}set fontName(e){if(!fl.available[e])throw new Error(`Missing BitmapFont "${e}"`);this._fontName!==e&&(this._fontName=e,this.dirty=!0)}get fontSize(){return this._fontSize??fl.available[this._fontName].size}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.dirty=!0)}get anchor(){return this._anchor}set anchor(e){"number"==typeof e?this._anchor.set(e):this._anchor.copyFrom(e)}get text(){return this._text}set text(e){e=String(null==e?"":e),this._text!==e&&(this._text=e,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(e){e!==this._roundPixels&&(this._roundPixels=e,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}destroy(e){const{_textureCache:t}=this,n="none"===fl.available[this._fontName].distanceFieldType?pl:ml;n.push(...this._activePagesMeshData);for(const e of this._activePagesMeshData)this.removeChild(e.mesh);this._activePagesMeshData=[],n.filter((e=>t[e.mesh.texture.baseTexture.uid])).forEach((e=>{e.mesh.texture=Mr.EMPTY}));for(const e in t)t[e].destroy(),delete t[e];this._font=null,this._textureCache=null,super.destroy(e)}};yl.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const vl=[".xml",".fnt"],xl={extension:{type:qt.LoadParser,priority:Bs.Normal},test:e=>vl.includes(Ke.extname(e).toLowerCase()),testParse:async e=>sl.test(e)||al.test(e),async parse(e,t,n){const r=sl.test(e)?sl.parse(e):al.parse(e),{src:i}=t,{page:s}=r,o=[];for(let e=0;e<s.length;++e){const t=s[e].file;let n=Ke.join(Ke.dirname(i),t);n=fo(n,i),o.push(n)}const a=await n.load(o),l=o.map((e=>a[e]));return fl.install(r,l,!0)},load:async(e,t)=>(await Ce.ADAPTER.fetch(e)).text(),unload(e){e.destroy()}};Qt.add(xl);const bl=class extends ka{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(e){return new bl(Object.keys(bl.defaultOptions).reduce(((t,n)=>({...t,[n]:e[n]})),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach((e=>{URL.revokeObjectURL(e.src),e.refs--,0===e.refs&&(e.fontFace&&document.fonts.delete(e.fontFace),delete bl.availableFonts[e.originalUrl])})),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(e,t={}){const{availableFonts:n}=bl;if(n[e]){const t=n[e];return this._fonts.push(t),t.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return Ce.ADAPTER.fetch(e).then((e=>e.blob())).then((async e=>new Promise(((t,n)=>{const r=URL.createObjectURL(e),i=new FileReader;i.onload=()=>t([r,i.result]),i.onerror=n,i.readAsDataURL(e)})))).then((async([r,i])=>{const s=Object.assign({family:Ke.basename(e,Ke.extname(e)),weight:"normal",style:"normal",src:r,dataSrc:i,refs:1,originalUrl:e,fontFace:null},t);n[e]=s,this._fonts.push(s),this.styleID++;const o=new FontFace(s.family,`url(${s.src})`,{weight:s.weight,style:s.style});s.fontFace=o,await o.load(),document.fonts.add(o),await document.fonts.ready,this.styleID++,this.fontsDirty=!0}))}addOverride(...e){const t=e.filter((e=>!this._overrides.includes(e)));t.length>0&&(this._overrides.push(...t),this.styleID++)}removeOverride(...e){const t=e.filter((e=>this._overrides.includes(e)));t.length>0&&(this._overrides=this._overrides.filter((e=>!t.includes(e))),this.styleID++)}toCSS(e){return["display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize*e}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing*e}px`,`text-align: ${this.align}`,`padding: ${this.padding*e}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight*e}px`]:[],...this.wordWrap?["word-wrap: "+(this.breakWords?"break-all":"break-word"),`max-width: ${this.wordWrapWidth*e}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness*e}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness*e}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS(e)]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce(((e,t)=>`${e}\n            @font-face {\n                font-family: "${t.family}";\n                src: url('${t.dataSrc}');\n                font-weight: ${t.weight};\n                font-style: ${t.style}; \n            }`),this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(e){this._stylesheet!==e&&(this._stylesheet=e,this.styleID++)}normalizeColor(e){var t;return Array.isArray(e)&&(t=e,Qe("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),e=At.shared.setValue(t).toNumber()),"number"==typeof e?function(e){return Qe("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),At.shared.setValue(e).toHex()}(e):e}dropShadowToCSS(e){let t=this.normalizeColor(this.dropShadowColor);const n=this.dropShadowAlpha,r=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),i=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&n<1&&(t+=(255*n|0).toString(16).padStart(2,"0"));const s=`${r*e}px ${i*e}px`;return this.dropShadowBlur>0?`text-shadow: ${s} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${s} ${t}`}reset(){Object.assign(this,bl.defaultOptions)}onBeforeDraw(){const{fontsDirty:e}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&e?new Promise((e=>setTimeout(e,100))):Promise.resolve()}get isSafari(){const{userAgent:e}=Ce.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(e)}set fillGradientStops(e){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(e){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(e){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(e){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(e){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(e){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(e){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};let wl=bl;wl.availableFonts={},wl.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};const Sl=class extends ss{constructor(e="",t={}){super(Mr.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this._loading=!1,this.localStyleID=-1,this.dirty=!1,this.ownsStyle=!1;const n=new Image,r=Mr.from(n,{scaleMode:Ce.SCALE_MODE,resourceOptions:{autoLoad:!1}});r.orig=new An,r.trim=new An,this.texture=r;const i="http://www.w3.org/2000/svg",s="http://www.w3.org/1999/xhtml",o=document.createElementNS(i,"svg"),a=document.createElementNS(i,"foreignObject"),l=document.createElementNS(s,"div"),u=document.createElementNS(s,"style");a.setAttribute("width","10000"),a.setAttribute("height","10000"),a.style.overflow="hidden",o.appendChild(a),this.maxWidth=Sl.defaultMaxWidth,this.maxHeight=Sl.defaultMaxHeight,this._domElement=l,this._styleElement=u,this._svgRoot=o,this._foreignObject=a,this._foreignObject.appendChild(u),this._foreignObject.appendChild(l),this._image=n,this._autoResolution=Sl.defaultAutoResolution,this._resolution=Sl.defaultResolution??Ce.RESOLUTION,this.text=e,this.style=t}measureText(e){const{text:t,style:n,resolution:r}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},e);Object.assign(this._domElement,{innerHTML:t,style:n.toCSS(r)}),this._styleElement.textContent=n.toGlobalCSS(),document.body.appendChild(this._svgRoot);const i=this._domElement.getBoundingClientRect();this._svgRoot.remove();const s=Math.min(this.maxWidth,Math.ceil(i.width)),o=Math.min(this.maxHeight,Math.ceil(i.height));return this._svgRoot.setAttribute("width",s.toString()),this._svgRoot.setAttribute("height",o.toString()),t!==this._text&&(this._domElement.innerHTML=this._text),n!==this._style&&(Object.assign(this._domElement,{style:this._style?.toCSS(r)}),this._styleElement.textContent=this._style?.toGlobalCSS()),{width:s+2*n.padding,height:o+2*n.padding}}async updateText(e=!0){const{style:t,_image:n}=this;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;const{width:r,height:i}=this.measureText();n.width=Math.ceil(Math.max(1,r)),n.height=Math.ceil(Math.max(1,i)),this._loading||(this._loading=!0,await new Promise((e=>{n.onload=async()=>{await t.onBeforeDraw(),this._loading=!1,this.updateTexture(),e()};const r=(new XMLSerializer).serializeToString(this._svgRoot);n.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(r)}`})))}get source(){return this._image}updateTexture(){const{style:e,texture:t,_image:n,resolution:r}=this,{padding:i}=e,{baseTexture:s}=t;t.trim.width=t._frame.width=n.width/r,t.trim.height=t._frame.height=n.height/r,t.trim.x=-i,t.trim.y=-i,t.orig.width=t._frame.width-2*i,t.orig.height=t._frame.height-2*i,this._onTextureUpdate(),s.setRealSize(n.width,n.height,r),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}_renderCanvas(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(e)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds(e)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(e){"boolean"==typeof e&&(e={children:e}),e=Object.assign({},Sl.defaultDestroyOptions,e),super.destroy(e);const t=null;this.ownsStyle&&this._style?.cleanFonts(),this._style=t,this._svgRoot?.remove(),this._svgRoot=t,this._domElement?.remove(),this._domElement=t,this._foreignObject?.remove(),this._foreignObject=t,this._styleElement?.remove(),this._styleElement=t,this._image.onload=null,this._image.src="",this._image=t}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(e){this.updateText(!0);const t=Lt(this.scale.x)||1;this.scale.x=t*e/this._image.width/this.resolution,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(e){this.updateText(!0);const t=Lt(this.scale.y)||1;this.scale.y=t*e/this._image.height/this.resolution,this._height=e}get style(){return this._style}set style(e){this._style!==e&&((e=e||{})instanceof wl?(this.ownsStyle=!1,this._style=e):e instanceof ka?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=wl.from(e)):(this.ownsStyle=!0,this._style=new wl(e)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(e){e=String(""===e||null==e?" ":e),e=this.sanitiseText(e),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}sanitiseText(e){return e.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};let _l=Sl;_l.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},_l.defaultMaxWidth=2024,_l.defaultMaxHeight=2024,_l.defaultAutoResolution=!0,e.fps;var Tl,El=i(6540),Cl=function(e,t,n){void 0===n&&(n={});var r=function(e,t,n){return n.key?e.session.ui.listeners[t][n.key]:e.session.ui.listeners[t]}(e,t,n);r&&0!==r.length&&r.forEach((function(e){return e.callback()}))},kl=function(e,t,n){void 0===n&&(n={});var r=(0,El.useState)()[1],i=(0,El.useCallback)((function(){return r({})}),[]);(0,El.useEffect)((function(){var r=e.session.ui.nextListenerId++;return function(e,t,n,r,i){if(i.key)return e.session.ui.listeners[t]||(e.session.ui.listeners[t]={}),void(e.session.ui.listeners[t][i.key]=[{id:123,callback:r}]);e.session.ui.listeners[t]||(e.session.ui.listeners[t]=[]),e.session.ui.listeners[t].push({id:n,callback:r})}(e,t,r,i,n),function(){!function(e,t,n,r){if(r.key){if(!e.session.ui.listeners[t])return;return delete e.session.ui.listeners[t][r.key],void(0===Object.keys(e.session.ui.listeners[t]).length&&delete e.session.ui.listeners[t])}e.session.ui.listeners[t]&&(e.session.ui.listeners[t]=e.session.ui.listeners[t].filter((function(e){return e.id!==n})),0===e.session.ui.listeners[t].length&&delete e.session.ui.listeners[t])}(e,t,r,n)}}),[])},Al=function(e,t,n){void 0===n&&(n={}),e.session.notifications.toast=t,Cl(e,k.Notifications),setTimeout((function(){e.session.notifications.toast=!1,Cl(e,k.Notifications)}),n.duration||5e3)},Ml=function(e,t,n,r){for(var i=t.data.inventory,s=2;s>=-2;s--)for(var o=2;o>=-2;o--){var a=n+o,l=r+s,u=o+2+5*(s+2),c=i.elements[u];if(0!==c&&Hd(e,a,l)){i.elements[u]=0,i.amount--;var h=Ch(c,a,l);Ad(e,a,l,h)}}},Pl=function(){return Pl=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Pl.apply(this,arguments)},Rl=function(r,i,s){i.type===D.Hauler&&function(r,i,s){var o,a,l=i.data,u=l.origin,c=l.target,h={x:i.x,y:i.y},d=i.data.movingToTarget,f=d?c:u;i.data.inventory=null!==(o=i.data.inventory)&&void 0!==o?o:{elements:new Array(25).fill(0),amount:0,targetElementType:null};var p=K.getDistance(h,f),m=100*(1+.5*(r.store.upgrades.hauler.speed.level-1));if(p<=1){if(i.data.pauseTimer=(null!==(a=i.data.pauseTimer)&&void 0!==a?a:0)+s,i.data.pauseTimer>=.2){var g=Math.floor(i.x/e.cellSize),y=Math.floor(i.y/e.cellSize);d?Ml(r,i,g,y):function(e,r,i,s){for(var o=r.data.inventory,a=-2;a<=2;a++)for(var l=-2;l<=2;l++){var u=i+l,c=s+a,h=l+2+5*(a+2);if(0===o.elements[h]){var d=Xd(e,u,c);d&&d!==n.Particle&&!ne.includes(d)&&(Ad(e,u,c,t.Empty),o.elements[h]=d,o.amount++)}}}(r,i,g,y),i.data.movingToTarget=!d,i.data.pauseTimer=0,i.data.currentSpeed=0}}else{var v=m;i.data.currentSpeed=p<50?Math.max(10,p/50*m):Math.min(m,i.data.currentSpeed+v*s);var x=K.getDirection(h,f);i.x+=x.x*i.data.currentSpeed*s,i.y+=x.y*i.data.currentSpeed*s}}(r,i,s)},Il=function(e,t,n){if(n.x=t.x-e.session.camera.x,n.y=t.y-e.session.camera.y,t.type===D.Hauler){var r=t.data.inventory.amount>0?e.session.rendering.pixi.textures.haulerClosed:e.session.rendering.pixi.textures.hauler;n.texture=r;var i=(t.data.movingToTarget?t.data.target:t.data.origin).x-t.x,s=0;if(Math.abs(i)>10){var o=t.data.currentSpeed/100;s=i>0?.2*o:-.2*o}n.rotation=n.rotation+.1*(s-n.rotation)}},Dl=((Tl={})[F.Artifact]="artifact",Tl),Fl=function(e,t,n,r,i){var s={id:e.store.meta.nextId.worldItem++,x:n,y:r,type:t,data:i};return Bc(e,s),Ll(e,"worldItems",Dl[t],s.id,n,r),s},Nl=function(e,t,n){n.x=t.x-e.session.camera.x,n.y=t.y-e.session.camera.y},Ll=function(e,t,n,r,i,s){var o=e.session.rendering.pixi.textures[n],a=new ss(o);a.anchor.set(.5),a.x=i-e.session.camera.x,a.y=s-e.session.camera.y,e.session.rendering.pixi.sprites[t][r]=a,e.session.rendering.pixi.foregroundEntitiesContainer.addChild(a)},Bl=function(e,t,n){e.session.rendering.pixi.foregroundEntitiesContainer.removeChild(e.session.rendering.pixi.sprites[t][n]),delete e.session.rendering.pixi.sprites[t][n]};function Ol(e){var t=function(e){return e*(Math.PI/180)}(e);return function(e){return(e+2*Math.PI)%(2*Math.PI)}(t)}var zl=function(e,t){if(["weapon","shovel","offhandShovel","builder","forearm"].forEach((function(t){e.session.rendering.pixi.sprites.player[t].visible=!1})),t)if(t.type===o.Weapon)switch(e.store.player.inventory.find((function(e){return e.id===t.id})).abilities[0].type){case c.Shoot:e.session.rendering.pixi.sprites.player.weapon.visible=!0;break;case c.Dig:e.session.rendering.pixi.sprites.player.shovel.visible=!0,e.session.rendering.pixi.sprites.player.offhandShovel.visible=!0}else e.session.rendering.pixi.sprites.player.builder.visible=!0,e.session.rendering.pixi.sprites.player.forearm.visible=!0},jl={vaporize:1},Ul={},Gl=50;function Vl(e,t){t.source&&(t.gainNode.gain.setValueAtTime(t.gainNode.gain.value,e.audioContext.currentTime),t.gainNode.gain.linearRampToValueAtTime(0,e.audioContext.currentTime+.05),t.source.stop(e.audioContext.currentTime+.05),t.source=null)}var Hl=function(e,t,n){if(void 0===n&&(n={}),jl[t]){var r=Date.now();if(r-(Ul[t]||0)<jl[t])return;Ul[t]=r}!function(e,t,n){var r,i,s,o,a,l,u,c,h,d,f;void 0===n&&(n={}),n.restart&&t.source&&(t.source.stop(),t.source=null),t.opts.loop?(t.source&&(t.source.stop(),t.source=null),t.source=e.audioContext.createBufferSource(),d=t.source,t.gainNode?t.gainNode.gain.cancelScheduledValues(e.audioContext.currentTime):t.gainNode=e.audioContext.createGain(),f=t.gainNode):(d=e.audioContext.createBufferSource(),t.source=d,f=e.audioContext.createGain()),d.buffer=t.buffer,d.loop=!!t.opts.loop;var p=null!==(i=null!==(r=n.playbackRate)&&void 0!==r?r:t.opts.playbackRate)&&void 0!==i&&i;p&&(d.playbackRate.value=p),t.filter=e.audioContext.createBiquadFilter();var m=n.filters?n.filters[0]:t.opts.filters[0];t.filter.type=m.type,t.filter.frequency.value=null!==(s=m.frequency)&&void 0!==s?s:2e3*Math.random()+100,d.connect(t.filter);var g=null!==(a=null!==(o=n.pan)&&void 0!==o?o:t.opts.pan)&&void 0!==a&&a;t.gainNode=f,!1!==g?(t.panner=e.audioContext.createStereoPanner(),t.panner.pan.value=g,t.filter.connect(t.panner),t.panner.connect(t.gainNode)):t.filter.connect(t.gainNode),t.gainNode.connect(e.audioContext.destination),f.gain.setValueAtTime((null!==(u=null!==(l=n.volume)&&void 0!==l?l:t.opts.volume)&&void 0!==u?u:1)*(n.ignoreGlobalVolume?1:e.globalVolume),e.audioContext.currentTime);var y=null!==(h=null!==(c=n.fadeOut)&&void 0!==c?c:t.opts.fadeOut)&&void 0!==h&&h;y&&f.gain.linearRampToValueAtTime(0,e.audioContext.currentTime+y),t.opts.offset?d.start(0,t.opts.offset):d.start(0),t.start=Date.now()}(e,e.sfx[t],n)},Wl=function(e,t){Vl(e,e.sfx[t])};function Xl(e,t,n){void 0===n&&(n=!1);var r=e.session.soundEngine;if(r.globalVolume=t,function(e){for(var t in e.sfx){var n=e.sfx[t];n.source&&n.gainNode&&Vl(e,n)}}(r),n){var i=e.session.settings.sound.musicVolume/Gl;e.session.music.engine.setVolume(i)}e.session.music.ambient.engine.setVolume(t)}function $l(e){Xl(e,0)}function Yl(e){Xl(e,e.session.settings.sound.sfxVolume/Gl)}var ql,Kl=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},Zl=function(e,t,n,r){var i=function(e,t,n,r){var i=new $a(e.session.rendering.pixi.frames.explosion);e.session.rendering.pixi.foregroundEntitiesContainer.addChild(i),i.anchor.set(.5),i.x=t-e.session.camera.x,i.y=n-e.session.camera.y,i.animationSpeed=.25,i.loop=!1,i.visible=!1;var s=r-e.store.meta.time;return s<=0?(i.visible=!0,i.play()):setTimeout((function(){i.visible=!0,i.play()}),s),i.onComplete=function(){i.parent.removeChild(i),e.session.explosions=e.session.explosions.filter((function(e){return e.sprite!==i}))},i}(e,t,n,r);e.session.explosions.push({x:t,y:n,time:r,sprite:i})},Ql=function(e,t,n,r){var i,s,o;void 0===r&&(r={});var a=Math.max(.5-.05*e.session.explosions.length,.1);if(a>0){var l=Math.min(600,Math.max(t-e.store.player.x,-600))/1e3,u=K.getDistance({x:t,y:n},{x:e.store.player.x,y:e.store.player.y}),c=200/Math.max(200,u);Hl(e.session.soundEngine,"explosion",{playbackRate:200/Math.min(800,Math.max(400,u))*K.getRandomFloatBetween(.5,5),pan:l,volume:c*a*.4}),Hl(e.session.soundEngine,"explosion2",{playbackRate:200/Math.min(800,Math.max(400,u))*K.getRandomFloatBetween(.5,5),pan:l,volume:c*a*.4,fadeOut:.5}),Hl(e.session.soundEngine,"explosion_overlay",{pan:l,volume:(1-c)*a*.5}),r.group&&Hl(e.session.soundEngine,"rocket_explosion",{pan:l,volume:c*a*.1,fadeOut:2})}if(ru(e,t,n,{brightness:null!==(i=r.brightness)&&void 0!==i?i:1.33,duration:null!==(s=r.duration)&&void 0!==s?s:eu,size:null!==(o=r.size)&&void 0!==o?o:tu}),r.group){ru(e,t,n,{brightness:3,duration:10,size:100}),Zl(e,t,n,e.store.meta.time);for(var h=0;h<9;h++){var d=2*Math.PI/9*h,f=t+50*Math.cos(d),p=n+50*Math.sin(d),m=e.store.meta.time+100+K.getRandomIntBetween(0,50);Zl(e,f,p,m)}for(h=0;h<10;h++){d=2*Math.random()*Math.PI;var g=50*Math.random()*2,y=t+g*Math.cos(d),v=n+g*Math.sin(d);m=e.store.meta.time+4*g,Zl(e,y,v,m)}}else Zl(e,t,n,e.store.meta.time)},Jl=function(e,t,n,r,i,s){void 0===s&&(s={}),e.session.effects.push({x:t,y:n,time:e.store.meta.time,sprite:r,duration:i,opts:s})},eu=20,tu=100,nu=function(t,n,r){return{xIndex:Math.floor(n/(t.store.world.size.width*e.cellSize)*t.session.lightZones[0].length),yIndex:Math.floor(r/(t.store.world.size.height*e.cellSize)*t.session.lightZones.length)}},ru=function(e,t,n,r){var i;if(void 0===r&&(r={}),r.useLightZones){i=nu(e,t,n);var s=e.session.lightZones[i.yIndex][i.xIndex];if(s){var o=s.amount++,a=s.light;return a.size=Math.min(1e3,1*a.size+o/2e4),a.x=Math.round(.9*a.x+.1*t),a.y=Math.round(.9*a.y+.1*n),a.tick=e.store.meta.tick,!1}}var l=r.brightness||1,u=r.duration||eu,c=r.size||tu,h=r.color||[1,.5,0,1],d={x:t,y:n,brightness:l,duration:u,tick:e.store.meta.tick,size:c,color:h},f=e.session.lights,p=-1;r.useLightZones&&(e.session.lightZones[i.yIndex][i.xIndex]={amount:1,light:d});for(var m=0;m<f.length;m++){if(null===f[m])return f[m]=d,{index:m,light:d};-1!==f[m].duration&&(-1===p||f[m].tick<f[p].tick)&&(p=m)}return-1!==p?(f[p]=d,{index:p,light:d}):(console.log("Unable to insert light!"),{index:null,light:d})},iu=function(e,t){return e.store.meta.tick-1-t.tick},su=[[92,214,214],[77,209,209]],ou=[K.HSLToRGBA(0,0,60),K.HSLToRGBA(0,0,58),K.HSLToRGBA(0,0,65)],au=((ql={})[t.Bedrock]={name:"Bedrock",interactions:["❌"],background:{model:"rgb",fg:ou[0],bg:ou[1],patternSprite:"backdrop_variant"}},ql[t.Divider]={hp:1,interactions:["⛏️","💥","🔥"]},ql[t.SandSoil]={name:"Sandsoil",interactions:["⛏️","💥"],hp:4,output:{elementType:n.Sand,chance:.5}},ql[t.Grass]={name:"Grass",interactions:["⛏️","💥"],hp:4,colorHSL:[94,45,48],output:{elementType:n.Sand,chance:.5}},ql[t.Moss]={name:"Moss",interactions:["⛏️","💥","🔥"],hp:1,colorHSL:[100,72,47]},ql[t.GoldSoil]={hp:1,output:{elementType:n.Gold,chance:1}},ql[t.Petal]={hp:1,output:{elementType:n.Petalium,chance:1}},ql[t.SporeSoil]={name:"Sporemound",interactions:["⛏️","💥"],hp:4,output:{elementType:n.Spore,chance:.5}},ql[t.Fog]={hp:1,backgroundElementType:n.Sand,fog:!0},ql[t.FogJetpackBlock]={hp:1,background:{model:"rgb",fg:su[0],bg:su[1],patternSprite:"no_jetpack_backdrop"},fog:!0},ql[t.FogWater]={hp:1,backgroundElementType:n.Sand,fog:!0},ql[t.FogLava]={hp:1,backgroundElementType:n.Sand,fog:!0},ql[t.FreezingIceSoil]={name:"Frostbed",interactions:["⛏️","💥"],hp:4,colorHSL:[180,30,95],background:{model:"rgb",fg:su[0],bg:su[1],patternSprite:"no_jetpack_backdrop"},output:{elementType:n.FreezingIce,chance:.5}},ql[t.Fluxite]={name:"Fluxite",interactions:["⛏️","💥"],hp:8,colorHSL:[287,100,44],background:{model:"rgb",fg:K.HSLToRGBA(287,100,44),bg:K.HSLToRGBA(287,100,46)}},ql[t.Ice]={name:"Ice",interactions:["🔥"]},ql[t.SandiumSoil]={name:"Redsoil",interactions:["⛏️","💥"],hp:20,output:{elementType:n.Sandium,chance:.5},colorHSL:[0,100,32]},ql[t.Obsidian]={name:"Scoria",interactions:["⛏️","💥"],hp:40,output:{elementType:n.Basalt,chance:1},colorHSL:[0,100,15]},ql[t.Crackstone]={name:"Crackstone",interactions:["💥"],hp:1,colorHSL:[40,40,80],background:{model:"rgb",fg:K.HSLToRGBA(40,40,64),bg:K.HSLToRGBA(40,40,66)}},ql),lu=function(){return lu=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},lu.apply(this,arguments)},uu=function(e,t){return 1e6*Math.sin(437057.545323*(112.01716*e+718.233*t))&255},cu=function(e,t,n){n/=100;var r=function(t){return(t+e/30)%12},i=(t/=100)*Math.min(n,1-n),s=function(e){return n-i*Math.max(-1,Math.min(r(e)-3,Math.min(9-r(e),1)))};return[Math.round(255*s(0)),Math.round(255*s(8)),Math.round(255*s(4)),255]},hu=e.debug.defaultBaseHue,du=(cu(hu,60,40),cu(hu,60,37),function(e,t,n,r){return e.session.colors.damagedSoilByColor?!!e.session.colors.damagedSoilByColor[t]&&!!e.session.colors.damagedSoilByColor[t][n]&&!!e.session.colors.damagedSoilByColor[t][n][r]:(console.log("NO ISDAMAMS",e.session.colors.damagedSoilByColor),!1)}),fu=function(e){var t;return(t={},t[n.Sand]=hu,t[n.Spore]=75,t[n.FreezingIce]=200,t[n.Petalium]=258,t[n.Sandium]=6,t)[e]},pu=function(e){return[cu(e,54,62),cu(e,59,61),cu(e,62,64),cu(e,68,67)]},mu=function(e,t){void 0===t&&(t=!1);for(var n=[],r=0,i=Object.entries(e);r<i.length;r++)for(var s=i[r],o=s[0],a=s[1],l=parseInt(o),u=t?1:0;u<a.length;u++){var c=Math.round(a[u][0]),h=Math.round(a[u][1]),d=Math.round(a[u][2]);n[c]||(n[c]=[]),n[c][h]||(n[c][h]=[]),n[c][h][d]=l}return n},gu=function(e){for(var t={},n={},r=1,i={},s=0,o=Object.entries(e);s<o.length;s++)for(var a=o[s],l=a[0],u=a[1],c=parseInt(l),h=0;h<u.length;h++){var d=u[h];n[r]=d,i[c]||(i[c]=[]),i[c][h]=r,t[r]=c,r++}return{colorIdByElementType:i,elementColorByColorId:n,colorId:r,elementTypeByColorId:t}},yu=[.9,.7,.65,.45,.4,.32,.2,.05],vu=function(t,n){return e.useMultithreading&&t.environment.context===p.Worker?Ld(n)?t.shared.obstacleImageData:t.shared.imageData:Ld(n)?t.session.rendering.obstacleImageData:t.session.rendering.imageData},xu=function(r,i,s,o,a){var l=function(r,i,s,o){var a,l,u;if(o===t.Empty)return[0,0,0,0];if([t.SandSoil,t.SporeSoil,t.Bedrock,t.Fog,t.FogJetpackBlock,t.FogWater,t.FogLava,t.FreezingIceSoil,t.Ice,t.Divider,t.Grass,t.Moss,t.GoldSoil,t.Petal,t.Fluxite,t.SandiumSoil,t.Obsidian,t.Crackstone].includes(o)){for(var c=!1,h=i-5;h<i+5;h++)for(var d=s-5;d<s+5;d++)if(!(h<0||d<0||h>=r.store.world.matrix.length||d>=r.store.world.matrix[0].length)){var f=h-i,p=d-s,m=Math.sqrt(f*f+p*p);if(!(m>=5))if(e.useMultithreading){var g=r.shared.obstacleImageData,y=4*(h+d*g.width),v=g.data[y],x=g.data[y+1],b=g.data[y+2];(0===g.data[y+3]||du(r,v,x,b))&&(!1===c||c>m)&&(c=m)}else r.store.world.matrix[d][h]!==t.SandSoil&&(!1===c||c>m)&&(c=m)}if(!1===c)return[0,0,0,255];var w=null!==(l=((a={})[t.Bedrock]={H:0,S:0,L:66},a[t.Ice]={H:199,S:99,L:90},a[t.Divider]={H:30,S:100,L:50},a[t.GoldSoil]={H:60,S:100,L:50},a)[o])&&void 0!==l?l:{H:r.session.colors.scheme.soil[o][0][0],S:r.session.colors.scheme.soil[o][0][1],L:r.session.colors.scheme.soil[o][0][2]},S=w.H,_=w.S,T=w.L,E=T-T/4*(c-1);return o===t.Fog?[0,0,0,Math.max(1,10*c)]:cu(S,_,E)}if([t.Block,t.ConveyorLeft,t.ConveyorRight,t.ShakerLeft,t.ShakerRight,t.SlidingBlock,t.SlidingBlockLeft,t.SlidingBlockRight,t.VelocitySoaker,t.Grower].includes(o))return[255,255,255,255];if([t.SandSoil,t.SporeSoil,t.FreezingIceSoil,t.Grass,t.Moss,t.GoldSoil,t.Petal].includes(o.cellType)){var C=(null===(u=au[o.cellType])||void 0===u?void 0:u.hp)||4;return uu(i,s)>o.hp/C*200?r.session.colors.scheme.soil[o.cellType][1]:r.session.colors.scheme.soil[o.cellType][2]}if(o.type===n.Sand)return(k=r.session.colors.scheme.element[n.Sand])[o.variantIndex];if(o.type===n.Particle){var k=r.session.colors.scheme.element[o.element.type];return o.element.type!==n.Sand?k[0]:k[o.element.variantIndex]}if(o.type===n.Water)return r.session.colors.scheme.element[n.Water][0];if(o.type===n.WetSand)return(k=r.session.colors.scheme.element[n.WetSand])[o.variantIndex];if(o.type===n.Slag)return(k=r.session.colors.scheme.element[n.Slag])[o.variantIndex];if(o.type===n.Gold)return(k=r.session.colors.scheme.element[n.Gold])[o.variantIndex];if(o.type===n.Steam)return r.session.colors.scheme.element[n.Steam][0];if(o.type===n.Spore)return(k=r.session.colors.scheme.element[n.Spore])[o.variantIndex];if(o.type===n.Petalium)return(k=r.session.colors.scheme.element[n.Petalium])[o.variantIndex];if(o.type===n.Seed)return(k=r.session.colors.scheme.element[n.Seed])[0];if(o.type===n.WetSpore)return(k=r.session.colors.scheme.element[n.WetSpore])[o.variantIndex];if(o.type===n.BurntSlag)return(k=r.session.colors.scheme.element[n.BurntSlag])[o.variantIndex];if(o.type===n.FreezingIce)return r.session.colors.scheme.element[n.FreezingIce][0];if(o.type===n.Flame)return(k=r.session.colors.scheme.element[n.Flame])[o.variantIndex];if(o.type===n.Fire){var A=o.duration.max-o.duration.left;return y=Math.floor(A/o.duration.max*4),r.session.colors.scheme.element[n.Fire][y]}return o.type===n.Lava?(k=r.session.colors.scheme.element[n.Lava])[o.variantIndex]:o.type===n.Sandium?(k=r.session.colors.scheme.element[n.Sandium])[o.variantIndex]:o.type===n.Gloom?r.session.colors.scheme.element[n.Gloom][0]:o.type===n.Basalt?(k=r.session.colors.scheme.element[n.Basalt])[o.variantIndex]:[255,0,0,255]}(r,i,s,o);if(!l)return console.log("No rgba for cell"),void bu(vu(r,o),i,s,0,105,108,255);if(a){var u=o===t.Empty?vu(r,a):vu(r,o);if(bu(u,i,s,l[0],l[1],l[2],l[3]),o!==t.Empty){var c=vu(r,a);c!==u&&bu(c,i,s,0,0,0,0)}}else bu(vu(r,o),i,s,l[0],l[1],l[2],l[3])},bu=function(e,t,n,r,i,s,o){var a=4*(t+n*e.width);e.data[a+0]=r,e.data[a+1]=i,e.data[a+2]=s,e.data[a+3]=o},wu=function(r,i,s){return o=void 0,a=void 0,u=function(){var o,a,l,u,c,h,d,p,m,g,y,v;return function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}(this,(function(x){switch(x.label){case 0:o=[[i,s]],a=new Set,x.label=1;case 1:return o.length>0?(l=Math.random())<.01?[4,new Promise((function(e){return setTimeout(e,0)}))]:[3,3]:[3,4];case 2:x.sent(),x.label=3;case 3:return l<.2&&o.sort((function(){return Math.random()-.5})),u=o.shift(),c=u[0],h=u[1],e.useMultithreading&&(d=r.environment,(p=K.getThreadIndexFromCellX(c,d.threadMeta.threadCount))!==d.threadMeta.startingIndex)?(r.environment.threadMeta.ports[p].postMessage([f.StartFogReveal,c,h]),[3,1]):a.has("".concat(c,",").concat(h))?[3,1]:(a.add("".concat(c,",").concat(h)),m=kd(r.store,c,h),Number.isInteger(m)&&J.includes(m)?((g=r.session.mainSensorCache.get(c,h))&&(y=g===R.Artifact1?"Zorvix-22":"Q7-Arynth",r.environment.postMessage([f.SpawnWorldItem,F.Artifact,c*e.cellSize,h*e.cellSize,{name:y,sensor:{position:{x:c,y:h}}}])),v=function(e,r,i){return e===t.FogWater?Ch(n.Water,r,i):e===t.FogLava?Ch(n.Lava,r,i):t.Empty}(m,c,h),Ad(r,c,h,v),o.push([c+1,h]),o.push([c-1,h]),o.push([c,h+1]),o.push([c,h-1]),[3,1]):(Nu(r,c,h,4),[3,1]));case 4:return[2]}}))},new((l=void 0)||(l=Promise))((function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):function(e){return e instanceof l?e:new l((function(t){t(e)}))}(t.value).then(n,r)}i((u=u.apply(o,a||[])).next())}));var o,a,l,u},Su=yu.length,_u=function(e,r,i,s,o){return void 0===o&&(o=!1),r===t.Empty?M.None:Bd(r)?function(e,t){var r=t.type,i=t.variantIndex;if(t.type===n.Particle&&(r=t.element.type,i=t.element.variantIndex),t.type===n.Fire){var s=t.duration.max-t.duration.left;i=Math.floor(s/t.duration.max*4)}return e.session.colors.colorIdByElementType[r][i]||e.session.colors.colorIdByElementType[r][0]}(e,r):Ld(r)?function(e,t,n,r,i){var s;if(Number.isInteger(t))return function(e,t,n,r,i){if(J.includes(t))return M.Darkness;var s=e.session.colors.colorIdByGroundCellType[t];if(void 0===s)return M.Misc;for(var o=!1,a=n-5;a<n+5;a++)for(var l=r-5;l<r+5;l++)if(!(i||a<0||l<0||a>=e.store.world.matrix.length||l>=e.store.world.matrix[0].length)){var u=a-n,c=l-r,h=Math.sqrt(u*u+c*c);if(!(h>=5)){var d=e.shared.mapData,f=a+l*d.width,p=d.data[f],m=e.session.colors.colorByColorId[p];(!qd(p)||m&&du(e,m[0],m[1],m[2]))&&(!1===o||o>h)&&(o=h)}}return!1===o?M.Darkness:s[0===o?0:Math.round((o-1)/5*(Su+3))]}(e,t,n,r,i);var o=t.cellType,a=e.session.colors.colorIdByGroundCellType[o];if(void 0===a)return M.Misc;var l=(null===(s=au[t.cellType])||void 0===s?void 0:s.hp)||4,u=t.hp/l*200;return a[uu(n,r)>u?Su+1:Su+2]}(e,r,i,s,o):(console.log("This should never happen!"),M.Misc)},Tu={unlock_guns_1:{title:"Unlock Guns 1",nextObjectives:["unlock_tools_1","unlock_refining_2"],check:function(e){return!0===e.store.player.tech[w.Guns1]}},unlock_tools_1:{title:"Unlock Tools 1",nextObjectives:["melt_ice","vaporize_water"],check:function(e){return!0===e.store.player.tech[w.Tools1]}},find_fluxite:{title:"Find Fluxite",nextObjectives:["upgrade_grabber"],check:function(e){return e.store.resources.fluxite>0}},melt_ice:{title:"Melt Ice"},vaporize_water:{title:"Vaporize Water",nextObjectives:["let_it_rain"]},let_it_rain:{title:"Let it rain",description:"Steam becomes rain when it reaches the sky."},find_artifacts:{title:"Find Artifacts",counter:{current:function(e){return e.store.resources.artifacts||0},required:2},check:function(e){return(e.store.resources.artifacts||0)>=2}},hover:{title:"Hover",description:"Press [SPACE] while in air to hover."},upgrade_grabber:{title:"Upgrade Grabber"},unlock_refining_2:{title:"Unlock Refining 2",nextObjectives:["unlock_guns_2"],check:function(e){return!0===e.store.player.tech[w.Refining2]}},unlock_guns_2:{title:"Unlock Guns 2",check:function(e){return!0===e.store.player.tech[w.Guns2]}}},Eu=["unlock_guns_1","find_fluxite","hover","find_artifacts"],Cu=function(e){e.store.objectives={active:Eu.map((function(e){return{id:e,completed:!1}}))}},ku=function(e,t){var n=e.store.objectives.active.find((function(e){return e.id===t}));if(n&&!n.completed){var r=Tu[t];r&&(n.completed=!0,r.nextObjectives&&r.nextObjectives.forEach((function(t){e.store.objectives.active.push({id:t,completed:!1})})),setTimeout((function(){e.store.objectives.active=e.store.objectives.active.filter((function(e){return e.id!==t})),Cl(e,k.Objectives)}),5e3),Cl(e,k.Objectives))}},Au=function(e,t){void 0===t&&(t=!1),e.store.objectives.active.forEach((function(n){if(!n.completed){var r=Tu[n.id];r&&(t&&r.counter&&Cl(e,k.Objectives),r.check&&r.check(e)&&ku(e,n.id))}}))},Mu=function(e,t){ku(e,t)},Pu=function(){return Pu=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Pu.apply(this,arguments)},Ru=function(e,n,r,i,s,o){void 0===o&&(o={fromRocketExplosion:!1});var a=kd(e.store,n,r);if(Nd(a)){if(Number.isInteger(a)){if(a===t.Crackstone&&!o.fromRocketExplosion)return;var l=a,u=au[l],c=u.hp-s;return c<=0?void Iu(e,u,l,n,r,i):void Ad(e,n,r,{cellType:l,hp:c})}var h=a.hp-s;h>0?(a.hp=h,Ad(e,n,r,a)):Iu(e,au[a.cellType],a.cellType,n,r,i)}},Iu=function(e,n,r,i,s,o){if(n.fog)wu(e,i,s);else if(r===t.Fluxite)e.environment.postMessage([f.IncrementFluxite,i,s]),e.environment.postMessage([f.SpawnFluxiteParticles,i,s]),Ad(e,i,s,t.Empty);else if(n.output&&Math.random()<n.output.chance){var a=Ch(n.output.elementType,i,s);ie(e,a,{x:K.getRandomFloatBetween(.5*-o.x,-o.x),y:-Math.abs(o.y)*K.getRandomFloatBetween(1,1.3)})}else Ad(e,i,s,t.Empty)},Du=0,Fu=function(t,n,r,i,s,o){for(var a=0;a<i.length;a++)for(var l=0;l<i[a].length;l++)if(0!==i[a][l]){var u=Math.floor(i.length/2),c=n+l-u,h=r+a-u;if(!(h<5)){if(e.useMultithreading){var d=t.environment;if(K.getThreadIndexFromCellX(c,d.threadMeta.threadCount)!==d.threadMeta.startingIndex)continue}Ru(t,c,h,s,o)}}Nu(t,n,r,i.length)},Nu=function(t,n,r,i){for(var s=-i;s<=i;s+=1)for(var o=-i;o<=i;o+=1){if(e.useMultithreading){var a=t.environment;if(K.getThreadIndexFromCellX(n+o,a.threadMeta.threadCount)!==a.threadMeta.startingIndex)continue}var l=n+o,u=r+s,c=kd(t.store,l,u);xu(t,l,u,c);var h=l+u*t.shared.mapData.width;t.shared.mapData.data[h]=_u(t,c,l,u)}},Lu=function(e,t,n){return!!Bu(e,t,n)&&(t.last=e.meta.time,!0)},Bu=function(e,t,n){var r=null!=n?n:t.time;return t.last<=e.meta.time-r},Ou=("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ/:§?,".split(""),function(e){e.store.tutorial.transitioningToNextStep=e.store.meta.time,Cl(e,k.Tutorial)}),zu=function(t,n,r){if(t.store.tutorial.active&&t.store.scene.active===x.Game&&!t.store.tutorial.transitioningToNextStep&&t.store.tutorial.currentStep===n){switch(n){case b.Dig:if(t.store.tutorial.data.amount++,Cl(t,k.Tutorial),t.store.tutorial.data.amount<5)return;break;case b.Hotbar:if(1!==r)return;return void Ou(t);case b.PickUpSand:var i=e.useMultithreading?t.shared.grabber[1]:r.tool.data[1];if(Cl(t,k.Tutorial),i<5)return;break;case b.RefineWetSand:if(t.store.tutorial.data.amount++,Cl(t,k.Tutorial),t.store.tutorial.data.amount<3)return;break;case b.SellGold:if(Cl(t,k.Tutorial),t.store.resources.gold<20)return;break;case b.OpenTechTree:setTimeout((function(){t.store.player.tech[w.Refining1]&&zu(t,b.UnlockRefining)}),5e3);break;case b.BuildShaker:if(![d.ShakerLeft,d.ShakerRight].includes(r))return;if(t.store.tutorial.data.amount++,Cl(t,k.Tutorial),t.store.tutorial.data.amount<5)return;break;case b.RefineGoldWithShaker:setTimeout((function(){t.store.player.tech[w.Logistics1]&&zu(t,b.UnlockLogistics)}),5e3)}Ou(t)}},ju=function(e){switch(e){case b.Move:return{sides:!1,up:!1};case b.Dig:case b.RefineWetSand:case b.BuildShaker:return{amount:0};default:return{}}},Uu=[{name:"Tools",id:"tools",items:[{name:"Grabber",id:"grabber",upgrades:[{name:"Material Scanner",id:"scanner",description:"Shows more information about materials when hovering",maxLevel:2,costs:[100]}]},{name:"Jetpack",id:"jetpack",upgrades:[{name:"Thrust Amplifier",id:"speed",description:"Increases flight and movement speed",maxLevel:3,costs:[500,1e3]}]},{name:"Flamethrower",id:"flamethrower",requirement:{item:l.Flamethrower},upgrades:[{name:"Extended Range",id:"range",description:"Increases the range of the flames (+25% per level)",maxLevel:3,costs:[800,1200]}]}]},{name:"Weapons",id:"weapons",items:[{name:"Shovel",id:"shovel",upgrades:[{name:"Quick Dig",id:"speed",description:"Reduces digging cooldown",maxLevel:4,costs:[500,500,500]}]},{name:"Gun",id:"gun",requirement:{item:l.Gun},upgrades:[{name:"Rapid Fire",id:"speed",description:"Increases firing rate",maxLevel:4,costs:[500,500,500]},{name:"Triple Burst",id:"bullets",description:"Increases bullets per shot (x3)",maxLevel:2,costs:[1e3],oneOff:!0}]},{name:"Rocket Launcher",id:"rocketLauncher",requirement:{item:l.RocketLauncher},upgrades:[{name:"Quick-Load System",id:"reload",description:"Reduces reload time",maxLevel:3,costs:[500,500]},{name:"Extended Magazine",id:"maxAmmo",description:"Increases max ammo",maxLevel:3,costs:[500,500]},{name:"Incendiary Warhead",id:"napalm",description:"Launches a napalm rocket that explodes into a fireball",maxLevel:2,costs:[1e3],oneOff:!0}]}]},{name:"Drones",id:"drones",requirement:{tech:w.Drones1},items:[{name:"Hauler",id:"hauler",requirement:{item:l.Hauler},upgrades:[{name:"Drone Fleet",id:"maxDrones",description:"Increases the maximum number of hauler drones (+2)",maxLevel:6,costs:[1e3,2e3,3e3,4e3,5e3]},{name:"Quantum Propulsion",id:"speed",description:"Increases drone movement speed (+25% per level)",maxLevel:4,costs:[1500,2e3,2500]}]},{name:"Digger",id:"digger",requirement:{item:l.Bouncer},upgrades:[{name:"Rapid Deployment",id:"cooldown",description:"Reduces the cooldown between launching diggers",maxLevel:4,costs:[1e3,1500,2e3]},{name:"Reinforced Hull",id:"hp",description:"Increases the number of bedrock hits before destruction",maxLevel:6,costs:[800,1200,1600,2e3,2500]}]}]}],Gu={gun:.15,shovel:.15,rocketLauncher:.25,digger:.25};function Vu(e,t,n){return e*(1-(t-1)*(Gu[n]||.25))}var Hu={1:[P.NoJetpack,P.NoGrab,P.NoBuild,P.NoFlamethrower],2:[P.NoBuild,P.NoGrab,P.NoFlamethrower],3:[P.NoBuild]},Wu={"255, 0, 0":1,"255, 255, 0":2,"255, 255, 255":3},Xu=function(e,t,n,r){var i=4*(n+r*t.width),s=t.data[i+0],o=t.data[i+1],a=t.data[i+2];if(0!==t.data[i+3]){var l=Wu["".concat(s,", ").concat(o,", ").concat(a)]||0,u=n+r*t.width;e.shared.authorization.data[u]=l}},$u=function(e,t,n,r,i,s){return void 0===s&&(s={}),Yu(e,t,n,r,i,s).authorized},Yu=function(t,r,i,s,o,a){void 0===a&&(a={});var l=oe.get(t.session,"structures",Math.floor(i/e.snapGridCellSize)*e.snapGridCellSize,Math.floor(s/e.snapGridCellSize)*e.snapGridCellSize);if(!l)return{authorized:!0};if(l.type===d.Collector&&r.type!==n.Gold)return{authorized:!1,isFilter:!1};var u=!1;if(l.filter){if(u=!0,a.isDiagonalCheck)return{authorized:!1,isFilter:u};var c="allow"===l.filter.mode,h=!0;return l.filter.density&&r.density<l.filter.density&&(h=!1),l.filter.elementType&&((Array.isArray(l.filter.elementType)?l.filter.elementType:[l.filter.elementType]).includes(r.type)||(h=!1)),{authorized:c?h:!h,isFilter:u}}return o?{authorized:!0,isFilter:u}:l.queued?{authorized:!1,isFilter:u}:{authorized:!0,isFilter:u}},qu=function(t,n){if(n.y<600)return!1;var r={x:Math.round((t.store.player.x+t.store.player.width/2)/e.cellSize),y:Math.round((t.store.player.y+t.store.player.height-1)/e.cellSize)},i=r.x,s=r.y,o=t.shared.authorization.data[i+s*t.shared.authorization.width];return!(Hu[o]||[]).includes(P.NoJetpack)},Ku=function(e,t,n){var r=e.shared.authorization.data[t+n*e.shared.authorization.width];return!(Hu[r]||[]).includes(P.NoGrab)},Zu=.4,Qu=Zu,Ju=null,ec=0,tc=[[0,0,0,0,1,1,1,0,0,0,0],[0,0,1,1,1,1,1,1,1,0,0],[0,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,0],[1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1],[0,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,0],[0,0,1,1,1,1,1,1,1,0,0],[0,0,0,0,1,1,1,0,0,0,0]],nc=function(e,t,n,r,i){Fu(e,n,r,tc,i,8)},rc=function(t,n){var r,i,s,o=K.getGunArmAxis(t.store.player),a=K.getAngle(o,t.session.input.mouse.worldPosition),l=K.getPointFromAngleAndDistance(o,a,6*e.cellSize);(null===(r=n.opts)||void 0===r?void 0:r.noMuzzleFlash)||t.session.rendering.pixi.sprites.player.muzzleFlash.visible||(t.session.rendering.pixi.sprites.player.muzzleFlash.visible=!0,t.session.rendering.pixi.sprites.player.muzzleFlash.gotoAndPlay(0)),(null===(i=n.opts)||void 0===i?void 0:i.noMuzzleFlash)||ru(t,l.x,l.y,{brightness:1,duration:10});var u=Rc(t,l.x,l.y,a,n);if(null===(s=n.opts)||void 0===s?void 0:s.tracerLight){var c=ru(t,l.x,l.y,n.opts.tracerLight);c&&null!==c.index&&(u.tracerLightIndex=c.index)}return u},ic=function(t,n){var r=K.getGunArmAxis(t.store.player),i=K.getAngle(r,t.session.input.mouse.worldPosition),s=K.getPointFromAngleAndDistance(r,i,6*e.cellSize),o={x:Math.round(s.x/e.cellSize),y:Math.round(s.y/e.cellSize)},a=o.x,l=o.y;console.log(i),K.getCoordinatesFromAngleAndDistance({x:a,y:l},i,10).forEach((function(e){var r=e.x,i=e.y;Ad(t,r,i,Ch(n,r,i))}))},sc=function(){return{id:l.RocketLauncher,itemType:a.Weapon,abilities:[{type:c.Shoot,cooldown:{time:400,last:0},attributes:{projectileBlueprint:{opts:{speed:100,duration:3,tracerLight:{brightness:.8,duration:-1,size:20}},type:s.Rocket,attributes:{cooldowns:{emitSmoke:{time:100,last:0}}}}}}],name:"Rocket Launcher",description:"Shoot a hole with rockets."}},oc=function(){return{id:l.Flamethrower,itemType:a.Weapon,abilities:[{type:c.Shoot,cooldown:{time:167,last:0},attributes:{projectileBlueprint:{opts:{speed:240,duration:.64,noMuzzleFlash:!0,tracerLight:{brightness:.8,duration:-1,size:70}},type:s.Fire,attributes:{cooldowns:{emitFire:{time:16,last:0}}}}}}],name:"Flamethrower",description:"Melt ice and burn stuff. Note: Firn (solid snow) needs to be dug out before burnt."}},ac=function(e){return 3+e.store.upgrades.rocketLauncher.maxAmmo.level-1},lc=function(e,t){if(t){var n=e.store.player.inventory.find((function(e){return e.itemType===a.Weapon&&e.id===t.id}));n&&n.abilities[0].type===c.Shoot&&n.abilities[0].attributes.projectileBlueprint.type===s.Fire&&(Wl(e.session.soundEngine,"flamethrower"),Wl(e.session.soundEngine,"flamethrower_overlay"))}},uc=function(e){var t=e.store.projectiles.find((function(e){return e.type===s.GrapplingHook}));t&&Ic(e,t),e.store.player.grapplingHook=!1},cc=function(e,t,n){if(void 0===n&&(n=!1),n||e.session.action.state[u.Start]){if(e.store.player.grapplingHook)return void uc(e);rc(e,{opts:{speed:1200},type:s.GrapplingHook,attributes:{}}),e.store.player.grapplingHook={fireTime:e.store.meta.time,eyelet:!1}}e.session.action.state[u.End]&&e.store.player.grapplingHook&&uc(e)},hc=function(){return hc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},hc.apply(this,arguments)},dc=function(e,t){return{x:e.x*t,y:e.y*t}},fc=[[0,0,0,0,1,1,1,0,0,0,0],[0,0,1,1,1,1,1,1,1,0,0],[0,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,0],[1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1],[0,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,0],[0,0,1,1,1,1,1,1,1,0,0],[0,0,0,0,1,1,1,0,0,0,0]],pc=function(e,t,n,r){var i=K.getVelocityFromAngle(t.initialAngle);i.x*=60,i.y*=60,Fu(e,n,r,fc,i,1)},mc=function(t,n,r,i){void 0===i&&(i={});var s,o=t.store,a=n.x,l=n.y,u=a-r.x,c=l-r.y,h=Math.abs(u)>Math.abs(c),d=u<0?1:-1,f=c<0?1:-1,p=Math.max(Math.abs(u),Math.abs(c)),m=Math.min(Math.abs(u),Math.abs(c)),g=0==m||0==p?0:m/p,y={x:a,y:l};if(0===p)return!1;for(var v=1;v<=p;v++){s=Math.round(v*g);var x=void 0,b=void 0;h?(b=v,x=s):(x=v,b=s);var w=l+x*f,S=a+b*d,_=Math.floor(S/e.cellSize),T=Math.floor(w/e.cellSize);if(e.useMultithreading){var E=t.shared.obstacleImageData,C=4*(_+T*E.width),k=E.data[C],A=E.data[C+1],M=E.data[C+2];if(E.data[C+3]>0&&(255!==k||255!==A||255!==M||!i.ignoreStructures))return{x:S,y:w,cX:_,cY:T,collidedCell:!0,lastFreePosition:y}}else{var P=kd(o,_,T);if(Nd(P))return{x:S,y:w,cX:_,cY:T,collidedCell:P,lastFreePosition:y}}if(S===r.x&&w===r.y)return{x:S,y:w,cX:_,cY:T,collidedCell:null};y={x:S,y:w}}},gc={init:function(t){t.session.lookup.conveyorBeltsGroupedByX=[];for(var n=function(n){t.session.lookup.conveyorBeltsGroupedByX.push(function(e){for(var t={},n=0,r=e;n<r.length;n++)t[r[n]]=[];return t}(te)),K.getThreadIndexFromCellX(n,t.environment.threadMeta.threadCount)===t.environment.threadMeta.startingIndex&&t.store.structures.forEach((function(r){r.x===n&&te.includes(r.type)&&t.session.lookup.conveyorBeltsGroupedByX[n/e.snapGridCellSize][r.type].push(r)}))},r=0;r<Math.floor(t.store.world.size.width/e.snapGridCellSize)*e.snapGridCellSize;r+=e.snapGridCellSize)n(r)},set:function(t,n,r){if("conveyorBeltsGroupedByX"===n)return function(t,n){t.session.lookup.conveyorBeltsGroupedByX[n.structure.x/e.snapGridCellSize][n.structure.type].push(n.structure)}(t,r)},remove:function(t,n,r){if("conveyorBeltsGroupedByX"===n){var i=r.structure,s=i.x,o=i.type,a=s/e.snapGridCellSize,l=t.session.lookup.conveyorBeltsGroupedByX[a][o],u=l.findIndex((function(e){return e.type===r.structure.type&&e.x===r.structure.x&&e.y===r.structure.y}));if(-1!==u)return l.splice(u,1);console.error("Could not find structure to remove in lookup",r.structure,l)}}};const yc=gc;var vc,xc,bc=function(){return bc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},bc.apply(this,arguments)},wc=1e3/e.fps*20,Sc=function(e,t){var n=e.store.meta.time-t.time,r=2*(1-(t.duration-n)/t.duration);(r*=Math.sin(Math.PI*n/t.duration))<.5&&n<t.duration/2&&(r=.5),r*=t.size;var i=1-(t.duration-n)/t.duration;i>.25&&(i=.25),t.sprite.alpha=i,t.sprite.scale.set(r,r),t.sprite.x=t.x-e.session.camera.x,t.sprite.y=t.y-e.session.camera.y},_c=function(e){return null!==e&&e.type===d.Collector},Tc=function(e,t){return!!zd(t,n.Gold)||!(!zd(t,n.Particle)||t.element.type!==n.Gold)},Ec=function(e,t,n,r){if(Tc(0,t)){var i=Dc(e,n.x,n.y),s=Dc(e,r.x,r.y),o=_c(i),a=_c(s);o&&Cc(e,i,1),a&&Cc(e,s,-1),o&&!a?Ac(e,n):!o&&a&&Mc(e,n)}},Cc=function(e,t,n,r){void 0===r&&(r=!1),t.data||(t.data={gold:0}),r?t.data.gold=n:t.data.gold+=n;var i=t.data.gold>0;t.data.hasGold!==i&&(t.data.hasGold=i,e.environment.context===p.Main?e.environment.multithreading.simulation.postAll(e,[f.UpdateStructure,t]):e.environment.postMessage([f.UpdateStructure,t]))},kc=function(t,n,r,i,s){if(Tc(0,n)){var o=Dc(t,r,i);o&&o.type===d.Collector&&("add"===s?(Cc(t,o,1),Ac(t,{x:o.x*e.cellSize,y:o.y*e.cellSize})):(Cc(t,o,-1),Mc(t,{x:o.x*e.cellSize,y:o.y*e.cellSize})))}},Ac=function(e,t){e.environment.postMessage([f.Collector,1,t])},Mc=function(e,t){e.environment.postMessage([f.Collector,-1,t])},Pc=function(t){e.useMultithreading&&(t.store.resources.gold=0,Cl(t,k.Resources),t.environment.multithreading.simulation.postAll(t,[f.Tally]))},Rc=function(e,t,n,r,i){var o=function(e,t,n,r,i){var s,o,a,l,u,c=r+(null!==(o=null===(s=i.opts)||void 0===s?void 0:s.angle)&&void 0!==o?o:0);return hc({id:e,x:t,y:n,initialAngle:c,velocity:dc(K.getVelocityFromAngle(c),null!==(l=null===(a=i.opts)||void 0===a?void 0:a.speed)&&void 0!==l?l:1),threshold:{x:0,y:0},duration:(null===(u=i.opts)||void 0===u?void 0:u.duration)?{max:i.opts.duration,left:i.opts.duration}:{max:-1}},{type:i.type,attributes:JSON.parse(JSON.stringify(i.attributes))})}(e.store.meta.nextId.projectile++,t,n,r,i);if(o.type===s.Rocket&&e.store.upgrades.rocketLauncher.napalm.level>=2&&(o.attributes.napalm=!0),o.type===s.Bouncer&&(o.attributes.hp=e.store.upgrades.digger.hp.level),o.type===s.Fire){var a=o.duration.max*(1+.25*(e.store.upgrades.flamethrower.range.level-1));o.duration.max=a,o.duration.left=a}e.store.projectiles.push(o);var l=function(e){switch(e){case s.Bullet:return"bullet";case s.Rocket:return"rocket";case s.Bouncer:return"bouncer";default:return null}}(o.type);return null!==l&&Ll(e,"projectiles",l,o.id,t,n),o},Ic=function(e,t){void 0!==t.tracerLightIndex&&function(e,t){e.session.lights[t]=null}(e,t.tracerLightIndex),e.store.projectiles=e.store.projectiles.filter((function(e){return e.id!==t.id})),Bl(e,"projectiles",t.id)},Dc=function(t,n,r){var i=Math.floor(n/e.cellSize)*e.cellSize,s=Math.floor(r/e.cellSize)*e.cellSize;return t.session.cache.structures[s]&&t.session.cache.structures[s][i]||null},Fc=function(e,t,n,r,i){return e.session.visualParticles.push(function(e,t,n,r,i){var s=function(e,t,n,r){var i=Mr.from(e.session.rendering.images.fume_particle.image),s=new ss(i);return s.anchor.set(.5),s.x=t-e.session.camera.x,s.y=n-e.session.camera.y,r&&void 0!==r.color&&(s.tint=r.color),((null==r?void 0:r.background)?e.session.rendering.pixi.backgroundEntitiesContainer:e.session.rendering.pixi.foregroundEntitiesContainer).addChild(s),s}(e,t,n,i),o=bc({x:t,y:n,velocity:r,threshold:{x:0,y:0},duration:(null==i?void 0:i.lifetime)?1e3*i.lifetime:wc,time:e.store.meta.time,sprite:s,size:(null==i?void 0:i.size)||1},(null==i?void 0:i.background)?{background:!0}:{});return Sc(e,o),o}(e,t,n,r,i))},Nc=function(e,t){e.store.drones.push(t)},Lc=function(e,t){e.store.drones=e.store.drones.filter((function(e){return e.id!==t.id}))},Bc=function(e,t){e.store.worldItems.push(t)},Oc=function(e,t){var r=e.store;if(t.type!==n.Particle&&!r.machineryEngine.runLaunchers)return!1;var i=Dc(e,t.x,t.y);if(!i)return!1;if(![d.LauncherUp,d.LauncherLeft,d.LauncherRight].includes(i.type))return!1;var s=jc(i.type);return t.type===n.Particle?(0===s.x?t.velocity.y=s.y:t.velocity=s,Fd(e,t.x,t.y)):ie(e,t,s),!0},zc=[.54*60,44.4],jc=function(e){switch(e){case d.LauncherUp:return{x:0,y:-K.getRandomFloatBetween(zc[0],zc[1])};case d.LauncherLeft:return{x:-K.getRandomFloatBetween(zc[0],zc[1]),y:-K.getRandomFloatBetween(zc[0],zc[1])};case d.LauncherRight:return{x:K.getRandomFloatBetween(zc[0],zc[1]),y:-K.getRandomFloatBetween(zc[0],zc[1])}}},Uc=function(t,r,i,s,o){void 0===o&&(o=1);var a=Hc(s);if(a||(a=Vc(i)),e.useMultithreading,a){var l=Math.sign(a.x),u=Math.sign(a.y),c=Math.ceil(Math.abs(a.x))*l,p=Math.ceil(Math.abs(a.y))*u;if(1===o&&[d.ShakerLeft,d.ShakerRight].includes(s)&&r.type===n.WetSand)!function(t,r){var i=Ch(n.Slag,r.x,r.y);i.isFreeFalling=!1,Ad(t,r.x,r.y,i),Math.random()>=.25||(t.store.tutorial.active&&t.environment.postMessage([f.TutorialStep,b.RefineGoldWithShaker]),Ad(t,r.x,r.y+2,Ch(n.Gold,r.x,r.y+2)),t.environment.postMessage([f.PlaySound,[{id:"coin",opts:{volume:.2,fadeOut:K.getRandomFloatBetween(.1,2),playbackRate:K.getRandomFloatBetween(.5,1.5)},modulateDistance:{x:r.x*e.cellSize,y:r.y*e.cellSize}}]]))}(t,r);else{var m={x:r.x+c,y:r.y+p},g=K.iterateToAndGetLastPosFulfillingCondition(r,m,(function(n,i){if(!$u(t,r,n,i,function(t,n){var r=oe.get(t.session,"structures",Math.floor(n.x/e.snapGridCellSize)*e.snapGridCellSize,Math.floor(n.y/e.snapGridCellSize)*e.snapGridCellSize);return!!r&&(r.filter||r.queued)}(t,r)))return!1;if(e.useMultithreading){var s=t.shared.imageData,o=4*(n+i*s.width);if(0!==t.shared.obstacleImageData.data[o+3])return!1;if(0===s.data[o+3])return!0;var a=t.session.colors.elementByColor[s.data[o]][s.data[o+1]][s.data[o+2]];return ne.includes(a)}var l=kd(t.store,n,i);return Gd(l,ne)}));if(g.x!==r.x||g.y!==r.y){var y=kd(t.store,r.x,r.y-1);if(Bd(y)&&Ph(y,[h.Solid,h.Slushy,h.Wisp])&&(o>100?console.log("more than 100 distanceToConveyor",r.x,r.y):Uc(t,y,i,s,o+1)),Gc(t,r,o,g)&&(r.isFreeFalling=!0),e.useMultithreading){var v=t.shared.imageData,x=4*(g.x+g.y*v.width),w=0!==v.data[x+3]?t.session.colors.elementByColor[v.data[x]][v.data[x+1]][v.data[x+2]]:null;null!==w&&ne.includes(w)?Wd(t,r,g.x,g.y,{eager:w}):Md(t,r,g.x,g.y)}else{var S=kd(t.store,g.x,g.y);zd(S,ne)?Pd(t,r,S):Md(t,r,g.x,g.y)}}else Fd(t,r.x,r.y)}}else console.log("No beltVelocity",s,i)},Gc=function(t,n,r,i){if(1!==r)return!1;if(e.useMultithreading){var s=t.environment;if(!K.isCellXInThread(i.x,s.threadMeta.startingIndex,s.threadMeta.threadCount)){var o=t.shared.imageData,a=4*(i.x+(i.y+1)*o.width);if(o.data[a+3]>0)return!1;if(t.shared.obstacleImageData.data[a+3]>0)return!1}}var l=kd(t.store,i.x,i.y+1);return!!Ud(l)},Vc=function(n){var r=e.conveyorDefaultSpeed;switch(n){case t.ConveyorLeft:return{x:-r,y:0};case t.ConveyorRight:return{x:r,y:0}}},Hc=function(e){switch(e){case d.ShakerLeft:case d.FilterLeft:return{x:-.005,y:0};case d.ShakerRight:case d.FilterRight:return{x:.005,y:0}}return!1},Wc=((vc={})[n.Water]=[[n.Sand,n.WetSand],[n.Spore,n.WetSpore],[n.Lava,n.Steam],[n.Flame,n.Steam]],vc[n.Sand]=[[n.Water,n.WetSand]],vc[n.Spore]=[[n.Water,n.WetSpore]],vc[n.Lava]=[[n.Water,n.Steam]],vc[n.Flame]=[[n.Water,n.Steam]],vc[n.Sandium]=[[n.Petalium,n.Gloom]],vc[n.Petalium]=[[n.Sandium,n.Gloom]],vc),Xc={},$c=function(r,i,s){if(Xc[i.type]===s.type)return Ad(r,s.x,s.y,t.Empty),!0;if(Xc[s.type]===i.type)return Ad(r,i.x,i.y,t.Empty),!0;var o=Wc[s.type];return!!o&&o.some((function(o){return i.type===o[0]&&(Ad(r,i.x,i.y,Ch(o[1],i.x,i.y)),e.useMultithreading&&(o[1]===n.WetSand?r.environment.postMessage([f.PlaySound,[{id:"splash",opts:{volume:.01,fadeOut:K.getRandomFloatBetween(.1,2),playbackRate:K.getRandomFloatBetween(.1,.7)},modulateDistance:{x:s.x*e.cellSize,y:s.y*e.cellSize}},{id:"splash_2",opts:{volume:.025,playbackRate:K.getRandomFloatBetween(.1,1)},modulateDistance:{x:s.x*e.cellSize,y:s.y*e.cellSize}}]]):o[1]===n.Steam&&r.environment.postMessage([f.PlaySound,[{id:"vaporize",opts:{volume:.1,fadeOut:K.getRandomFloatBetween(.1,.5),playbackRate:K.getRandomFloatBetween(.5,1.5)},modulateDistance:{x:s.x*e.cellSize,y:s.y*e.cellSize}}]])),[i.type,s.type].includes(n.Spore)||[i.type,s.type].includes(n.Lava)?Ad(r,s.x,s.y,t.Empty):Ad(r,s.x,s.y,Ch(o[1],s.x,s.y)),e.useMultithreading?r.store.tutorial.active&&r.environment.postMessage([f.TutorialStep,b.WetSand]):zu(r,b.WetSand),!0)}))},Yc=function(r,i,s){return!(s!==t.VelocitySoaker||i.type!==n.BurntSlag||i.velocity.y<200||!qc(r,i.x,i.y,n.Spore)||(Rd(r,i),qc(r,i.x,i.y,n.Gold),r.environment.postMessage([f.PlaySound,[{id:"coin",opts:{volume:.2,fadeOut:K.getRandomFloatBetween(.1,2),playbackRate:K.getRandomFloatBetween(.5,1.5)},modulateDistance:{x:i.x*e.cellSize,y:i.y*e.cellSize}}]]),0))},qc=function(t,n,r,i){for(var s=[{x:Math.floor(n/e.snapGridCellSize)*e.snapGridCellSize,y:r+2},{x:Math.ceil(n/e.snapGridCellSize)*e.snapGridCellSize,y:r+4}],o=s[0].y;o<=s[1].y;o++)if(Ud(kd(t.store,n,o)))return Ad(t,n,o,Ch(i,n,o)),!0;var a=Array.from({length:s[1].x-s[0].x+1},(function(e,t){return t+s[0].x})),l=Array.from({length:s[1].y-s[0].y+1},(function(e,t){return t+s[0].y}));a=a.sort((function(){return Math.random()-.5})),l=l.sort((function(){return Math.random()-.5}));for(var u=0,c=a;u<c.length;u++)for(var h=c[u],d=0,f=l;d<f.length;d++){var p=f[d];if(Ud(kd(t.store,h,p)))return Ad(t,h,p,Ch(i,h,p)),!0}return!1},Kc=function(r,i,s){if(i.type!==n.FreezingIce)return!1;if(s.type!==n.Water)return!1;Ad(r,i.x,i.y,t.Empty);var o=s.x,a=s.y,l=function(e,i){var s=Xd(r,e,i),o=$d(r,e,i);return s===n.Water||o===t.Ice},u=l(o-1,a),c=l(o+1,a),h=l(o,a-1),d=l(o,a+1);return!(!u&&!c||!h&&!d||(function(r,i,s){var o,a,l,u;o=void 0,a=void 0,u=function(){var o,a,l,u,c,h,d,p,m,g,y;return function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}(this,(function(v){switch(v.label){case 0:o=[[i,s]],a=new Set,v.label=1;case 1:return o.length>0?o.length>20?[2]:(l=Math.random())<.01?[4,new Promise((function(e){return setTimeout(e,0)}))]:[3,3]:[3,4];case 2:v.sent(),v.label=3;case 3:return l<.2&&o.sort((function(){return Math.random()-.5})),u=o.shift(),c=u[0],h=u[1],e.useMultithreading&&(d=r.environment,(p=K.getThreadIndexFromCellX(c,d.threadMeta.threadCount))!==d.threadMeta.startingIndex)?(r.environment.threadMeta.ports[p].postMessage([f.StartWaterFreeze,c,h]),[3,1]):a.has("".concat(c,",").concat(h))?[3,1]:(a.add("".concat(c,",").concat(h)),m=kd(r.store,c,h),zd(m,n.Water)?(g={x:c*e.cellSize,y:h*e.cellSize,width:e.cellSize,height:e.cellSize},y={x:r.shared.playerPos[0],y:r.shared.playerPos[1],width:e.playerSize.width,height:e.playerSize.height},K.doRectanglesOverlap(g,y)||(Ad(r,c,h,t.Ice),Nu(r,c,h,4)),o.push([c+1,h]),o.push([c-1,h]),o.push([c,h+1]),o.push([c,h-1]),[3,1]):[3,1]);case 4:return[2]}}))},new((l=void 0)||(l=Promise))((function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):function(e){return e instanceof l?e:new l((function(t){t(e)}))}(t.value).then(n,r)}i((u=u.apply(o,a||[])).next())}))}(r,s.x,s.y),r.environment.postMessage([f.PlaySound,[{id:"freeze",opts:{volume:.2,fadeOut:K.getRandomFloatBetween(.1,2),playbackRate:K.getRandomFloatBetween(.5,1.5)},modulateDistance:{x:s.x*e.cellSize,y:s.y*e.cellSize}}]]),0))},Zc=function(e,t){if(t.type!==n.WetSpore)return!1;var r=Dc(e,t.x,t.y+1);return!(!r||r.type!==d.Grower||(Ad(e,t.x,t.y,Ch(n.Seed,t.x,t.y)),0))},Qc=function(r,i,s){if(i.type!==n.FreezingIce)return!1;if(s.type!==n.Lava)return!1;Ad(r,i.x,i.y,t.Empty);var o=s.x,a=s.y,l=function(e,i){var s=Xd(r,e,i),o=$d(r,e,i);return s===n.Lava||o===t.Obsidian},u=l(o-1,a),c=l(o+1,a),h=l(o,a-1),d=l(o,a+1);return!(!u&&!c||!h&&!d||(function(r,i,s){var o,a,l,u;o=void 0,a=void 0,u=function(){var o,a,l,u,c,h,d,p,m,g,y;return function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}(this,(function(v){switch(v.label){case 0:o=[[i,s]],a=new Set,v.label=1;case 1:return o.length>0?o.length>20?[2]:(l=Math.random())<.01?[4,new Promise((function(e){return setTimeout(e,0)}))]:[3,3]:[3,4];case 2:v.sent(),v.label=3;case 3:return l<.2&&o.sort((function(){return Math.random()-.5})),u=o.shift(),c=u[0],h=u[1],e.useMultithreading&&(d=r.environment,(p=K.getThreadIndexFromCellX(c,d.threadMeta.threadCount))!==d.threadMeta.startingIndex)?(r.environment.threadMeta.ports[p].postMessage([f.StartLavaFreeze,c,h]),[3,1]):a.has("".concat(c,",").concat(h))?[3,1]:(a.add("".concat(c,",").concat(h)),m=kd(r.store,c,h),zd(m,n.Lava)?(g={x:c*e.cellSize,y:h*e.cellSize,width:e.cellSize,height:e.cellSize},y={x:r.shared.playerPos[0],y:r.shared.playerPos[1],width:e.playerSize.width,height:e.playerSize.height},K.doRectanglesOverlap(g,y)||(Ad(r,c,h,t.Obsidian),Nu(r,c,h,4)),o.push([c+1,h]),o.push([c-1,h]),o.push([c,h+1]),o.push([c,h-1]),[3,1]):[3,1]);case 4:return[2]}}))},new((l=void 0)||(l=Promise))((function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):function(e){return e instanceof l?e:new l((function(t){t(e)}))}(t.value).then(n,r)}i((u=u.apply(o,a||[])).next())}))}(r,s.x,s.y),r.environment.postMessage([f.PlaySound,[{id:"freeze",opts:{volume:.2,fadeOut:K.getRandomFloatBetween(.1,2),playbackRate:K.getRandomFloatBetween(.5,1.5)},modulateDistance:{x:s.x*e.cellSize,y:s.y*e.cellSize}}]]),0))};!function(e){e[e.Both=0]="Both",e[e.None=1]="None",e[e.Right=2]="Right",e[e.Left=3]="Left"}(xc||(xc={}));var Jc,eh,th=function(e,t,r){if(Bd(r)){if($c(e,t,r))return!0;if(Kc(e,t,r))return!0;if(Qc(e,r,t))return!0;if(!Ah(r,n.Particle)&&!r.isFreeFalling&&Rh(e,t,r))return Wd(e,t,r.x,r.y,{elementToSwapWith:r}),!0}return!1},nh=function(t,n,r,i){if(e.useMultithreading){var s=t.environment;if(K.getThreadIndexFromCellX(r,s.threadMeta.threadCount)!==s.threadMeta.startingIndex){var o=t.shared.imageData,a=4*(r+i*o.width);if(0!==o.data[a+3]){var l=t.session.colors.elementByColor[o.data[a]][o.data[a+1]][o.data[a+2]],u=Ih[l];if(!u)return console.log(l,"does not exist in ELEMENT_CONFIG"),!1;if(Rh(t,n,{type:l,density:u.density}))return Wd(t,n,r,i),!0}return!1}}var c=kd(t.store,r,i);return!!th(t,n,c)},rh=!1,ih=function(r,i,s,o){return a=void 0,l=void 0,c=function(){var a,l,u,c,h,d,p,m,g,y;return function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}(this,(function(v){switch(v.label){case 0:a=[[i,s]],l=new Set,u=o===t.Ice?40:10,v.label=1;case 1:return a.length>0?a.length>u?[2]:(c=Math.random())<.99?[4,new Promise((function(e){return setTimeout(e,0)}))]:[3,3]:[3,4];case 2:v.sent(),v.label=3;case 3:return c<.2&&a.sort((function(){return Math.random()-.5})),h=a.shift(),d=h[0],p=h[1],e.useMultithreading&&(m=r.environment,(g=K.getThreadIndexFromCellX(d,m.threadMeta.threadCount))!==m.threadMeta.startingIndex)?(r.environment.threadMeta.ports[g].postMessage([f.StartMelt,d,p,o]),[3,1]):l.has("".concat(d,",").concat(p))?[3,1]:(l.add("".concat(d,",").concat(p)),y=kd(r.store,d,p),jd(y,t.Ice)||y===t.FreezingIceSoil?(y===t.FreezingIceSoil?Ru(r,d,p,{x:0,y:0},3):(Ad(r,d,p,Ch(n.Water,d,p)),rh||(r.environment.postMessage([f.ForceCompleteObjective,"melt_ice"]),rh=!0)),Nu(r,d,p,4),a.push([d+1,p]),a.push([d-1,p]),a.push([d,p+1]),a.push([d,p-1]),[3,1]):(function(e,t,n,r){Number.isInteger(t)&&J.includes(t)&&wu(e,n,r)}(r,y,d,p),[3,1]));case 4:return[2]}}))},new((u=void 0)||(u=Promise))((function(e,t){function n(e){try{i(c.next(e))}catch(e){t(e)}}function r(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):function(e){return e instanceof u?e:new u((function(t){t(e)}))}(t.value).then(n,r)}i((c=c.apply(a,l||[])).next())}));var a,l,u,c};(eh=Jc||(Jc={}))[eh.Fire=0]="Fire",eh[eh.Water=1]="Water";var sh,oh,ah=1e3,lh={time:0,distance:1/0,pan:0},uh={time:0,distance:1/0,pan:0},ch=function(e,r,i,s,o){if(r.type===n.Lava&&i===t.Ice&&ih(e,s,o,i),Bd(i)){if($c(e,r,i))return!0;if(Kc(e,i,r))return!0;if(Qc(e,i,r))return!0;if(!Ah(i,n.Particle)&&!i.isFreeFalling&&r.density>i.density)return Wd(e,r,i.x,i.y,{elementToSwapWith:i}),!0}return!1},hh=function(e,t,n){void 0===n&&(n=!1);for(var r,i=K.getRandomIntBetween(1,2),s=t.velocity.x<0?-i:i,o=t.x+s,a=t.x;a!==o;){if(!Hd(e,a+=s<0?-1:1,t.y)){if(n){var l=Xd(e,a,t.y);if(null!==l&&Mh(l,h.Gas))return dh(e,t,a,t.y),!0}break}r=a}return r?(t.movesOnSameYAxis.y!==t.y&&(t.movesOnSameYAxis.y=t.y,t.movesOnSameYAxis.count=0),t.movesOnSameYAxis.count+=1,Md(e,t,r,t.y),!0):(t.lastSideCheckedPosition&&t.x===t.lastSideCheckedPosition||Fd(e,t.x,t.y),t.lastSideCheckedPosition=t.x,t.velocity.x=-t.velocity.x,!1)},dh=function(t,n,r,i){if(e.useMultithreading){var s=t.environment;if(K.getThreadIndexFromCellX(r,s.threadMeta.threadCount)!==s.threadMeta.startingIndex){var o=t.shared.imageData,a=4*(r+i*o.width);if(0!==o.data[a+3]){var l=t.session.colors.elementByColor[o.data[a]][o.data[a+1]][o.data[a+2]],u=Ih[l];if(!u)return console.log(l,"does not exist in ELEMENT_CONFIG"),!1;if(n.density>u.density)return Wd(t,n,r,i),!0}return!1}}var c=kd(t.store,r,i);return!!ch(t,n,c,r,i)},fh=function(e,t){Ad(e,t.x,t.y,t.element),t.element.isFreeFalling=!0,t.element.threshold={x:0,y:0},t.element.velocity={x:t.velocity.x,y:Math.max(t.velocity.y,t.element.minVelocity.y)},t.element.x=t.x,t.element.y=t.y},ph=!1,mh=function(e,r,i,s,o){if(Bd(i)){if($c(e,r,i))return!0;if(!Ah(i,n.Particle)&&!i.isFreeFalling&&r.density>i.density)return Wd(e,r,i.x,i.y,{elementToSwapWith:i}),!0}return r.type===n.Fire&&i===t.Ice&&function(e,r,i){(Math.random()>=.99||[{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1}].every((function(t){return Hd(e,r+t.x,i+t.y)||Xd(e,r+t.x,i+t.y)===n.Fire})))&&function(e,n,r){var i=kd(e.store,n,r);(jd(i,t.Ice)||i===t.FreezingIceSoil)&&ih(e,n,r,i)}(e,r,i)}(e,s,o),!1},gh=function(e,t,r){if(void 0===r&&(r=!1),t.type===n.Fire)return!1;for(var i,s=K.getRandomIntBetween(1,2),o=t.velocity.x<0?-s:s,a=t.x+o,l=t.x;l!==a;){if(!Hd(e,l+=o<0?-1:1,t.y)){if(r){var u=Xd(e,l,t.y);if(null!==u&&Mh(u,h.Liquid))return yh(e,t,l,t.y),!0}break}i=l}return i?(t.movesOnSameYAxis.y!==t.y&&(t.movesOnSameYAxis.y=t.y,t.movesOnSameYAxis.count=0),t.movesOnSameYAxis.count+=1,Md(e,t,i,t.y),!0):(t.lastSideCheckedPosition&&t.x===t.lastSideCheckedPosition||Fd(e,t.x,t.y),t.lastSideCheckedPosition=t.x,t.velocity.x=-t.velocity.x,!1)},yh=function(t,r,i,s){if(e.useMultithreading){var o=t.environment;if(K.getThreadIndexFromCellX(i,o.threadMeta.threadCount)!==o.threadMeta.startingIndex){var a=t.shared.imageData,l=4*(i+s*a.width);if(0!==a.data[l+3]){var u=t.session.colors.elementByColor[a.data[l]][a.data[l+1]][a.data[l+2]],c=Ih[u];if(!c)return console.log(u,"does not exist in ELEMENT_CONFIG"),!1;if(r.type===n.Fire&&c.type===n.Fire)return console.log("is this ever triggered?"),Wd(t,r,i,s),!0;if(r.density>c.density)return Wd(t,r,i,s),!0}return!1}}var h=kd(t.store,i,s);return!!mh(t,r,h,i,s)};({})[n.Slag]=function(){return{output:{elementType:n.BurntSlag,chance:.25}}},(sh={})[t.Moss]=!1,sh[t.Divider]=!1,sh[t.GoldSoil]=n.Gold,sh[t.Petal]=n.Petalium,function(e){e[e.Both=0]="Both",e[e.None=1]="None",e[e.Right=2]="Right",e[e.Left=3]="Left"}(oh||(oh={}));var vh,xh=function(e,t,r){if(Bd(r)){if($c(e,t,r))return!0;if(Kc(e,t,r))return!0;if(!Ah(r,n.Particle)&&!r.isFreeFalling&&Rh(e,t,r))return Wd(e,t,r.x,r.y,{elementToSwapWith:r}),!0}return!1},bh=function(t,n,r,i){if(e.useMultithreading){var s=t.environment;if(K.getThreadIndexFromCellX(r,s.threadMeta.threadCount)!==s.threadMeta.startingIndex){var o=t.shared.imageData,a=4*(r+i*o.width);if(0!==o.data[a+3]){var l=t.session.colors.elementByColor[o.data[a]][o.data[a+1]][o.data[a+2]],u=Ih[l];if(!u)return console.log(l,"does not exist in ELEMENT_CONFIG"),!1;if(Rh(t,n,{type:l,density:u.density}))return Wd(t,n,r,i),!0}return!1}}var c=kd(t.store,r,i);return!!xh(t,n,c)};!function(e){e[e.Both=0]="Both",e[e.None=1]="None",e[e.Right=2]="Right",e[e.Left=3]="Left"}(vh||(vh={}));var wh,Sh,_h=function(e,t,r){if(Bd(r)){if($c(e,t,r))return!0;if(Kc(e,t,r))return!0;if(!Ah(r,n.Particle)&&!r.isFreeFalling&&Rh(e,t,r))return Wd(e,t,r.x,r.y,{elementToSwapWith:r}),!0}return!1},Th=function(t,n,r,i){if(e.useMultithreading){var s=t.environment;if(K.getThreadIndexFromCellX(r,s.threadMeta.threadCount)!==s.threadMeta.startingIndex){var o=t.shared.imageData,a=4*(r+i*o.width);if(0!==o.data[a+3]){var l=t.session.colors.elementByColor[o.data[a]][o.data[a+1]][o.data[a+2]],u=Ih[l];if(!u)return console.log(l,"does not exist in ELEMENT_CONFIG"),!1;if(Rh(t,n,{type:l,density:u.density}))return Wd(t,n,r,i),!0}return!1}}var c=kd(t.store,r,i);return!!_h(t,n,c)},Eh=function(){return Eh=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Eh.apply(this,arguments)},Ch=function(r,i,s,o){var a,l,u=Ih[r],c=Dh[u.matterType],h=function(e,t){switch(e){case n.Flame:case n.Fire:return K.getRandomFloatBetween(t.duration-.25,t.duration+1.25);default:return t.duration}}(r,u),d={type:r,cellType:t.Element,x:i,y:s,velocity:{x:Math.random()>=.5?1:-1,y:e.gravity/60},minVelocity:{x:0,y:e.gravity/60},threshold:{x:0,y:0},hasBeenUpdated:!1,isFreeFalling:!0,density:u.density,variantIndex:K.getRandomIntBetween(0,3),duration:h?{max:h,left:h}:{max:-1}};return Eh(Eh(Eh({},d),null===(a=u.getExtraProps)||void 0===a?void 0:a.call(u)),null===(l=c.getExtraProps)||void 0===l?void 0:l.call(c,o,d))},kh=function(e,t){t.hasBeenUpdated=!0,e.world.updatedCellPositions.push({x:t.x,y:t.y})},Ah=function(e,t){return e.type==t},Mh=function(e,t){return Ih[e].matterType==t},Ph=function(e,t){return t.includes(Ih[e.type].matterType)},Rh=function(t,n,r){if(n.type===r.type)return!1;var i=oe.get(t.session,"structures",Math.floor(n.x/e.snapGridCellSize)*e.snapGridCellSize,Math.floor(n.y/e.snapGridCellSize)*e.snapGridCellSize+e.snapGridCellSize);if(i&&i.filter&&i.filter.elementType){if("allow"===i.filter.mode&&i.filter.elementType===n.type)return!0;if("block"===i.filter.mode&&i.filter.elementType!==n.type)return!0}return n.density>r.density},Ih=((wh={})[n.Sand]={name:"Sand",interactions:["💧"],density:150,matterType:h.Solid},wh[n.WetSand]={name:"Wet Sand",interactions:["↔️"],density:150,matterType:h.Slushy},wh[n.Slag]={name:"Slag",interactions:["🔥"],density:50,matterType:h.Slushy},wh[n.Gold]={name:"Gold",interactions:["💰"],density:300,matterType:h.Solid},wh[n.Water]={name:"Water",interactions:["🔥","❄️"],density:100,matterType:h.Liquid},wh[n.Particle]={matterType:h.Particle},wh[n.Steam]={name:"Steam",density:25,matterType:h.Gas},wh[n.Spore]={name:"Spore",interactions:["💧"],density:150,matterType:h.Solid},wh[n.Petalium]={name:"Amethelis",interactions:["🌄 (Redsand)"],density:40,matterType:h.Wisp},wh[n.WetSpore]={name:"Wet Spore",interactions:["🪴"],density:100,matterType:h.Slushy},wh[n.Seed]={name:"Seed",density:100,matterType:h.Static,getExtraProps:function(){var e=K.getRandomFloatBetween(.1,.5);return{data:{seedlings:1,grows:K.getRandomIntBetween(5,20),runway:20},duration:{max:e,left:e}}}},wh[n.BurntSlag]={name:"Burnt Slag",interactions:["⬇️"],density:50,matterType:h.Solid},wh[n.Fire]={name:"Fire",density:25,matterType:h.Gas,duration:1.28},wh[n.FreezingIce]={name:"Snow",interactions:["🔥"],density:150,matterType:h.Solid},wh[n.Flame]={name:"Flame",density:50,matterType:h.Solid,duration:.28},wh[n.Lava]={name:"Lava",interactions:["❄️"],density:75,matterType:h.Liquid,duration:.28},wh[n.Sandium]={name:"Redsand",interactions:["🌸 (Amethelis)"],density:160,matterType:h.Solid},wh[n.Gloom]={name:"Voidbloom",interactions:["🔮 (Flux Emanator)"],density:30,matterType:h.Slushy},wh[n.Basalt]={name:"Cinder",density:50,matterType:h.Solid},wh),Dh=((Sh={})[h.Solid]={update:function(n,r,i){var s=n.store;if(!r.hasBeenUpdated&&Dd(s,r.x,r.y)&&!Oc(n,r)){var o=!1,a=oe.get(n.session,"structures",Math.floor(r.x/e.snapGridCellSize)*e.snapGridCellSize,Math.floor(r.y/e.snapGridCellSize)*e.snapGridCellSize);a&&(o=a.filter||a.queued),o&&a.filter&&(r.velocity.y=r.minVelocity.y);var l=kd(s,r.x,r.y+1),u=Vd(l),c=Yu(n,r,r.x,r.y+1,o),h=!c.authorized,d=xc.Both,f=Ud(l);if(u||h||jd(l,t.Block))return r.isFreeFalling=!1,r.velocity.y=r.minVelocity.y,r.velocity.x=0,kh(s,r),u&&!e.useMultithreading&&(Uc(n,r,l,a.type),Fd(n,r.x,r.y)),void Zc(n,r);if(c.authorized&&c.isFilter&&(d=xc.None),f||(jd(l,t.SlidingBlockLeft)?d=xc.Left:jd(l,t.SlidingBlockRight)&&(d=xc.Right)),r.threshold.y+=r.velocity.y*i,r.velocity.y+=e.gravity*i,r.threshold.y<1)return r.isFreeFalling&&Fd(n,r.x,r.y),void(f||d===xc.None||(d!==xc.Left&&d!==xc.Both||Hd(n,r.x-1,r.y+1)&&Fd(n,r.x,r.y),d!==xc.Right&&d!==xc.Both||Hd(n,r.x+1,r.y+1)&&Fd(n,r.x,r.y)));var p=Math.floor(r.threshold.y);if(r.threshold.y=r.threshold.y%1,f){var m=!1,g=r.y+1;if(p>1)for(var y=r.y+p,v=r.y+2;v<=y;v+=1){var x=kd(s,r.x,v),b=Ud(x),w=Yu(n,r,r.x,v,o),S=w.authorized;if(!b||!S){b||(h=!S,l=x),m=!0,!S||w.isFilter||!b&&(Vd(x)||jd(x,t.Block))?d=xc.None:b||(jd(x,t.SlidingBlockLeft)?d=xc.Left:jd(l,t.SlidingBlockRight)&&(d=xc.Right));break}g++}if(Md(n,r,r.x,g),!m)return void(r.isFreeFalling=!0)}if((!l||h||!th(n,r,l))&&!Yc(n,r,l))if(h&&Zc(n,r))console.log("gro second case... necessary to keep this?");else{if(r.isFreeFalling){var _=Math.abs(r.velocity.y)/10;0===r.velocity.x&&(r.velocity.x=Math.random()>=.5?1:-1),r.velocity.x=r.velocity.x<0?-_:_}if(r.isFreeFalling=!1,r.velocity.y*=.9,r.velocity.y<r.minVelocity.y&&(r.velocity.y=r.minVelocity.y),r.threshold.x+=r.velocity.x*i,r.velocity.x*=.9,d!==xc.None&&function(e,t,n){var r=t.velocity.x<0?-1:1,i=n===xc.Right?t.x+1:n===xc.Left?t.x-1:t.x-r,s=t.y+1;if($u(e,t,i,s,!1,{isDiagonalCheck:!0})){if(Hd(e,i,s))return Md(e,t,i,s),!0;if(nh(e,t,i,s))return!0}if(n!==xc.Both)return!1;if(i=t.x+r,$u(e,t,i,s,!1,{isDiagonalCheck:!0})){if(Hd(e,i,s))return Md(e,t,i,s),!0;if(nh(e,t,i,s))return!0}return!1}(n,r,d))r.isFreeFalling=!0;else{if(r.velocity.x<6&&r.velocity.x>-6)return r.velocity.x=0,void(r.threshold.x=0);if(r.threshold.x<1&&r.threshold.x>-1)Fd(n,r.x,r.y);else{var T=r.threshold.x<0?Math.ceil(r.threshold.x):Math.floor(r.threshold.x);r.threshold.x=r.threshold.x%1;for(var E,C,k=r.x+T,A=r.x,M=r.y;A!==k&&Hd(n,A+=T<0?-1:1,M)&&$u(n,r,A,M,o);)Hd(n,A,M+1)&&$u(n,r,A,M+1,o)&&(M+=1),E=A,C=M;E&&Md(n,r,E,C)}}}}}},Sh[h.Liquid]={update:function(t,r,i){var s=t.store;if(!r.hasBeenUpdated&&Dd(s,r.x,r.y)){if(r.movesOnSameYAxis.count>1e3)return e.useMultithreading&&t.shared.reservoir[0]++,void Rd(t,r);if(r.threshold.y+=r.velocity.y*i,r.velocity.y+=e.gravity*i,r.threshold.y<1)if(r.isFreeFalling)try{Fd(t,r.x,r.y)}catch(e){console.log("Error in reportToChunkAtCellPos",e,JSON.stringify(r))}else hh(t,r);else{var o=Math.floor(r.threshold.y);r.threshold.y=r.threshold.y%1;var a=kd(s,r.x,r.y+1);if(Ud(a)){var l=r.y+1;if(o>1)for(var u=r.y+o,c=r.y+2;c<=u;c+=1){var h=kd(s,r.x,c);if(!Ud(h))break;l++}r.isFreeFalling=!0;try{Md(t,r,r.x,l)}catch(e){}}else r.isFreeFalling&&r.type===n.Water&&function(e,t,n,r){var i=K.getDistance({x:t,y:n},{x:e.shared.playerPos[0],y:e.shared.playerPos[1]}),s=t-e.shared.playerPos[0],o=Math.min(1,Math.max(-1,s/ah));r===Jc.Fire&&i<e.shared.naturalAmbience[0]?(e.shared.naturalAmbience[0]=i,e.shared.naturalAmbience[1]=o):r===Jc.Water&&i<e.shared.naturalAmbience[2]&&(e.shared.naturalAmbience[2]=i,e.shared.naturalAmbience[3]=o)}(t,r.x*e.cellSize,r.y*e.cellSize,Jc.Water),ch(t,r,a,r.x,r.y+1)||(r.isFreeFalling=!1,r.velocity.y*=.9,r.velocity.y<r.minVelocity.y&&(r.velocity.y=r.minVelocity.y),function(e,t){var n=t.velocity.x<0?-1:1,r=t.x-n,i=t.y+1;return Hd(e,r,i)?(Md(e,t,r,i),!0):!!dh(e,t,r,i)||(r=t.x+n,Hd(e,r,i)?(Md(e,t,r,i),!0):!!dh(e,t,r,i))}(t,r)||hh(t,r,!0))}}},getExtraProps:function(e){return{movesOnSameYAxis:{y:0,count:0},lastSideCheckedPosition:null}}},Sh[h.Particle]={update:function(t,r,i){var s=t.store;if(!r.hasBeenUpdated&&Dd(s,r.x,r.y)){Oc(t,r),r.threshold.x+=r.velocity.x*i,r.threshold.y+=r.velocity.y*i,r.velocity.y+=e.gravity*i;var o=r.threshold.x<0?Math.ceil(r.threshold.x):Math.floor(r.threshold.x),a=r.threshold.y<0?Math.ceil(r.threshold.y):Math.floor(r.threshold.y);if(0!==o||0!==a){0!==o&&(r.threshold.x=r.threshold.x%1),0!==a&&(r.threshold.y=r.threshold.y%1);var l=function(t,n,r){for(var i,s=n.x,o=n.y,a=s-r.x,l=o-r.y,u=Math.abs(a)>Math.abs(l),c=a<0?1:-1,h=l<0?1:-1,d=Math.max(Math.abs(a),Math.abs(l)),f=Math.min(Math.abs(a),Math.abs(l)),p=0==f||0==d?0:f/d,m=null,g=1;g<=d;g++){i=Math.round(g*p);var y=void 0,v=void 0;u?(v=g,y=i):(y=g,v=i);var x=o+y*h,b=s+v*c;if(b<0||b>=t.store.world.size.width||x<0||x>=t.store.world.size.height)return{lastNonEmpty:null,lastEmpty:null};var w=oe.get(t.session,"structures",Math.floor(b/e.snapGridCellSize)*e.snapGridCellSize,Math.floor(x/e.snapGridCellSize)*e.snapGridCellSize);if(w&&(w.filter||w.queued)){var S=oe.get(t.session,"structures",Math.floor(n.x/e.snapGridCellSize)*e.snapGridCellSize,Math.floor(n.y/e.snapGridCellSize)*e.snapGridCellSize);if(!S||!S.queued)return{lastNonEmpty:{x:b,y:x},lastEmpty:m,hitFilter:!0}}if(e.useMultithreading){var _=t.environment;if(K.getThreadIndexFromCellX(b,_.threadMeta.threadCount)!==_.threadMeta.startingIndex){var T=t.shared.obstacleImageData,E=4*(b+x*T.width),C=T.data[E+3],k=t.shared.imageData.data[E+3];if(C>0||k>0)return{lastNonEmpty:{x:b,y:x},lastEmpty:m};if(m={x:b,y:x},b===r.x&&x===r.y)return{lastNonEmpty:null,lastEmpty:m};continue}}var A=kd(t.store,b,x);if(!Ud(A))return{lastNonEmpty:{cell:A,x:b,y:x},lastEmpty:m};if(m={cell:A,x:b,y:x},b===r.x&&x===r.y)return{lastNonEmpty:null,lastEmpty:m}}}(t,r,{x:r.x+o,y:r.y+a});if(l.lastNonEmpty||l.lastEmpty)if(l.lastNonEmpty)if(!e.useMultithreading||l.lastNonEmpty.cell&&!l.hitFilter){if(zd(l.lastNonEmpty.cell,n.Water)&&!Ah(r.element,n.FreezingIce)){var u=l.lastNonEmpty.cell;return r.velocity.x*=.98,void Wd(t,r,u.x,u.y,{elementToSwapWith:u})}l.lastEmpty&&Md(t,r,l.lastEmpty.x,l.lastEmpty.y),zd(l.lastNonEmpty.cell,n.Particle)?Fd(t,r.x,r.y):fh(t,r)}else l.lastEmpty?Md(t,r,l.lastEmpty.x,l.lastEmpty.y):Xd(t,l.lastNonEmpty.x,l.lastNonEmpty.y)===n.Water?Wd(t,r,l.lastNonEmpty.x,l.lastNonEmpty.y):fh(t,r);else Md(t,r,l.lastEmpty.x,l.lastEmpty.y);else fh(t,r)}else Fd(t,r.x,r.y)}},getExtraProps:function(e){return{element:e.element,velocity:e.velocity,density:e.element.density}}},Sh[h.Gas]={update:function(t,r,i){var s=t.store;if(!r.hasBeenUpdated&&Dd(s,r.x,r.y))if(r.movesOnSameYAxis.count>1e3)Ah(r,n.Steam)?Ad(t,r.x,r.y,Ch(n.Water,r.x,r.y)):Rd(t,r);else if(r.threshold.y+=r.velocity.y*i,r.velocity.y+=e.upflow*i,r.threshold.y>-1)r.isFreeFalling?Fd(t,r.x,r.y):gh(t,r);else{var o=Math.ceil(r.threshold.y);r.threshold.y=r.threshold.y%1;var a={x:r.x,y:r.y-1};if(!(a.y<0)){var l=kd(s,a.x,a.y);if(Ud(l)){var u=r.y-1;if(o>1)for(var c=r.y-o,h=r.y-2;h<=c;h-=1){var d=kd(s,r.x,h);if(!Ud(d))break;u--}if(r.isFreeFalling=!0,r.y<100&&r.type===n.Steam){if(t.shared.reservoir[0]>0){t.shared.reservoir[0]--;try{Ad(t,r.x,u,Ch(n.Water,r.x,u)),Ad(t,r.x,r.y,Ch(n.Water,r.x,r.y)),ph||(t.environment.postMessage([f.ForceCompleteObjective,"let_it_rain"]),ph=!0)}catch(e){console.log("Gas reservoir out of bounds issue happened",r,o,u)}return}return Md(t,r,r.x,u),void Ad(t,r.x,r.y,Ch(n.Water,r.x,r.y))}Md(t,r,r.x,u)}else mh(t,r,l,a.x,a.y)||(r.isFreeFalling=!1,r.velocity.y*=.9,r.velocity.y>r.minVelocity.y&&(r.velocity.y=r.minVelocity.y),function(e,t){var n=t.velocity.x<0?-1:1,r=t.x-n,i=t.y-1;return Hd(e,r,i)?(Md(e,t,r,i),!0):!!yh(e,t,r,i)||(r=t.x+n,Hd(e,r,i)?(Md(e,t,r,i),!0):!!yh(e,t,r,i))}(t,r)||gh(t,r,!0))}}},getExtraProps:function(t,n){return{movesOnSameYAxis:{y:0,count:0},lastSideCheckedPosition:null,velocity:{x:Math.random()>=.5?1:-1,y:e.upflow/60},minVelocity:{x:0,y:e.upflow/60}}}},Sh[h.Static]={update:!1},Sh[h.Slushy]={update:function(n,r,i){var s=n.store;if(!r.hasBeenUpdated&&Dd(s,r.x,r.y)&&!Oc(n,r)){var o=!1,a=oe.get(n.session,"structures",Math.floor(r.x/e.snapGridCellSize)*e.snapGridCellSize,Math.floor(r.y/e.snapGridCellSize)*e.snapGridCellSize);a&&(o=a.filter||a.queued),o&&a.filter&&(r.velocity.y=r.minVelocity.y);var l=kd(s,r.x,r.y+1),u=Vd(l),c=Yu(n,r,r.x,r.y+1,o),h=!c.authorized,d=oh.Both,f=Ud(l);if(u||h||jd(l,t.Block))return r.isFreeFalling=!1,r.velocity.y=r.minVelocity.y,r.velocity.x*=.7,kh(s,r),u&&!e.useMultithreading&&(Uc(n,r,l,a.type),Fd(n,r.x,r.y)),void Zc(n,r);if(c.authorized&&c.isFilter&&(d=oh.None),f||(jd(l,t.SlidingBlockLeft)?d=oh.Left:jd(l,t.SlidingBlockRight)&&(d=oh.Right)),r.threshold.y+=r.velocity.y*i,r.velocity.y+=e.gravity*i,r.threshold.y<1)return r.isFreeFalling&&Fd(n,r.x,r.y),void(f||d===oh.None||(d!==oh.Left&&d!==oh.Both||Hd(n,r.x-1,r.y+1)&&Fd(n,r.x,r.y),d!==oh.Right&&d!==oh.Both||Hd(n,r.x+1,r.y+1)&&Fd(n,r.x,r.y)));var p=Math.floor(r.threshold.y);if(r.threshold.y=r.threshold.y%1,f){var m=!1,g=r.y+1;if(p>1)for(var y=r.y+p,v=r.y+2;v<=y;v+=1){var x=kd(s,r.x,v),b=Ud(x),w=Yu(n,r,r.x,v,o),S=w.authorized;if(!b||!S){b||(h=!S,l=x),m=!0,!S||w.isFilter||!b&&(Vd(x)||jd(x,t.Block))?d=oh.None:b||(jd(x,t.SlidingBlockLeft)?d=oh.Left:jd(l,t.SlidingBlockRight)&&(d=oh.Right));break}g++}if(Md(n,r,r.x,g),!m)return void(r.isFreeFalling=!0)}if((!l||h||!xh(n,r,l))&&!Yc(n,r,l))if(h&&Zc(n,r))console.log("gro second case... necessary to keep this?");else{if(r.isFreeFalling){var _=Math.abs(r.velocity.y)/5;_*=.8+.4*Math.random(),0===r.velocity.x&&(r.velocity.x=2*(Math.random()-.5)),r.velocity.x=r.velocity.x<0?-_:_}if(r.isFreeFalling=!1,r.velocity.y*=.95,r.velocity.y<r.minVelocity.y&&(r.velocity.y=r.minVelocity.y),r.threshold.x+=r.velocity.x*i,r.velocity.x*=.95,d!==oh.None&&function(e,t,n){var r=t.velocity.x<0?-1:1,i=n===oh.Right?t.x+1:n===oh.Left?t.x-1:t.x-r,s=t.y+1;if($u(e,t,i,s,!1,{isDiagonalCheck:!0})){if(Hd(e,i,s))return Md(e,t,i,s),!0;if(bh(e,t,i,s))return!0}if(n!==oh.Both)return!1;if(i=t.x+r,$u(e,t,i,s,!1,{isDiagonalCheck:!0})){if(Hd(e,i,s))return Md(e,t,i,s),!0;if(bh(e,t,i,s))return!0}return!1}(n,r,d))r.isFreeFalling=!0;else{if(r.velocity.x<6&&r.velocity.x>-6)return r.velocity.x=0,void(r.threshold.x=0);if(r.threshold.x<1&&r.threshold.x>-1)Fd(n,r.x,r.y);else{var T=r.threshold.x<0?Math.ceil(r.threshold.x):Math.floor(r.threshold.x);r.threshold.x=r.threshold.x%1;for(var E,C,k=r.x+T,A=r.x,M=r.y;A!==k&&Hd(n,A+=T<0?-1:1,M)&&$u(n,r,A,M,o);)Hd(n,A,M+1)&&$u(n,r,A,M+1,o)&&(M+=1),E=A,C=M;E&&Md(n,r,E,C)}}}}}},Sh[h.Wisp]={update:function(n,r,i){var s=n.store;if(!r.hasBeenUpdated&&Dd(s,r.x,r.y)){if(Ud(kd(s,r.x,r.y+1))){var o=.5+Math.random();if(r.velocity.y=Math.min(r.velocity.y+1*e.gravity*o*i,6),0===r.velocity.x&&(r.velocity.x=Math.random()>.5?8:-8),Math.random()<.1&&(r.velocity.x*=-1,Math.random()<.3&&(r.velocity.y*=.5)),r.threshold.x+=r.velocity.x*i,r.threshold.y+=r.velocity.y*i,Math.abs(r.threshold.x)>=1){var a=r.threshold.x<0?Math.ceil(r.threshold.x):Math.floor(r.threshold.x);r.threshold.x=r.threshold.x%1;var l=r.x+a;if(Hd(n,l,r.y))return void Md(n,r,l,r.y)}}else r.velocity.x=0,r.velocity.y=r.minVelocity.y;if(!Oc(n,r)){var u=!1,c=oe.get(n.session,"structures",Math.floor(r.x/e.snapGridCellSize)*e.snapGridCellSize,Math.floor(r.y/e.snapGridCellSize)*e.snapGridCellSize);c&&(u=c.filter||c.queued),u&&c.filter&&(r.velocity.y=r.minVelocity.y);var h=kd(s,r.x,r.y+1),d=Vd(h),f=Yu(n,r,r.x,r.y+1,u),p=!f.authorized,m=vh.Both,g=Ud(h);if(d||p||jd(h,t.Block))return r.isFreeFalling=!1,r.velocity.y=r.minVelocity.y,r.velocity.x=0,kh(s,r),d&&!e.useMultithreading&&(Uc(n,r,h,c.type),Fd(n,r.x,r.y)),void Zc(n,r);if(f.authorized&&f.isFilter&&(m=vh.None),g||(jd(h,t.SlidingBlockLeft)?m=vh.Left:jd(h,t.SlidingBlockRight)&&(m=vh.Right)),r.threshold.y+=r.velocity.y*i,r.velocity.y+=e.gravity*i,r.threshold.y<1)return r.isFreeFalling&&Fd(n,r.x,r.y),void(g||m===vh.None||(m!==vh.Left&&m!==vh.Both||Hd(n,r.x-1,r.y+1)&&Fd(n,r.x,r.y),m!==vh.Right&&m!==vh.Both||Hd(n,r.x+1,r.y+1)&&Fd(n,r.x,r.y)));var y=Math.floor(r.threshold.y);if(r.threshold.y=r.threshold.y%1,g){var v=!1,x=r.y+1;if(y>1)for(var b=r.y+y,w=r.y+2;w<=b;w+=1){var S=kd(s,r.x,w),_=Ud(S),T=Yu(n,r,r.x,w,u),E=T.authorized;if(!_||!E){_||(p=!E,h=S),v=!0,!E||T.isFilter||!_&&(Vd(S)||jd(S,t.Block))?m=vh.None:_||(jd(S,t.SlidingBlockLeft)?m=vh.Left:jd(h,t.SlidingBlockRight)&&(m=vh.Right));break}x++}if(Md(n,r,r.x,x),!v)return void(r.isFreeFalling=!0)}if((!h||p||!_h(n,r,h))&&!Yc(n,r,h))if(p&&Zc(n,r))console.log("gro second case... necessary to keep this?");else{if(r.isFreeFalling){var C=Math.abs(r.velocity.y)/10;0===r.velocity.x&&(r.velocity.x=Math.random()>=.5?1:-1),r.velocity.x=r.velocity.x<0?-C:C}if(r.isFreeFalling=!1,r.velocity.y*=.9,r.velocity.y<r.minVelocity.y&&(r.velocity.y=r.minVelocity.y),r.threshold.x+=r.velocity.x*i,r.velocity.x*=.9,m!==vh.None&&function(e,t,n){var r=t.velocity.x<0?-1:1,i=n===vh.Right?t.x+1:n===vh.Left?t.x-1:t.x-r,s=t.y+1;if($u(e,t,i,s,!1,{isDiagonalCheck:!0})){if(Hd(e,i,s))return Md(e,t,i,s),!0;if(Th(e,t,i,s))return!0}if(n!==vh.Both)return!1;if(i=t.x+r,$u(e,t,i,s,!1,{isDiagonalCheck:!0})){if(Hd(e,i,s))return Md(e,t,i,s),!0;if(Th(e,t,i,s))return!0}return!1}(n,r,m))r.isFreeFalling=!0;else{if(r.velocity.x<6&&r.velocity.x>-6)return r.velocity.x=0,void(r.threshold.x=0);if(r.threshold.x<1&&r.threshold.x>-1)Fd(n,r.x,r.y);else{var k=r.threshold.x<0?Math.ceil(r.threshold.x):Math.floor(r.threshold.x);r.threshold.x=r.threshold.x%1;for(var A,M,P=r.x+k,R=r.x,I=r.y;R!==P&&Hd(n,R+=k<0?-1:1,I)&&$u(n,r,R,I,u);)Hd(n,R,I+1)&&$u(n,r,R,I+1,u)&&(I+=1),A=R,M=I;A&&Md(n,r,A,M)}}}}}}},Sh);const Fh=JSON.parse('{"conveyor-belt-left":[[4,4,4,4],[3,3,3,3],[3,3,3,3],[3,3,3,3]],"conveyor-belt-right":[[5,5,5,5],[3,3,3,3],[3,3,3,3],[3,3,3,3]],"conveyor-belt-shaker-left":[[4,6,6,6],[3,0,0,0],[3,0,0,0],[3,0,0,0]],"conveyor-belt-shaker-right":[[7,7,7,5],[0,0,0,3],[0,0,0,3],[0,0,0,3]],"splitter-left":[[0,0,8,0],[0,0,0,8],[0,0,0,3],[0,0,0,3]],"splitter-right":[[0,8,0,0],[8,0,0,0],[3,0,0,0],[3,0,0,0]],"dropper":[[8,0,0,8],[8,0,8,3],[8,0,3,3],[0,8,3,3]],"dropper-2":[[8,0,0,8],[3,0,0,3],[3,0,0,3],[3,8,0,3]],"foundation":[[3,3,3,3],[3,3,3,3],[3,3,3,3],[3,3,3,3]],"foundation-triangle-left":[[0,0,0,9],[0,0,9,3],[0,9,3,3],[9,3,3,3]],"foundation-triangle-right":[[10,0,0,0],[3,10,0,0],[3,3,10,0],[3,3,3,10]],"foundation-triangle-left-del":[[3,3,3,3],[0,3,3,3],[0,0,3,3],[0,0,0,3]],"foundation-triangle-right-del":[[3,3,3,3],[3,3,3,0],[3,3,0,0],[3,0,0,0]],"sliding-foundation":[[8,8,8,8],[8,8,8,8],[8,8,8,8],[8,8,8,8]],"velocity-soaker":[[11,11,11,11],[0,0,0,0],[0,0,0,0],[0,0,0,0]],"grower":[[12,12,12,12],[0,0,0,0],[0,0,0,0],[0,0,0,0]]}');for(var Nh,Lh=i.t(Fh,2),Bh=1e3,Oh=[{name:"conveyors",structures:[d.ConveyorLeft,d.ConveyorRight],sounds:[{id:"machinery",volMod:.03},{id:"machinery_rhythm",volMod:.05}]},{name:"launchers",structures:[d.LauncherLeft,d.LauncherRight,d.LauncherUp],sounds:[{id:"machinery_ambience",volMod:.5}]},{name:"shakers",structures:[d.ShakerLeft,d.ShakerRight],sounds:[{id:"machinery_rhythm_2",volMod:.025},{id:"machinery_rhythm_2_b",volMod:.025}]}],zh=function(t,n,r){var i=K.getDistance(t.store.player,{x:n.x*e.cellSize,y:n.y*e.cellSize}),s=n.x*e.cellSize-t.store.player.x,o=t.session.ambience[r];if(o.distance>i&&(o.distance=i),s<0){var a=Math.abs(s);a<o.xDistance.left&&(o.xDistance.left=a)}else s<o.xDistance.right&&(o.xDistance.right=s)},jh=function(){for(var e={},t=0;t<Oh.length;t++)e[Oh[t].name]={distance:1/0,xDistance:{left:1/0,right:1/0}};return e},Uh=function(e,t){var n=Math.min(600,Math.max(e.x-t.x,-600))/1e3,r=K.getDistance({x:e.x,y:e.y},{x:t.x,y:t.y});return{pan:n,volMod:Math.pow(200/Math.max(200,r),2)}},Gh=function(e,t){return e.session.input.keys[e.session.settings.keyBindings[t]]===y.Pressed},Vh=function(t,n){return{x:t*e.cellSize+e.cellSize*e.snapGridCellSize/2,y:n*e.cellSize+e.cellSize*e.snapGridCellSize/2}},Hh=function(e,t,n){e.store.world.lights=e.store.world.lights.filter((function(e){return e.x!==t||e.y!==n}))},Wh=function(t,n){t.store;var r=t.session;if(r.action.state[u.Start]){var i={x:r.input.mouse.position.x,y:r.input.mouse.position.y};r.action.customData={start:i,end:i}}else if(r.action.state[u.Active]){if(!r.action.customData)return;r.action.customData.end={x:r.input.mouse.position.x,y:r.input.mouse.position.y}}else if(r.action.state[u.End])try{var s=$h(t),o=s.start,a=s.end;if(n.id===l.PipeRemover){var c=[];t.store.pipes=t.store.pipes.filter((function(e){return!_d(t,o,a,e,(function(e,t){return oe.delete(e.session,"pipes",t.x,t.y),c.push({x:t.x,y:t.y}),!0}))})),t.store.pumpsCache.forEach((function(e){Qh(t,e)})),c.forEach((function(e){Kh(t,e.x,e.y)}))}else Xh(t,o,a,{removeCells:!0});r.action.customData=null;var h=Uh({x:a.x*e.cellSize,y:a.y*e.cellSize},{x:t.store.player.x,y:t.store.player.y}),d=h.pan;return h.volMod,Hl(t.session.soundEngine,"build",{volume:.1,restart:!0,playbackRate:.5,pan:d}),void Hl(t.session.soundEngine,"build4",{volume:.3,restart:!0,playbackRate:.5,pan:d})}catch(e){console.error(e)}},Xh=function(n,r,i,s){if(void 0===s&&(s={}),n.environment.context===p.Main&&(n.environment.multithreading.simulation.postAll(n,[f.RemoveStructuresBetween,r,i]),s.playSound)){var o=Uh({x:i.x*e.cellSize,y:i.y*e.cellSize},{x:n.store.player.x,y:n.store.player.y}),a=o.pan;o.volMod,Hl(n.session.soundEngine,"build",{volume:.1,restart:!0,playbackRate:.5,pan:a}),Hl(n.session.soundEngine,"build4",{volume:.3,restart:!0,playbackRate:.5,pan:a})}var l=0;n.store.structures=n.store.structures.filter((function(o,a){return!_d(n,r,i,o,(function(n,r){var i;if(function(t,n){oe.delete(t.session,"structures",n.x,n.y),e.useMultithreading&&t.environment.context===p.Worker&&te.includes(n.type)&&yc.remove(t,"conveyorBeltsGroupedByX",{structure:n})}(n,r),n.environment.context===p.Main)r.type===d.LiquidVent&&Qh(n,r),r.type===d.Pump&&(n.store.pumpsCache=n.store.pumpsCache.filter((function(e){return!(e.type===r.type&&e.x===r.x&&e.y===r.y)}))),r.type===d.GloomEmitter&&(n.store.gloom.emitterPositions=n.store.gloom.emitterPositions.filter((function(e){return!(e.x===r.x&&e.y===r.y)}))),r.type===d.Light&&function(e,t){var n=Vh(t.x,t.y);Hh(e,n.x,n.y)}(n,r),Jl(n,r.x*e.cellSize-2*e.cellSize,r.y*e.cellSize-2*e.cellSize,"build_flash3",200,{fadeOut:!0,animationDelay:5*l}),l++;else if(K.isCellXInThread(r.x,n.environment.threadMeta.startingIndex,n.environment.threadMeta.threadCount)){for(var o=r.x;o<r.x+e.snapGridCellSize;o++){var a=kd(n.store,o,r.y-1);Bd(a)&&(a.isFreeFalling=!0)}Fd(n,r.x,r.y),r.type===d.Collector&&function(t,n){for(var r=n.x;r<n.x+e.snapGridCellSize;r++)for(var i=n.y;i<n.y+e.snapGridCellSize;i++){var s=kd(t.store,r,i);Tc(0,s)&&Mc(t,{x:n.x*e.cellSize,y:n.y*e.cellSize})}}(n,r)}if(s.removeCells){if(r.queued)return;var u=gd(r.type),c=u.shape;if(!c)return;for(var h=0;h<c.length;h++)for(o=0;o<c[h].length;o++)if(0!==c[h][o]){var f=null!==(i=u.offset)&&void 0!==i?i:{x:0,y:0},m=r.x+o+f.x,g=r.y+h+f.y;Ad(n,m,g,t.Empty)}}}))}))},$h=function(t){var n,r,i=t.session,s=Math.ceil((i.camera.x+i.action.customData.start.x)/e.snapGridCellSize),o=Math.ceil((i.camera.y+i.action.customData.start.y)/e.snapGridCellSize),a=Math.floor((i.camera.x+i.action.customData.end.x)/e.snapGridCellSize),l=Math.floor((i.camera.y+i.action.customData.end.y)/e.snapGridCellSize);return s>a&&(s=(n=[a,s])[0],a=n[1]),o>l&&(o=(r=[l,o])[0],l=r[1]),{start:{x:s,y:o},end:{x:a,y:l}}},Yh={0:0,2:1,8:2,10:3,4:4,6:5,12:6,14:7,1:8,3:9,9:10,11:11,5:12,7:13,13:14,15:15},qh=function(t,n,r){var i=0;return Zh(t,n,r-e.snapGridCellSize)&&(i|=1),Zh(t,n+e.snapGridCellSize,r)&&(i|=2),Zh(t,n,r+e.snapGridCellSize)&&(i|=4),Zh(t,n-e.snapGridCellSize,r)&&(i|=8),Yh[i]||0},Kh=function(t,n,r){for(var i=0,s=[{x:n,y:r-e.snapGridCellSize},{x:n+e.snapGridCellSize,y:r},{x:n,y:r+e.snapGridCellSize},{x:n-e.snapGridCellSize,y:r}];i<s.length;i++){var o=s[i],a=oe.get(t.session,"pipes",o.x,o.y);if((null==a?void 0:a.type)===d.Pipe){var l=qh(t,o.x,o.y);a.data=a.data||{},a.data.pipeSpriteIndex=l}}},Zh=function(e,t,n){var r=oe.get(e.session,"pipes",t,n);return void 0!==r&&r.type===d.Pipe},Qh=function(t,n){if([d.Pipe,d.Pump,d.LiquidVent].includes(n.type))if(![d.Pump,d.LiquidVent].includes(n.type)||Zh(t,n.x,n.y)){var r=new Set,i=[],s=[],o=function(n,a){var l="".concat(n,",").concat(a);if(!r.has(l)){r.add(l);var u=oe.get(t.session,"structures",n,a);(null==u?void 0:u.type)===d.Pump?i.push(u):(null==u?void 0:u.type)===d.LiquidVent&&s.push(u);for(var c=0,h=[{x:n,y:a-e.snapGridCellSize},{x:n+e.snapGridCellSize,y:a},{x:n,y:a+e.snapGridCellSize},{x:n-e.snapGridCellSize,y:a}];c<h.length;c++){var f=h[c];Zh(t,f.x,f.y)&&o(f.x,f.y)}}};o(n.x,n.y);for(var a=0,l=i;a<l.length;a++){var u=l[a];u.data=u.data||{},u.data.connectedVents=s.map((function(e){return{x:e.x,y:e.y}}))}}else n.type===d.Pump&&(n.data=n.data||{},n.data.connectedVents=[])},Jh=function(r,i){return s=void 0,o=void 0,l=function(){var s,o,a,l,u,c,h,d,p,m,g,y,v,x;return function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}(this,(function(b){if(!(null===(x=null===(v=i.data)||void 0===v?void 0:v.connectedVents)||void 0===x?void 0:x.length))return[2];if(i.data.waterBuffer=i.data.waterBuffer||0,s=0,o=i.data.connectedVents.map((function(t){for(var n=0,i=t.y+1;i<t.y+e.snapGridCellSize-1;i++)for(var o=t.x+1;o<t.x+e.snapGridCellSize-1;o++)Hd(r,o,i)&&n++;return s+=n,n})),a=i.data.connectedVents.filter((function(e,t){return o[t]>0})),o.filter((function(e){return e>0})),0===a.length)return[2];if(l=0,i.data.waterBuffer>0&&(u=Math.min(i.data.waterBuffer,s),l+=u,i.data.waterBuffer-=u),l<s)for(c=i.y+1;c<i.y+e.snapGridCellSize-1;c++){for(h=i.x+1;h<i.x+e.snapGridCellSize-1&&!(Xd(r,h,c)===n.Water&&(r.environment.multithreading.simulation.post(r,K.getThreadIndexFromCellX(h,r.environment.multithreading.simulation.threads.length),[f.QueueSetCell,[h,c,t.Empty,n.Water]]),++l>=s));h++);if(l>=s)break}if(l>0){for(d=[],a.forEach((function(t){for(var n=t.y+1;n<t.y+e.snapGridCellSize-1;n++)for(var i=t.x+1;i<t.x+e.snapGridCellSize-1;i++)Hd(r,i,n)&&d.push({x:i,y:n,vent:t})})),d.length<l&&(i.data.waterBuffer=l-d.length),m=d.length-1;m>0;m--)p=Math.floor(Math.random()*(m+1)),y=[d[p],d[m]],d[m]=y[0],d[p]=y[1];for(m=0;m<Math.min(l,d.length);m++)g=d[m],r.environment.multithreading.simulation.post(r,K.getThreadIndexFromCellX(g.x,r.environment.multithreading.simulation.threads.length),[f.QueueSetCell,[g.x,g.y,Ch(n.Water,g.x,g.y)]])}return[2]}))},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{i(l.next(e))}catch(e){t(e)}}function r(e){try{i(l.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(n,r)}i((l=l.apply(s,o||[])).next())}));var s,o,a,l},ed=function(){return ed=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},ed.apply(this,arguments)},td={},nd=0,rd=Object.entries(Lh);nd<rd.length;nd++){var id=rd[nd],sd=id[0],od=id[1];od.map&&(td[sd]=od.map((function(e){return e.map((function(e){return{0:t.Empty,3:t.Block,4:t.ConveyorLeft,5:t.ConveyorRight,6:t.ShakerLeft,7:t.ShakerRight,8:t.SlidingBlock,9:t.SlidingBlockLeft,10:t.SlidingBlockRight,11:t.VelocitySoaker,12:t.Grower}[e]}))})))}var ad,ld=function(t,n,r,i,s){if(void 0===s&&(s={}),s.alwaysAvailableZone){var o=s.alwaysAvailableZone;if(n>=o.start.x&&n<o.end.x&&r>=o.start.y&&r<o.end.y)return C.Available}if(!function(e,t,n){var r=e.shared.authorization.data[t+n*e.shared.authorization.width];return!(Hu[r]||[]).includes(P.NoBuild)}(t,n,r))return C.FullyBlocked;var a=i.structureType;if(i.shape&&K.doRectanglesOverlap({x:n*e.cellSize,y:r*e.cellSize,width:e.cellSize*e.snapGridCellSize,height:e.cellSize*e.snapGridCellSize},t.store.player))return C.FullyBlocked;if(a!==d.Pipe&&Dc(t,n,r))return C.FullyBlocked;var l=fd(t,n,r);return a===d.Light&&l?C.FullyBlocked:gd(a).shape&&l?C.PartiallyBlocked:C.Available},ud=function(t,n,r){var i=t.store.options.buildMode;n===d.Collector?i=T.Rectangular:n!==d.Foundation&&(i=T.Linear);var s=i===T.Rectangular?r:bd(t.session.building.start,r,n),o=i===T.Rectangular?null:wd(t,s,n),a=gd(n,o);a.singleBuild&&(s=r);var l=cd(t,s,i).map((function(n){var r=a.structureType;return r!==d.LauncherUp||Gh(t,g.ReverseBuildDirection)||(-90===o&&s.x===n.x&&s.y===n.y?r=0===K.getAngle({x:n.x+e.cellSize/2,y:n.y+e.cellSize/2},{x:t.session.input.mouse.cellPosition.x,y:s.y+e.cellSize/2})?d.LauncherRight:d.LauncherLeft:90===o&&t.session.building.start.x===n.x&&t.session.building.start.y===n.y&&(r=0===K.getAngle({x:n.x+e.cellSize/2,y:n.y+e.cellSize/2},{x:t.session.input.mouse.cellPosition.x,y:t.session.building.start.y+e.cellSize/2})?d.LauncherRight:d.LauncherLeft)),{x:n.x,y:n.y,structureType:r,clearance:ld(t,n.x,n.y,a)}}));return a.singleBuild&&(l=[l[0]]),{positions:l,endPosition:s,structureConfig:a}},cd=function(e,t,n){return n===T.Rectangular?xd(e.session.building.start,t):vd(e.session.building.start,t)},hd=function(t,r,i){var s,o,a;void 0===i&&(i={});var l=null!==(s=i.structureConfig)&&void 0!==s?s:gd(i.structureType,null!==(o=i.angle)&&void 0!==o?o:void 0);if(l.structureType===d.GloomEmitter&&t.store.gloom.emitterPositions.length>0)return Al(t,"Only one ".concat(md[d.GloomEmitter].name," can exist at a time")),null;var u=null!==(a=l.offset)&&void 0!==a?a:{x:0,y:0},c={x:r.x+u.x,y:r.y+u.y},h=pd(l.structureType,c.x,c.y);if(h.type===d.Pipe){if(Zh(t,h.x,h.y))return null;!function(e,t){e.store.pipes.push(t),oe.set(e.session,"pipes",t.x,t.y,t)}(t,h),function(e,t){var n=qh(e,t.x,t.y);t.data={pipeSpriteIndex:n},Kh(e,t.x,t.y)}(t,h)}else h.type===d.Pump&&t.store.pumpsCache.push(h),h.type===d.GloomEmitter&&t.store.gloom.emitterPositions.push({x:h.x,y:h.y}),function(t,n){t.store.structures.push(n),oe.set(t.session,"structures",n.x,n.y,n),e.useMultithreading&&t.environment.context===p.Worker&&(te.includes(n.type)&&yc.set(t,"conveyorBeltsGroupedByX",{structure:n}),n.type===d.Collector&&(Kd(t,n.x)||n.type===d.Collector&&function(t,n){for(var r=n.x;r<n.x+e.snapGridCellSize;r++)for(var i=n.y;i<n.y+e.snapGridCellSize;i++){var s=kd(t.store,r,i);Tc(0,s)&&(Cc(t,n,1),Ac(t,{x:n.x*e.cellSize,y:n.y*e.cellSize}))}}(t,n)))}(t,h);return zu(t,b.BuildShaker,h.type),r.clearance===C.PartiallyBlocked&&(h.queued=!0),i.copiedStructure?(i.copiedStructure.filter&&(h.filter=i.copiedStructure.filter),i.copiedStructure.data&&(h.data=i.copiedStructure.data)):([d.FilterLeft,d.FilterRight].includes(h.type)&&(h.filter=t.store.options.defaultFilter),[d.ShakerLeft,d.ShakerRight].includes(h.type)&&(h.filter={elementType:n.Gold,mode:"allow"}),h.type===d.Grower&&(h.filter={elementType:[n.Gold,n.Petalium],mode:"allow"}),h.type===d.GloomEmitter&&(h.filter={density:1e4,mode:"allow"}),h.type===d.SoundBox&&(h.data=JSON.parse(JSON.stringify({note:t.session.soundBox.selectedNote,octave:1})))),h.type!==d.LiquidVent&&h.type!==d.Pump||Qh(t,h),h.type===d.Light&&function(e,t){var n=Vh(t.x,t.y);e.store.world.lights.push({x:n.x,y:n.y,brightness:.5,size:400,color:[1,1,1,1]}),e.store.world.lights.push({x:n.x,y:n.y,brightness:.8,size:200,color:[1,1,1,1]})}(t,h),e.useMultithreading&&h.type!==d.Pipe&&t.environment.multithreading.simulation.postAll(t,[f.AddStructure,h]),h.queued?h:l.shape?(dd(t,r,l),h):h},dd=function(e,t,n){for(var r,i=n.shape,s=0;s<i.length;s++)for(var o=0;o<i[s].length;o++){var a=i[s][o];if(0!==a){var l=null!==(r=n.offset)&&void 0!==r?r:{x:0,y:0},u=o+t.x+l.x,c=s+t.y+l.y;Ad(e,u,c,a)}}},fd=function(t,n,r){for(var i=0;i<e.cellSize;i++)for(var s=0;s<e.cellSize;s++){if(!e.useMultithreading)throw new Error("Not implemented");var o=t.shared.imageData,a=4*(n+i+(r+s)*o.width);if(0!==o.data[a+3])return!0;if(0!==t.shared.obstacleImageData.data[a+3])return!0}return!1},pd=function(e,t,n){return ed(ed({},{type:e,x:t,y:n}),{lastLaunch:0})},md=((Nh={})[d.ConveyorRight]={shape:td["conveyor-belt-right"],variants:[{id:d.ConveyorLeft,angles:[-180,180]},{id:d.ConveyorRight,angles:[0]}],name:"Conveyor Belt",description:"Transports sand and other solid elements. Hold Shift to reverse direction when building."},Nh[d.ConveyorLeft]={shape:td["conveyor-belt-left"]},Nh[d.ShakerRight]={variants:[{id:d.ShakerLeft,angles:[-45,135]},{id:d.ShakerRight,angles:[45,-135]}],name:"Shaker",description:"Place Wet Sand on the shaker to refine it automatically to Gold (↓) and Slag. Should be built diagonally to allow natural throughput."},Nh[d.ShakerLeft]={},Nh[d.LauncherUp]={shape:td["launcher-up"],variants:[{id:d.LauncherLeft,angles:[-135]},{id:d.LauncherUp,angles:[-90,90]},{id:d.LauncherRight,angles:[-45]}],name:"Launcher",description:"Will launch elements upward (straight or to the sides). You can build a column of launchers to create a vertical conveyor lift."},Nh[d.LauncherLeft]={shape:td["launcher-left"]},Nh[d.LauncherRight]={shape:td["launcher-right"]},Nh[d.SplitterLeft]={shape:td["splitter-left"],variants:[{id:d.SplitterLeft,angles:[180]},{id:d.SplitterRight,angles:[0]}]},Nh[d.SplitterRight]={shape:td["splitter-right"]},Nh[d.Dropper]={shape:td.dropper,variants:[{id:d.Dropper,angles:[-180,-90,0,90,180,-135,-45,45,135]}]},Nh[d.Foundation]={shape:td.foundation,variants:[{id:d.FoundationAngledLeft,angles:[135]},{id:d.FoundationTriangleRightDel,angles:[-45]},{id:d.FoundationAngledRight,angles:[45]},{id:d.FoundationTriangleLeftDel,angles:[-135]},{id:d.Foundation,angles:[-180,-90,0,90,180]}],name:"Block",description:"A basic block foundation. Hold Shift to reverse the direction of angled blocks."},Nh[d.FoundationAngledLeft]={shape:td["foundation-triangle-left"]},Nh[d.FoundationAngledRight]={shape:td["foundation-triangle-right"]},Nh[d.Collector]={variants:[{id:d.Collector,angles:[-180,-90,0,90,180,-135,-45,45,135]}],name:"Collector",description:"A collector tile that you can put gold in, giving you credits ($). Gold needs to stay inside the collector for it to be available (i.e. it needs to have a solid foundation below it). When used it will be removed automatically."},Nh[d.FoundationTriangleRightDel]={shape:td["foundation-triangle-right-del"],variants:[{id:d.FoundationTriangleRightDel,angles:[-180,-90,0,90,180,-135,-45,45,135]}]},Nh[d.FoundationTriangleLeftDel]={shape:td["foundation-triangle-left-del"]},Nh[d.FilterRight]={variants:[{id:d.FilterLeft,angles:[-180,180]},{id:d.FilterRight,angles:[0]}],name:"Filter",description:"Filters out element based on the filter settings. The filtered element goes through while the rest will get transported as usual."},Nh[d.FilterLeft]={},Nh[d.SlidingFoundation]={shape:td["sliding-foundation"],variants:[{id:d.SlidingFoundation,angles:[-180,-90,0,90,180,-135,-45,45,135]}]},Nh[d.VelocitySoaker]={shape:td["velocity-soaker"],variants:[{id:d.VelocitySoaker,angles:[-180,0,180]}],name:"Kinetic Slag Press",description:"Drop Burnt Slag on a soaker from a great height to refine it into Gold and Spores."},Nh[d.Grower]={variants:[{id:d.Grower,angles:[-180,0,180]}],name:"Planter Box",description:"Drop Wet Spores on a planter box to start growing flowers that you can destroy to get Gold and Petals."},Nh[d.SoundBox]={variants:[{id:d.SoundBox,angles:[-180,0,180]}]},Nh[d.Pipe]={variants:[{id:d.Pipe,angles:[-180,-90,0,90,180]}],name:"Pipe",description:"Pipes are used to transport liquids."},Nh[d.Pump]={variants:[{id:d.Pump,angles:[0]}],singleBuild:!0,name:"Pump",description:"Draws in liquid and runs it through the connected pipes."},Nh[d.LiquidVent]={variants:[{id:d.LiquidVent,angles:[0]}],singleBuild:!0,name:"Liquid Vent",description:"Releases liquids from the connected pipe."},Nh[d.Light]={variants:[{id:d.Light,angles:[0]}],singleBuild:!0,name:"Light",description:"A light that illuminates the area."},Nh[d.GloomEmitter]={variants:[{id:d.GloomEmitter,angles:[0]}],singleBuild:!0,name:"Flux Emanator",description:"Converts Voidbloom into Fluxite."},Nh),gd=function(e,t){var n=md[e];if(void 0===t)return ed(ed({structureType:e},void 0!==n.shape?{shape:n.shape}:{}),void 0!==n.singleBuild?{singleBuild:n.singleBuild}:{});for(var r=0,i=n.variants;r<i.length;r++){var s=i[r];if(s.angles.includes(t))return gd(s.id)}return console.error("Invalid angle ".concat(t," for structure type ").concat(e)),ed({structureType:e},{})},yd=function(t,n){return{x:e.snapGridCellSize*Math.round((t-e.cellSize/2)/e.snapGridCellSize),y:e.snapGridCellSize*Math.round((n-e.cellSize/2)/e.snapGridCellSize)}},vd=function(t,n,r){void 0===r&&(r=!1);for(var i={x:n.x,y:n.y},s={x:n.x-t.x,y:n.y-t.y},o=Math.sign(s.x),a=Math.sign(s.y),l=[],u=0;!(i.x===t.x&&i.y===t.y||++u>100);)l.push({x:i.x,y:i.y}),i.x-=o*e.snapGridCellSize,i.y-=a*e.snapGridCellSize;return l.push(t),l},xd=function(t,n){for(var r=Math.min(t.x,n.x),i=Math.max(t.x,n.x),s=Math.min(t.y,n.y),o=Math.max(t.y,n.y),a=[],l=r;l<=i;l+=e.snapGridCellSize)for(var u=s;u<=o;u+=e.snapGridCellSize)a.push({x:l,y:u});return a},bd=function(t,n,r){t={x:t.x+e.cellSize/2,y:t.y+e.cellSize/2},n={x:n.x+e.cellSize/2,y:n.y+e.cellSize/2};var i=K.getAngle(t,n),s=K.getDistance(t,n),o=i,a=md[r];a&&(o=a.variants.flatMap((function(e){return e.angles})).reduce((function(e,t){return Math.abs(t-i)<Math.abs(e-i)?t:e})));var l=K.getPointFromAngleAndDistance(t,o,s);return yd(l.x,l.y)},wd=function(e,t,n){var r=e.session,i=r.building.start.x===t.x&&r.building.start.y===t.y?Sd(r,t,n):K.getAngle(r.building.start,t);return e.session.input.keys[e.session.settings.keyBindings[g.ReverseBuildDirection]]===y.Pressed&&(i=i>0?i-180:i+180),i},Sd=function(t,n,r){switch(r){case d.ConveyorRight:return K.getAngle({x:t.building.start.x+e.cellSize/2,y:t.building.start.y},{x:t.input.mouse.cellPosition.x,y:n.y});case d.LauncherUp:var i={x:n.x+e.cellSize/2,y:n.y+e.cellSize/2},s=t.input.mouse.cellPosition;return s.y<i.y?s.x<i.x?-135:-45:90;default:return 0}},_d=function(t,n,r,i,s){var o=i.x+e.snapGridCellSize,a=i.y+e.snapGridCellSize;return i.x<=r.x&&o>n.x&&i.y<=r.y&&a>n.y&&(s&&s(t,i),!0)},Td={"0, 0, 0":t.SandSoil,"0, 255, 0":{bg:t.SandSoil,fg:t.Grass},"0, 224, 0":{bg:t.SandSoil,fg:t.Moss},"0, 102, 0":{bg:t.Bedrock,fg:t.Divider},"255, 255, 0":t.SporeSoil,"204, 255, 255":t.FreezingIceSoil,"153, 255, 255":{bg:t.SandSoil,fg:t.FreezingIceSoil},"153, 51, 0":t.Fog,"255, 0, 153":t.FogJetpackBlock,"102, 102, 255":{bg:t.FogJetpackBlock,fg:t.FogWater},"102, 102, 102":{bg:t.Bedrock,fg:t.Fog},"153, 102, 255":{bg:t.SandSoil,fg:t.FogWater},"255, 102, 0":{bg:t.SandSoil,fg:t.FogLava},"175, 0, 224":t.Fluxite,"255, 85, 0":t.SandiumSoil,"205, 139, 139":t.Crackstone,"51, 51, 51":{bg:{model:"rgb",fg:ou[2],bg:ou[2]},fg:t.Fog},"0, 0, 255":t.SandSoil},Ed=function(t,n,r,i,s){var o=n.data[r+0],a=n.data[r+1],l=n.data[r+2];if(0!==n.data[r+3]){var u=1;58===o&&211===a&&204===l&&(u=1.1);var c={x:i*e.cellSize,y:s*e.cellSize,color:[o/255,a/255,l/255,1],brightness:u,size:400};t.push(c)}},Cd=function(e,t,n,r,i){var s=t.data[n+0],o=t.data[n+1],a=t.data[n+2];if(0!==t.data[n+3]){var l=R.Artifact1;255===s&&0===o&&0===a?l=R.Artifact1:255===s&&255===o&&0===a&&(l=R.Artifact2),e.push({x:r,y:i,type:l})}},kd=function(e,t,n){return e.world.matrix[n][t]},Ad=function(n,r,i,s){if(e.useMultithreading&&n.environment.context===p.Main){var o=n.environment;o.multithreading.simulation.post(n,K.getThreadIndexFromCellX(r,o.multithreading.simulation.threads.length),[f.SetCell,[r,i,s]])}else{var a=n.environment,l=K.getThreadIndexFromCellX(r,a.threadMeta.threadCount);if(l===a.threadMeta.startingIndex){var u=r+i*n.shared.mapData.width;n.shared.mapData.data[u]=_u(n,s,r,i),xu(n,r,i,s,kd(n.store,r,i)),n.store.world.matrix[i][r]=s,Fd(n,r,i),s===t.Empty&&function(e,t,n){var r=Dc(e,t,n);if(r&&r.queued){var i=e.store.postProcessing.buildCheck.locations;(function(e,t,n){return!!e[n]&&e[n][t]})(i,t,n)||(i[n]||(i[n]=[]),i[n][t]=!0,e.store.postProcessing.buildCheck.cellPositionsToTry.push({x:t,y:n}))}}(n,r,i)}else a.threadMeta.ports[l].postMessage([f.SetCell,[r,i,s]])}},Md=function(n,r,i,s){if(function(t,n,r,i){var s=Dc(t,r.x,r.y);if(s&&s.type===d.SoundBox&&!function(e,t){var n=Dc(e,t.x,t.y);return!!n&&n.type===d.SoundBox}(t,i)){var o=s.data.note.tone;t.environment.postMessage([f.PlaySound,[{id:"piano_".concat(o),opts:{playbackRate:[.5,1,2][s.data.note.octave],volume:1,filters:[{type:"lowpass",frequency:2e3*Math.random()+100}]},modulateDistance:{x:s.x*e.cellSize,y:s.y*e.cellSize}}]])}}(n,0,{x:i,y:s},{x:r.x,y:r.y}),Ec(n,r,{x:i,y:s},{x:r.x,y:r.y}),Ad(n,r.x,r.y,t.Empty),e.useMultithreading&&(r.x,r.y),r.x=i,r.y=s,e.useMultithreading){var o=n.environment,a=K.getThreadIndexFromCellX(i,o.threadMeta.threadCount);if(a!==o.threadMeta.startingIndex)return void n.environment.threadMeta.ports[a].postMessage([f.SetCell,[i,s,r]])}Ad(n,i,s,r),kh(n.store,r)},Pd=function(e,t,n){var r=t.x,i=t.y;t.x=n.x,t.y=n.y,n.x=r,n.y=i,Ad(e,t.x,t.y,t),Ad(e,n.x,n.y,n),kh(e.store,t),kh(e.store,n)},Rd=function(e,n){Ad(e,n.x,n.y,t.Empty)},Id=function(t,n,r){var i=Math.floor(r/e.chunkSize),s=Math.floor(n/e.chunkSize);return t.world.chunks[i][s]},Dd=function(e,t,n){return Id(e,t,n).shouldUpdate},Fd=function(t,n,r,i){if(void 0===i&&(i={}),i.defer)t.store.world.deferredChunkReports.push({x:n,y:r});else{var s=t.store.world.chunks.length-1,o=t.store.world.chunks[0].length-1,a=Math.floor(r/e.chunkSize),l=Math.floor(n/e.chunkSize);if(!(l<0||l>o||a<0||a>s)){if(n%e.chunkSize==0&&l>0)if(e.useMultithreading&&K.isCellXAtThreadSeam(n)){var u=t.environment,c=K.getThreadIndexFromCellX(n-1,u.threadMeta.threadCount);t.environment.threadMeta.ports[c].postMessage([f.SetChunkActive,[n-1,r]])}else Id(t.store,n-1,r).shouldUpdateNextFrame=!0;n%e.chunkSize==e.chunkSize-1&&l<o&&(e.useMultithreading&&K.isCellXAtThreadSeam(n)?(u=t.environment,c=K.getThreadIndexFromCellX(n+1,u.threadMeta.threadCount),t.environment.threadMeta.ports[c].postMessage([f.SetChunkActive,[n+1,r]])):Id(t.store,n+1,r).shouldUpdateNextFrame=!0),r%e.chunkSize==0&&a>0&&(Id(t.store,n,r-1).shouldUpdateNextFrame=!0),r%e.chunkSize==e.chunkSize-1&&a<s&&(Id(t.store,n,r+1).shouldUpdateNextFrame=!0),Id(t.store,n,r).shouldUpdateNextFrame=!0}}},Nd=function(e){return Number.isInteger(e)?Q.includes(e):Q.includes(e.cellType)},Ld=function(e){return Number.isInteger(e)?!Z.includes(e):!Z.includes(e.cellType)},Bd=function(e){return!Number.isInteger(e)&&e.cellType===t.Element},Od=function(e,t){return Array.isArray(t)?t.includes(e.type):e.type===t},zd=function(e,t){return Bd(e)&&Od(e,t)},jd=function(e,t){return Number.isInteger(e)?e===t:e.cellType===t},Ud=function(e){return Number.isInteger(e)&&e===t.Empty},Gd=function(e,n){return Number.isInteger(e)?e===t.Empty:e.cellType===t.Element&&Od(e,n)},Vd=function(e){return function(e,t){return Number.isInteger(e)?t.includes(e):t.includes(e.cellType)}(e,ee)},Hd=function(t,n,r){if(e.useMultithreading){var i=t.shared.obstacleImageData,s=4*(n+r*i.width),o=i.data[s+3],a=t.shared.imageData.data[s+3];return 0===o&&0===a}var l=kd(t.store,n,r);return Ud(l)},Wd=function(t,n,r,i,s){var o;if(void 0===s&&(s={eager:!1}),Ec(t,n,{x:r,y:i},{x:n.x,y:n.y}),n.velocity.y=Math.min(n.velocity.y,60),e.useMultithreading){var a=t.environment,l=K.getThreadIndexFromCellX(r,a.threadMeta.threadCount);if(l!==a.threadMeta.startingIndex){if(s.eager){var u={x:n.x,y:n.y};Md(t,n,r,i),Ad(t,u.x,u.y,Ch(s.eager,u.x,u.y))}else t.environment.threadMeta.ports[l].postMessage([f.SwapElement,[r,i,n]]);return}}var c=null!==(o=s.elementToSwapWith)&&void 0!==o?o:kd(t.store,r,i);Pd(t,n,c)},Xd=function(t,n,r){if(e.useMultithreading){var i=t.shared.imageData,s=4*(n+r*i.width),o=i.data[s],a=i.data[s+1],l=i.data[s+2];return 0===i.data[s+3]?null:t.session.colors.elementByColor[o][a][l]}var u=kd(t.store,n,r);return Ud(u)?null:u.type},$d=function(t,n,r){var i=n+r*t.shared.mapData.width,s=t.shared.mapData.data[i];return 0===s||s===M.Darkness||s===M.Misc||s<e.obstacleBreakpoint?null:t.session.colors.cellTypeOrElementTypeByColorId[s]},Yd=function(e,t,n){var r=t+n*e.shared.mapData.width;return e.shared.mapData.data[r]===M.Darkness},qd=function(t){return t>=e.obstacleBreakpoint},Kd=function(e,t){var n=e.environment;return K.getThreadIndexFromCellX(t,n.threadMeta.threadCount)!==n.threadMeta.startingIndex},Zd=function(){return{id:l.Vacuum,itemType:a.Tool,name:"Vacuum",description:"A vacuum that can be used to move sand effectively."}},Qd=[[0,1,1,1,1,1,1,1,1,1,0],[1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1],[0,1,1,1,1,1,1,1,1,1,0]],Jd=function(e){if(e.session.overrideCamera)return{x:e.session.overrideCamera.x,y:e.session.overrideCamera.y};var t=e.store.player.x+e.store.player.width/2-Math.floor(e.session.rendering.canvas.width/2),n=e.store.player.y+e.store.player.height/2-Math.floor(e.session.rendering.canvas.height/2),r=e.session.rendering.canvas.width*e.session.zoomLevel,i=e.session.rendering.canvas.height*e.session.zoomLevel,s=(r-e.session.rendering.canvas.width)/2,o=(i-e.session.rendering.canvas.height)/2;return{x:Math.round(t-s),y:Math.round(n-o)}},ef=function(e,t,n){e.session.overrideCamera={x:t-Math.floor(e.session.rendering.canvas.width/2),y:n-Math.floor(e.session.rendering.canvas.height/2)}};l.Demolisher,l.Copier,function(e){e[e.Unlocked=0]="Unlocked",e[e.Locked=1]="Locked",e[e.Unknown=2]="Unknown"}(ad||(ad={}));var tf,nf=function(e,t){e.session.ui.tooltip.activeTick=e.store.meta.tick,e.session.ui.tooltip.data=t,Cl(e,k.Tooltip)},rf=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},sf=25,of=Math.sqrt(sf),af=Array.from({length:of},(function(){return Array.from({length:of},(function(){return 1}))})),lf=Math.floor(af.length/2),uf=function(t,n){0===(e.useMultithreading?t.shared.grabber[1]:n.amount)&&(e.useMultithreading?t.shared.grabber[0]=0:n.targetElementType=0)},cf=function(){return cf=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},cf.apply(this,arguments)},hf=function(t){var n,r,i=t.session,s=Math.ceil((i.camera.x+i.action.customData.pos.start.x)/e.snapGridCellSize),o=Math.ceil((i.camera.y+i.action.customData.pos.start.y)/e.snapGridCellSize),a=Math.floor((i.camera.x+i.action.customData.pos.end.x)/e.snapGridCellSize),l=Math.floor((i.camera.y+i.action.customData.pos.end.y)/e.snapGridCellSize);return s>a&&(s=(n=[a,s])[0],a=n[1]),o>l&&(o=(r=[l,o])[0],l=r[1]),{start:{x:s,y:o},end:{x:a,y:l}}},df=function(){return{id:l.Cryoblaster,itemType:a.Tool,name:"Cryoblaster",description:"Used to freeze water and solidify lava.",data:{cooldown:{time:20,last:0}}}},ff=((tf={})[l.Grabber]=function(r,i,s){void 0===s&&(s={});var o=r.session;if(r.environment.context===p.Main){if(0===r.shared.grabber[1]&&!o.action.state[u.Active]){if(!Object.values(o.windows).some((function(e){return e.open}))){var a=o.input.mouse.cellPosition.x,l=o.input.mouse.cellPosition.y;if(a>=0&&a<r.store.world.size.width&&l>=0&&l<r.store.world.size.height){var c=Xd(r,a,l);if(c)return void nf(r,{type:"grabber",elementType:c});var h=$d(r,a,l);if(h)return void nf(r,{type:"grabber",groundCellType:h});var m=Dc(r,a,l);if(m&&(m.type===d.FilterLeft||m.type===d.FilterRight))return void nf(r,{type:"grabber",structure:m})}}return}for(var g=af.length-1;g>=0;g-=1)for(var y=af[g].length-1;y>=0;y-=1){var v=o.input.mouse.cellPosition.x+y-lf,x=o.input.mouse.cellPosition.y+g-lf;if(!Ku(r,v,x))return}return zu(r,b.PickUpSand,{tool:i}),void r.environment.multithreading.simulation.postAll(r,[f.HandleGrabber,o.input.mouse.cellPosition.x,o.input.mouse.cellPosition.y,o.action.state,o.input.mouse.shaken])}var w=s.mouseShaken,S=r.store,_=s.cellPosition?s.cellPosition.x:o.input.mouse.cellPosition.x,T=s.cellPosition?s.cellPosition.y:o.input.mouse.cellPosition.y;if(w&&r.store.tutorial.active&&r.store.tutorial.currentStep<b.RefineGoldWithShaker)!function(t,r,i,s){var o=e.useMultithreading?t.shared.grabber[1]:r.data[1],a=e.useMultithreading?t.shared.grabber[0]:r.data[0];if(a&&0!==o&&a===n.WetSand)for(var l=(e.useMultithreading?t.shared.grabber:r.data).slice(2),u=3,c=af.length-1;c>=0;c-=1)for(var h=af[c].length-1;h>=0;h-=1){var d=i+h-lf,p=s+c-lf,m=t.environment;if(K.getThreadIndexFromCellX(d,m.threadMeta.threadCount)===m.threadMeta.startingIndex){var g=h+c*Math.sqrt(sf);if(l[g]===a){var y=kd(t.store,d,p);if(!Ud(y))return;if(3===u){var v={x:d*e.cellSize,y:p*e.cellSize};t.environment.postMessage([f.PlaySound,[{id:"shake",opts:{volume:.05},modulateDistance:v},{id:"beads",opts:{volume:.15},modulateDistance:v}]])}var x=t.store.tutorial.active&&t.store.tutorial.currentStep===b.RefineWetSand?.5:.25;if(Math.random()<x?e.useMultithreading?(t.store.tutorial.active&&t.environment.postMessage([f.TutorialStep,b.RefineWetSand]),t.shared.grabber[g+2]=n.Gold):(zu(t,b.RefineWetSand),r.data[g+2]=n.Gold):(e.useMultithreading?(t.shared.grabber[g+2]=0,t.shared.grabber[1]-=1):(r.data[g+2]=0,r.data[1]-=1),uf(t,r)),Ad(t,d,p,Ch(n.Slag,d,p)),0==--u)return}}}}(r,i,_,T);else{var E=s.actionState,C=r.shared.grabber[1],k=r.shared.grabber[0],A=r.shared.grabber.slice(2);if(E[u.Start]&&function(t,n,r){if(e.useMultithreading&&0!==n){for(var i=0,s=0;s<Math.sqrt(sf);s++)for(var o=0;o<Math.sqrt(sf);o++)0!==r[o+s*Math.sqrt(sf)]&&i++;0===i&&t.shared.grabber.fill(0)}}(r,C,A),E[u.Active])for(var M=0,P=function(e){var t=[],n=Math.floor(e/2);t.push([n,n]);for(var r=1;r<=n;r++)for(var i=-r;i<=r;i++)for(var s=-r;s<=r;s++)Math.max(Math.abs(s),Math.abs(i))===r&&t.push([n+s,n+i]);return t}(af.length);M<P.length;M++){var R=P[M],I=(y=R[0],g=R[1],v=_+y-lf,x=T+g-lf,r.environment);if(K.getThreadIndexFromCellX(v,I.threadMeta.threadCount)===I.threadMeta.startingIndex){var D=kd(S,v,x);Bd(D)&&!zd(D,rf(rf([],ne,!0),[n.Particle],!1))&&0===A[F=y+g*Math.sqrt(sf)]&&(k&&D.type!==k||(Ad(r,v,x,t.Empty),kc(r,D,v,x,"deduct"),e.useMultithreading?(k||(k=D.type,r.shared.grabber[0]=D.type),r.shared.grabber[F+2]=D.type,r.shared.grabber[1]++):(k||(k=D.type,i.data[0]=D.type),i.data[F+2]=D.type,i.data[1]++)))}}else if(0!==C)for(g=af.length-1;g>=0;g-=1)for(y=af[g].length-1;y>=0;y-=1){var F,N=A[F=y+g*Math.sqrt(sf)];if(0!==N&&(v=_+y-lf,x=T+g-lf,I=r.environment,K.getThreadIndexFromCellX(v,I.threadMeta.threadCount)===I.threadMeta.startingIndex&&(D=kd(S,v,x),Ud(D)))){e.useMultithreading?(r.shared.grabber[F+2]=0,r.shared.grabber[1]-=1):(i.data[F+2]=0,i.data[1]-=1);var L=Ch(N,v,x);Ad(r,v,x,L),kc(r,L,v,x,"add"),uf(r,i)}}}},tf[l.Demolisher]=Wh,tf[l.GrapplingHook]=cc,tf[l.Vacuum]=function(t,r){if(t.session.action.state[u.Active]){var i={x:(t.store.player.x+t.store.player.width/2)/e.cellSize,y:(t.store.player.y+t.store.player.height/2)/e.cellSize},s={x:t.session.action.point.x/e.cellSize,y:t.session.action.point.y/e.cellSize},o=K.getAngle(i,s),a={x:120*-(c=K.getVelocityFromAngle(o)).x,y:120*-c.y},l={x:Math.floor(t.session.action.point.x/e.cellSize),y:Math.floor(t.session.action.point.y/e.cellSize)};e.useMultithreading?t.environment.multithreading.simulation.postAll(t,[f.Vacuum,[r,l,a]]):function(t,r,i,s){for(var o=0;o<Qd.length;o++)for(var a=0;a<Qd[o].length;a++)if(0!==Qd[o][a]){var l=Math.floor(Qd.length/2),u=i.x+a-l,c=i.y+o-l;if(e.useMultithreading){var h=t.environment;if(K.getThreadIndexFromCellX(u,h.threadMeta.threadCount)!==h.threadMeta.startingIndex)continue}var d=kd(t.store,u,c);Bd(d)&&(Ah(d,n.Particle)||Ah(d,n.Water)||(d.hasBeenUpdated=!1,ie(t,d,s)))}}(t,0,l,a)}var c},tf[l.Copier]=function(t,n){var r=t.store,i=t.session;if(i.action.state[u.Start]){if(i.action.customData&&i.action.customData.selectedStructures){if(i.action.customData.mode===A.Selected){var s={x:Math.floor(i.action.customData.start.x/e.snapGridCellSize)*e.snapGridCellSize,y:Math.floor(i.action.customData.start.y/e.snapGridCellSize)*e.snapGridCellSize};if(i.input.mouse.cellPosition.x>=s.x&&i.input.mouse.cellPosition.x<=i.action.customData.end.x&&i.input.mouse.cellPosition.y>=s.y&&i.input.mouse.cellPosition.y<=i.action.customData.end.y&&Dc(t,i.input.mouse.cellPosition.x,i.input.mouse.cellPosition.y)){i.action.customData.mode=A.Moving;var a={x:i.input.mouse.cellPosition.x,y:i.input.mouse.cellPosition.y};return i.action.customData.pos={end:a},void(i.action.customData.mouseOffset={x:i.input.mouse.cellPosition.x-s.x,y:i.input.mouse.cellPosition.y-s.y})}}if(i.action.customData=null,Cl(t,k.ShortcutHelper),!Gh(t,g.Marquee)){var c=yf(t);c&&c.type===o.Tool&&c.id===l.Copier||(i.input.mouse.clicked=!1,i.input.mouse.pressed=!1,i.input.mouse.released=!1)}}var h={x:i.input.mouse.position.x,y:i.input.mouse.position.y};i.action.customData={pos:{start:h,end:h}}}else if(i.action.state[u.Active]){if(!i.action.customData)return;if(!i.action.customData.pos)return;i.action.customData.pos.end={x:i.input.mouse.position.x,y:i.input.mouse.position.y}}else if(i.action.state[u.End]){if(!i.action.customData)return;if(i.action.customData.mode===A.Moving){s=i.action.customData.start;var f=i.action.customData.end;return t.session.input.keys[t.session.settings.keyBindings[g.Copy]]!==y.Pressed&&Xh(t,s,f,{removeCells:!0}),function(t,n){var r={x:Math.floor(t.input.mouse.cellPosition.x/e.snapGridCellSize)*e.snapGridCellSize,y:Math.floor(t.input.mouse.cellPosition.y/e.snapGridCellSize)*e.snapGridCellSize},i=r.x,s=r.y;i-=Math.floor(t.action.customData.mouseOffset.x/e.snapGridCellSize)*e.snapGridCellSize,s-=Math.floor(t.action.customData.mouseOffset.y/e.snapGridCellSize)*e.snapGridCellSize,i=Math.floor(i/e.snapGridCellSize)*e.snapGridCellSize,s=Math.floor(s/e.snapGridCellSize)*e.snapGridCellSize;var o=t.action.customData.selectedStructures.length;t.action.customData.selectedStructures.forEach((function(t,r){var a={x:i+t.x,y:s+t.y},l=1+(r-(o-1))/(0-(o-1));isNaN(l)&&(l=1);var u=Uh({x:a.x*e.cellSize,y:a.x*e.cellSize},{x:n.store.player.x,y:n.store.player.y}),c=u.pan,h=(u.volMod,[]);0===r&&(Hl(n.session.soundEngine,"build_start",{volume:.05,restart:!0,pan:c}),1!==o&&Hl(n.session.soundEngine,"build_start2",{volume:.1,restart:!0,pan:c})),(o-1-r)%12==0&&h.push({id:"build",opts:{volume:.1,restart:!0,playbackRate:.5*l,pan:c}}),(o-1-r)%24==0&&h.push({id:"build4",opts:{volume:.3,restart:!0,playbackRate:l,pan:c}});var d=gd(t.type);ld(n,a.x,a.y,d)===C.Available?(hd(n,{x:a.x,y:a.y},{structureType:t.type,copiedStructure:t}),Jl(n,a.x*e.cellSize-2*e.cellSize,a.y*e.cellSize-2*e.cellSize,"build_flash4",200,{fadeOut:!0,animationDelay:5*r,sounds:h})):Jl(n,a.x*e.cellSize-2*e.cellSize,a.y*e.cellSize-2*e.cellSize,"build_flash3",200,{fadeOut:!0,animationDelay:5*r,sounds:h})})),t.action.customData=null,Cl(n,k.ShortcutHelper)}(i,t),i.action.customData=null,void Cl(t,k.ShortcutHelper)}try{var p=hf(t),m=p.start,v=p.end,x=r.structures.filter((function(e){return!!_d(t,m,v,e)})).map((function(t){return cf(cf({type:t.type,originalPos:{x:t.x,y:t.y},x:t.x-Math.floor(m.x/e.snapGridCellSize)*e.snapGridCellSize,y:t.y-Math.floor(m.y/e.snapGridCellSize)*e.snapGridCellSize},t.filter?{filter:JSON.parse(JSON.stringify(t.filter))}:{}),t.data&&t.type!==d.Collector?{data:JSON.parse(JSON.stringify(t.data))}:{})}));if(0===x.length)return i.action.customData=null,void Cl(t,k.ShortcutHelper);var b=Math.min.apply(Math,x.map((function(e){return e.x}))),w=Math.min.apply(Math,x.map((function(e){return e.y})));return x=x.map((function(e){return cf(cf({},e),{x:e.x-b,y:e.y-w})})),i.action.customData={marqueeSelected:!0,mode:A.Selected,start:{x:m.x+b,y:m.y+w},end:v,selectedStructures:x,mouseOffset:{x:i.input.mouse.cellPosition.x-(m.x+b),y:i.input.mouse.cellPosition.y-(m.y+w)}},void Cl(t,k.ShortcutHelper)}catch(e){console.error(e)}}},tf[l.Teleporter]=function(e,t,n){void 0===n&&(n={}),e.session.action.state[u.Start]&&function(e,t,n){var r=Jd(e),i={x:t,y:n};if(!e.session.lerpCamera){e.session.lerpCamera={start:r,time:Date.now(),duration:1e3};var s=function(e,t){var n={x:t.x-Math.floor(e.session.rendering.canvas.width/2),y:t.y-Math.floor(e.session.rendering.canvas.height/2)};return{x:Math.round(n.x),y:Math.round(n.y)}}(e,i);e.session.overrideCamera=s,setTimeout((function(){e.session.lerpCamera=!1}),1e3)}}(e,e.session.input.mouse.worldPosition.x,e.session.input.mouse.worldPosition.y)},tf[l.PipeRemover]=function(e,t){Wh(e,t)},tf[l.Hauler]=function(t,n,r){if(void 0===r&&(r={}),t.session.action.state[u.Start]){var i=Math.round(t.session.input.mouse.worldPosition.x/e.cellSize)*e.cellSize+e.cellSize/2,s=Math.round(t.session.input.mouse.worldPosition.y/e.cellSize)*e.cellSize+e.cellSize/2;t.session.action.customData={type:"hauler",origin:{x:i,y:s}}}if(t.session.action.state[u.End]){if(!t.session.action.customData)return;if("hauler"!==t.session.action.customData.type)return;var o=t.session.action.customData.origin,a=Math.round(t.session.input.mouse.worldPosition.x/e.cellSize)*e.cellSize+e.cellSize/2,l=Math.round(t.session.input.mouse.worldPosition.y/e.cellSize)*e.cellSize+e.cellSize/2;if(K.getDistance(o,{x:a,y:l})<5*e.cellSize)return Al(t,"Drag to create a path for the hauler."),void(t.session.action.customData=null);var c=2*t.store.upgrades.hauler.maxDrones.level,h=t.store.drones.filter((function(e){return e.type===D.Hauler})).length;if(h>=c){var d=t.store.drones.filter((function(e){return e.type===D.Hauler})).sort((function(e,t){return e.id-t.id}))[0];Ml(t,d,Math.floor(d.x/e.cellSize),Math.floor(d.y/e.cellSize)),function(e,t){Bl(e,"drones",t.id),Lc(e,t)}(t,d)}(function(e,t,n,r,i){var s=i;t===D.Hauler&&(s=Pl(Pl({},i),{movingToTarget:!1,currentSpeed:0,pauseTimer:0,inventory:{elements:new Array(25).fill(0),amount:0}}));var o={id:e.store.meta.nextId.drone++,x:n,y:r,type:t,data:s};Nc(e,o),Ll(e,"drones","hauler",o.id,o.x,o.y)})(t,D.Hauler,t.store.player.x+t.store.player.width/2,t.store.player.y+t.store.player.height/2,{origin:{x:o.x,y:o.y},target:{x:a,y:l}}),t.session.action.customData=null}},tf[l.Cryoblaster]=function(t,r){if(t.session.action.state[u.Active]&&Lu(t.store,r.data.cooldown)){for(var i=t.store.player.x+t.store.player.width/2,s=t.store.player.y+t.store.player.height/2,o=t.session.input.mouse.worldPosition.x,a=t.session.input.mouse.worldPosition.y,l=Math.atan2(a-s,o-i),c=K.getGunArmAxis(t.store.player),h=K.getAngle(c,t.session.input.mouse.worldPosition),d=K.getPointFromAngleAndDistance(c,h,6*e.cellSize),f=!1,p=0;p<5;p++){var m=d.x+8*(Math.random()-.5),g=d.y+8*(Math.random()-.5),y=Math.floor(m/e.cellSize),v=Math.floor(g/e.cellSize);if(Hd(t,y,v)){var x=.3*(Math.random()-.5),b=240*(.8+.4*Math.random()),w=l+x,S={x:Math.cos(w)*b,y:Math.sin(w)*b},_=Ch(n.FreezingIce,y,v);ie(t,_,S),f=!0}}f&&(Hl(t.session.soundEngine,"freeze",{fadeOut:.2+.6*Math.random(),playbackRate:.6+.8*Math.random(),volume:.04+.04*Math.random()}),Hl(t.session.soundEngine,"flamethrower",{fadeOut:.2+.6*Math.random(),playbackRate:.3+.4*Math.random(),volume:.04+.04*Math.random()}))}},tf),pf=function(t){var n,r=t.store;if(!(r.tutorial.active&&r.tutorial.currentStep<b.Dig)){var i=t.session,h={x:r.player.x+r.player.width/2,y:r.player.y+r.player.height/2-2},p=K.getAngle(h,i.input.mouse.worldPosition);if(K.getDistance(h,i.input.mouse.worldPosition)<16?i.action.point={x:i.input.mouse.worldPosition.x,y:i.input.mouse.worldPosition.y}:i.action.point=K.getPointFromAngleAndDistance(h,p,16),i.action.state=((n={})[u.Start]=i.input.mouse.clicked,n[u.Active]=i.input.mouse.pressed,n[u.End]=i.input.mouse.released,n),e.useMultithreading&&(t.shared.actionState[0]=+i.action.state[u.Start],t.shared.actionState[1]=+i.action.state[u.Active],t.shared.actionState[2]=+i.action.state[u.End]),!e.debug.active||!Wf.spawnElements(t,i)){var m=gf(t);if(null!==m)switch(m.type){case o.Weapon:!function(t,n){if(t.session.action.state[u.Active]||t.session.action.state[u.End]){var r=n.id,i=t.store.player.inventory.find((function(e){return e.itemType===a.Weapon&&e.id===r}));if(i)if(i.id!==l.Flamethrower||function(t,n){var r={x:Math.round((n.x+n.width/2)/e.cellSize),y:Math.round((n.y+n.height-1)/e.cellSize)},i=r.x,s=r.y,o=t.shared.authorization.data[i+s*t.shared.authorization.width];return!(Hu[o]||[]).includes(P.NoFlamethrower)}(t,t.store.player))if(t.session.action.state[u.End])lc(t,n);else{var o=!1;if(i.id===l.Shovel&&t.store.upgrades.shovel.momentum.level>1){var h=K.getAngle({x:(t.store.player.x+t.store.player.width/2)/e.cellSize,y:(t.store.player.y+t.store.player.height/2)/e.cellSize},{x:t.session.action.point.x/e.cellSize,y:t.session.action.point.y/e.cellSize}),d=K.getVelocityFromAngle(h);if(d.x*=60,d.y*=60,t.store.player.velocity.x=3*d.x,d.y<0&&(t.store.player.velocity.y=1.5*d.y),Math.random()<.3)for(var p=Math.floor(5*Math.random())+1,m=h+Math.PI+.3*(Math.random()-.5),g=K.getVelocityFromAngle(m),y=0;y<p;y++){var v=1*(Math.random()-.5),x=60*K.getRandomFloatBetween(.1,2);Fc(t,t.store.player.x+t.store.player.width/2+10*(Math.random()-.5),t.store.player.y+t.store.player.height/2+10*(Math.random()-.5),{x:-g.x*x+60*v,y:-g.y*x+60*v})}}i.abilities.forEach((function(n){var r=n.cooldown.time;if(i.id===l.Gun){if(1===t.store.upgrades.gun.bullets.level&&2===n.levelRequirement)return;var a=t.store.upgrades.gun.speed.level;r=Vu(n.cooldown.time,a,"gun")}else if(i.id===l.Shovel)a=t.store.upgrades.shovel.speed.level,r=Vu(n.cooldown.time,a,"shovel");else if(i.id===l.Bouncer){var h=t.store.upgrades.digger.cooldown.level;r=Vu(n.cooldown.time,h,"digger")}if(Lu(t.store,n.cooldown,r)){if(i.id===l.RocketLauncher){var d=t.store.player.weaponsMeta.rocketLauncher.ammo;if(0===d.current)return void(t.session.action.state[u.Start]&&Hl(t.session.soundEngine,"ammo_empty",{volume:.15}));d.current===ac(t)&&(d.reload.last=t.store.meta.time),d.current--,Cl(t,k.Hotbar)}if(n.ammo){if(0===n.ammo.current){if(!Lu(t.store,n.ammo.reload))return;n.ammo.current=n.ammo.max}n.ammo.current--,0===n.ammo.current&&(n.ammo.reload.last=t.store.meta.time)}if(!o){if(n.type===c.Dig){if(t.store.upgrades.shovel.momentum.level>1&&(m=Date.now())-ec>=500){var p=Math.max(r/1e3*1.2,.8004);Hl(t.session.soundEngine,"boost",{volume:K.getRandomFloatBetween(.15,.25),fadeOut:p}),Hl(t.session.soundEngine,"boost_overlay",{volume:K.getRandomFloatBetween(.03,.07),fadeOut:p}),ec=m}t.session.soundEngine.gate.dig?(Hl(t.session.soundEngine,"dig",{fadeOut:.4}),Hl(t.session.soundEngine,"dig",{playbackRate:.5,fadeOut:.7}),Hl(t.session.soundEngine,"gun_overlay",{volume:.3}),zu(t,b.Dig)):t.store.tutorial.currentStep!==b.Dig||t.store.hints.nonDestructible||(Al(t,"Look for soft materials, like grass or dirt.",{duration:1e4}),t.store.hints.nonDestructible=!0)}else if(n.type===c.Shoot){var m=Date.now(),g=Ju?m-Ju:100;Zu=Math.max(.2,g<200?.95*Zu:Qu),Ju=m,n.attributes.projectileBlueprint.type===s.Fire?t.session.action.state[u.Start]&&(Hl(t.session.soundEngine,"flamethrower"),Hl(t.session.soundEngine,"flamethrower_overlay"),Hl(t.session.soundEngine,"flamethrower2",{fadeOut:1})):(Hl(t.session.soundEngine,"gun",{volume:Zu/2}),Hl(t.session.soundEngine,"gun_overlay",{volume:Zu/2}),Hl(t.session.soundEngine,"dig",{volume:Zu/2,playbackRate:.5}),Hl(t.session.soundEngine,"pistol",{volume:Zu/4}),n.attributes.projectileBlueprint.type===s.Rocket&&(Hl(t.session.soundEngine,"rocket_launch",{volume:.05,fadeOut:1}),Hl(t.session.soundEngine,"jet",{volume:.05,pan:0})))}o=!0}switch(n.type){case c.Dig:var y={x:Math.floor(t.session.action.point.x/e.cellSize),y:Math.floor(t.session.action.point.y/e.cellSize)},v=y.x,x=y.y,w=K.getAngle({x:(t.store.player.x+t.store.player.width/2)/e.cellSize,y:(t.store.player.y+t.store.player.height/2)/e.cellSize},{x:t.session.action.point.x/e.cellSize,y:t.session.action.point.y/e.cellSize}),S=K.getVelocityFromAngle(w);S.x*=60,S.y*=60,e.useMultithreading?t.environment.multithreading.simulation.postAll(t,[f.Dig,[i,v,x,S]]):nc(t,i,v,x,S);break;case c.Shoot:rc(t,n.attributes.projectileBlueprint);break;case c.Spray:ic(t,n.attributes.elementType)}}}))}else lc(t,n);else console.error("Weapon not found in inventory")}}(t,m);break;case o.Building:!function(t,n){var r=t.session;if(r.action.state[u.Start]||r.action.state[u.End]){if(!r.building.placing)return r.building.start=yd(r.input.mouse.cellPosition.x,r.input.mouse.cellPosition.y),r.building.placing=!0,void Cl(t,k.ShortcutHelper);r.action.state[u.Start]&&r.action.state[u.Active]&&(console.log("Resetting after broken mouse state"),r.building.placing=!1,r.input.mouse.clicked=!1,r.input.mouse.pressed=!1,r.input.mouse.released=!1,Cl(t,k.ShortcutHelper));var i=ud(t,n,yd(r.input.mouse.cellPosition.x,r.input.mouse.cellPosition.y)),s=null,o=i.positions.length;i.positions.reverse().forEach((function(n,r){return i=void 0,a=void 0,u=function(){var i,a,l,u,c,h;return function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}(this,(function(d){return n.clearance!==C.FullyBlocked&&(i=hd(t,n,{structureType:n.structureType}))&&(s=i),a=1+(r-(o-1))/(0-(o-1)),isNaN(a)&&(a=1),l=Uh({x:n.x*e.cellSize,y:n.x*e.cellSize},{x:t.store.player.x,y:t.store.player.y}),u=l.pan,l.volMod,c=[],0===r&&(Hl(t.session.soundEngine,"build_start",{volume:.05,restart:!0,pan:u}),1!==o&&Hl(t.session.soundEngine,"build_start2",{volume:.1,restart:!0,pan:u})),(o-1-r)%3==0&&c.push({id:"build",opts:{volume:.1,restart:!0,playbackRate:.5*a,pan:u}}),(o-1-r)%6==0&&c.push({id:"build4",opts:{volume:.3,restart:!0,playbackRate:a,pan:u}}),h=n.clearance===C.FullyBlocked?"build_flash3":"build_flash",Jl(t,n.x*e.cellSize-2*e.cellSize,n.y*e.cellSize-2*e.cellSize,h,200,{fadeOut:!0,animationDelay:20*r,sounds:c}),[2]}))},new((l=void 0)||(l=Promise))((function(e,t){function n(e){try{s(u.next(e))}catch(e){t(e)}}function r(e){try{s(u.throw(e))}catch(e){t(e)}}function s(t){t.done?e(t.value):function(e){return e instanceof l?e:new l((function(t){t(e)}))}(t.value).then(n,r)}s((u=u.apply(i,a||[])).next())}));var i,a,l,u})),s&&s.type===d.Pipe&&Qh(t,s),r.building.placing=!1,t.session.building.amountOfTiles=0,Cl(t,k.ShortcutHelper)}}(t,m.id);break;case o.Tool:!function(e,t){var n=e.store.player.inventory.find((function(e){return e.itemType===a.Tool&&e.id===t}));ff[n.id](e,n)}(t,m.id)}}}},mf=function(e){var t=gf(e);if(!t)return null;switch(t.type){case o.Weapon:return e.store.player.inventory.find((function(e){return e.itemType===a.Weapon&&e.id===t.id}));case o.Building:return null;case o.Tool:return e.store.player.inventory.find((function(e){return e.itemType===a.Tool&&e.id===t.id}))}},gf=function(e){return e.store,Gh(e,g.Marquee)&&!e.session.building.placing||e.session.action.customData&&e.session.action.customData.marqueeSelected?{type:o.Tool,id:l.Copier}:Gh(e,g.Demolish)&&!e.session.building.placing?{type:o.Tool,id:l.Demolisher}:null!==e.session.building.activeStructureType?{type:o.Building,id:e.session.building.activeStructureType}:yf(e)},yf=function(e){return e.store.player.action?e.store.player.action:vf(e)},vf=function(e){var t=e.store;return null===t.player.hotbar.activeSlotIndex?null:t.player.hotbar.items[t.player.hotbar.activeSlotIndex]};e.fps;function xf(e,t,n){return e+(t-e)*n}var bf=function(e,t,n,r){var i=e.texture.baseTexture.width,s=e.texture.baseTexture.height,o=t.x,a=t.y,l=Math.min(n,i-o),u=Math.min(r,s-a);e.texture.frame=new An(o,a,l,u)};function wf(e,t,n,r,i,s){for(var o=new Uint8Array(r*i),a=0;a<i;a++){var l=(n+a)*s+t,u=l+r;o.set(e.subarray(l,u),a*r)}return o}var Sf,_f,Tf,Ef=function(n){var r=n.session.rendering,i={x:Math.floor(n.session.camera.x/e.cellSize),y:Math.floor(n.session.camera.y/e.cellSize)};e.useMultithreading&&(n.session.rendering,n.session.resolution.width,e.cellSize,n.session.resolution.height,e.cellSize),e.useExperimentalRenderer||(r.worldChannel.context.clearRect(0,0,r.canvas.width,r.canvas.height),r.obstacleChannel.context.clearRect(0,0,r.canvas.width,r.canvas.height)),r.pixi.dynamic2D.context.clearRect(0,0,r.canvas.width,r.canvas.height),r.overlayContext.clearRect(0,0,r.canvas.width,r.canvas.height),r.canvas.width,e.cellSize,n.session.zoomLevel,r.canvas.height,e.cellSize,n.session.zoomLevel;var u={width:n.session.resolution.width/e.cellSize,height:n.session.resolution.height/e.cellSize},c=wf(n.shared.mapData.data,i.x,i.y,u.width,u.height,n.shared.mapData.width);r.pixi.tilemap.set(c),r.pixi.tilemapTexture.update();var h=wf(n.shared.wallData.data,i.x,i.y,u.width,u.height,n.shared.wallData.width);r.pixi.wallTilemap.set(h),r.pixi.wallTilemapTexture.update(),r.pixi.filter.uniforms.lightPosition=[n.session.resolution.width/2,n.session.resolution.height/2],r.pixi.outlineElementsFilter.uniforms.magicalFixturePoint=[-n.session.camera.x,1080+n.session.camera.y],r.pixi.filter.uniforms.magicalFixturePoint=[-n.session.camera.x,1080+n.session.camera.y],r.pixi.filter.uniforms.lights=function(e){var t=Kl(Kl([],e.session.lights,!0),e.store.world.lights,!0),n=t.filter((function(e){return null!==e})).map((function(t){var n,r=void 0!==t.tick?iu(e,t):0;n=void 0!==t.duration&&void 0!==t.tick?-1===t.duration?t.brightness:(t.duration-r)/(t.duration/t.brightness):t.brightness;var i=t.size,s=t.color,o=s[0],a=s[1],l=s[2],u=s[3];return[t.x-e.session.camera.x,e.session.resolution.height-(t.y-e.session.camera.y),n,i,o,a,l,u]})),r=t.filter((function(e){return null===e})).map((function(){return[0,0,0,0,0,0,0,0]}));return Kl(Kl([],n,!0),r,!0).flat()}(n),r.pixi.filter.uniforms.uDisableRaycastStepping=n.session.settings.disableShadows,r.pixi.outlineElementsFilter.uniforms.uCameraPosition=[n.session.camera.x,n.session.camera.y],r.pixi.filter.uniforms.uCameraPosition=[n.session.camera.x,n.session.camera.y],r.pixi.skyFilter.uniforms.uCameraPosition=[n.session.camera.x,n.session.camera.y],r.pixi.skyFilter.uniforms.uPlayerPosition=[n.session.camera.x+1e3,n.session.camera.y+500],r.pixi.skyFilter.uniforms.uLockSkyColor=n.session.settings.lockSkyColor;var f=e.playtest?2e3:1500;r.pixi.mountainsSprite.tilePosition.x=Math.round(-n.session.camera.x/2)+Math.round(n.session.resolution.width/2)-f,r.pixi.mountainsSprite.y=Math.round(-n.session.camera.y/2)+Math.round(n.session.resolution.height/2)+525,r.pixi.treesSprite.tilePosition.x=Math.round(-n.session.camera.x/1.5)+Math.round(n.session.resolution.width/2)-f-500,r.pixi.treesSprite.y=Math.round(-n.session.camera.y/1.5)+Math.round(n.session.resolution.height/2)+925,function(e){bf(e.session.rendering.pixi.fogSprite,e.session.camera,e.session.rendering.canvas.width,e.session.rendering.canvas.height)}(n),e.useExperimentalRenderer&&r.pixi.dynamicSprites.forEach((function(t){t.texture.update(),r.canvas.style.transform="translate(-".concat(n.session.camera.x%e.cellSize,"px, -").concat(n.session.camera.y%e.cellSize,"px)")})),e.useExperimentalRenderer||kf(n),function(e){!function(e){var t=e.store.player.x+e.store.player.width/2,n=e.store.player.y+e.store.player.height/2,r=e.session.input.mouse.worldPosition.x<t;e.session.rendering.pixi.sprites.player.container.scale.x=r?-1:1;var i={x:Math.round(t-e.session.camera.x),y:Math.round(n-e.session.camera.y-2)};e.session.rendering.pixi.sprites.player.container.x=i.x,e.session.rendering.pixi.sprites.player.container.y=i.y;var s=K.getGunArmAxis(e.store.player),o=K.getAngle(s,e.session.input.mouse.worldPosition),a=Ol(r?Math.PI-o:o)+(r?Math.PI:0);e.session.rendering.pixi.sprites.player.weapon.rotation=a,e.session.rendering.pixi.sprites.player.shovel.rotation=a,e.session.rendering.pixi.sprites.player.offhandShovel.rotation=a,e.session.rendering.pixi.sprites.player.builder.rotation=a,e.session.rendering.pixi.sprites.player.muzzleFlash.rotation=a}(e);for(var t=0;t<e.store.projectiles.length;t+=1){var n=e.store.projectiles[t];if(a=e.session.rendering.pixi.sprites.projectiles[n.id])if(a.x=n.x-e.session.camera.x,a.y=n.y-e.session.camera.y,n.type===s.Bouncer){var r=Math.atan2(n.velocity.y,n.velocity.x);a.rotation=r}else a.rotation=Ol(n.initialAngle)}for(t=0;t<e.session.explosions.length;t+=1){var i=e.session.explosions[t];(a=i.sprite).x=i.x-e.session.camera.x,a.y=i.y-e.session.camera.y}for(t=0;t<e.store.drones.length;t+=1){var o=e.store.drones[t];(a=e.session.rendering.pixi.sprites.drones[o.id])&&Il(e,o,a)}for(t=0;t<e.store.worldItems.length;t+=1){var a,l=e.store.worldItems[t];(a=e.session.rendering.pixi.sprites.worldItems[l.id])&&Nl(e,l,a)}}(n),function(t){var n=mf(t);if(n&&n.itemType===a.Tool&&n.id===l.Grabber){var r=af.length,i=Math.floor(r/2),s=Cf(t,(t.session.input.mouse.cellPosition.x-i)*e.cellSize+.5-1,(t.session.input.mouse.cellPosition.y-i)*e.cellSize+.5-1);if(t.session.rendering.overlayContext.strokeStyle="yellow",t.session.rendering.overlayContext.lineWidth=1,t.session.rendering.overlayContext.strokeRect(Math.floor(s.x)-.5,Math.floor(s.y)-.5,r*e.cellSize+1,r*e.cellSize+1),0!==(e.useMultithreading?t.shared.grabber[1]:n.data[1]))for(var o=(e.useMultithreading?t.shared.grabber:n.data).slice(2),u=0;u<af.length;u+=1)for(var c=0;c<af[u].length;c+=1){var h=o[c+u*Math.sqrt(sf)];if(0!==h){var d=t.session.colors.scheme.element[h][0],f=d[0],p=d[1],m=d[2];t.session.rendering.overlayContext.fillStyle="rgb(".concat(f,", ").concat(p,", ").concat(m,")");var g=Cf(t,(t.session.input.mouse.cellPosition.x+c-lf)*e.cellSize,(t.session.input.mouse.cellPosition.y+u-lf)*e.cellSize);t.session.rendering.overlayContext.fillRect(g.x,g.y,e.cellSize,e.cellSize)}}}}(n),function(n){if(!(n.store.tutorial.active&&n.store.tutorial.currentStep<b.Dig)){var r=gf(n);if(r&&(r.type===o.Weapon&&r.id===l.Shovel||r.type===o.Tool&&r.id===l.Vacuum)){var i=!0,s=e.cellSize;if(r.type===o.Weapon){var a=n.store.player.inventory.find((function(e){return e.id===r.id})),u=n.store.meta.time-a.abilities[0].cooldown.last;if(r.id===l.Shovel){var c=n.store.upgrades.shovel.speed.level,h=Vu(a.abilities[0].cooldown.time,c,"shovel");i=Bu(n.store,a.abilities[0].cooldown,h),s=e.cellSize*(u/h)}else i=Bu(n.store,a.abilities[0].cooldown),s=e.cellSize*(u/a.abilities[0].cooldown.time)}var d=r.id===l.Shovel?tc:Qd;n.session.soundEngine.gate.dig=!1;for(var f=0;f<d.length;f+=1)for(var p=0;p<d[f].length;p+=1)if(0!==d[f][p]){var m=Math.floor(n.session.action.point.x/e.cellSize)+p-Math.floor(d.length/2),g=Math.floor(n.session.action.point.y/e.cellSize)+f-Math.floor(d.length/2);if(!(m<0||g<0)){if(e.useMultithreading){var y=r.id===l.Shovel?n.shared.obstacleImageData:n.shared.imageData,v=4*(m+g*y.width);if(0===y.data[v+3])continue}else{var x=kd(n.store,m,g);if(!Nd(x))continue}var w=Cf(n,m*e.cellSize,g*e.cellSize),S=$d(n,m,g);S&&Nd(S)&&S!==t.Crackstone&&(n.session.soundEngine.gate.dig=!0,n.session.rendering.pixi.dynamic2D.context.fillStyle="yellow",i?n.session.rendering.pixi.dynamic2D.context.fillRect(w.x,w.y,e.cellSize,e.cellSize):n.session.rendering.pixi.dynamic2D.context.fillRect(w.x,w.y,s,s))}}}}}(n),function(t){var n=mf(t);if(n&&n.itemType===a.Tool&&n.id===l.Hauler){var r=t.session.input.mouse.worldPosition,i=Math.round(r.x/e.cellSize)*e.cellSize+e.cellSize/2,s=Math.round(r.y/e.cellSize)*e.cellSize+e.cellSize/2,o=t.session.rendering.overlayContext,u=e.cellSize;if(t.store.drones.forEach((function(e){if(e.type===D.Hauler){var n=Cf(t,e.data.origin.x-2.5*u,e.data.origin.y-2.5*u);o.strokeStyle="rgba(0, 255, 0, 0.8)",o.strokeRect(Math.floor(n.x)+.5,Math.floor(n.y)+.5,5*u,5*u);var r=Cf(t,e.data.target.x-2.5*u,e.data.target.y-2.5*u);o.strokeStyle="rgba(255, 85, 85, 0.8)",o.strokeRect(Math.floor(r.x)+.5,Math.floor(r.y)+.5,5*u,5*u)}})),!t.session.action.customData||"hauler"!==t.session.action.customData.type){var c=Cf(t,i-2.5*u,s-2.5*u);return o.strokeStyle="rgba(0, 255, 0, 1.0)",void o.strokeRect(Math.floor(c.x)+.5,Math.floor(c.y)+.5,5*u,5*u)}var h=t.session.action.customData.origin,d=Cf(t,h.x-2.5*u,h.y-2.5*u);o.strokeStyle="rgba(0, 255, 0, 1.0)",o.strokeRect(Math.floor(d.x)+.5,Math.floor(d.y)+.5,5*u,5*u);var f=Cf(t,i-2.5*u,s-2.5*u);o.strokeStyle="rgba(255, 85, 85, 1.0)",o.strokeRect(Math.floor(f.x)+.5,Math.floor(f.y)+.5,5*u,5*u)}}(n),function(e){e.session.effects=e.session.effects.filter((function(t){var n,r=e.session.rendering.images[t.sprite],i=r.height,s=r.width/i,o=t.duration/s,a=e.store.meta.time-t.time;if(t.opts.animationDelay&&a<t.opts.animationDelay?n=0:(t.opts.animationDelay&&(a-=t.opts.animationDelay),n=Math.floor(a/o),t.opts.sounds&&0===n&&t.opts.sounds.forEach((function(t){Hl(e.session.soundEngine,t.id,t.opts)}))),n>s-1)return!1;var l=e.session.rendering.overlayContext;t.opts.fadeOut&&(l.globalAlpha=(s-n)/s);var u=Cf(e,t.x,t.y);return l.drawImage(r.image,n*i,0,i,i,u.x,u.y,i,i),1!==l.globalAlpha&&(l.globalAlpha=1),!0}))}(n),function(t){if(t.session.input.mouse.available){var n=function(e){var t=gf(e);return t?t.type!==o.Building?null:t.id:null}(t);if(null!==n){var r=yd(t.session.input.mouse.cellPosition.x,t.session.input.mouse.cellPosition.y);if(t.session.rendering.overlayContext.fillStyle="#0dd30d",t.session.building.placing){var i=ud(t,n,r);if(Gh(t,g.Ruler)){var s=i.positions,a={width:0,height:0};if(s.length>0){var l=Math.min.apply(Math,s.map((function(e){return e.x}))),u=Math.max.apply(Math,s.map((function(e){return e.x}))),c=Math.min.apply(Math,s.map((function(e){return e.y}))),h=Math.max.apply(Math,s.map((function(e){return e.y})));a.width=Math.abs(u-l)/e.snapGridCellSize+1,a.height=Math.abs(h-c)/e.snapGridCellSize+1}nf(t,{type:"building",dimensions:a,amountOfTiles:i.positions.length})}if(i.positions.forEach((function(n){var r=n.structureType;Rf(t,{type:r,x:n.x,y:n.y},{ctx:t.session.rendering.overlayContext,placing:!0});var i=t.session.rendering.images[function(e){switch(e){case C.Available:return"build_flash";case C.PartiallyBlocked:return"build_flash2";case C.FullyBlocked:return"build_flash3"}}(n.clearance)],s=e.cellSize*e.snapGridCellSize+2,o=Cf(t,n.x*e.cellSize-1,n.y*e.cellSize-1);t.session.rendering.overlayContext.drawImage(i.image,7,7,s,s,o.x,o.y,s,s)})),n===d.ConveyorRight||n===d.FilterRight){var f=K.getAngle({x:t.session.building.start.x+e.cellSize/2,y:t.session.building.start.y+e.cellSize/2},{x:t.session.input.mouse.cellPosition.x,y:i.endPosition.y+e.cellSize/2});Gh(t,g.ReverseBuildDirection)&&(f=f>0?f-180:f+180);var p=e.cellSize*e.snapGridCellSize,m=p,y=Cf(t,i.endPosition.x*e.cellSize+m/2,i.endPosition.y*e.cellSize+p/2),v=y.x,x=y.y,b=(f+90)*Math.PI/180;t.session.rendering.overlayContext.fillStyle="#0dd30d",t.session.rendering.overlayContext.translate(v,x),t.session.rendering.overlayContext.rotate(b),t.session.rendering.overlayContext.beginPath(),t.session.rendering.overlayContext.moveTo(-m/2,p/2),t.session.rendering.overlayContext.lineTo(m/2,p/2),t.session.rendering.overlayContext.lineTo(0,-p/2),t.session.rendering.overlayContext.closePath(),t.session.rendering.overlayContext.fill(),t.session.rendering.overlayContext.rotate(-b),t.session.rendering.overlayContext.translate(-v,-x)}}else{var w=Cf(t,r.x*e.cellSize,r.y*e.cellSize);t.session.rendering.overlayContext.fillRect(w.x,w.y,e.cellSize*e.snapGridCellSize,e.cellSize*e.snapGridCellSize)}}}}(n),function(t){var n=mf(t);if(n&&n.itemType===a.Tool&&n.id===l.Copier&&null!==t.session.action.customData&&void 0!==t.session.action.customData.selectedStructures){var r=yd(t.session.input.mouse.cellPosition.x,t.session.input.mouse.cellPosition.y);t.session.action.customData.selectedStructures.forEach((function(n){var i=t.session.action.customData.mode===A.Selected?{x:t.session.action.customData.start.x+n.x,y:t.session.action.customData.start.y+n.y}:{x:r.x+n.x-Math.floor(t.session.action.customData.mouseOffset.x/e.snapGridCellSize)*e.snapGridCellSize,y:r.y+n.y-Math.floor(t.session.action.customData.mouseOffset.y/e.snapGridCellSize)*e.snapGridCellSize};i.x=Math.floor(i.x/e.snapGridCellSize)*e.snapGridCellSize,i.y=Math.floor(i.y/e.snapGridCellSize)*e.snapGridCellSize;var s=gd(n.type),o=ld(t,i.x,i.y,s,{alwaysAvailableZone:{start:{x:Math.floor(t.session.action.customData.start.x/e.snapGridCellSize)*e.snapGridCellSize,y:Math.floor(t.session.action.customData.start.y/e.snapGridCellSize)*e.snapGridCellSize},end:{x:Math.floor(t.session.action.customData.end.x/e.snapGridCellSize)*e.snapGridCellSize,y:Math.floor(t.session.action.customData.end.y/e.snapGridCellSize)*e.snapGridCellSize}}});o===C.Available&&Rf(t,{type:n.type,x:i.x,y:i.y},{ctx:t.session.rendering.overlayContext});var a=o===C.Available||t.session.action.customData.mode===A.Selected?t.session.rendering.images.build_flash4:t.session.rendering.images.build_flash3,l=e.cellSize*e.snapGridCellSize+2,u=Cf(t,i.x*e.cellSize-1,i.y*e.cellSize-1);if(t.session.rendering.overlayContext.drawImage(a.image,7,7,l,l,u.x,u.y,l,l),(o===C.Available||t.session.action.customData.mode===A.Selected)&&t.session.input.keys[t.session.settings.keyBindings[g.Copy]]===y.Pressed){var c=t.session.rendering.images.copy,h={width:e.snapGridCellSize*e.cellSize,height:e.snapGridCellSize*e.cellSize};u=Cf(t,i.x*e.cellSize,i.y*e.cellSize),t.session.rendering.overlayContext.drawImage(c.image,0,0,h.width,h.height,u.x,u.y,h.width,h.height)}}))}}(n),function(e){var t=mf(e);!t||t.itemType!==a.Tool||t.id!==l.Demolisher&&t.id!==l.PipeRemover||null!==e.session.action.customData&&e.session.action.customData.start&&(e.session.rendering.overlayContext.lineWidth=2,e.session.rendering.overlayContext.strokeStyle="red",e.session.rendering.overlayContext.beginPath(),e.session.rendering.overlayContext.rect(e.session.action.customData.start.x,e.session.action.customData.start.y,e.session.action.customData.end.x-e.session.action.customData.start.x,e.session.action.customData.end.y-e.session.action.customData.start.y),e.session.rendering.overlayContext.stroke())}(n),function(e){var t=mf(e);t&&t.itemType===a.Tool&&t.id===l.Copier&&null!==e.session.action.customData&&void 0!==e.session.action.customData.pos&&e.session.action.customData.mode!==A.Moving&&(e.session.rendering.overlayContext.lineWidth=2,e.session.rendering.overlayContext.strokeStyle="rgb(0, 204, 255)",e.session.rendering.overlayContext.beginPath(),e.session.rendering.overlayContext.rect(e.session.action.customData.pos.start.x,e.session.action.customData.pos.start.y,e.session.action.customData.pos.end.x-e.session.action.customData.pos.start.x,e.session.action.customData.pos.end.y-e.session.action.customData.pos.start.y),e.session.rendering.overlayContext.stroke())}(n),function(e){if(e.store.player.grapplingHook){var t=e.store.player.grapplingHook.eyelet||e.store.projectiles.find((function(e){return e.type===s.GrapplingHook}));t?function(e,t,n){var r=K.getGunArmAxis(e.store.player),i=r.x,s=r.y,o={x:i-e.session.camera.x,y:s-e.session.camera.y},a={x:t.x-e.session.camera.x,y:t.y-e.session.camera.y},l=Math.sqrt(Math.pow(a.x-o.x,2)+Math.pow(a.y-o.y,2)),u=o,c=(e.store.meta.time-n)/20/16;c>1&&(c=1);for(var h=1;h<=200;h++){var d=h/200,f=xf(o.x,a.x,d),p=xf(o.y,a.y,d),m=Math.min(h,200-h)/20,g=10*Math.min(1,m),y=Math.sin(2*d*Math.PI/.2)*g*(1-c),v={x:(a.y-o.y)/l,y:-(a.x-o.x)/l},x={x:f+y*v.x,y:p+y*v.y};e.session.rendering.overlayContext.strokeStyle="black",e.session.rendering.overlayContext.beginPath(),e.session.rendering.overlayContext.moveTo(u.x,u.y),e.session.rendering.overlayContext.lineTo(x.x,x.y),e.session.rendering.overlayContext.lineWidth=2,e.session.rendering.overlayContext.stroke(),u=x}}(e,t,e.store.player.grapplingHook.fireTime):console.error("No eyelet found!")}}(n),e.debug.drawChunks&&Wf.drawChunks2(n),r.pixi.dynamic2D.texture.update(),r.pixi.app.renderer.render(r.pixi.app.stage)},Cf=function(e,t,n){return{x:Math.round(t-e.session.camera.x),y:Math.round(n-e.session.camera.y)}},kf=function(t){t.session;e.cellSize,e.cellSize;e.cellSize,e.cellSize,t.store.pipes.forEach((function(e){Rf(t,e)})),t.store.structures.forEach((function(n){var r={x:n.x*e.cellSize,y:n.y*e.cellSize},i=e.snapGridCellSize*e.cellSize;(function(e,t,n,r,i){return!(e.session.camera.x>=t+r||e.session.camera.x+e.session.resolution.width<=t||e.session.camera.y>=n+i||e.session.camera.y+e.session.resolution.height<=n)})(t,r.x,r.y,i,i)&&(Rf(t,n),Af(t,n),Mf(t,n))}))},Af=function(t,n){var r=mf(t);if(r&&r.itemType===a.Tool&&r.id===l.Demolisher&&null!==t.session.action.customData)if(t.session.action.customData.start){var i=$h(t);if(i&&_d(t,i.start,i.end,n)){var s=t.session.rendering.images.x,o={width:e.snapGridCellSize*e.cellSize,height:e.snapGridCellSize*e.cellSize},u=Cf(t,n.x*e.cellSize,n.y*e.cellSize);t.session.rendering.overlayContext.drawImage(s.image,0,0,o.width,o.height,u.x,u.y,o.width,o.height)}}else console.error("No start in customData",t.session.action.customData)},Mf=function(t,n){var r=mf(t);if(r&&r.itemType===a.Tool&&r.id===l.Copier&&null!==t.session.action.customData&&void 0!==t.session.action.customData.pos&&t.session.action.customData.mode!==A.Moving){var i=hf(t);if(i&&_d(t,i.start,i.end,n)){var s=t.session.rendering.images.build_flash4,o=e.cellSize*e.snapGridCellSize+2,u=Cf(t,n.x*e.cellSize-1,n.y*e.cellSize-1);t.session.rendering.overlayContext.drawImage(s.image,7,7,o,o,u.x,u.y,o,o)}}},Pf=((Sf={})[d.ConveyorLeft]={imageName:"conveyor_left"},Sf[d.ConveyorRight]={imageName:"conveyor_right"},Sf[d.LauncherUp]={imageName:"launcher",size:{width:4*e.cellSize,height:4*e.cellSize}},Sf[d.LauncherLeft]={imageName:"launcher_left",size:{width:4*e.cellSize,height:6*e.cellSize}},Sf[d.LauncherRight]={imageName:"launcher_right",size:{width:4*e.cellSize,height:6*e.cellSize}},Sf[d.SplitterLeft]={imageName:"splitter_left",size:{width:7*e.cellSize,height:4*e.cellSize}},Sf[d.SplitterRight]={imageName:"splitter_right",offset:{x:-3*e.cellSize,y:0},size:{width:7*e.cellSize,height:4*e.cellSize}},Sf[d.Collector]={imageName:"sell",size:{width:4*e.cellSize,height:4*e.cellSize}},Sf[d.VelocitySoaker]={imageName:"velocity"},Sf[d.Grower]={imageName:"farm",size:{width:4*e.cellSize,height:4*e.cellSize}},Sf[d.SoundBox]={imageName:"sound_box",size:{width:4*e.cellSize,height:4*e.cellSize}},Sf[d.FilterRight]={imageName:"filter_right"},Sf[d.FilterLeft]={imageName:"filter_left"},Sf[d.ShakerRight]={imageName:"shaker_right",size:{width:4*e.cellSize,height:20}},Sf[d.ShakerLeft]={imageName:"shaker_left",size:{width:4*e.cellSize,height:20}},Sf[d.Foundation]={imageName:"block"},Sf[d.FoundationAngledRight]={imageName:"triangle_right"},Sf[d.FoundationTriangleRightDel]={imageName:"triangle_right_del"},Sf[d.FoundationAngledLeft]={imageName:"triangle_left"},Sf[d.FoundationTriangleLeftDel]={imageName:"triangle_left_del"},Sf[d.Pipe]={imageName:"pipes",size:{width:4*e.cellSize,height:4*e.cellSize}},Sf[d.Pump]={imageName:"pump",size:{width:4*e.cellSize,height:4*e.cellSize}},Sf[d.LiquidVent]={imageName:"liquid_vent",size:{width:4*e.cellSize,height:4*e.cellSize}},Sf[d.Light]={imageName:"light"},Sf[d.GloomEmitter]={imageName:"gloom_emitter"},Sf),Rf=function(t,n,r){var i,s,o,a;if(void 0===r&&(r={}),!e.debug.doNotDrawStructures)if(n.queued){var l=t.session.rendering.images.build_flash2,u=e.cellSize*e.snapGridCellSize+2,c=Cf(t,n.x*e.cellSize-1,n.y*e.cellSize-1);t.session.rendering.overlayContext.drawImage(l.image,39,7,u,u,c.x,c.y,u,u)}else{gd(n.type);var h=t.session.rendering.pixi.dynamic2D.context;if([d.LauncherUp,d.LauncherLeft,d.LauncherRight,d.SplitterLeft,d.SplitterRight].includes(n.type)){var f=Pf[n.type],p=(l=t.session.rendering.images[f.imageName],u=null!==(i=f.size)&&void 0!==i?i:{width:e.snapGridCellSize*e.cellSize,height:e.snapGridCellSize*e.cellSize},null!==(s=f.offset)&&void 0!==s?s:{x:0,y:0});r.placing||zh(t,n,"launchers"),c=Cf(t,n.x*e.cellSize+p.x,n.y*e.cellSize+p.y),h.drawImage(l.image,0,0,u.width+2,u.height+2,c.x-1,c.y-1,u.width+2,u.height+2)}else{if([d.ConveyorLeft,d.ConveyorRight].includes(n.type)){l=t.session.rendering.images[Pf[n.type].imageName],u=e.snapGridCellSize*e.cellSize;var m=n.type===d.ConveyorLeft?t.shared.conveyorBeltsAnimationIndex[0]:t.shared.conveyorBeltsAnimationIndex[1];c=Cf(t,n.x*e.cellSize,n.y*e.cellSize),h.drawImage(l.image,16*m,0,16,16,c.x,c.y,16,16);var g=Cf(t,n.x*e.cellSize,(n.y+1)*e.cellSize),y=oe.get(t.session,"structures",n.x-e.snapGridCellSize,n.y);y&&y.type===n.type||(h.fillStyle="black",h.fillRect(g.x,g.y,e.cellSize,2*e.cellSize));var v=Cf(t,(n.x+3)*e.cellSize,(n.y+1)*e.cellSize),x=oe.get(t.session,"structures",n.x+e.snapGridCellSize,n.y);return x&&x.type===n.type||(h.fillStyle="black",h.fillRect(v.x,v.y,e.cellSize,2*e.cellSize)),void(r.placing||zh(t,n,"conveyors"))}if(n.type!==d.Collector)if(n.type!==d.VelocitySoaker)if(n.type!==d.Grower)if(n.type!==d.Pipe)if(n.type!==d.Pump)if(n.type!==d.LiquidVent)if(n.type!==d.Light)if(n.type!==d.GloomEmitter)if(n.type!==d.SoundBox)if([d.FilterRight,d.FilterLeft].includes(n.type))l=n.type===d.FilterLeft?t.session.rendering.images.filter_left:t.session.rendering.images.filter_right,u=e.snapGridCellSize*e.cellSize,m=n.type===d.FilterLeft?t.shared.conveyorBeltsAnimationIndex[0]:t.shared.conveyorBeltsAnimationIndex[1],c=Cf(t,n.x*e.cellSize,n.y*e.cellSize),h.drawImage(l.image,18*m,0,18,18,c.x-1,c.y-1,18,18);else{if([d.ShakerRight,d.ShakerLeft].includes(n.type)){l=n.type===d.ShakerLeft?t.session.rendering.images.shaker_left:t.session.rendering.images.shaker_right;var b=Math.floor(t.store.meta.time/(10*t.session.timestep.frameDuration))%2;return c=Cf(t,n.x*e.cellSize,n.y*e.cellSize),h.drawImage(l.image,18*b,0,18,22,c.x-1,c.y-1,18,22),void(r.placing||zh(t,n,"shakers"))}n.type!==d.Foundation?n.type!==d.FoundationAngledRight?n.type!==d.FoundationTriangleRightDel?n.type!==d.FoundationAngledLeft?n.type!==d.FoundationTriangleLeftDel?e.debug.showUnderlyingCellsInStructures:(l=t.session.rendering.images.triangle_left_del,u=e.snapGridCellSize*e.cellSize,c=Cf(t,n.x*e.cellSize,n.y*e.cellSize),h.drawImage(l.image,0,0,e.snapGridCellSize,e.snapGridCellSize,c.x,c.y,u,u)):(l=t.session.rendering.images.triangle_left,u=e.snapGridCellSize*e.cellSize,c=Cf(t,n.x*e.cellSize,n.y*e.cellSize),h.drawImage(l.image,0,0,e.snapGridCellSize,e.snapGridCellSize,c.x,c.y,u,u)):(l=t.session.rendering.images.triangle_right_del,u=e.snapGridCellSize*e.cellSize,c=Cf(t,n.x*e.cellSize,n.y*e.cellSize),h.drawImage(l.image,0,0,e.snapGridCellSize,e.snapGridCellSize,c.x,c.y,u,u)):(l=t.session.rendering.images.triangle_right,u=e.snapGridCellSize*e.cellSize,c=Cf(t,n.x*e.cellSize,n.y*e.cellSize),h.drawImage(l.image,0,0,e.snapGridCellSize,e.snapGridCellSize,c.x,c.y,u,u)):(l=t.session.rendering.images.block,u=e.snapGridCellSize*e.cellSize,c=Cf(t,n.x*e.cellSize,n.y*e.cellSize),h.drawImage(l.image,0,0,e.snapGridCellSize,e.snapGridCellSize,c.x,c.y,u,u))}else l=t.session.rendering.images.sound_box,u=e.snapGridCellSize*e.cellSize,c=Cf(t,n.x*e.cellSize,n.y*e.cellSize),h.drawImage(l.image,0,0,u,u,c.x,c.y,u,u);else{l=t.session.rendering.images.gloom_emitter,c=(u=e.snapGridCellSize*e.cellSize,Cf(t,n.x*e.cellSize,n.y*e.cellSize));h.drawImage(l.image,0,0,u,u,c.x,c.y,u,u)}else{f=Pf[n.type];l=t.session.rendering.images[f.imageName],u=e.snapGridCellSize*e.cellSize,c=Cf(t,n.x*e.cellSize,n.y*e.cellSize);h.drawImage(l.image,0,0,u,u,c.x,c.y,u,u)}else{l=t.session.rendering.images.liquid_vent,u=e.snapGridCellSize*e.cellSize,c=Cf(t,n.x*e.cellSize,n.y*e.cellSize);h.drawImage(l.image,0,0,u,u,c.x,c.y,u,u)}else{l=t.session.rendering.images.pump,u=e.snapGridCellSize*e.cellSize,c=Cf(t,n.x*e.cellSize,n.y*e.cellSize);h.drawImage(l.image,0,0,u,u,c.x,c.y,u,u)}else{l=t.session.rendering.images.pipes,u=e.snapGridCellSize*e.cellSize,c=Cf(t,n.x*e.cellSize,n.y*e.cellSize);3===(_=null!==(a=null===(o=n.data)||void 0===o?void 0:o.pipeSpriteIndex)&&void 0!==a?a:0)&&n.x/4%2!=0&&(_=16),12===_&&n.y/4%2==0&&(_=17);var w=_%6,S=Math.floor(_/6);h.drawImage(l.image,16*w,16*S,16,16,c.x,c.y,16,16)}else{l=t.session.rendering.images.farm,u=e.snapGridCellSize*e.cellSize,c=Cf(t,n.x*e.cellSize,n.y*e.cellSize);h.drawImage(l.image,0,0,18,18,c.x-1,c.y-1,18,18)}else{l=t.session.rendering.images.velocity,u=e.snapGridCellSize*e.cellSize,c=Cf(t,n.x*e.cellSize,n.y*e.cellSize);h.drawImage(l.image,0,0,18,417,c.x-1,c.y-1-400,18,417)}else{l=t.session.rendering.images.sell,u=e.snapGridCellSize*e.cellSize,c=Cf(t,n.x*e.cellSize,n.y*e.cellSize);var _=n.data&&n.data.hasGold?1:0;h.drawImage(l.image,16*_,0,u,u,c.x,c.y,u,u)}}}},If=((_f={})[l.Demolisher]="x",_f[l.Copier]="copy",function(e,t){if(!(e.store.tutorial.active&&e.store.tutorial.currentStep<b.Hotbar)&&t!==e.store.player.hotbar.activeSlotIndex){zu(e,b.Hotbar,t),lc(e,gf(e)),e.store.player.action=null,e.store.player.hotbar.activeSlotIndex=t,Cl(e,k.Hotbar);var n=vf(e);n&&(n.id===d.FilterRight&&(e.session.windows.building.filterConfig=!0,Cl(e,k.FilterConfig)),n.type===o.Weapon&&Hl(e.session.soundEngine,"cocking"),n.type!==o.Building&&e.session.building.placing&&(e.session.building.placing=!1,Cl(e,k.ShortcutHelper))),e.session.building.activeStructureType=null,e.session.action.customData=null,Cl(e,k.ShortcutHelper),zl(e,n),Cl(e,k.ShortcutHelper)}}),Df=function(e,t){var n=e.store.player.hotbar.items.findIndex((function(e){return null===e}));-1!==n&&(e.store.player.hotbar.items[n]=t,Cl(e,k.Hotbar))},Ff=function(){return Ff=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Ff.apply(this,arguments)},Nf=function(e,t,n){var r;return void 0===n&&(n=S.Unknown),r=Bf(t,e.id)?S.Researched:e.id===w.Refining1||n===S.Researched?S.Available:n===S.Available?S.Visible:n===S.Unknown?S.Hidden:S.Unknown,Ff(Ff({},e),{status:r,children:e.children?e.children.map((function(e){return Nf(e,t,r)})):[]})},Lf=function(e){return e.status===S.Hidden?null:Ff(Ff({},e),{children:e.children?e.children.map(Lf).filter((function(e){return null!==e})):[]})},Bf=function(e,t){return!!e.store.player.tech[t]},Of=function(){return[{id:w.Refining1,name:"Refining 1",description:"Unlocks Shakers that can separate Gold and Slag from Wet Sand. Build diagonally and drop Wet Sand on it.",cost:20,unlocks:{structures:[d.ShakerRight]},children:[{id:w.Logistics1,name:"Logistics 1",description:"Unlocks Conveyor Belts and Launchers.",cost:50,unlocks:{structures:[d.ConveyorRight,d.LauncherUp]},children:[{id:w.Guns1,name:"Guns 1",description:"Unlocks Gun.",cost:500,unlocks:{items:[l.Gun]},children:[{id:w.Filters1,name:"Filters 1",description:"Unlocks Filters that work like conveyor belts but can allow certain elements to pass through.",cost:100,unlocks:{structures:[d.FilterRight]},children:[{id:w.Pipes1,name:"Pipes 1",description:"Unlocks Pipes, Pumps and Liquid Vents.",cost:2e3,unlocks:{structures:[d.Pipe,d.Pump,d.LiquidVent],items:[l.PipeRemover]},children:[{id:w.Filters2,name:"Filters 2",cost:1e3,unavailable:!0}]}]},{id:w.Refining2,name:"Refining 2",description:"Unlocks Kinetic Slag Press to further process Slag into more Gold.",cost:1e3,unlocks:{structures:[d.VelocitySoaker]},children:[{id:w.Guns2,name:"Guns 2",description:"Unlocks Rocket Launcher.",cost:3e3,unlocks:{items:[l.RocketLauncher]},children:[{id:w.Guns3,name:"Guns 3",cost:1e4,unavailable:!0}]},{id:w.Refining3,name:"Refining 3",description:"Unlocks Planter Boxes.",cost:2e3,unlocks:{structures:[d.Grower]},children:[{id:w.Refining4,name:"Refining 4",description:"Unlocks Flux Emanator to create Fluxite from Voidbloom.",cost:4e3,unlocks:{structures:[d.GloomEmitter]},children:[{id:w.Refining5,name:"Refining 5",cost:7e3,unavailable:!0}]}]}]},{id:w.Tools1,name:"Tools 1",description:"Unlocks Flamethrower to melt ice and vaporize water.",cost:250,unlocks:{items:[l.Flamethrower]},children:[{id:w.Tools2,name:"Tools 2",description:"Unlocks Vacuum to move piles of sand.",cost:500,unlocks:{items:[l.Vacuum]},children:[{id:w.Tools3,name:"Tools 3",description:"Unlocks Cryoblaster to freeze water and solidify lava.",cost:1500,unlocks:{items:[l.Cryoblaster]},children:[{id:w.Tools4,name:"Tools 4",description:"Unlocks Grappling Hook to move around.",cost:3500,unlocks:{items:[l.GrapplingHook]}}]}]},{id:w.Lights1,name:"Lights 1",description:"Unlocks wall-mounted Lights.",cost:750,unlocks:{structures:[d.Light]},children:[{id:w.Drones1,name:"Drones 1",description:"Unlocks drones: Digger and Hauler.",cost:3e3,unlocks:{items:[l.Bouncer,l.Hauler]},children:[{id:w.Drones2,name:"Drones 2",cost:5e3,unavailable:!0}]}]}]}]}]}]}]},zf=function(r,i){if(r.store.resources.gold<i.cost)return!1;switch(Hl(r.session.soundEngine,"research"),i.id){case w.Refining1:zu(r,b.UnlockRefining);break;case w.Logistics1:zu(r,b.UnlockLogistics)}return r.store.player.tech[i.id]=!0,function(r,i){r.store.resources.gold-=i,Cl(r,k.Resources);var s=r.store.structures.filter((function(e){return e.type===d.Collector}));s.sort((function(e,t){return t.y-e.y}));var o=i;s.some((function(i){for(var s=e.snapGridCellSize-1;s>=0;s--)for(var a=0;a<e.snapGridCellSize;a++)if(Xd(r,i.x+a,i.y+s)===n.Gold&&(Ad(r,i.x+a,i.y+s,t.Empty),Cc(r,i,-1),0==--o))return!0;return!1}))}(r,i.cost),i.unlocks&&(i.unlocks.structures&&i.unlocks.structures.forEach((function(e){jf(r,e),Df(r,{id:e,type:o.Building})})),i.unlocks.items&&i.unlocks.items.forEach((function(e){var t=Uf[e]();r.store.player.inventory.push(t),Df(r,{id:e,type:t.itemType===a.Weapon?o.Weapon:o.Tool})}))),Cl(r,k.Management),Au(r),!0},jf=function(e,t){e.store.player.buildings.push(t)},Uf=((Tf={})[l.Gun]=function(){return{id:l.Gun,itemType:a.Weapon,abilities:[{type:c.Shoot,cooldown:{time:167,last:0},attributes:{projectileBlueprint:{opts:{speed:600},type:s.Bullet,attributes:{blastRadius:3}}}},{type:c.Shoot,levelRequirement:2,cooldown:{time:167,last:0},attributes:{projectileBlueprint:{opts:{speed:600,angle:5},type:s.Bullet,attributes:{blastRadius:3}}}},{type:c.Shoot,levelRequirement:2,cooldown:{time:167,last:0},attributes:{projectileBlueprint:{opts:{speed:600,angle:-5},type:s.Bullet,attributes:{blastRadius:3}}}}],name:"Gun",description:"Shoot a hole."}},Tf[l.RocketLauncher]=sc,Tf[l.Bouncer]=function(){return{id:l.Bouncer,itemType:a.Weapon,abilities:[{type:c.Shoot,cooldown:{time:1200,last:0},attributes:{projectileBlueprint:{opts:{speed:300},type:s.Bouncer,attributes:{hp:1}}}}],name:"Digger",description:"Drone that digs autonomously until hitting a hard surface."}},Tf[l.Shotgun]=function(){return{id:l.Shotgun,itemType:a.Weapon,abilities:[{type:c.Shoot,cooldown:{time:100,last:0},attributes:{projectileBlueprint:{opts:{speed:600},type:s.Bullet,attributes:{blastRadius:3}}}},{type:c.Shoot,cooldown:{time:100,last:0},attributes:{projectileBlueprint:{opts:{speed:600,angle:5},type:s.Bullet,attributes:{blastRadius:3}}}},{type:c.Shoot,cooldown:{time:100,last:0},attributes:{projectileBlueprint:{opts:{speed:600,angle:-5},type:s.Bullet,attributes:{blastRadius:3}}}}],name:"Shotgun",description:"Shoot a hole with slugs."}},Tf[l.Flamethrower]=oc,Tf[l.Vacuum]=Zd,Tf[l.GrapplingHook]=function(){return{id:l.GrapplingHook,itemType:a.Tool,name:"Grappling Hook",description:"A grappling hook that can be used to swing around."}},Tf[l.PipeRemover]=function(){return{id:l.PipeRemover,itemType:a.Tool,name:"Pipe Remover",description:"Used to remove pipes."}},Tf[l.Hauler]=function(){return{itemType:a.Tool,id:l.Hauler,name:"Hauler",description:"Drone that can haul items."}},Tf[l.Cryoblaster]=df,Tf);const Gf={run:function(e,t){switch(t){case"flamethrower":e.store.player.inventory.push(oc());break;case"vacuum":case"vacuum":e.store.player.inventory.push(Zd());break;case"gun":e.store.player.inventory.push(Uf[l.Gun]());break;case"rocket":e.store.player.inventory.push(Uf[l.RocketLauncher]());break;case"bouncer":e.store.player.inventory.push(Uf[l.Bouncer]());break;case"shotgun":e.store.player.inventory.push(Uf[l.Shotgun]());break;case"teleporter":e.store.player.inventory.push({id:l.Teleporter,itemType:a.Tool,data:{teleporting:!1,locations:[],actionStartTime:0},name:"Teleporter",description:"A teleporter that can be used to teleport."});break;case"toast":Al(e,"Hello, world!")}}};var Vf=function(e){return t=void 0,n=void 0,i=function(){var t,n;return function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}(this,(function(r){switch(r.label){case 0:return t=window.performance.memory.totalJSHeapSize/1048576,console.log("Memory consumption (MB):",t),[4,performance.measureUserAgentSpecificMemory()];case 1:return n=r.sent(),console.log(null!=e?e:"Memory consumption (MB) from performance.measureUserAgentSpecificMemory:",JSON.stringify(n)),[2]}}))},new((r=void 0)||(r=Promise))((function(e,s){function o(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(o,a)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i},Hf={setup:function(t){window.__debug={tally:function(){Pc(t)},ensureQueuedStructuresAreBuilt:function(){t.store.structures.forEach((function(e){e.queued&&function(e,t){if(!fd(e,t.x,t.y)){var n=gd(t.type);delete t.queued,dd(e,{x:t.x,y:t.y},n),e.environment.postMessage([f.UpdateStructure,t])}}(t,e)}))},state:t,config:e,admin:{run:function(e){Gf.run(t,e)},spawnCustomLight:function(n,r){ru(t,1372*e.cellSize,892*e.cellSize,{duration:1e4,brightness:1.2}),ru(t,1433*e.cellSize,880*e.cellSize,{duration:1e4,brightness:.5})}},trackMemoryConsumption:Vf,moveCamera:function(e,n){ef(t,e,n)}};var n={};console.once=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0],i=e.slice(1);n[r]||(console.log.apply(console,e),n[r]=i)}},getConveyorCellColor:function(e){switch(e.structureCellType){case 0:return"rgb(255, 255, 255)";case 1:return"rgb(0, 0, 0)";case 2:return"rgb(255, 0, 0)";case 3:return"rgb(0, 255, 0)";case 4:return"rgb(0, 0, 255)";case 5:return"rgb(255, 255, 0)";case 6:return"rgb(255, 0, 255)";case 7:return"rgb(26, 231, 255)";case 8:return"rgb(255, 0, 204)";case 9:return"rgb(174, 255, 0)"}},createFpsMeter:function(e){var t,n=0,r=Date.now(),i=document.getElementById("fps");return setInterval((function(){i.textContent=(1e3/n).toFixed(1)+" fps"}),1e3),function(){var e=(t=Date.now())-r;n+=(e-n)/20,r=t}},spawnElements:function(n,r){var i=n.store;if(!r.action.state[u.Active])return!1;var s=e.debug.brushSize;if("Shift"===r.input.currentLastKey){for(var o=-s;o<=s;o+=1)for(var a=-s;a<=s;a+=1){var l=kd(i,r.input.mouse.cellPosition.x+a,r.input.mouse.cellPosition.y+o);Nd(l)&&Ad(n,r.input.mouse.cellPosition.x+a,r.input.mouse.cellPosition.y+o,t.Empty)}return!0}if("e"===r.input.currentLastKey){for(o=-s;o<=s;o+=1)for(a=-s;a<=s;a+=1){var c={x:r.input.mouse.cellPosition.x+a,y:r.input.mouse.cellPosition.y+o};Ad(n,c.x,c.y,r.debug.brush.cellType),n.environment.multithreading.simulation.post(n,K.getThreadIndexFromCellX(c.x,n.environment.multithreading.simulation.threads.length),[f.RedrawSurroundingCells,[c.x,c.y]])}return!0}if("f"===r.input.currentLastKey){for(o=-s;o<=s;o+=1)for(a=-s;a<=s;a+=1)if(c={x:r.input.mouse.cellPosition.x+a,y:r.input.mouse.cellPosition.y+o},r.debug.brush.overwrite||Hd(n,c.x,c.y)){var h=Ch(r.debug.brush.elementType,c.x,c.y);h.skipPhysics=r.debug.brush.skipPhysics,Ad(n,c.x,c.y,h)}return!0}if("g"===r.input.currentLastKey)return ru(n,r.input.mouse.worldPosition.x,r.input.mouse.worldPosition.y,{brightness:e.debug.flashlight.brightness,size:e.debug.flashlight.size,duration:e.debug.flashlight.duration,color:e.debug.flashlight.color}),!0;if("o"===r.input.currentLastKey)return Fl(n,F.Artifact,r.input.mouse.worldPosition.x,r.input.mouse.worldPosition.y),!0;if("l"===r.input.currentLastKey){var d=r.input.mouse.cellPosition,p=d.x,m=d.y;console.log("cell debug",p,m),n.shared.debug.cellPos[0]=p,n.shared.debug.cellPos[1]=m,[n.shared.imageData,n.shared.obstacleImageData].forEach((function(e,t){var n=4*(p+m*e.width),r=e.data[n],i=e.data[n+1],s=e.data[n+2],o=e.data[n+3];console.log(0===t?"imageData":"obstacleImageData",r,i,s,o)}));var g=p+m*n.shared.mapData.width,y=n.shared.mapData.data[g],v=n.session.colors.colorByColorId[y];return console.log("mapData",y,v),n.environment.multithreading.simulation.post(n,K.getThreadIndexFromCellX(p,n.environment.multithreading.simulation.threads.length),[f.DebugCell,[p,m]]),!0}return"o"===r.input.currentLastKey&&(console.log("hello???"),n.session.windows.options.open=!0,Cl(n,k.Options),!0)},drawRulers:function(e){e.session.rendering.context.strokeStyle="red",e.session.rendering.context.beginPath(),e.session.rendering.context.rect(0,0,e.session.rendering.canvas.width/2,e.session.rendering.canvas.height/2),e.session.rendering.context.stroke(),e.session.rendering.context.beginPath(),e.session.rendering.context.rect(e.session.rendering.canvas.width/2,0,e.session.rendering.canvas.width/2,e.session.rendering.canvas.height/2),e.session.rendering.context.stroke(),e.session.rendering.context.beginPath(),e.session.rendering.context.rect(0,e.session.rendering.canvas.height/2,e.session.rendering.canvas.width/2,e.session.rendering.canvas.height/2),e.session.rendering.context.stroke(),e.session.rendering.context.beginPath(),e.session.rendering.context.rect(e.session.rendering.canvas.width/2,e.session.rendering.canvas.height/2,e.session.rendering.canvas.width/2,e.session.rendering.canvas.height/2),e.session.rendering.context.stroke();for(var t=1;t<=10;t++){var n=16*t,r=32*t;e.session.rendering.context.beginPath(),e.session.rendering.context.rect(e.session.rendering.canvas.width/2-n/2,e.session.rendering.canvas.height/2-r/2,n,r),e.session.rendering.context.stroke()}},drawChunks:function(t){var n=t.session,r=e.cellSize*e.chunkSize;if(!window.__tempDrawChunksCanvas){window.__tempDrawChunksCanvas=document.createElement("canvas"),window.__tempDrawChunksCanvas.width=t.store.world.size.width*e.cellSize,window.__tempDrawChunksCanvas.height=t.store.world.size.height*e.cellSize;for(var i=window.__tempDrawChunksCanvas.getContext("2d"),s=0;s<t.store.world.chunks.length;s++)for(var o=0;o<t.store.world.chunks[s].length;o++){var a=t.store.world.chunks[s][o];a&&(i.beginPath(),i.strokeStyle=a.shouldUpdate?"blue":"white",i.rect(o*r,s*r,r,r),i.stroke())}}n.rendering.offscreenContext.drawImage(window.__tempDrawChunksCanvas,0,0)},drawChunks2:function(t){for(var n=t.session,r=t.store,i=e.cellSize*e.chunkSize,s=n.camera.x-n.camera.x%i,o=n.camera.y-n.camera.y%i,a={x:s/e.chunkSize/e.cellSize,y:o/e.chunkSize/e.cellSize},l=a.y;l<a.y+Math.ceil(n.rendering.canvas.height/e.chunkSize/e.cellSize)+1;l++)for(var u=a.x;u<a.x+Math.ceil(n.rendering.canvas.width/e.chunkSize/e.cellSize)+1;u++)if(r.world.chunks[l]&&r.world.chunks[l][u]){var c=e.chunkSize*e.cellSize,h=n.rendering.overlayContext;if(h.beginPath(),e.useMultithreading){var d=u+l*(t.store.world.size.width/e.chunkSize);t.shared.activeChunks&&0!==t.shared.activeChunks[d]?h.strokeStyle="rgba(255, 0, 0, ".concat(t.shared.activeChunks[d]/e.debug.drawChunkFade,")"):(d%2==0&&(h.fillStyle="red",h.fillRect(u*c-n.camera.x,l*c-n.camera.y,4,4)),h.strokeStyle="white")}else h.strokeStyle="white";h.rect(u*c-n.camera.x,l*c-n.camera.y,c-1,c-1),h.stroke()}}};const Wf=Hf,Xf=(e,t)=>{switch(t){case e.settings.keyBindings.Left:return"left";case e.settings.keyBindings.Right:return"right"}};var $f=function(e,t){var n=Math.max(window.innerWidth/e,window.innerHeight/t);return Math.ceil(10*n)/10},Yf=function(e,t,n){e.style.transform="scale(".concat(n,")"),e.style.transformOrigin="top left",e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform+=" translate(-50%, -50%)",t.style.transform="scale(".concat(n,")"),t.style.transformOrigin="top left",t.style.position="absolute",t.style.top="50%",t.style.left="50%",t.style.transform+=" translate(-50%, -50%)"},qf=function(e){var t=e.session.scale;return t>1&&(t=Math.round(t)),e.session.settings.uiScale?t*(e.session.settings.uiScale/100):t},Kf=function(e){return e.key.toLowerCase()},Zf=function(e){e.action.customData=null,e.building.placing=!1,document.body.style.cursor="",e.rendering.pixi.app.renderer.events.cursorStyles.default=e.rendering.pixi.cursors.default,e.rendering.pixi.app.renderer.events.setCursor(e.rendering.pixi.cursors.default),e.input.keys&&Object.keys(e.input.keys).forEach((function(t){e.input.keys[t]=y.Up}))};var Qf=function(){function e(){this.cache={}}return e.prototype.set=function(e,t,n){this.cache[e]||(this.cache[e]={}),this.cache[e][t]=n},e.prototype.get=function(e,t){var n;return null===(n=this.cache[e])||void 0===n?void 0:n[t]},e.prototype.has=function(e,t){var n;return void 0!==(null===(n=this.cache[e])||void 0===n?void 0:n[t])},e}();const Jf=Qf;var ep,tp,np=function(){var e;return!("undefined"==typeof window||-1===window.navigator.userAgent.indexOf("Electron")&&"renderer"!==(null===(e=window.process)||void 0===e?void 0:e.type))},rp=function(){return rp=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},rp.apply(this,arguments)},ip=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,a)}l((r=r.apply(e,t||[])).next())}))},sp=function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},op=function(e){return ip(void 0,void 0,void 0,(function(){return sp(this,(function(t){return[2,new Promise((function(t,n){var r=window.indexedDB.open("SandustryDatabase",1);r.onsuccess=function(){var i=r.result,s=i.transaction("SandustryObjectStore","readonly"),o=s.objectStore("SandustryObjectStore").get(e);o.onsuccess=function(){t(o.result)},o.onerror=function(e){console.log(e),n("Unable to retrieve data from database!")},s.oncomplete=function(){i.close()}},r.onerror=function(e){console.log(e),n("Unable to access database!")}}))]}))}))},ap=function(e,t,n,r){return ip(void 0,void 0,void 0,(function(){return sp(this,(function(i){switch(i.label){case 0:return"electron"!==e?[3,2]:[4,window.electron.save(t,n,r)];case 1:return i.sent(),[3,3];case 2:!function(e,t,n){ip(void 0,void 0,void 0,(function(){var r,i;return sp(this,(function(s){return r=window.indexedDB,(i=r.open("SandustryDatabase",1)).onsuccess=function(){var r=i.result,s=r.transaction("SandustryObjectStore","readwrite");s.objectStore("SandustryObjectStore").put({id:e,metaData:{id:e,name:t,timestamp:(new Date).toISOString(),playTime:n.meta.time,resources:{gold:n.resources.gold,fluxite:n.resources.fluxite,artifacts:n.resources.artifacts}},data:n}),s.oncomplete=function(){r.close()}},[2]}))}))}(t,n,r),i.label=3;case 3:return[2]}}))}))},lp=function(e){return ip(void 0,void 0,void 0,(function(){var t,r,i,s,o,a;return sp(this,(function(l){switch(l.label){case 0:return[4,e.environment.multithreading.simulation.postAllAwait(e,[f.Save,e.store.meta.tick])];case 1:return l.sent(),t=e.session.saving.id,r=e.session.saving.name,i=rp({},e.store),s=rp({},i.world),o=s.matrix.map((function(e){return e.map((function(e){return"number"==typeof e?e:"hp"in e?[e.cellType,e.hp]:e.type===n.Particle?e:e.type+100}))})),s.matrix=o,i.world=s,[4,ap(e.session.runtime,t,r,i)];case 2:return l.sent(),a={id:t},"electron"!==e.session.runtime?[3,4]:[4,window.electron.saveLastPlayedGame(a)];case 3:return l.sent(),[3,5];case 4:localStorage.setItem("lastPlayedGame",JSON.stringify(a)),l.label=5;case 5:return hp(e),[2]}}))}))},up=function(e){return ip(void 0,void 0,void 0,(function(){var t,n,r;return sp(this,(function(i){switch(i.label){case 0:return np()?(r={},[4,window.electron.load(e)]):[3,2];case 1:return r.data=i.sent(),t=r,[3,4];case 2:return[4,op(e)];case 3:t=i.sent(),i.label=4;case 4:return(n=t.data).world.matrix&&(n.world.matrix=n.world.matrix.map((function(e,t){return e.map((function(e,n){return Array.isArray(e)?{cellType:e[0],hp:e[1]}:"object"==typeof e?(e.hasBeenUpdated=!1,e):e>=100?Ch(e-100,n,t):e}))}))),[2,n]}}))}))},cp=function(e,t){var n,r;switch(t.type){case"autosave":n="autosave",r="Autosave";break;case"new":if(!t.name)throw new Error("Name required for new save");n=Math.random().toString(36).substring(2,15),r=t.name;break;case"existing":if(!t.id)throw new Error("ID required for existing save");n=t.id,r=t.name||"Unnamed Save"}e.session.saving={name:r,id:n},e.environment.multithreading.simulation.manager.postMessage([f.SetPaused,!0])},hp=function(e){e.session.saving=!1,e.environment.multithreading.simulation.manager.postMessage([f.SetPaused,!1])},dp=function(e){return ip(void 0,void 0,void 0,(function(){return sp(this,(function(t){switch(t.label){case 0:return np()?[4,window.electron.deleteSave(e)]:[3,2];case 1:return t.sent(),[3,3];case 2:return[2,new Promise((function(t,n){var r=window.indexedDB.open("SandustryDatabase",1);r.onsuccess=function(){var i=r.result,s=i.transaction("SandustryObjectStore","readwrite"),o=s.objectStore("SandustryObjectStore").delete(e);o.onsuccess=function(){t(!0)},o.onerror=function(e){console.error("Error deleting save:",e),n("Unable to delete save from database!")},s.oncomplete=function(){i.close()}},r.onerror=function(e){console.error("Error accessing database:",e),n("Unable to access database!")}}))];case 3:return[2]}}))}))},fp=function(e,t){for(var n=0;n<4;n++){var r=t.x+n,i=t.y-1,s=Xd(e,r,i);null!==s&&pp(e,s,r,i)}},pp=function(e,r,i,s){var o;if(r!==n.Gloom)return!1;var a=Dc(e,i,s+1);if(!a||a.type!==d.GloomEmitter)return!1;for(var l=a.y+4,u=a.x,c=new Set,h=[],p=0;p<4;p++)h.push([u+p,l]);for(;h.length>0;){var m=Math.floor(Math.random()*h.length),g=h[m],y=g[0],v=g[1];h.splice(m,1);var x="".concat(y,",").concat(v);if(!c.has(x)){c.add(x);var b=Dc(e,y,v),w=b?gd(b.type):null;if(Hd(e,y,v)&&(!b||w.shape)&&(y%2==0||v%2==0||y%2==1&&v%2==1&&y%4==v%4))return Ad(e,y,v,t.Fluxite),Ad(e,i,s,t.Empty),e.environment.multithreading.simulation.post(e,K.getThreadIndexFromCellX(y,e.environment.multithreading.simulation.threads.length),[f.RedrawSurroundingCells,[y,v]]),!0;for(var S=[[0,1],[1,0],[-1,0],[0,-1]],_=S.length-1;_>0;_--){var T=Math.floor(Math.random()*(_+1));o=[S[T],S[_]],S[_]=o[0],S[T]=o[1]}for(var E=0,C=S;E<C.length;E++){var k=C[E],A=y+(p=k[0]),M=v+k[1],P=Dc(e,A,M),R=P?gd(P.type):null;if(!P||R.shape){var I=$d(e,A,M);(Hd(e,A,M)||I===t.Fluxite)&&h.push([A,M])}}}}return!0},mp=function(){return mp=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},mp.apply(this,arguments)},gp=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,a)}l((r=r.apply(e,t||[])).next())}))},yp=function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},vp=((ep={})[_.SpawnMainMenuElements]={interval:3e3,multithreading:!1,callback:function(t,r,i){return gp(void 0,void 0,void 0,(function(){var r,i,s,o,a,l,u,c,h,d,f,p,m,g,y,v;return yp(this,(function(b){if(t.store.scene.active!==x.MainMenu)return[2];for(r=K.getRandomIntBetween(1,10),i=K.getRandomIntBetween(1,4),s=[{type:n.Sand,weight:.3},{type:n.Spore,weight:.3},{type:n.Petalium,weight:.1},{type:n.Flame,weight:.3},{type:n.Water,weight:.2},{type:n.Steam,weight:.15}],o=s.reduce((function(e,t){return e+t.weight}),0),a=Math.random()*o,l=0,c=0,h=s;c<h.length;c++)if(d=h[c],l+=d.weight,a<=l){u=d.type;break}for(f=K.getRandomIntBetween(-350,350),p=K.getRandomIntBetween(-500,-400),u===n.Steam&&(p=-p),m={x:Math.round((t.store.player.x+f)/e.cellSize),y:Math.round((t.store.player.y+p)/e.cellSize)},g=-r;g<=r;g+=1)for(y=-i;y<=i;y+=1)Ad(t,(v={x:m.x+y,y:m.y+g}).x,v.y,Ch(u,v.x,v.y));return[2]}))}))}},ep[_.Autosave]={interval:3e5,multithreading:!1,callback:function(e,t,n){return gp(void 0,void 0,void 0,(function(){return yp(this,(function(t){return e.store.scene.active===x.MainMenu||(cp(e,{type:"autosave"}),Al(e,"Autosaving...")),[2]}))}))}},ep[_.Pump]={interval:500,multithreading:!1,callback:function(e,t,n){return gp(void 0,void 0,void 0,(function(){var t,n,r,i;return yp(this,(function(s){switch(s.label){case 0:t=0,n=e.store.pumpsCache,s.label=1;case 1:return t<n.length?(r=n[t],i=oe.get(e.session,"structures",r.x,r.y),[4,Jh(e,i)]):[3,4];case 2:s.sent(),s.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))}},ep[_.EmitGloom]={interval:2e3,multithreading:!1,callback:function(e,t,n){return gp(void 0,void 0,void 0,(function(){var t,n,r;return yp(this,(function(i){switch(i.label){case 0:t=0,n=e.store.gloom.emitterPositions,i.label=1;case 1:return t<n.length?(r=n[t],[4,fp(e,r)]):[3,4];case 2:i.sent(),i.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))}},ep[_.PingPumpChunksFIX]={interval:1e4,multithreading:!1,callback:function(e,t,n){return gp(void 0,void 0,void 0,(function(){var t,n,r,i,s;return yp(this,(function(o){for(t=0,n=e.store.pumpsCache;t<n.length;t++)r=n[t],i=e.environment,s=K.getThreadIndexFromCellX(r.x,i.multithreading.simulation.threads.length),i.multithreading.simulation.post(e,s,[f.PingChunk,r.x,r.y]);return[2]}))}))}},ep),xp=function(t,n){return gp(void 0,void 0,void 0,(function(){var r,i,s,o;return yp(this,(function(a){switch(a.label){case 0:r=0,i=t.session.triggers,a.label=1;case 1:if(!(r<i.length))return[3,8];if(s=i[r],!(o=vp[s.id]))return[3,7];if(o.multithreading&&!e.useMultithreading)return[3,7];s.accumulator+=n,a.label=2;case 2:return s.accumulator>=o.interval?o.sequentialRuns?[3,4]:[4,o.callback(t,s,n)]:[3,7];case 3:return a.sent(),s.accumulator-=o.interval,[3,6];case 4:return s.runCount++,[4,o.callback(t,s,n)];case 5:if(a.sent(),s.runCount<o.sequentialRuns)return[3,7];s.runCount=0,s.accumulator-=o.interval,a.label=6;case 6:return[3,2];case 7:return r++,[3,1];case 8:return[2]}}))}))},bp=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,a)}l((r=r.apply(e,t||[])).next())}))},wp=function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},Sp=.25,_p=function(){function e(){this.tracks=[{url:"music/Ambient Nothingness Intensity 1.ogg",loaded:!1,volume:1,playCount:0},{url:"music/Ambient Wonderful Intensity 1.ogg",loaded:!1,volume:.8,playCount:0},{url:"music/Ambient Exploration Intensity 1.ogg",loaded:!1,volume:.6,playCount:0},{url:"music/Ambient Sadness Intensity 1.ogg",loaded:!1,volume:.5,playCount:0},{url:"music/Ambient Wonderlust Intensity 1.ogg",loaded:!1,volume:.4,playCount:0}],this.currentTrackIndex=0,this.globalVolume=.25,this.isPlaying=!1,this.totalTransitions=0}return e.prototype.loadTrack=function(e){return bp(this,void 0,void 0,(function(){var t,n=this;return wp(this,(function(r){switch(r.label){case 0:return this.tracks[e].loaded?[2]:((t=this.tracks[e]).audio=new Audio(t.url),t.audio.volume=this.globalVolume*t.volume,t.audio.addEventListener("ended",(function(){return n.playNext()})),[4,t.audio.load()]);case 1:return r.sent(),t.loaded=!0,[2]}}))}))},e.prototype.play=function(e){return bp(this,void 0,void 0,(function(){var t;return wp(this,(function(n){switch(n.label){case 0:return void 0!==e&&(this.currentTrackIndex=e),[4,this.stop()];case 1:return n.sent(),[4,this.loadTrack(this.currentTrackIndex)];case 2:return n.sent(),(t=this.tracks[this.currentTrackIndex]).audio?(t.playCount=(t.playCount||0)+1,[4,t.audio.play()]):[3,4];case 3:n.sent(),this.isPlaying=!0,n.label=4;case 4:return[2]}}))}))},e.prototype.pause=function(){var e=this.tracks[this.currentTrackIndex];e.audio&&(e.audio.pause(),this.isPlaying=!1)},e.prototype.resume=function(){var e=this.tracks[this.currentTrackIndex];e.audio&&!this.isPlaying&&(e.audio.play(),this.isPlaying=!0)},e.prototype.stop=function(){return bp(this,void 0,void 0,(function(){var e;return wp(this,(function(t){return(e=this.tracks[this.currentTrackIndex]).audio&&(e.audio.pause(),e.audio.currentTime=0,this.isPlaying=!1),[2]}))}))},e.prototype.delay=function(){return bp(this,void 0,void 0,(function(){var e;return wp(this,(function(t){switch(t.label){case 0:return e=10*(this.totalTransitions+1),[4,new Promise((function(t){return setTimeout(t,1e3*e)}))];case 1:return t.sent(),[2]}}))}))},e.prototype.playNext=function(){return bp(this,void 0,void 0,(function(){return wp(this,(function(e){switch(e.label){case 0:return[4,this.stop()];case 1:return e.sent(),[4,this.delay()];case 2:return e.sent(),this.currentTrackIndex=(this.currentTrackIndex+1)%this.tracks.length,this.totalTransitions++,[4,this.play()];case 3:return e.sent(),[2]}}))}))},e.prototype.playPrevious=function(){return bp(this,void 0,void 0,(function(){return wp(this,(function(e){switch(e.label){case 0:return this.currentTrackIndex=(this.currentTrackIndex-1+this.tracks.length)%this.tracks.length,[4,this.play()];case 1:return e.sent(),[2]}}))}))},e.prototype.setTrackVolume=function(e,t){e>=0&&e<this.tracks.length&&(this.tracks[e].volume=Math.max(0,Math.min(1,t)),this.tracks[e].audio&&(this.tracks[e].audio.volume=this.globalVolume*this.tracks[e].volume))},e.prototype.setVolume=function(e){var t=this;e*=Sp,this.globalVolume=Math.max(0,Math.min(1,e)),this.tracks.forEach((function(e){e.audio&&(e.audio.volume=t.globalVolume*e.volume)}))},e.prototype.getVolume=function(){return this.globalVolume},e.prototype.isCurrentlyPlaying=function(){return this.isPlaying},e}(),Tp=function(){function e(){this.ambient={url:"music/178689__carlvus__london-uk-ambience-feb-2013-04.ogg",loaded:!1,volume:1},this.globalVolume=Sp,this.isPlaying=!1}return e.prototype.loadAmbient=function(){return bp(this,void 0,void 0,(function(){return wp(this,(function(e){switch(e.label){case 0:return this.ambient.loaded?[2]:(this.ambient.audio=new Audio(this.ambient.url),this.ambient.audio.volume=this.globalVolume*this.ambient.volume,this.ambient.audio.loop=!0,[4,this.ambient.audio.load()]);case 1:return e.sent(),this.ambient.loaded=!0,[2]}}))}))},e.prototype.play=function(){return bp(this,void 0,void 0,(function(){return wp(this,(function(e){switch(e.label){case 0:return[4,this.loadAmbient()];case 1:return e.sent(),this.ambient.audio?[4,this.ambient.audio.play()]:[3,3];case 2:e.sent(),this.isPlaying=!0,e.label=3;case 3:return[2]}}))}))},e.prototype.pause=function(){this.ambient.audio&&(this.ambient.audio.pause(),this.isPlaying=!1)},e.prototype.resume=function(){this.ambient.audio&&!this.isPlaying&&(this.ambient.audio.play(),this.isPlaying=!0)},e.prototype.setVolume=function(e){e*=Sp,this.globalVolume=Math.max(0,Math.min(1,e)),this.ambient.audio&&(this.ambient.audio.volume=this.globalVolume*this.ambient.volume)},e.prototype.getVolume=function(){return this.globalVolume},e.prototype.isCurrentlyPlaying=function(){return this.isPlaying},e}(),Ep=function(){return Ep=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Ep.apply(this,arguments)},Cp={keyBindings:(tp={},tp[g.Left]="a",tp[g.Right]="d",tp[g.Boost]="w",tp[g.Descend]="s",tp[g.Jump]=" ",tp[g.OpenInventory]="tab",tp[g.OpenBuildMenu]="q",tp[g.OpenTechTree]="t",tp[g.OpenUpgrades]="u",tp[g.Escape]="escape",tp[g.ReverseBuildDirection]="shift",tp[g.BuildMode]="r",tp[g.Marquee]="shift",tp[g.Demolish]="x",tp[g.Copy]="c",tp[g.Delete]="backspace",tp[g.Ruler]="v",tp[g.Pause]="p",tp[g.PauseCamera]="r",tp[g.GrapplingHook]="g",tp),sound:{sfxVolume:Gl,musicVolume:Gl},uiScale:!1,capFrameRate:!1,lockSkyColor:!1,disableShadows:!1,disableBackgroundShader:!1,showFps:!1,windowMode:"fullscreen"},kp=[g.PauseCamera,g.Pause];function Ap(){var e,t,n={};try{var r=np()?window.electron.getSettingsSync():localStorage.getItem("settings");r&&(n=JSON.parse(r))}catch(e){console.error("Failed to parse settings from localStorage:",e)}return Ep(Ep(Ep({},Cp),n),{keyBindings:Ep(Ep({},Cp.keyBindings),null!==(e=n.keyBindings)&&void 0!==e?e:{}),sound:Ep(Ep({},Cp.sound),null!==(t=n.sound)&&void 0!==t?t:{})})}var Mp=function(e,t){var n=new OffscreenCanvas(e,t),r=n.getContext("2d");return r.imageSmoothingEnabled=!1,{canvas:n,context:r}};const Pp=function(r,i,s,o){var a,l=performance.now(),c=(i.terrain,document.getElementById("canvas")),h={width:1920,height:1088},d=$f(h.width,h.height),f=document.getElementById("overlay-canvas");Yf(c,f,d);var p=h.width,m=h.height;c.width=p,c.height=m;var g=new OffscreenCanvas(r.world.size.width*e.cellSize,r.world.size.height*e.cellSize),v=g.getContext("2d",{willReadFrequently:!0});v.imageSmoothingEnabled=!1,r.scene.active!==x.MainMenu&&v.drawImage(s.images.fog.image,0,0,g.width,g.height);var b=new OffscreenCanvas(Math.ceil(p/e.cellSize),Math.ceil(m/e.cellSize)),w=new OffscreenCanvas(Math.ceil(p/e.cellSize),Math.ceil(m/e.cellSize)),S=new OffscreenCanvas(p,m),_=S.getContext("2d");_.imageSmoothingEnabled=!1;var T=new OffscreenCanvas(p,m),C=T.getContext("2d");C.imageSmoothingEnabled=!1;var A=new OffscreenCanvas(p,m),P=A.getContext("2d");P.imageSmoothingEnabled=!1;var R=new OffscreenCanvas(p,m),I=R.getContext("2d");I.imageSmoothingEnabled=!1;var D=new OffscreenCanvas(p,m),F=D.getContext("2d");F.imageSmoothingEnabled=!1;var N=Mp(p,m),L=Mp(p,m),B=Mp(p,m),O=Mp(p,m),z=Mp(p,m);f.width=p,f.height=m;var j=f.getContext("2d");j.imageSmoothingEnabled=!1;var U=document.getElementById("minimap-obstacle");U.width=e.minimapSize,U.height=e.minimapSize;var G=U.getContext("2d");G.imageSmoothingEnabled=!1;var V=document.getElementById("minimap-world");V.width=e.minimapSize,V.height=e.minimapSize;var H=V.getContext("2d");H.imageSmoothingEnabled=!1;var W,X,$,Y,q,K,Z=function(){var e,r={element:(e={},e[n.Sand]=pu(fu(n.Sand)),e[n.Water]=[[102,204,255,255]],e[n.WetSand]=[cu(fu(n.Sand),60,45),cu(fu(n.Sand),60,44),cu(fu(n.Sand),60,46),cu(fu(n.Sand),60,47)],e[n.Slag]=[cu(fu(n.Sand),0,70),cu(fu(n.Sand),0,69),cu(fu(n.Sand),0,68),cu(fu(n.Sand),0,67)],e[n.Gold]=[cu(60,100,50),cu(60,99,51),cu(60,98,49),cu(60,100,48)],e[n.Gloom]=[[103,102,102,255]],e[n.Steam]=[[255,255,204,255]],e[n.Spore]=pu(fu(n.Spore)),e[n.Petalium]=pu(fu(n.Petalium)),e[n.WetSpore]=[cu(fu(n.Spore),60,45),cu(fu(n.Spore),60,44),cu(fu(n.Spore),60,46),cu(fu(n.Spore),60,47)],e[n.Seed]=[[70,153,26,255]],e[n.BurntSlag]=[cu(fu(n.Sand),0,40),cu(fu(n.Sand),0,39),cu(fu(n.Sand),0,38),cu(fu(n.Sand),0,37)],e[n.Fire]=[[251,235,51,255],[253,176,67,255],[246,146,30,255],[246,126,30,255]],e[n.FreezingIce]=[[204,204,204,255]],e[n.Flame]=[[252,176,67,255],[245,146,30,255],[252,176,67,255],[245,146,30,255]],e[n.Lava]=[[255,189,11,255],[255,179,11,255],[255,169,11,255],[255,159,11,255]],e[n.Sandium]=[cu(0,70,45),cu(0,70,44),cu(0,70,43),cu(0,70,42)],e[n.Basalt]=[cu(0,100,20),cu(3,100,22),cu(7,100,24),cu(10,100,26)],e),soil:Object.keys(au).map((function(e){return{id:e,config:au[e]}})).reduce((function(e,t){if(t.config.colorHSL)return e[t.id]=[[t.config.colorHSL[0],t.config.colorHSL[1],t.config.colorHSL[2]],cu(t.config.colorHSL[0],t.config.colorHSL[1],t.config.colorHSL[2]+4),cu(t.config.colorHSL[0],t.config.colorHSL[1],t.config.colorHSL[2]+1)],e;var n=t.config.output?fu(t.config.output.elementType):t.config.hue;return e[t.id]=[[n,60,36],cu(n,60,40),cu(n,60,37)],e}),{})},i=gu(r.element),s=i.colorIdByElementType,o=i.elementColorByColorId,a=(i.colorId,i.elementTypeByColorId),l=function(e){var n,r={},i={},s={},o=M.ObstacleStart;for(var a in e)if(void 0!==e[a][0][0]){r[a]=[];for(var l=0,u=e[a];l<u.length;l++){var c=u[l];if(3===c.length){i[o]=cu(c[0],c[1],c[2]),r[a].push(o),s[o]=parseInt(a),o--;for(var h=0,d=yu;h<d.length;h++){var f=d[h];i[o]=cu(c[0],c[1],c[2]*f),r[a].push(o),s[o]=parseInt(a),o--}}else i[o]=c,r[a].push(o),s[o]=parseInt(a),o--}}var p=((n={})[t.Bedrock]={H:0,S:0,L:66},n[t.Ice]={H:199,S:99,L:90},n[t.Divider]={H:30,S:100,L:50},n[t.GoldSoil]={H:60,S:100,L:50},n);for(var a in p){i[o]=cu(p[a].H,p[a].S,p[a].L),r[a]=[o],s[o]=parseInt(a),o--;for(var m=0,g=yu;m<g.length;m++)f=g[m],i[o]=cu(p[a].H,p[a].S,p[a].L*f),r[a].push(o),s[o]=parseInt(a),o--}return{colorIdByGroundCellType:r,groundColorByColorId:i,cellTypeByColorId:s}}(r.soil),u=l.colorIdByGroundCellType,c=l.groundColorByColorId,h=l.cellTypeByColorId,d=lu(lu({},o),c),f=lu(lu({},a),h);return{scheme:r,elementByColor:mu(r.element),damagedSoilByColor:mu(r.soil,!0),colorIdByElementType:s,colorIdByGroundCellType:u,colorByColorId:d,cellTypeOrElementTypeByColorId:f}}(),Q=function(t,n,r,i,s,o,a,l,u,c,h,d,f){var p=new As({view:t,width:n,height:r,backgroundAlpha:0}),m="url('img/cursor_default.png'),auto";p.renderer.events.cursorStyles.default=m;var g=new ns;g.width=n,g.height=r,p.stage.addChild(g);var y=new ns;g.addChild(y);var v=new ss;v.width=n,v.height=r,y.addChild(v);var b=Mr.from(i.images.mountains_tiling_4x.image),w=new qa(b,n,r);w.width=n,w.height=r,w.y=340,y.addChild(w);var S=Mr.from(i.images.trees_tiling_4x.image),_=new qa(S,n,r);_.width=n,_.height=r,y.addChild(_);var T=new gr(null,"// Define the saturate function to keep x within [0.0, 1.0]\n#define saturate(x) clamp(x,0.,1.)\n\n// Define the rgb function to normalize r,g,b values to [0,1] range\n#define rgb(r,g,b) (vec3(r,g,b)/255.)\n\n// Declare uniform variables\nuniform vec2 uWorldPixelSize;\nuniform vec2 uResolution;\nuniform float uTime;\nuniform vec2 uPlayerPosition;\nuniform sampler2D uSampler;\nuniform vec2 uCameraPosition;\nuniform bool uLockSkyColor;\n\n// Declare varying variable\nvarying vec2 vTextureCoord;\n\n// Define the rand function for generating pseudo-random numbers\nfloat random(float x) { return fract(sin(x) * 71.5413291); }\n\n// Overload the rand function for 2D input\nfloat random(vec2 x) { return random(dot(x, vec2(13.4251, 15.5128))); }\n\n// Define the noise function for generating Perlin-like noise\nfloat noise(vec2 x)\n{\n    vec2 gridCell = floor(x);\n    vec2 withinCell = x - gridCell;\n    withinCell *= withinCell*(3.0-2.0*withinCell);\n\n    return mix(mix(random(gridCell), random(gridCell+vec2(1,0)), withinCell.x),\n               mix(random(gridCell+vec2(0,1)), random(gridCell+vec2(1,1)), withinCell.x), withinCell.y);\n}\n\n// Define the fbm function for generating fractal brownian motion noise\nfloat fbm(vec2 x)\n{\n    float noiseSum = 0.0, amplitude = 1.0, frequency = 1.0;\n    for (int i=0; i<5; i++)\n    {\n        amplitude *= 2.0;\n        frequency *= 0.5;\n        noiseSum += frequency * noise(amplitude * x);\n    }\n    return noiseSum;\n}\n\n// Define the cloud function for generating cloud-like effects\nfloat cloud(vec2 uv, float scaleX, float scaleY, float density, float sharpness, float speed)\n{\n    return pow(saturate(fbm(vec2(scaleX,scaleY)*(uv+vec2(speed,0)*uTime))-(1.0-density)), 1.0-sharpness);\n}\n\n// Add these new functions near the top with other utility functions\nfloat pulseEffect(float time) {\n    return 1.0 + 0.05 * sin(time * 0.25); // Reduced amplitude from 0.1 to 0.05 and slowed frequency from 0.5 to 0.25\n}\n\n// Add this hueShift function before the sunCorona function\nvec3 hueShift(vec3 color, float shift) {\n    const vec3 k = vec3(0.57735, 0.57735, 0.57735);\n    float cosAngle = cos(shift);\n    return vec3(color * cosAngle + cross(k, color) * sin(shift) + k * dot(k, color) * (1.0 - cosAngle));\n}\n\nvec3 sunCorona(vec2 sunPosition, float time) {\n    float distance = length(sunPosition);\n    float corona = exp(-60.0 * distance) * 0.3;\n    \n    // More subtle animated corona rings with slower movement\n    corona += 0.1 * exp(-32.0 * abs(distance - 0.05 + 0.01 * sin(time * 0.3)));  // Reduced wave amplitude and speed\n    corona += 0.05 * exp(-24.0 * abs(distance - 0.1 + 0.01 * sin(time * 0.2)));  // Reduced wave amplitude and speed\n    \n    // Even more subtle color shift with slower movement\n    vec3 coronaColor = hueShift(rgb(255,200,150), sin(time * 0.05) * 0.05);  // Reduced color shift amount and speed\n    return coronaColor * corona * 0.5;\n}\n\n// Define the render function for rendering the sky, sun and clouds\nvec3 render(vec2 uv, vec2 originalUv, float modX, float modY)\n{\n    // Create multiple sky color pairs that we'll cycle between\n    vec3 skyTop1 = rgb(135,206,235);    // Light sky blue\n    vec3 skyBottom1 = rgb(176,224,230);  // Powder blue\n    \n    vec3 skyTop2 = rgb(255,160,122);    // Light salmon\n    vec3 skyBottom2 = rgb(255,218,185);  // Peach\n    \n    vec3 skyTop3 = rgb(70,130,180);     // Steel blue\n    vec3 skyBottom3 = rgb(176,196,222);  // Light steel blue\n    \n    vec3 skyTop4 = rgb(147,197,114);    // Light forest green\n    vec3 skyBottom4 = rgb(200,233,183);  // Pale green\n    \n    vec3 skyTop5 = rgb(123,104,238);    // Medium slate blue\n    vec3 skyBottom5 = rgb(230,230,250);  // Lavender\n    \n    // Calculate the cycle progress\n    float cycleSpeed = 0.01; // Base speed\n    float cycleTime = uTime * cycleSpeed;\n    float rawCycle = mod(cycleTime, 5.0);\n    \n    // Create a stepped cycle with different durations\n    float transitionDuration = 0.2;\n    float cycle;\n    float transition;\n    \n    // Adjust cycle lengths (total should add up to 5.0)\n    float cycle1Length = 3.0;  // Light blue\n    float cycle2Length = 0.25;  // Salmon (short)\n    float cycle3Length = 0.5;  // Steel blue\n    float cycle4Length = 0.25;  // Forest green (short)\n    float cycle5Length = 1.0;  // Lavender\n    \n    if (rawCycle < cycle1Length) {\n        cycle = 0.0;\n        transition = smoothstep(cycle1Length - transitionDuration, cycle1Length, rawCycle);\n    } else if (rawCycle < (cycle1Length + cycle2Length)) {\n        cycle = 1.0;\n        transition = smoothstep(cycle2Length - transitionDuration, cycle2Length, rawCycle - cycle1Length);\n    } else if (rawCycle < (cycle1Length + cycle2Length + cycle3Length)) {\n        cycle = 2.0;\n        transition = smoothstep(cycle3Length - transitionDuration, cycle3Length, rawCycle - (cycle1Length + cycle2Length));\n    } else if (rawCycle < (cycle1Length + cycle2Length + cycle3Length + cycle4Length)) {\n        cycle = 3.0;\n        transition = smoothstep(cycle4Length - transitionDuration, cycle4Length, rawCycle - (cycle1Length + cycle2Length + cycle3Length));\n    } else {\n        cycle = 4.0;\n        transition = smoothstep(cycle5Length - transitionDuration, cycle5Length, rawCycle - (cycle1Length + cycle2Length + cycle3Length + cycle4Length));\n    }\n    \n    // Interpolate between color pairs based on cycle\n    vec3 skyTopColor, skyBottomColor;\n    \n    if (uLockSkyColor) {\n        // If locked, use the first color pair\n        skyTopColor = skyTop1;\n        skyBottomColor = skyBottom1;\n    } else {\n        // Existing color cycling logic\n        if (cycle < 1.0) {\n            skyTopColor = mix(skyTop1, skyTop2, transition);\n            skyBottomColor = mix(skyBottom1, skyBottom2, transition);\n        } else if (cycle < 2.0) {\n            skyTopColor = mix(skyTop2, skyTop3, transition);\n            skyBottomColor = mix(skyBottom2, skyBottom3, transition);\n        } else if (cycle < 3.0) {\n            skyTopColor = mix(skyTop3, skyTop4, transition);\n            skyBottomColor = mix(skyBottom3, skyBottom4, transition);\n        } else if (cycle < 4.0) {\n            skyTopColor = mix(skyTop4, skyTop5, transition);\n            skyBottomColor = mix(skyBottom4, skyBottom5, transition);\n        } else {\n            skyTopColor = mix(skyTop5, skyTop1, transition);\n            skyBottomColor = mix(skyBottom5, skyBottom1, transition);\n        }\n    }\n    \n    vec3 skyColor = mix(skyBottomColor, skyTopColor, uv.y);\n\n    // Shift cloud UVs based on player position like the sun\n    vec2 cloudUv = originalUv;\n    cloudUv.x -= modX;  // Use the same horizontal shift as the sun\n    cloudUv.y += modY;  // Use the same vertical shift as the sun\n\n    // Add clouds across the entire sky, behind mountains\n    float cloudLayer1 = cloud(cloudUv, 3.0, 3.0, 0.5, 0.7, 0.0025);  // Reduced speed from 0.01 to 0.005\n    float cloudLayer2 = cloud(cloudUv, 6.0, 6.0, 0.3, 0.8, 0.005);   // Reduced speed from 0.02 to 0.01\n    \n    // Combine cloud layers\n    float cloudDensity = cloudLayer1 * 0.7 + cloudLayer2 * 0.3;\n    \n    // Create white cloud color with slight blue tint\n    vec3 cloudColor = mix(vec3(1.0), skyColor, 0.3);\n    \n    // Keep mountains in front of clouds\n    vec4 mountains = texture2D(uSampler, vTextureCoord);\n    float mountainMask = smoothstep(0.01, 0.02, mountains.a);\n\n    // Apply clouds to sky ONLY where there are no mountains\n    skyColor = mix(skyColor, cloudColor, cloudDensity * 0.7 * (1.0 - mountainMask));  // Clouds only in sky areas\n\n    // Apply mountains\n    skyColor = mix(skyColor, vec3(mountains.rgb), mountainMask * 0.2);\n\n    // Increase sun size by reducing the exponential factor\n    vec2 sunPosition = uv - vec2(0., 0.85);\n    float pulsingSize = pulseEffect(uTime);\n    float sunIntensity = exp(-500.0 * dot(sunPosition, sunPosition) / pulsingSize);\n    vec3 sunColor = rgb(255,155,102) * sunIntensity * 0.6;\n    vec3 coronaEffect = sunCorona(sunPosition, uTime);\n    \n    // Clouds affect sun visibility only where there are no mountains\n    float skyMask = 1.0 - mountainMask;\n    sunColor *= (1.0 - cloudDensity) * skyMask;  // Clouds reduce sun visibility\n    coronaEffect *= (1.0 - cloudDensity) * skyMask;  // Clouds also affect corona\n\n    skyColor += (sunColor + coronaEffect);\n\n    return skyColor;\n}\n\n// Define the main function for rendering\nvoid main( void )\n{\n    // vec4 foreground = texture2D(uBackgroundSampler, vTextureCoord);\n    // if (foreground.a != 0.0)\n    // {\n    //     gl_FragColor = foreground;\n    //     return;\n    // }\n\n    vec2 resolution = uResolution;\n    vec2 uv = gl_FragCoord.xy / resolution.xy;\n    vec2 originalUv = uv;\n\n    // Calculate sun position modifiers\n    vec2 sunPosInScreenPixels = vec2((-uPlayerPosition.x / 4.0) + (resolution.x / 2.0) + 1100.0, \n                                    ((-uPlayerPosition.y + (resolution.y / 2.0)) / 4.0) + 500.0);\n    vec2 sunPos = vec2(sunPosInScreenPixels.x / resolution.x, sunPosInScreenPixels.y / resolution.y);\n\n    float modX = sunPos.x;\n    float modY = sunPos.y;\n    \n    uv.x -= modX;\n    uv.x *= resolution.x / resolution.y;\n    uv.y += modY;\n\n    gl_FragColor = vec4(render(uv, originalUv, modX, modY), 1.0);\n}\n",{uResolution:[o.width,o.height],uWorldPixelSize:[a.world.size.width*e.cellSize,a.world.size.height*e.cellSize],uTime:0,uPlayerPosition:[0,0],uCameraPosition:[0,0]});y.filters=[T];var E,C,k=[];e.useExperimentalRenderer&&((E=ss.from(l)).width=n,E.height=r,E.texture.baseTexture.scaleMode=me.NEAREST,k.push(E),(C=ss.from(u)).width=n,C.height=r,C.texture.baseTexture.scaleMode=me.NEAREST,k.push(C));var A=new ss;A.width=n,A.height=r,p.stage.addChild(A);var P={width:n/e.cellSize,height:r/e.cellSize},R=new Uint8Array(P.width*P.height),I=Mr.fromBuffer(R,P.width,P.height,{format:he.RED,type:fe.UNSIGNED_BYTE}),D=new Uint8Array(P.width*P.height),F=Mr.fromBuffer(D,P.width,P.height,{format:he.RED,type:fe.UNSIGNED_BYTE}),N=function(e,t,n){var r=M.Darkness+1,i=new Uint8Array(4*r);i[0]=0,i[1]=0,i[2]=0,i[3]=0;for(var s=1;s<r;s++)if(s!==M.Darkness)if(s!==M.Misc){var o=n[s];o&&(i[4*s]=o[0],i[4*s+1]=o[1],i[4*s+2]=o[2],i[4*s+3]=o[3])}else i[4*s]=255,i[4*s+1]=255,i[4*s+2]=255,i[4*s+3]=255;else i[4*s]=0,i[4*s+1]=0,i[4*s+2]=0,i[4*s+3]=255;return Mr.fromBuffer(i,r,1)}(f.colorIdByElementType,f.colorIdByGroundCellType,f.colorByColorId),L=new gr(null,"#define N 100.0\n#define MAX_LIGHTS 100\n#define SOFT_SHADOW 0.995\n\nuniform vec2 uResolution;\nuniform sampler2D uSampler;\nuniform float time;\nuniform bool uDrawUndergroundFog;\nuniform vec2 magicalFixturePoint;\nuniform float minLightAmount;\nuniform vec2 uCameraPosition;\nuniform vec2 uWorldSize;\n\nuniform sampler2D uTilemapTexture;\nuniform vec2 uTilemapSize;\nuniform sampler2D uWallTilemapTexture;\n\nuniform sampler2D uRGBAByColorIdLookupTexture;\nuniform sampler2D uWallRGBALookupTexture;\n\nvarying vec2 vTextureCoord;\n\nfloat hash(vec2 p) {\n    vec3 p3  = fract(vec3(p.xyx) * 0.1031);\n    p3 += dot(p3, p3.yzx + 19.19);\n    return fract((p3.x + p3.y) * p3.z);\n}\n\n// rand [0,1]\nfloat rand(vec2 p) {\n\treturn fract(sin(dot(p, vec2(12.543,514.123)))*4732.12);\n}\n\nfloat noise(vec2 p) {\n    vec2 i = floor(p);\n    vec2 f = fract(p);\n    vec2 u = f * f * (3.0 - 2.0 * f);\n\n    float a = rand(i);\n    float b = rand(i + vec2(1.0, 0.0));\n    float c = rand(i + vec2(0.0, 1.0));\n    float d = rand(i + vec2(1.0, 1.0));\n\n    float x1 = mix(a, b, u.x);\n    float x2 = mix(c, d, u.x);\n    float y = mix(x1, x2, u.y);\n\n    return y;\n}\n\n// Fractal Brownian Motion\nfloat fbm(vec2 p) {\n    float amplitude = 0.6;\n    float noiseSum = 0.0;\n    \n    for (int i = 0; i < 8; i++) {\n        noiseSum += amplitude * noise(p);\n        amplitude *= 0.5;\n        p *= 2.0;\n    }\n    \n    return noiseSum;\n}\n\nfloat gas(vec2 uv) {\n    vec2 t = vec2(0,-time);\n\tfloat c1 = fbm(fbm(uv*3.0)*0.75+uv*3.0+t/3.0);\n\tfloat c2 = fbm(fbm(uv*2.0)*0.5+uv*7.0+t/3.0);\n\tfloat c3 = fbm(fbm(uv*10.0-t)*0.75+uv*5.0+t/6.0);\n    float r = mix(c1, c2, c3*c3);\n\treturn r*r;\n}\n\nfloat getTileValue(vec2 coord, sampler2D texture)\n{\n    // Normalizing to [0, 1] and flipping y-coordinate\n    vec2 relativeCoord = vec2(coord.x / uResolution.x, (uResolution.y - coord.y) / uResolution.y);\n    \n    // Scaling to tilemap size\n    vec2 tilemapCoord = relativeCoord * uTilemapSize;\n    \n    // Adjust the tilemap coordinates by the camera position offset\n    vec2 cameraOffset = mod(uCameraPosition, vec2(4.0));\n    tilemapCoord += cameraOffset / uResolution * uTilemapSize;\n\n    vec2 tileCoord = floor(tilemapCoord);\n\n    vec2 textureCoord = (tileCoord + vec2(0.5)) / uTilemapSize;\n\n    // Sample the 2D texture at the calculated texture coordinates\n    float tileValue = texture2D(texture, textureCoord).r * 255.0;\n\n    return tileValue;\n}\n\n// bool isOutline(float tileValue) {\n//     if (tileValue == 0.0) return false;\n\n//     vec2 offsets[8]; // Declare the array without initializing\n\n//     // Initialize each element of the array\n//     offsets[0] = vec2(0, -1);\n//     offsets[1] = vec2(0, 1);\n//     offsets[2] = vec2(-1, 0);\n//     offsets[3] = vec2(1, 0);\n//     offsets[4] = vec2(-1, -1);\n//     offsets[5] = vec2(1, 1);\n//     offsets[6] = vec2(1, -1);\n//     offsets[7] = vec2(-1, 1);\n\n//     for (int i = 0; i < 8; i++) {\n//         float localTileValue = getTileValue(gl_FragCoord.xy + offsets[i]);\n//         if (localTileValue == 0.0) {\n//             return true;\n//         }\n//     }\n\n//     return false;\n// }\n\n// 5.0 HARDCODED FOR WATER!!!\n// 100.0 HARDCODED FOR OBSTACLE BREAKPOINT\nbool isOutline(vec2 coord, float tileValue)\n{\n    // This causes random flickering for some reason so disabling for now\n    // TODO: Look into other ways to optimize this so that it doesn't do unnecessary checks\n    // if (tileValue != 0.0 && tileValue != 5.0 && tileValue >= 100.0) {\n    //     return false;\n    // }\n\n    // Get the tile values for the neighboring pixels\n    float leftTileValue = getTileValue(coord + vec2(-1.0, 0.0), uTilemapTexture);\n    float rightTileValue = getTileValue(coord + vec2(1.0, 0.0), uTilemapTexture);\n    float topTileValue = getTileValue(coord + vec2(0.0, -1.0), uTilemapTexture);\n    float bottomTileValue = getTileValue(coord + vec2(0.0, 1.0), uTilemapTexture);\n\n    // Check if any neighboring tile values are not the same as the current tile value\n    if (tileValue == 0.0) {\n        return leftTileValue != 0.0 || rightTileValue != 0.0 || topTileValue != 0.0 || bottomTileValue != 0.0;\n    } else if (tileValue == 5.0) {\n        return leftTileValue != 0.0 && leftTileValue != 5.0 || \n               rightTileValue != 0.0 && rightTileValue != 5.0 || \n               topTileValue != 0.0 && topTileValue != 5.0 || \n               bottomTileValue != 0.0 && bottomTileValue != 5.0;\n    // 100 and above is ground... TODO: Set this at compile time\n    } else if (tileValue < 100.0) {\n        return leftTileValue > 100.0 || rightTileValue > 100.0 || topTileValue > 100.0 || bottomTileValue > 100.0;\n    }\n\n    return false;\n}\n\n// OLD SIMPLE. ENABLE AND CHANGE gl_FragColor = color; to gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0); to achieve sketching\n// bool isOutline(vec2 coord, float tileValue)\n// {\n//     // Get the tile values for the neighboring pixels\n//     float leftTileValue = getTileValue(coord + vec2(-1.0, 0.0));\n//     float rightTileValue = getTileValue(coord + vec2(1.0, 0.0));\n//     float topTileValue = getTileValue(coord + vec2(0.0, -1.0));\n//     float bottomTileValue = getTileValue(coord + vec2(0.0, 1.0));\n\n//     // Check if the current tile value is 0.0 and if any neighboring tile values are not 0.0\n//     if (tileValue == 0.0 && (leftTileValue != 0.0 || rightTileValue != 0.0 || topTileValue != 0.0 || bottomTileValue != 0.0)) {\n//         return true;\n//     }\n\n//     return false;\n// }\n\n// vec4 outline(vec4 fg, vec2 offset, vec4 world) {\n    \n//     vec4 fgTest = texture2D(uSampler, vTextureCoord + offset);\n//     vec4 worldTest = texture2D(uWorldSampler, vTextureCoord + offset);\n//     vec4 obstacleTest = texture2D(obstacleSampler, vTextureCoord + offset);\n\n//     bool fgIsWater = fg.r == 0.4 && fg.g == 0.8 && fg.b == 1.0;\n//     bool worldTestIsWater = worldTest.r == 0.4 && worldTest.g == 0.8 && worldTest.b == 1.0;\n\n//     if (fg.a == 0.0 && fgTest.a == 1.0 && !worldTestIsWater) {\n//         return mix(fg, vec4(0.0, 0.0, 0.0, 1.0), 1.0);\n//     }\n\n//     if (world.a == 1.0 && obstacleTest.a == 1.0) {\n//         return mix(fg, vec4(0.0, 0.0, 0.0, 1.0), 1.0);\n//     }\n\n//     if (fgIsWater\n//         && !worldTestIsWater\n//     ) {\n//         return mix(fg, vec4(0.0, 0.0, 0.0, 1.0), 1.0);\n//     }\n\n//     return fg;\n// }\n\n\nvec4 water()\n{\n    vec2 res = uResolution;\n    vec2 uv = (gl_FragCoord.xy - magicalFixturePoint.xy) / res.xy;\n\n    //background texture\n    \n    //background color rgb( 49/255, 169/255, 238/255, 255/255 ) -- 0.192156862745098, 0.6627450980392157, 0.9333333333333333\n    vec4 texture_color = vec4(0.192156862745098, 0.6627450980392157, 0.9333333333333333, 1.0);\n    \n    vec4 k = vec4(time)*0.8;\n    k.xy = uv * 7.0;\n    float val1 = length(0.5-fract(k.xyw*=mat3(vec3(-2.0,-1.0,0.0), vec3(3.0,-1.0,1.0), vec3(1.0,-1.0,-1.0))*0.5));\n    float val2 = length(0.5-fract(k.xyw*=mat3(vec3(-2.0,-1.0,0.0), vec3(3.0,-1.0,1.0), vec3(1.0,-1.0,-1.0))*0.2));\n    float val3 = length(0.5-fract(k.xyw*=mat3(vec3(-2.0,-1.0,0.0), vec3(3.0,-1.0,1.0), vec3(1.0,-1.0,-1.0))*0.5));\n    vec4 color = vec4 ( pow(min(min(val1,val2),val3), 7.0) * 3.0)+texture_color * 0.75; // 0.75 is opacity\n\n    // Used to be -1 to -4\n    for (int y = -1; y >= -2; y--) {\n        float tileValue = getTileValue(gl_FragCoord.xy - vec2(0, y), uTilemapTexture);\n\n        if (tileValue == 0.0) {\n            color = mix(color, vec4(1.0, 1.0, 1.0, 1.0), 0.2);\n            break;\n        }\n    }\n    \n    return color;\n}\n\nvec4 steam()\n{\n    vec2 res = uResolution;\n    vec2 uv = (gl_FragCoord.xy - magicalFixturePoint.xy) / res.xy;\n    vec3 col = 1.0 + 1.0*cos(time*1.0+uv.xyx+vec3(1,1,1));\n    vec4 color = vec4(col,1.0) * gas(uv) * 0.25;\n    return color;\n}\n\nvec3 snow()\n{\n    vec2 res = uResolution;\n    vec2 xy = (gl_FragCoord.xy - magicalFixturePoint.xy);\n\n    // Checker pattern size\n    float checkerSize = 4.0;\n\n    vec2 uv = xy / uResolution.xy;\n    uv.y += time * 0.005; // Adding a constant factor of movement to Y-coordinates\n\n    // Sparkling effect\n    // float sparkle = hash(xy * 5.0) > 0.5 ? 1.2 : 1.0;\n\n    // Calculate the checker pattern\n    vec2 cell = floor(uv * uResolution.xy / checkerSize);\n    float checker = hash(cell);\n\n    // Time varying parameter for color\n    float t = uv.y * 10.0; // Modify this for sine wave based on Y-coordinates\n\n    // Sine wave pattern to slightly shift color\n    float value = 0.5 + 0.5 * sin(t);\n\n    // Lighter base colors\n    vec3 color = mix(vec3(1.0, 1.0, 1.0), vec3(0.8, 1.0, 1.0), checker + value * 0.5);\n\n    return color;\n}\n\nvec4 gloom()\n{\n    vec2 res = uResolution;\n    vec2 xy = (gl_FragCoord.xy - magicalFixturePoint.xy);\n    vec2 uv = xy / res.xy;\n    \n    vec2 t = vec2(0, -0.5);\n    \n    float pattern1 = fbm(fbm(uv * 3.0) * 0.75 + uv * 3.0 + t);\n    float pattern2 = fbm(fbm(uv * 2.0) * 0.5 + uv * 7.0 + t);\n    \n    // Slightly brighter purple colors\n    vec3 darkPurple = vec3(0.3, 0.1, 0.4);    // Base purple\n    vec3 mediumPurple = vec3(0.4, 0.2, 0.5);  // Medium purple\n    \n    vec3 color = mix(darkPurple, mediumPurple, pattern1);\n    color = mix(color, vec3(0.35, 0.15, 0.45), pattern2 * 0.5);\n    \n    float brightness = 0.6 + 0.4 * fbm(uv * 5.0 + t); // Increased brightness range\n    color *= brightness;\n    \n    return vec4(color, 1.0);\n}\n\nvoid main(void)\n{\n    // Add check for pixels outside world boundary at the bottom\n    // Done in lightning.glsl now\n    // vec2 worldPixel = vec2(gl_FragCoord.x, uResolution.y - gl_FragCoord.y) + uCameraPosition;\n    // if (worldPixel.y > uWorldSize.y) {\n    //     gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n    //     return;\n    // }\n\n    float tileValue = getTileValue(gl_FragCoord.xy, uTilemapTexture);\n\n    vec2 pixelSize = vec2(1.0) / uResolution;\n    bool outline = isOutline(gl_FragCoord.xy, tileValue);\n\n    if (outline) {\n        // if (tileValue == 5.0) {\n        //     gl_FragColor = vec4(0.4, 0.8, 1.0, 0.5);\n        //     return;\n        // }\n\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        return;\n    }\n\n    // All this should probably be removed since this shader do not handle light sources anymore\n    // but I can't be bothered fixing all the mix calls, so just keeping the bare minimum for now \n    // <--\n    float lightAmount = 1.0;\n    vec4 blackColor = vec4(0.0, 0.0, 0.0, 1.0);\n    if (lightAmount < minLightAmount) {\n        lightAmount = minLightAmount;\n    }\n    float highestTorchLightAmount = 0.0;\n    vec4 torchColor = vec4(1.0, 0.5, 0.0, 1.0);\n    // --\x3e\n\n    // 5.0 HARDCODED FOR WATER!!!\n    if (tileValue == 5.0) {\n        vec4 color = water();\n        gl_FragColor = mix(blackColor, mix(color, torchColor, highestTorchLightAmount / 4.0), max(lightAmount, highestTorchLightAmount) * 1.2);\n        return;\n    }\n\n    // 22.0 HARDCODED FOR STEAM!!! (look in colorIdByElementType and it will be the first array item for the key that matches the ElementType.Steam enum value)\n    if (tileValue == 23.0) {\n        vec4 color = steam();\n        gl_FragColor = mix(blackColor, mix(color, torchColor, highestTorchLightAmount / 4.0), max(lightAmount, highestTorchLightAmount) * 1.2);\n        return;\n    }\n\n    // 27.0 HARDCODED FOR SNOW!!!\n    if (tileValue == 28.0) {\n        vec3 color = snow();\n        gl_FragColor = mix(blackColor, mix(vec4(color, 1.0), torchColor, highestTorchLightAmount / 4.0), max(lightAmount, highestTorchLightAmount) * 1.2);\n        return;\n    }\n\n    // 22.0 HARDCODED FOR GLOOM!!!\n    if (tileValue == 22.0) {\n        vec4 color = gloom();\n        gl_FragColor = mix(blackColor, mix(color, torchColor, highestTorchLightAmount / 4.0), max(lightAmount, highestTorchLightAmount) * 1.2);\n        return;\n    }\n\n    // if (tileValue == 0.0) {\n\n    float normalizedTileValue = (tileValue + 0.5) / 255.0; // tileValue / 255.0; // 255.0 HARDCODED! 255.0 needs to match the number of colors in the uRGBAByColorIdLookupTexture. TODO: Add this as compile step or use a uniform\n    vec4 color = texture2D(uRGBAByColorIdLookupTexture, vec2(normalizedTileValue, 0.0));\n\n    if (tileValue == 0.0) {\n        float wallTileValue = getTileValue(gl_FragCoord.xy, uWallTilemapTexture);\n        // If it's 0.0 it is already set to transparent so no need to do anything\n        if (wallTileValue != 0.0) {\n            color = texture2D(uWallRGBALookupTexture, vec2((wallTileValue + 0.5) / 255.0, 0.0));\n        }\n    }\n\n    gl_FragColor = color;\n}",{uResolution:[o.width,o.height],minLightAmount:0,time:0,uDrawUndergroundFog:!1,uTilemapTexture:I,uWallTilemapTexture:F,uTilemapSize:[P.width,P.height],uRGBAByColorIdLookupTexture:N,uWallRGBALookupTexture:[],uWorldSize:[a.world.size.width*e.cellSize,a.world.size.height*e.cellSize]});A.filters=[L];var B=new OffscreenCanvas(n,r),O=B.getContext("2d");O.imageSmoothingEnabled=!1;var z=Mr.from(B),j=new ss(z);p.stage.addChild(j);var U=new ns;p.stage.addChild(U);var G=function(e,t){var n=new ns;n.width=e.images.player.image.width,n.height=e.images.player.image.height,n.x=t.screen.width/2,n.y=t.screen.height/2-2;var r=Mr.from(e.images.weapon.image),i=new ss(r);i.x=6,i.y=2,i.pivot.x=3,i.pivot.y=7,i.visible=!1,n.addChild(i);var s=Mr.from(e.images.builder.image),o=new ss(s);o.x=6,o.y=2,o.pivot.x=3,o.pivot.y=7,o.visible=!1,n.addChild(o);var a=Mr.from(e.images.player.image),l=new ss(a);l.texture.baseTexture.scaleMode=me.NEAREST,l.anchor.set(.5),l.width=e.images.player.image.width,l.height=e.images.player.image.height,n.addChild(l);var u=new ss(Mr.from(e.images.gun.image));u.y=2,u.pivot.x=3,u.pivot.y=6,u.visible=!1,n.addChild(u);var c=new ss(r);c.x=-6,c.y=2,c.pivot.x=3,c.pivot.y=7,c.visible=!1,n.addChild(c);var h=Mr.from(e.images.player_arm_vertical.image),d=new ss(h);d.x=-9,d.y=0,d.visible=!1,n.addChild(d);for(var f=e.images.muzzle_flash,p=new hn(f.image),m=f.height,g=f.height,y=[],v=0;v<f.width/g;v++){var x=new An(v*m,0,m,g);y.push(new Mr(p,x))}var b=new $a(y);return n.addChild(b),b.y=2,b.pivot.x=-21,b.pivot.y=15,b.animationSpeed=.5,b.visible=!1,b.loop=!1,b.onComplete=function(){b.visible=!1},n.addChild(b),{container:n,body:l,weapon:u,builder:o,forearm:d,shovel:c,offhandShovel:i,muzzleFlash:b}}(i,p);a.scene.active!==x.MainMenu&&p.stage.addChild(G.container);var V=new ns;p.stage.addChild(V);var H=Mr.from(s),W=new ss(H);bf(W,{x:0,y:0},n,r),p.stage.addChild(W);var X=new gr(null,"#define N 100.0\n#define MAX_LIGHTS 100\n#define SOFT_SHADOW 0.995\n\nuniform vec2 uResolution;\nuniform vec2 lightPosition;\nuniform vec4 lights[MAX_LIGHTS * 2];\n// Size of light in pixels\nuniform float lightSize;\nuniform float minLightAmount;\nuniform sampler2D uSampler;\nuniform float time;\nuniform bool uDrawUndergroundFog;\nuniform vec2 magicalFixturePoint;\nuniform vec2 uCameraPosition;\n\nuniform sampler2D uTilemapTexture;\nuniform vec2 uTilemapSize;\nuniform vec2 uWorldSize;\n\nuniform float uTerrainShadowValue; // 0.995 at top and 0.95 at bottom\n\nuniform bool uDisableRaycastStepping;\n\nvarying vec2 vTextureCoord;\n\nfloat getTileValue(vec2 coord)\n{\n    // Normalizing to [0, 1] and flipping y-coordinate\n    vec2 relativeCoord = vec2(coord.x / uResolution.x, (uResolution.y - coord.y) / uResolution.y);\n    \n    // Scaling to tilemap size\n    vec2 tilemapCoord = relativeCoord * uTilemapSize;\n    \n    // Adjust the tilemap coordinates by the camera position offset\n    vec2 cameraOffset = mod(uCameraPosition, vec2(4.0));\n    tilemapCoord += cameraOffset / uResolution * uTilemapSize;\n\n    vec2 tileCoord = floor(tilemapCoord);\n\n    vec2 textureCoord = (tileCoord + vec2(0.5)) / uTilemapSize;\n\n    // Sample the 2D texture at the calculated texture coordinates\n    float tileValue = texture2D(uTilemapTexture, textureCoord).r * 255.0;\n\n    return tileValue;\n}\n\nfloat terrain(vec2 samplePoint)\n{\n    // Convert samplePoint to pixel coordinates and flip the y-coordinate\n    vec2 pixelCoord = vec2(samplePoint.x * uResolution.x, (1.0 - samplePoint.y) * uResolution.y);\n\n    // Get the tile value using the updated getTileValue function\n    float tileValue = getTileValue(pixelCoord);\n    \n    // Set samplePointAlpha to 1.0 if the tile value is above 100, otherwise 0.0\n    float samplePointAlpha = tileValue > 100.0 ? 1.0 : 0.0;\n    \n    // Convert to stepped value\n    float sampleStepped = step(0.1, samplePointAlpha);\n    float returnValue = 1.0 - sampleStepped;\n\n    // Soften the shadows. Comment out for hard shadows.\n    // The closer the first number is to 1.0, the softer the shadows.\n    // returnValue = mix(SOFT_SHADOW, 1.0, returnValue);\n    // For terrain (when samplePointAlpha > 0), use a different shadow value\n    // TODO: Is SOFT_SHADOW even doing anything now? Changing it doesn't seem to affect anything.\n    float shadowValue = (tileValue > 100.0) ? uTerrainShadowValue : SOFT_SHADOW;\n    returnValue = mix(shadowValue, 1.0, returnValue);\n\n    return returnValue;\n}\n\nfloat raycast()\n{\n        // Start our mixing variable at 1.0\n    float lightAmount = 1.0;\n\n    // lightSize 0.0 is above ground right now\n    if (lightSize == 0.0) {\n        return lightAmount;\n    }\n\n    // Distance in pixels to the light\n    float distanceToLight = length(lightPosition - vec2(gl_FragCoord.x, uResolution.y - gl_FragCoord.y));\n\n    // Normalize the fragment coordinate from (0.0, 0.0) to (1.0, 1.0)\n    // vec2 normalizedFragCoord = fragCoord/iResolution.xy;\n\n    // NOT WORKING\n    // vec2 normalizedLightCoord = lightPosition.xy/resolution.xy;\n    // HARDCORE FOR NOW\n    vec2 normalizedLightCoord = lightPosition.xy/uResolution.xy;\n\n    // Find out how much light we have based on the distance to our light\n    // lightAmount *= 1.0 - smoothstep(0.0, lightSize, distanceToLight);\n    // This creates a cool glow that emualtes the bloom effect I'm looking for\n\n    lightAmount *= (1.0 - smoothstep(0.0, lightSize, distanceToLight));\n    // Glow up version\n    // lightAmount *= (1.0 - smoothstep(0.0, lightSize, distanceToLight)) * 1.5;\n\n    if (uDisableRaycastStepping) {\n        // Skip raycast stepping and just return the distance-based light amount\n        return lightAmount;\n    }\n\n    // float shadowAmount = terrain(vTextureCoord);\n    // lightAmount *= shadowAmount;\n    for(float i = 0.0; i < N; i++)\n    {\n        // A 0.0 - 1.0 ratio between where our current pixel is, and where the light is\n        float t = i / N;\n        // Grab a coordinate between where we are and the light\n        vec2 samplePoint = mix(vTextureCoord, normalizedLightCoord, t);\n        // Is there something there? If so, we'll assume we are in shadow\n        float shadowAmount = terrain(samplePoint);\n\n        if (i == 0.0 && shadowAmount == SOFT_SHADOW) {\n            // No need to calcuate any further since pixel is not visible\n            break;\n        }\n        // Multiply the light amount.\n        // (Multiply in case we want to upgrade to soft shadows)\n        lightAmount *= shadowAmount;\n\n        // Possible optimization EXITEARLY123. Try different values from 0.0 to 1.0\n        // if (lightAmount < 0.95) {\n        //     lightAmount = 0.5;\n        //     break;\n        // }\n    }\n\n    // When EXITEARLY123 is enabled to draw rest of screen with shadows\n    // lightAmount *= 1.0 - smoothstep(0.0, lightSize, distanceToLight);\n\n    return lightAmount;\n}\n\nvoid main(void)\n{\n    // Add check for pixels outside world boundary at the bottom\n    vec2 worldPixel = vec2(gl_FragCoord.x, uResolution.y - gl_FragCoord.y) + uCameraPosition;\n    if (worldPixel.y > uWorldSize.y) {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        return;\n    }\n\n    vec4 fg = texture2D(uSampler, vTextureCoord);\n        \n    float lightAmount = raycast();\n    \n    // Change black color to be transparent when tile value is >= 254 (mostly to make explosions show through since they will be clipped by black otherwise if rendered on top of darkness)\n    // So when it's in darkness the lighting layer will be transparent, but will be shown as black since the underlying tile is still black\n    float currentTileValue = getTileValue(gl_FragCoord.xy);\n    vec4 color = currentTileValue >= 254.0 ? vec4(0.0, 0.0, 0.0, 0.0) : vec4(0.0, 0.0, 0.0, 1.0);\n\n    // Our fragment color will be somewhere between black and channel 1\n    // dependent on the value of b.\n\n    if (lightAmount < minLightAmount) {\n        lightAmount = minLightAmount;\n    }\n\n    vec4 maxTorchColor = vec4(0.0);\n    float totalTorchLightAmount = 0.0;\n    \n    // Only process torch lighting if tile value is less than 254\n    if (currentTileValue < 254.0) {\n        for (int i = 0; i < MAX_LIGHTS; i++) {\n            vec4 lightPosition = lights[i * 2];\n            vec4 lightProperties = lights[i * 2 + 1];\n            \n            if (lightPosition.z < 0.0001) {\n                break;\n            }\n            \n            float distanceToTorch = length(lightPosition.xy - gl_FragCoord.xy);\n            float torchLightAmount = lightPosition.z;\n            float torchSize = lightPosition.w;\n            \n            torchLightAmount *= 1.0 - smoothstep(0.0, torchSize, distanceToTorch);\n            \n            maxTorchColor.r = max(maxTorchColor.r, lightProperties.r * torchLightAmount);\n            maxTorchColor.g = max(maxTorchColor.g, lightProperties.g * torchLightAmount);\n            maxTorchColor.b = max(maxTorchColor.b, lightProperties.b * torchLightAmount);\n            maxTorchColor.a = max(maxTorchColor.a, lightProperties.a * torchLightAmount);\n            \n            totalTorchLightAmount = max(totalTorchLightAmount, torchLightAmount);\n        }\n    }\n\n    vec4 blendedTorchColor = maxTorchColor;\n    float highestTorchLightAmount = totalTorchLightAmount;\n\n    gl_FragColor = mix(color, mix(fg, blendedTorchColor, highestTorchLightAmount / 4.0), max(lightAmount, highestTorchLightAmount));\n}",{uResolution:[o.width,o.height],lightPosition:[0,0],lightSize:1e3,lights:[o.width/2,o.height/2,o.width/2,o.height/2,o.width/2,o.height/2],minLightAmount:0,time:0,uDrawUndergroundFog:!1,uTilemapTexture:I,uTilemapSize:[P.width,P.height],uWorldSize:[a.world.size.width*e.cellSize,a.world.size.height*e.cellSize]}),$=new ss;$.width=n,$.height=r,$.filters=[X],p.stage.addChild($);for(var Y=i.images.explosion_44x44,q=new hn(Y.image),K=Y.height,Z=Y.height,Q=[],J=0;J<Y.width/Z;J++){var ee=new An(J*K,0,K,Z);Q.push(new Mr(q,ee))}return p.ticker.autoStart=!1,p.ticker.stop(),{app:p,cursors:{default:m,marquee:"url('img/cursor_marquee.png'),auto",demolish:"url('img/cursor_demolish.png'),auto"},dynamic2D:{context:O,texture:z},tilemap:R,tilemapTexture:I,wallTilemap:D,wallTilemapTexture:F,filter:X,skyFilter:T,outlineElementsFilter:L,mountainsSprite:w,treesSprite:_,foregroundSprite:$,dynamicSprites:k,mapContainer:A,fogSprite:W,backgroundEntitiesContainer:U,foregroundEntitiesContainer:V,sprites:{player:G,projectiles:{},drones:{},worldItems:{}},frames:{explosion:Q},textures:{bullet:Mr.from(i.images.bullet.image),rocket:Mr.from(i.images.rocket.image),bouncer:Mr.from(i.images.bouncer.image),hauler:Mr.from(i.images.hauler.image),haulerClosed:Mr.from(i.images.hauler_closed.image),artifact:Mr.from(i.images.artifact.image)},toggleSkyFilter:function(e){y.filters=e?[T]:null,document.body.style.backgroundColor=e?"#000000":"rgb(135,206,235)"}}}(c,p,m,s,g,h,r,w,b,0,0,0,Z),J={x:0,y:0},ee={rendering:{canvas:c,worldCanvas:b,worldContext:b.getContext("2d"),obstacleCanvas:w,obstacleContext:w.getContext("2d"),foregroundOffscreenCanvas:R,foregroundOffscreenContext:I,offscreenOutlineCanvas:D,offscreenOutlineContext:F,offscreenCanvas:S,offscreenContext:_,worldOffscreenCanvas:T,worldOffscreenContext:C,obstacleOffscreenCanvas:A,obstacleOffscreenContext:P,backgroundChannel:N,channel:L,worldChannel:B,obstacleChannel:O,foregroundChannel:z,overlayCanvas:f,overlayContext:j,obstacleImageData:new ImageData(r.world.size.width,r.world.size.height),imageData:new ImageData(r.world.size.width,r.world.size.height),pixi:Q,images:s.images,fog:{state:E.Above,cooldown:{last:0},lastPosition:!1},minimap:{world:{canvas:V,context:H},obstacle:{canvas:U,context:G}}},resolution:h,camera:J,lerpCamera:!1,overrideCamera:!1,input:{currentLastKey:null,keys:{},action:{move:(q=[],K=function(e){for(var t=0;t<q.length;t++)q[t]===e&&q.splice(t,1)},{up:W=W||!1,left:X=X||!1,right:$=$||!1,down:Y=Y||!1,onKeyDown:function(e,t){var n=t.key;let r=Xf(e,n.toLowerCase());r&&(K(r),q.push(r))},onKeyUp:function(e,t){var n=t.key;let r=Xf(e,n.toLowerCase());r&&K(r)},order:q,onKeyToggle:function(e){var t=e.key;let n=Xf(t.toLowerCase());n&&(q.length>0&&q[0]===n?K(n):q[0]=n)}}),boost:!1,jump:!1},mouse:{pressed:!1,clicked:!1,released:!1,position:{x:0,y:0},worldPosition:{x:9999,y:9999},cellPosition:{x:0,y:0},lastCellPosition:{x:0,y:0},lastBigMoveX:0,shaken:!1,available:!0}},tabActive:!0,saving:!1,paused:!1,timestep:{lastTime:0,frameDuration:1e3/e.fps},action:{point:{x:0,y:0},state:(a={},a[u.Start]=!1,a[u.Active]=!1,a[u.End]=!1,a),customData:null},building:{activeStructureType:null,start:{x:0,y:0},placing:!1,amountOfTiles:0},buttons:{pressed:!1},cache:{structures:[],pipes:[]},zoomLevel:1,scale:d,lights:new Array(100).fill(null),lightZones:Array(10*Math.ceil(r.world.size.height*e.cellSize/h.height)).fill(!1).map((function(){return Array(10*Math.ceil(r.world.size.width*e.cellSize/h.width)).fill(null)})),explosions:[],effects:[],colors:Z,visualParticles:[],soundEngine:o,ambience:jh(),music:{engine:new _p,ambient:{engine:new Tp}},windows:{building:{open:!1,filterConfig:!1,soundBoxConfig:!1},inventory:{open:!1},techTree:{open:!1,selectedTech:null},upgrades:{open:!1},menu:{open:!1},loader:{open:!1},options:{open:!1},playtestFinished:{open:!1}},ui:{visible:!0,nextListenerId:1,listeners:{},minimap:{visible:!1},tooltip:{activeTick:!1,data:null}},soundBox:{selectedNote:{tone:"C",octave:1}},debug:{brush:{elementType:n.Sand,overwrite:!1,skipPhysics:!1,cellType:t.Ice}},mainSensorCache:new Jf,notifications:{toast:!1},monitor:{threads:[]},triggers:Object.entries(vp).map((function(e){var t=e[0],n=e[1];return mp(mp({accumulator:0,id:parseInt(t)},n.sequentialRuns?{runCount:0}:{}),n.extra?{extra:n.extra}:{})})),runtime:np()?"electron":"browser",settings:Ap()};return console.log("session.runtime",ee.runtime),function(e,t){document.addEventListener("visibilitychange",(function(n){"visible"==document.visibilityState?(t.timestep.lastTime=performance.now(),t.tabActive=!0,Yl({store:e,session:t})):(Zf(t),t.tabActive=!1,$l({store:e,session:t}))})),document.addEventListener("mousedown",(function(e){3!==e.button&&4!==e.button||(e.preventDefault(),e.stopPropagation())}));var n=t.rendering.canvas;n.addEventListener("mousedown",(function(e){if(0===e.button){t.input.mouse.pressed=t.input.mouse.clicked=!0;var n=t.rendering.canvas.getBoundingClientRect();t.input.mouse.position={x:Math.round((e.clientX-n.left)/t.scale),y:Math.round((e.clientY-n.top)/t.scale)}}})),document.body.addEventListener("mousemove",(function(e){var n=t.rendering.canvas.getBoundingClientRect();t.input.mouse.position={x:Math.round((e.clientX-n.left)/t.scale),y:Math.round((e.clientY-n.top)/t.scale)}})),document.body.addEventListener("mouseup",(function(e){0===e.button&&t.input.mouse.pressed&&(t.input.mouse.pressed=!1,t.input.mouse.released=!0)})),document.body.addEventListener("mouseenter",(function(e){t.input.mouse.available=!0})),document.body.addEventListener("mouseleave",(function(e){t.input.mouse.available=!1,t.action.customData=null,t.building.placing=!1,document.body.style.cursor="",t.rendering.pixi.app.renderer.events.cursorStyles.default=t.rendering.pixi.cursors.default,t.rendering.pixi.app.renderer.events.setCursor(t.rendering.pixi.cursors.default)})),n.addEventListener("wheel",(function(e){}));var r=t.input,i=t.soundEngine;window.addEventListener("keydown",(function(n){var s=Kf(n);n.target instanceof Element&&("INPUT"===n.target.tagName||"TEXTAREA"===n.target.tagName)||(n.preventDefault(),e.scene.active!==x.Intro&&(n.repeat||r.keys&&(r.keys[s]=y.Down),r.action.move.onKeyDown(t,n),r.currentLastKey=s,s===t.settings.keyBindings.Boost?(r.action.boost||(Hl(i,"boost"),Hl(i,"boost_overlay")),r.action.boost="up"):s===t.settings.keyBindings.Descend&&(r.action.boost||(Hl(i,"boost"),Hl(i,"boost_overlay")),r.action.boost="down")))}),!1),window.addEventListener("keyup",(function(e){var n=Kf(e);e.preventDefault(),r.keys&&(r.keys[n]===y.Pressed?r.keys[n]=y.Released:r.keys[n]===y.Down&&(r.keys[n]=y.All)),r.action.move.onKeyUp(t,e),r.currentLastKey=null,(n===t.settings.keyBindings.Boost||n===t.settings.keyBindings.Descend)&&(r.action.boost&&(Wl(i,"boost"),Wl(i,"boost_overlay")),r.action.boost=!1)}),!1),window.addEventListener("blur",(function(){Zf(t)})),n.addEventListener("wheel",(function(e){})),window.addEventListener("resize",(function(){var e=$f(t.rendering.canvas.width,t.rendering.canvas.height);t.scale=e,Yf(t.rendering.canvas,t.rendering.overlayCanvas,e),Cl({session:t},k.Root)}))}(r,ee),console.log("setupSession",performance.now()-l),ee};var Rp=function(){return Rp=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Rp.apply(this,arguments)};function Ip(t,n,r){var i=oe.get(t.session,"structures",Math.floor(n/e.snapGridCellSize)*e.snapGridCellSize,Math.floor(r/e.snapGridCellSize)*e.snapGridCellSize);if(i&&(i.filter||i.queued))return!0;if(e.useMultithreading){var s=t.shared.obstacleImageData,o=4*(n+r*s.width);return s.data[o+3]>0}return Ld(kd(t.store,n,r))}function Dp(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}var Fp=e.cellSize,Np=function(e){for(var t=e.store.player,n=Math.floor(t.x/Fp),r=Math.ceil((t.x+t.width)/Fp),i=Math.floor((t.y+t.height+1)/Fp),s=n;s<=r;s++)if(Ip(e,s,i))return!0;return!1},Lp=function(t){for(var n=t.store.player,r=0;r<2;r++){var i=K.getRandomIntBetween(-2,5),s=K.getRandomIntBetween(6,8),o={x:60*K.getRandomFloatBetween(-.5,.5),y:60*K.getRandomFloatBetween(.5,1.5)};Fc(t,n.x+i*e.cellSize,n.y+s*e.cellSize,o,{background:!0})}},Bp=function(e){e.session.paused=!0,e.environment.multithreading.simulation.manager.postMessage([f.SetPaused,!0])},Op=function(e){e.session.paused=!1,e.environment.multithreading.simulation.manager.postMessage([f.SetPaused,!1])},zp=function(e){e.store.scene.active!==x.Intro&&(jp(e),Hp(e),Gp(e,e.session),pf(e),Up(e.session))},jp=function(t){var n=t.session,r=(n.rendering.canvas.getBoundingClientRect(),Math.round(n.camera.x+n.input.mouse.position.x)),i=Math.round(n.camera.y+n.input.mouse.position.y);n.input.mouse.worldPosition={x:r,y:i},e.useMultithreading&&(t.shared.mouse.worldPosition[0]=r,t.shared.mouse.worldPosition[1]=i);var s=Math.floor(r/e.cellSize),o=Math.floor(i/e.cellSize);n.input.mouse.lastCellPosition={x:n.input.mouse.cellPosition.x,y:n.input.mouse.cellPosition.y},n.input.mouse.cellPosition={x:s,y:o};var a=n.input.mouse.cellPosition.x-n.input.mouse.lastCellPosition.x;Math.abs(a)>1&&(Math.sign(n.input.mouse.lastBigMoveX)!==Math.sign(a)&&(n.input.mouse.shaken=!0),n.input.mouse.lastBigMoveX=a)},Up=function(e){e.input.mouse.clicked&&(e.input.mouse.clicked=!1),e.input.mouse.released&&(e.input.mouse.released=!1),e.input.mouse.shaken&&(e.input.mouse.shaken=!1)},Gp=function(e,t){e.store;var n=parseInt(t.input.currentLastKey);Number.isNaN(n)||n<1||n>9||If(e,n-1)},Vp=function(e,t){e.session.windows.building.filterConfig=!1;for(var n=0,r=Object.entries(e.session.windows);n<r.length;n++){var i=r[n],s=i[0],o=i[1];s!==t&&o.open&&(o.open=!1)}},Hp=function(e){for(var t=e.session.settings.keyBindings,n={},r=0,i=Object.entries(t);r<i.length;r++){var s=i[r],o=s[0];n[c=s[1]]||(n[c]=[]),n[c].push({keyBinding:o,action:Wp(o)})}for(var a=function(t,n){var r=e.session.input.keys[t];if(!r||r===y.Up)return"continue";n.forEach((function(t){t.keyBinding;var n=t.action;switch(r){case y.Down:n.down&&n.down(e);break;case y.Pressed:n.pressed&&n.pressed(e);break;case y.Released:n.released&&n.released(e);break;case y.All:n.down&&n.down(e),n.pressed&&n.pressed(e),n.released&&n.released(e)}})),r===y.Down?e.session.input.keys[t]=y.Pressed:r!==y.Released&&r!==y.All||(e.session.input.keys[t]=y.Up)},l=0,u=Object.entries(n);l<u.length;l++){var c,h=u[l];a(c=h[0],h[1])}},Wp=function(t){switch(t){case g.OpenBuildMenu:return{down:function(e){e.store.tutorial.active&&e.store.tutorial.currentStep<b.OpenTechTree||(zu(e,b.OpenBuildMenu),e.session.windows.building.filterConfig&&(e.session.windows.building.filterConfig=!1,Cl(e,k.FilterConfig)),Vp(e,"building"),e.session.windows.building.open=!e.session.windows.building.open,Cl(e,k.Management),Hl(e.session.soundEngine,"open",{volume:.05}))}};case g.OpenTechTree:return{down:function(e){e.store.tutorial.active&&e.store.tutorial.currentStep<b.OpenTechTree||(e.session.windows.techTree.selectedTech=null,Pc(e),Vp(e,"techTree"),zu(e,b.OpenTechTree),e.session.windows.techTree.open=!e.session.windows.techTree.open,Cl(e,k.Management),Hl(e.session.soundEngine,"open",{volume:.05}))}};case g.OpenInventory:return{down:function(e){e.store.tutorial.active&&e.store.tutorial.currentStep<b.OpenTechTree||(Vp(e,"inventory"),e.session.windows.inventory.open=!e.session.windows.inventory.open,Cl(e,k.Management),Hl(e.session.soundEngine,"open",{volume:.05}))}};case g.OpenUpgrades:return{down:function(e){e.store.tutorial.active&&e.store.tutorial.currentStep<b.OpenTechTree||(Vp(e,"upgrades"),e.session.windows.upgrades.open=!e.session.windows.upgrades.open,Cl(e,k.Management),Hl(e.session.soundEngine,"open",{volume:.05}))}};case g.GrapplingHook:return{down:function(e){e.store.player.inventory.find((function(e){return e.id===l.GrapplingHook}))&&cc(e,0,!0)},released:function(e){e.store.player.grapplingHook&&(e.store.player.grapplingHook=!1)}};case g.Escape:return{down:function(e){if(e.store.scene.active!==x.MainMenu&&(!e.session.windows.building.filterConfig||(e.session.windows.building.filterConfig=!1,Cl(e,k.FilterConfig),e.session.windows.options.open))&&!e.session.windows.options.open){for(var t=!1,n=0,r=Object.entries(e.session.windows);n<r.length;n++){var i=r[n],s=i[0],o=i[1];o.open&&(o.open=!1,t=!0,"menu"===s&&(Op(e),e.session.building.placing=!1,Cl(e,k.ShortcutHelper),Cl(e,k.Menu),Yl(e)))}if(t)Cl(e,k.Management);else{if(e.session.building.placing)return e.session.building.placing=!1,e.session.input.mouse.clicked=!1,e.session.input.mouse.pressed=!1,e.session.input.mouse.released=!1,void Cl(e,k.ShortcutHelper);e.session.windows.menu.open=!0,Cl(e,k.Menu),Bp(e),$l(e)}}}};case g.Pause:return{down:function(t){e.debug.active&&(t.session.paused?Op(t):Bp(t))}};case g.ReverseBuildDirection:case g.Copy:return{};case g.Delete:return{down:function(e){var t=mf(e);if(t&&t.itemType===a.Tool&&t.id===l.Copier&&null!==e.session.action.customData&&void 0!==e.session.action.customData.selectedStructures){var n=e.session.action.customData.start,r=e.session.action.customData.end;Xh(e,n,r,{removeCells:!0,playSound:!0}),e.session.action.customData=null,Cl(e,k.ShortcutHelper)}}};case g.PauseCamera:return{down:function(t){e.debug.active&&(t.session.overrideCamera?(t.session.overrideCamera=!1,t.session.lerpCamera||(t.session.lerpCamera={start:{x:t.session.camera.x,y:t.session.camera.y},time:Date.now(),duration:500},setTimeout((function(){t.session.lerpCamera=!1}),500))):t.session.overrideCamera={x:t.session.camera.x,y:t.session.camera.y})}};case g.Marquee:return{down:function(e){e.session.building.placing||(e.session.rendering.pixi.app.renderer.events.cursorStyles.default=e.session.rendering.pixi.cursors.marquee,e.session.rendering.pixi.app.renderer.events.setCursor(e.session.rendering.pixi.cursors.marquee))},released:function(e){e.session.rendering.pixi.app.renderer.events.cursorStyles.default=e.session.rendering.pixi.cursors.default,e.session.rendering.pixi.app.renderer.events.setCursor(e.session.rendering.pixi.cursors.default),e.session.action.customData&&!e.session.action.customData.selectedStructures&&(e.session.action.customData=null)}};case g.Demolish:return{down:function(e){e.session.building.placing||(e.session.rendering.pixi.app.renderer.events.cursorStyles.default=e.session.rendering.pixi.cursors.demolish,e.session.rendering.pixi.app.renderer.events.setCursor(e.session.rendering.pixi.cursors.demolish))},released:function(e){e.session.rendering.pixi.app.renderer.events.cursorStyles.default=e.session.rendering.pixi.cursors.default,e.session.rendering.pixi.app.renderer.events.setCursor(e.session.rendering.pixi.cursors.default),e.session.action.customData=null}};case g.BuildMode:return{down:function(e){e.store.options.buildMode=e.store.options.buildMode===T.Rectangular?T.Linear:T.Rectangular,Cl(e,k.ShortcutHelper)}};case g.Jump:return{down:function(e){if(!Np(e))return e.store.player.isHovering=!e.store.player.isHovering,e.store.player.isHovering&&Mu(e,"hover"),e.session.input.action.boost&&(Wl(e.session.soundEngine,"boost"),Wl(e.session.soundEngine,"boost_overlay"),e.session.input.action.boost=!1),void(e.store.player.isHovering?Hl(e.session.soundEngine,"humming"):Wl(e.session.soundEngine,"humming"));e.store.player.isHovering=!1,Wl(e.session.soundEngine,"humming"),e.session.input.action.jump=!0},released:function(e){e.session.input.action.jump=!1}};default:return{}}},Xp=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,a)}l((r=r.apply(e,t||[])).next())}))},$p=function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},Yp=function(e,t){return void 0===t&&(t={}),Xp(void 0,void 0,void 0,(function(){var n,r,i;return $p(this,(function(s){switch(s.label){case 0:return[4,qp("img/".concat(null!==(i=t.fileName)&&void 0!==i?i:e,".png"))];case 1:return n=s.sent(),r={width:n.width,height:n.height,image:n},t.withImageData&&(r.imageData=K.getImageDataFromImage(n)),[2,{name:e,imageAsset:r}]}}))}))},qp=function(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){return t(r)},r.onerror=n,r.src=e}))},Kp=function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},Zp=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},Qp=[],Jp=function(){for(var e=navigator.hardwareConcurrency-2,t=[],n=0;n<e;n++){var r=new MessageChannel;Qp.push(r.port2),t.push({worker:em("simulation"),meta:{startingIndex:n,threadCount:e,ports:[],managerPort:r.port1}})}for(n=0;n<e;n++)for(var i=n;i<e;i++){var s=new MessageChannel;t[n].meta.ports[i]=s.port1,t[i].meta.ports[n]=s.port2}return t},em=function(e){return"manager"===e?new Worker(new URL(i.p+i.u(546),i.b)):new Worker(new URL(i.p+i.u(924),i.b))},tm=function(e,t){var n=e.environment.multithreading.simulation.resolvers,r=n[t];void 0!==r.done?(r.done++,r.done===e.environment.multithreading.simulation.threads.length&&(r.resolve(),delete n[t])):r.resolve()};const nm=function(){return{simulation:{manager:em("manager"),threads:Jp(),resolvers:{},setHandlers:function(t){var n=t.environment.multithreading.simulation.threads;if(t.environment.multithreading.simulation.resolvers,e.debug.showThreadLoad){var r=document.createElement("div");r.id="thread-load",r.style.cssText="\n                        position: fixed;\n                        top: 45px;\n                        right: 75px;\n                        font-family: monospace;\n                        color: white;\n                        text-shadow: 1px 1px 1px black;\n                        text-align: right;\n                    ",document.body.appendChild(r),n.forEach((function(e,n){var i=t.session.monitor.threads[n].loadDisplay;i.style.cssText="\n                            margin: 2px 0;\n                            padding: 2px;\n                            background: rgba(0,0,0,0.5);\n                            border-radius: 3px;\n                        ",r.appendChild(i)}))}n.forEach((function(n){n.worker.onmessage=function(r){switch(r.data[0]){case f.InitFinished:tm(t,f.Init);break;case f.SetPixel:var i=r.data[1];xu.apply(void 0,Zp([t],i,!1));break;case f.UpdateFinished:var s=n.meta.startingIndex,o=performance.now()-t.session.monitor.threads[s].updateStarted;if(t.session.monitor.threads[s].updateTime=o,e.debug.showThreadLoad){var a=Math.min(100,o/(1e3/60)*100);t.session.monitor.threads[s].loadDisplay.innerHTML="Thread ".concat(s,": ").concat(a.toFixed(1),"% [").concat("█".repeat(Math.floor(a/10))).concat(".".repeat(10-Math.floor(a/10)),"]"),t.session.monitor.threads[s].loadDisplay.style.color=a>90?"#ff4444":a>70?"#ffaa44":"#44ff44"}tm(t,r.data[r.data.length-1]);break;case f.Save:r.data[1].forEach((function(e){var n,r=e.y,i=e.startX,s=e.columns;(n=t.store.world.matrix[r]).splice.apply(n,Zp([i,s.length],s,!1))})),tm(t,f.Save);break;case f.RunConveyorBelts:tm(t,f.RunConveyorBelts);break;case f.Collector:var l=r.data[1],u=r.data[2];if(t.store.resources.gold+=l,Cl(t,k.Resources),zu(t,b.SellGold),u){var c=Uh({x:u.x*e.cellSize,y:u.y*e.cellSize},{x:t.store.player.x,y:t.store.player.y}),h=c.pan,m=c.volMod;Hl(t.session.soundEngine,"collect",{volume:.05*m,playbackRate:K.getRandomFloatBetween(.5,1.5),pan:h})}break;case f.TutorialStep:zu(t,r.data[1]);break;case f.UpdateStructure:!function(e,t){var n=e.store.structures.findIndex((function(e){return e.x===t.x&&e.y===t.y}));-1===n&&console.error("No structure",t),e.store.structures[n]=t,oe.set(e.session,"structures",t.x,t.y,t),e.environment.context===p.Worker&&[d.ConveyorLeft,d.ConveyorRight].includes(t.type)&&(yc.remove(e,"conveyorBeltsGroupedByX",{structure:t}),yc.set(e,"conveyorBeltsGroupedByX",{structure:t}))}(t,r.data[1]);break;case f.PlaySound:r.data[1].forEach((function(n){if(n.modulateDistance){var r=Uh({x:n.modulateDistance.x,y:n.modulateDistance.y},{x:t.store.player.x,y:t.store.player.y}),i=r.pan,s=r.volMod;n.opts.pan=i,n.opts.volume=s*n.opts.volume,n.id.startsWith("piano")&&Jl(t,n.modulateDistance.x-2*e.cellSize,n.modulateDistance.y-2*e.cellSize,"sound_box_flash",200,{fadeOut:!0})}if("vaporize"===n.id)for(var o=n.modulateDistance.x,a=n.modulateDistance.y,l=0;l<3;l++){var u=Math.random()*Math.PI*2,c=K.getRandomFloatBetween(30,60);Fc(t,o+e.cellSize/2,a+e.cellSize/2,{x:Math.cos(u)*c,y:Math.sin(u)*c},{background:!0})}if("splash"===n.id)for(o=n.modulateDistance.x,a=n.modulateDistance.y,l=0;l<3;l++)Fc(t,o+e.cellSize/2,a+e.cellSize/2,{x:0,y:0},{background:!0});"coin"===n.id&&(o=n.modulateDistance.x,a=n.modulateDistance.y,Fc(t,o+e.cellSize/2,a+e.cellSize/2,{x:0,y:0},{background:!0})),Hl(t.session.soundEngine,n.id,n.opts)}));break;case f.AddLight:ru(t,r.data[1],r.data[2],r.data[3]);break;case f.MoveCamera:ef(t,r.data[1],r.data[2]);break;case f.IncrementFluxite:var g=r.data[1],y=r.data[2];!function(t,n,r){t.store.resources.fluxite=(t.store.resources.fluxite||0)+1,t.store.progression.upgradesUnlocked||(t.store.progression.upgradesUnlocked=!0,Au(t));var i=Date.now();if(i-Du>=40){var s=function(e,t,n,r){void 0===r&&(r=1);var i=Math.min(600,Math.max(t-e.store.player.x,-600))/1e3,s=K.getDistance({x:t,y:n},{x:e.store.player.x,y:e.store.player.y});return{pan:i,volume:200/Math.max(200,s)*r,playbackRate:200/Math.min(800,Math.max(400,s))}}(t,n*e.cellSize,r*e.cellSize,.4);Hl(t.session.soundEngine,"fluxite",s),Hl(t.session.soundEngine,"fluxite_2",Pu(Pu({},s),{playbackRate:s.playbackRate*K.getRandomFloatBetween(.5,1.5),volume:.25*s.volume})),Hl(t.session.soundEngine,"fluxite_3",Pu(Pu({},s),{playbackRate:.5*s.playbackRate*K.getRandomFloatBetween(.5,1.5),volume:s.volume*K.getRandomFloatBetween(.1,1)*.8})),Du=i}Cl(t,k.Resources)}(t,g,y);break;case f.SpawnFluxiteParticles:g=r.data[1],y=r.data[2],function(t,n,r){for(var i=0;i<2;i++){var s=Math.random()*Math.PI*2,o=K.getRandomFloatBetween(50,150),a={x:Math.cos(s)*o,y:Math.sin(s)*o},l=t.store.world.horizon[Math.floor(n)]*e.cellSize,u=(r+.5)*e.cellSize,c=K.getRandomFloatBetween(.5,5),h=u<l?.2*c:c,d=K.getRandomFloatBetween(2,4),f=u<l?.5*d:d;Fc(t,(n+.5)*e.cellSize,(r+.5)*e.cellSize,a,{color:16711935,size:f,lifetime:h})}}(t,g,y);break;case f.SpawnWorldItem:var v=r.data[1],x=(g=r.data[2],y=r.data[3],r.data[4]);Fl(t,v,g,y,x);break;case f.ForceCompleteObjective:Mu(t,r.data[1])}}}))},init:function(t){var n=function(e){var t=e.session,n=new SharedArrayBuffer(t.rendering.obstacleImageData.data.byteLength),r=new SharedArrayBuffer(e.session.rendering.imageData.data.byteLength),i=new SharedArrayBuffer(4),s=new SharedArrayBuffer(3),o=new SharedArrayBuffer(27),a=new SharedArrayBuffer(4),l=new SharedArrayBuffer(2),u=new SharedArrayBuffer(e.store.world.size.width*e.store.world.size.height),c=new SharedArrayBuffer(e.store.world.size.width*e.store.world.size.height),h=new SharedArrayBuffer(e.store.world.size.width*e.store.world.size.height),d=new SharedArrayBuffer(32),f=new SharedArrayBuffer(8),p=new Float32Array(d);return p[0]=1/0,p[2]=1/0,e.shared={obstacleImageData:{data:new Uint8ClampedArray(n),width:t.rendering.obstacleImageData.width,height:t.rendering.obstacleImageData.height},imageData:{data:new Uint8ClampedArray(r),width:e.session.rendering.imageData.width,height:e.session.rendering.imageData.height},mouse:{worldPosition:new Uint16Array(i)},actionState:new Uint8Array(s),grabber:new Uint8Array(o),debug:{cellPos:new Uint16Array(a)},reservoir:new Uint16Array(l),mapData:{data:new Uint8Array(u),width:e.store.world.size.width,height:e.store.world.size.height},wallData:{data:new Uint8Array(c),width:e.store.world.size.width,height:e.store.world.size.height},authorization:{data:new Uint8Array(h),width:e.store.world.size.width,height:e.store.world.size.height},naturalAmbience:p,playerPos:new Float32Array(f)},{obstacleImageData:{sab:n,width:t.rendering.obstacleImageData.width,height:t.rendering.obstacleImageData.height},imageData:{sab:r,width:e.session.rendering.imageData.width,height:e.session.rendering.imageData.height},mapData:{sab:u,width:e.store.world.size.width,height:e.store.world.size.height},wallData:{sab:c,width:e.store.world.size.width,height:e.store.world.size.height},authorization:{sab:h,width:e.store.world.size.width,height:e.store.world.size.height},mouseWorldPosSab:i,actionStateSab:s,grabberSab:o,debugCellPosSab:a,reservoirSab:l,naturalAmbienceSab:d,playerPosSab:f}}(t);if(e.debug.drawChunks){var r=new SharedArrayBuffer(Math.pow(t.store.world.size.width/e.chunkSize,2));t.shared.activeChunks=new Uint8Array(r),n.activeChunksSab=r}return t.environment.multithreading.simulation.setHandlers(t),new Promise((function(e,r){t.environment.multithreading.simulation.threads.forEach((function(e){e.worker.postMessage([f.Init,t.environment.multithreading.simulation.getWorkerStore(t.store),t.environment.multithreading.simulation.getWorkerSession(t.session),n,e.meta],Zp(Zp([],e.meta.ports,!0),[e.meta.managerPort],!1))})),t.environment.multithreading.simulation.resolvers[f.Init]={done:0,resolve:e}}))},startManager:function(e){var t=function(e){var t=new SharedArrayBuffer(8);return e.shared.conveyorBeltsAnimationIndex=new Uint8Array(t),{conveyorBeltsAnimationIndexSab:t}}(e),n=e.environment.multithreading.simulation.threads.map((function(e){return Qp[e.meta.startingIndex]}));e.environment.multithreading.simulation.manager.postMessage([f.Init,e.environment.multithreading.simulation.threads.length,n,e.store.world.size.width,e.store.world.size.height,t],n)},post:function(e,t,n){return e.environment.multithreading.simulation.threads[t].worker.postMessage(n)},postAll:function(e,t){e.environment.multithreading.simulation.threads.forEach((function(e){e.worker.postMessage(t)}))},postAllAwait:function(e,t){return new Promise((function(n,r){var i;if([f.RunUpdate].includes(t[0])){var s=function(){for(var e="",t="0123456789abcdef",n=0;n<32;n++)e+=t[Math.floor(16*Math.random())],7!==n&&11!==n&&15!==n&&19!==n||(e+="-");return e}();t.splice(1,0,s),i=s}else i=t[0];e.environment.multithreading.simulation.threads.forEach((function(n){t[0]===f.RunUpdate&&(e.session.monitor.threads[n.meta.startingIndex].updateStarted=performance.now()),n.worker.postMessage(t)})),e.environment.multithreading.simulation.resolvers[i]={done:0,resolve:n}}))},postToEachThreadColumnSequentiallyAwait:function(e,t,n){return void 0===n&&(n=!1),new Promise((function(r,i){return s=void 0,o=void 0,l=function(){var i,s,o,a,l;return Kp(this,(function(u){switch(u.label){case 0:i=K.getNumberOfThreadColumns(e),s=n?-1:i,o=n?-1:1,a=function(n){return Kp(this,(function(r){switch(r.label){case 0:return[4,new Promise((function(r,i){var s=K.getThreadIndexFromCellX(n*K.getThreadColumnSize(),e.environment.multithreading.simulation.threads.length);e.environment.multithreading.simulation.threads[s].worker.postMessage(Zp(Zp([],t,!0),[n],!1)),e.environment.multithreading.simulation.resolvers[t[0]]={resolve:r}}))];case 1:return r.sent(),[2]}}))},l=n?i-1:0,u.label=1;case 1:return l===s?[3,4]:[5,a(l)];case 2:u.sent(),u.label=3;case 3:return l+=o,[3,1];case 4:return r(),[2]}}))},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{i(l.next(e))}catch(e){t(e)}}function r(e){try{i(l.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(n,r)}i((l=l.apply(s,o||[])).next())}));var s,o,a,l}))},getWorkerStore:function(e){return{world:e.world,machineryEngine:{runLaunchers:e.machineryEngine.runLaunchers},structures:e.structures,meta:{tick:e.meta.tick},tutorial:{active:e.tutorial.active,currentStep:e.tutorial.currentStep},workarounds:{obstructedElements:[],queueSetCell:[]},postProcessing:{buildCheck:{locations:[],cellPositionsToTry:[]}}}},getWorkerSession:function(e){return{cache:{structures:[]},colors:e.colors,lookup:{conveyorBeltsGroupedByX:[]},mainSensorCache:e.mainSensorCache}}}}};var rm=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,a)}l((r=r.apply(e,t||[])).next())}))},im=function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},sm=function(e,t,n){return void 0===n&&(n=3),new Promise((function(r,i){var s=function(){var o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="arraybuffer",o.onload=function(){e.decodeAudioData(o.response,r,(function(){n>0?(console.log("Retrying load for ".concat(t)),s()):i(new Error("Failed to load sound: ".concat(t)))}))},o.onerror=function(){n>0?(console.log("Retrying load for ".concat(t)),s()):i(new Error("Failed to load sound: ".concat(t)))},o.send()};s()}))},om=!1,am=function(e){return e===x.Intro?[{done:!1},{done:!1},{done:!1}]:[]},lm=function(){return lm=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},lm.apply(this,arguments)};var um=i(4848),cm=i(5338),hm=function(){return hm=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},hm.apply(this,arguments)};function dm(t){if(kl(t.state,k.Debug),!e.debug.active)return(0,um.jsx)(um.Fragment,{});var n=(0,El.useState)(!1),r=n[0],i=n[1];return r?(0,um.jsxs)("div",hm({className:"fixed bottom-2 right-2 w-96 pt-12 text-white"},{children:[(0,um.jsx)("button",hm({className:"absolute top-2 right-2 bg-gray-500 text-white p-2",onClick:function(){i(!1)}},{children:"Close"})),(0,um.jsx)("div",{children:Object.keys(Ih).map((function(e){var n=Ih[e];return(0,um.jsx)("button",hm({className:"bg-gray-500 text-white p-2 m-2 ".concat(t.state.session.debug.brush.elementType===parseInt(e)?"border-solid border-2 border-indigo-600":""),onClick:function(){t.state.session.debug.brush.elementType=parseInt(e),Cl(t.state,k.Debug)}},{children:n.name}),e)}))}),(0,um.jsxs)("div",{children:[(0,um.jsxs)("div",{children:[(0,um.jsx)("button",hm({className:"bg-gray-500 text-white p-2 m-2",onClick:function(){e.debug.brushSize>0&&(e.debug.brushSize--,Cl(t.state,k.Debug))}},{children:"-"})),(0,um.jsx)("input",{type:"number",className:"text-center text-black",value:e.debug.brushSize,onChange:function(n){var r=parseInt(n.target.value,10);isNaN(r)||(e.debug.brushSize=r,Cl(t.state,k.Debug))},style:{width:"60px"}}),(0,um.jsx)("button",hm({className:"bg-gray-500 text-white p-2 m-2",onClick:function(){e.debug.brushSize++,Cl(t.state,k.Debug)}},{children:"+"}))]}),(0,um.jsxs)("div",{children:[(0,um.jsx)("input",{type:"checkbox",checked:t.state.session.debug.brush.overwrite,onChange:function(e){t.state.session.debug.brush.overwrite=e.target.checked,Cl(t.state,k.Debug)}}),"Overwrite"]}),(0,um.jsxs)("div",{children:[(0,um.jsx)("input",{type:"checkbox",checked:t.state.session.debug.brush.skipPhysics,onChange:function(e){t.state.session.debug.brush.skipPhysics=e.target.checked,Cl(t.state,k.Debug)}}),"Skip physics"]}),(0,um.jsx)("div",{children:Object.keys(au).map((function(e){var n=au[e];return(0,um.jsx)("button",hm({className:"bg-gray-500 text-white p-2 m-2 ".concat(t.state.session.debug.brush.cellType===parseInt(e)?"border-solid border-2 border-indigo-600":""),onClick:function(){t.state.session.debug.brush.cellType=parseInt(e),Cl(t.state,k.Debug)}},{children:n.name||"Soil ".concat(e)}),e)}))}),(0,um.jsx)("div",{children:["flamethrower","rocket","gun","shotgun","teleporter","vacuum","bouncer"].map((function(e){return(0,um.jsx)("button",hm({className:"bg-gray-500 text-white p-2 m-2",onClick:function(){Gf.run(t.state,e)}},{children:e}))}))}),t.state.store.tutorial.active&&(0,um.jsx)("div",{children:(0,um.jsx)("button",hm({className:"bg-gray-500 text-white p-2 m-2",onClick:function(){t.state.environment.multithreading.simulation.postAll(t.state,[f.SetTutorialStep,b.TutorialEnd]),t.state.store.tutorial.currentStep=b.TutorialEnd,t.state.store.tutorial.active=!1,t.state.store.player.x=2796,t.state.store.player.y=2474,Cl(t.state,k.Root)}},{children:"Finish tutorial"}))}),(0,um.jsx)("div",{children:(0,um.jsx)("button",hm({className:"bg-gray-500 text-white p-2 m-2",onClick:function(){t.state.session.ui.visible=!1,Cl(t.state,k.Root)}},{children:"Hide UI"}))}),(0,um.jsxs)("div",{children:[(0,um.jsxs)("label",{children:["Light Size: ",e.debug.lightSize]}),(0,um.jsx)("br",{}),(0,um.jsx)("input",{type:"range",min:"0",max:"2000",value:e.debug.lightSize,onChange:function(n){e.debug.lightSize=parseInt(n.target.value),Cl(t.state,k.Debug)}})]}),(0,um.jsxs)("div",{children:[(0,um.jsxs)("label",{children:["Terrain Shadow Value: ",e.debug.terrainShadowValue]}),(0,um.jsx)("br",{}),(0,um.jsx)("input",{type:"range",min:"85",max:"100",step:"0.5",value:100*e.debug.terrainShadowValue,onChange:function(n){e.debug.terrainShadowValue=parseFloat(n.target.value)/100,Cl(t.state,k.Debug)}})]}),(0,um.jsxs)("div",{children:[(0,um.jsxs)("label",{children:["Brightness: ",10*e.debug.flashlight.brightness]}),(0,um.jsx)("br",{}),(0,um.jsx)("input",{type:"range",min:"0",max:"100",value:10*e.debug.flashlight.brightness,onChange:function(n){e.debug.flashlight.brightness=parseInt(n.target.value)/10,Cl(t.state,k.Debug)}})]}),(0,um.jsxs)("div",{children:[(0,um.jsxs)("label",{children:["Size: ",e.debug.flashlight.size]}),(0,um.jsx)("br",{}),(0,um.jsx)("input",{type:"range",min:"0",max:"500",value:e.debug.flashlight.size,onChange:function(n){e.debug.flashlight.size=parseInt(n.target.value),Cl(t.state,k.Debug)}})]}),(0,um.jsxs)("div",{children:[(0,um.jsxs)("label",{children:["Duration: ",e.debug.flashlight.duration]}),(0,um.jsx)("br",{}),(0,um.jsx)("input",{type:"range",min:"0",max:"10000",value:e.debug.flashlight.duration,onChange:function(n){e.debug.flashlight.duration=parseInt(n.target.value),Cl(t.state,k.Debug)}})]})]})]})):(0,um.jsx)("div",hm({className:"fixed bottom-2 right-2"},{children:(0,um.jsx)("button",hm({className:"bg-gray-500 text-white p-2",onClick:function(){i(!0)}},{children:"Debug"}))}))}const fm=(0,El.createContext)({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),pm=(0,El.createContext)({}),mm=(0,El.createContext)(null),gm="undefined"!=typeof document,ym=gm?El.useLayoutEffect:El.useEffect,vm=(0,El.createContext)({strict:!1}),xm=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),bm="data-"+xm("framerAppearId");class wm{constructor(){this.order=[],this.scheduled=new Set}add(e){if(!this.scheduled.has(e))return this.scheduled.add(e),this.order.push(e),!0}remove(e){const t=this.order.indexOf(e);-1!==t&&(this.order.splice(t,1),this.scheduled.delete(e))}clear(){this.order.length=0,this.scheduled.clear()}}const Sm=["read","resolveKeyframes","update","preRender","render","postRender"];function _m(e,t){let n=!1,r=!0;const i={delta:0,timestamp:0,isProcessing:!1},s=Sm.reduce(((e,t)=>(e[t]=function(e){let t=new wm,n=new wm,r=0,i=!1,s=!1;const o=new WeakSet,a={schedule:(e,s=!1,a=!1)=>{const l=a&&i,u=l?t:n;return s&&o.add(e),u.add(e)&&l&&i&&(r=t.order.length),e},cancel:e=>{n.remove(e),o.delete(e)},process:l=>{if(i)s=!0;else{if(i=!0,[t,n]=[n,t],n.clear(),r=t.order.length,r)for(let n=0;n<r;n++){const r=t.order[n];o.has(r)&&(a.schedule(r),e()),r(l)}i=!1,s&&(s=!1,a.process(l))}}};return a}((()=>n=!0)),e)),{}),o=e=>{s[e].process(i)},a=()=>{const s=performance.now();n=!1,i.delta=r?1e3/60:Math.max(Math.min(s-i.timestamp,40),1),i.timestamp=s,i.isProcessing=!0,Sm.forEach(o),i.isProcessing=!1,n&&t&&(r=!1,e(a))},l=Sm.reduce(((t,o)=>{const l=s[o];return t[o]=(t,s=!1,o=!1)=>(n||(n=!0,r=!0,i.isProcessing||e(a)),l.schedule(t,s,o)),t}),{});return{schedule:l,cancel:e=>Sm.forEach((t=>s[t].cancel(e))),state:i,steps:s}}const{schedule:Tm,cancel:Em}=_m(queueMicrotask,!1);function Cm(e){return e&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}const km=(0,El.createContext)({});let Am=!1;function Mm(e,t,n,r,i){const{visualElement:s}=(0,El.useContext)(pm),o=(0,El.useContext)(vm),a=(0,El.useContext)(mm),l=(0,El.useContext)(fm).reducedMotion,u=(0,El.useRef)();r=r||o.renderer,!u.current&&r&&(u.current=r(e,{visualState:t,parent:s,props:n,presenceContext:a,blockInitialAnimation:!!a&&!1===a.initial,reducedMotionConfig:l}));const c=u.current,h=(0,El.useContext)(km);!c||c.projection||!i||"html"!==c.type&&"svg"!==c.type||function(e,t,n,r){const{layoutId:i,layout:s,drag:o,dragConstraints:a,layoutScroll:l,layoutRoot:u}=t;e.projection=new n(e.latestValues,t["data-framer-portal-id"]?void 0:Rm(e.parent)),e.projection.setOptions({layoutId:i,layout:s,alwaysMeasureLayout:Boolean(o)||a&&Cm(a),visualElement:e,scheduleRender:()=>e.scheduleRender(),animationType:"string"==typeof s?s:"both",initialPromotionConfig:r,layoutScroll:l,layoutRoot:u})}(u.current,n,i,h),(0,El.useInsertionEffect)((()=>{c&&c.update(n,a)}));const d=(0,El.useRef)(Boolean(n[bm]&&!window.HandoffComplete));return ym((()=>{c&&(c.updateFeatures(),Tm.render(c.render),d.current&&c.animationState&&c.animationState.animateChanges())})),(0,El.useEffect)((()=>{c&&(!d.current&&c.animationState&&c.animationState.animateChanges(),d.current&&(d.current=!1,Am||(Am=!0,queueMicrotask(Pm))))})),c}function Pm(){window.HandoffComplete=!0}function Rm(e){if(e)return!1!==e.options.allowProjection?e.projection:Rm(e.parent)}function Im(e,t,n){return(0,El.useCallback)((r=>{r&&e.mount&&e.mount(r),t&&(r?t.mount(r):t.unmount()),n&&("function"==typeof n?n(r):Cm(n)&&(n.current=r))}),[t])}function Dm(e){return"string"==typeof e||Array.isArray(e)}function Fm(e){return null!==e&&"object"==typeof e&&"function"==typeof e.start}const Nm=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Lm=["initial",...Nm];function Bm(e){return Fm(e.animate)||Lm.some((t=>Dm(e[t])))}function Om(e){return Boolean(Bm(e)||e.variants)}function zm(e){return Array.isArray(e)?e.join(" "):e}const jm={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Um={};for(const e in jm)Um[e]={isEnabled:t=>jm[e].some((e=>!!t[e]))};const Gm=(0,El.createContext)({}),Vm=Symbol.for("motionComponentSymbol");function Hm({preloadedFeatures:e,createVisualElement:t,useRender:n,useVisualState:r,Component:i}){e&&function(e){for(const t in e)Um[t]={...Um[t],...e[t]}}(e);const s=(0,El.forwardRef)((function(e,s){let o;const a={...(0,El.useContext)(fm),...e,layoutId:Wm(e)},{isStatic:l}=a,u=function(e){const{initial:t,animate:n}=function(e,t){if(Bm(e)){const{initial:t,animate:n}=e;return{initial:!1===t||Dm(t)?t:void 0,animate:Dm(n)?n:void 0}}return!1!==e.inherit?t:{}}(e,(0,El.useContext)(pm));return(0,El.useMemo)((()=>({initial:t,animate:n})),[zm(t),zm(n)])}(e),c=r(e,l);if(!l&&gm){(0,El.useContext)(vm).strict;const e=function(e){const{drag:t,layout:n}=Um;if(!t&&!n)return{};const r={...t,...n};return{MeasureLayout:(null==t?void 0:t.isEnabled(e))||(null==n?void 0:n.isEnabled(e))?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}(a);o=e.MeasureLayout,u.visualElement=Mm(i,c,a,t,e.ProjectionNode)}return(0,um.jsxs)(pm.Provider,{value:u,children:[o&&u.visualElement?(0,um.jsx)(o,{visualElement:u.visualElement,...a}):null,n(i,e,Im(c,u.visualElement,s),c,l,u.visualElement)]})}));return s[Vm]=i,s}function Wm({layoutId:e}){const t=(0,El.useContext)(Gm).id;return t&&void 0!==e?t+"-"+e:e}function Xm(e){function t(t,n={}){return Hm(e(t,n))}if("undefined"==typeof Proxy)return t;const n=new Map;return new Proxy(t,{get:(e,r)=>(n.has(r)||n.set(r,t(r)),n.get(r))})}const $m=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Ym(e){return"string"==typeof e&&!e.includes("-")&&!!($m.indexOf(e)>-1||/[A-Z]/u.test(e))}const qm={},Km=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Zm=new Set(Km);function Qm(e,{layout:t,layoutId:n}){return Zm.has(e)||e.startsWith("origin")||(t||void 0!==n)&&(!!qm[e]||"opacity"===e)}const Jm=e=>Boolean(e&&e.getVelocity),eg={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},tg=Km.length,ng=e=>t=>"string"==typeof t&&t.startsWith(e),rg=ng("--"),ig=ng("var(--"),sg=e=>!!ig(e)&&og.test(e.split("/*")[0].trim()),og=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,ag=(e,t)=>t&&"number"==typeof e?t.transform(e):e,lg=(e,t,n)=>n>t?t:n<e?e:n,ug={test:e=>"number"==typeof e,parse:parseFloat,transform:e=>e},cg={...ug,transform:e=>lg(0,1,e)},hg={...ug,default:1},dg=e=>Math.round(1e5*e)/1e5,fg=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu,pg=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu,mg=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu;function gg(e){return"string"==typeof e}const yg=e=>({test:t=>gg(t)&&t.endsWith(e)&&1===t.split(" ").length,parse:parseFloat,transform:t=>`${t}${e}`}),vg=yg("deg"),xg=yg("%"),bg=yg("px"),wg=yg("vh"),Sg=yg("vw"),_g={...xg,parse:e=>xg.parse(e)/100,transform:e=>xg.transform(100*e)},Tg={...ug,transform:Math.round},Eg={borderWidth:bg,borderTopWidth:bg,borderRightWidth:bg,borderBottomWidth:bg,borderLeftWidth:bg,borderRadius:bg,radius:bg,borderTopLeftRadius:bg,borderTopRightRadius:bg,borderBottomRightRadius:bg,borderBottomLeftRadius:bg,width:bg,maxWidth:bg,height:bg,maxHeight:bg,size:bg,top:bg,right:bg,bottom:bg,left:bg,padding:bg,paddingTop:bg,paddingRight:bg,paddingBottom:bg,paddingLeft:bg,margin:bg,marginTop:bg,marginRight:bg,marginBottom:bg,marginLeft:bg,rotate:vg,rotateX:vg,rotateY:vg,rotateZ:vg,scale:hg,scaleX:hg,scaleY:hg,scaleZ:hg,skew:vg,skewX:vg,skewY:vg,distance:bg,translateX:bg,translateY:bg,translateZ:bg,x:bg,y:bg,z:bg,perspective:bg,transformPerspective:bg,opacity:cg,originX:_g,originY:_g,originZ:bg,zIndex:Tg,backgroundPositionX:bg,backgroundPositionY:bg,fillOpacity:cg,strokeOpacity:cg,numOctaves:Tg};function Cg(e,t,n,r){const{style:i,vars:s,transform:o,transformOrigin:a}=e;let l=!1,u=!1,c=!0;for(const e in t){const n=t[e];if(rg(e)){s[e]=n;continue}const r=Eg[e],h=ag(n,r);if(Zm.has(e)){if(l=!0,o[e]=h,!c)continue;n!==(r.default||0)&&(c=!1)}else e.startsWith("origin")?(u=!0,a[e]=h):i[e]=h}if(t.transform||(l||r?i.transform=function(e,{enableHardwareAcceleration:t=!0,allowTransformNone:n=!0},r,i){let s="";for(let t=0;t<tg;t++){const n=Km[t];void 0!==e[n]&&(s+=`${eg[n]||n}(${e[n]}) `)}return t&&!e.z&&(s+="translateZ(0)"),s=s.trim(),i?s=i(e,r?"":s):n&&r&&(s="none"),s}(e.transform,n,c,r):i.transform&&(i.transform="none")),u){const{originX:e="50%",originY:t="50%",originZ:n=0}=a;i.transformOrigin=`${e} ${t} ${n}`}}const kg=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Ag(e,t,n){for(const r in t)Jm(t[r])||Qm(r,n)||(e[r]=t[r])}function Mg(e,t,n){const r={},i=function(e,t,n){const r={};return Ag(r,e.style||{},e),Object.assign(r,function({transformTemplate:e},t,n){return(0,El.useMemo)((()=>{const r=kg();return Cg(r,t,{enableHardwareAcceleration:!n},e),Object.assign({},r.vars,r.style)}),[t])}(e,t,n)),r}(e,t,n);return e.drag&&!1!==e.dragListener&&(r.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=!0===e.drag?"none":"pan-"+("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(r.tabIndex=0),r.style=i,r}const Pg=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Rg(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Pg.has(e)}let Ig=e=>!Rg(e);try{(Dg=require("@emotion/is-prop-valid").default)&&(Ig=e=>e.startsWith("on")?!Rg(e):Dg(e))}catch(Tl){}var Dg;function Fg(e,t,n){return"string"==typeof e?e:bg.transform(t+n*e)}const Ng={offset:"stroke-dashoffset",array:"stroke-dasharray"},Lg={offset:"strokeDashoffset",array:"strokeDasharray"};function Bg(e,{attrX:t,attrY:n,attrScale:r,originX:i,originY:s,pathLength:o,pathSpacing:a=1,pathOffset:l=0,...u},c,h,d){if(Cg(e,u,c,d),h)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:f,style:p,dimensions:m}=e;f.transform&&(m&&(p.transform=f.transform),delete f.transform),m&&(void 0!==i||void 0!==s||p.transform)&&(p.transformOrigin=function(e,t,n){return`${Fg(t,e.x,e.width)} ${Fg(n,e.y,e.height)}`}(m,void 0!==i?i:.5,void 0!==s?s:.5)),void 0!==t&&(f.x=t),void 0!==n&&(f.y=n),void 0!==r&&(f.scale=r),void 0!==o&&function(e,t,n=1,r=0,i=!0){e.pathLength=1;const s=i?Ng:Lg;e[s.offset]=bg.transform(-r);const o=bg.transform(t),a=bg.transform(n);e[s.array]=`${o} ${a}`}(f,o,a,l,!1)}const Og=()=>({...kg(),attrs:{}}),zg=e=>"string"==typeof e&&"svg"===e.toLowerCase();function jg(e,t,n,r){const i=(0,El.useMemo)((()=>{const n=Og();return Bg(n,t,{enableHardwareAcceleration:!1},zg(r),e.transformTemplate),{...n.attrs,style:{...n.style}}}),[t]);if(e.style){const t={};Ag(t,e.style,e),i.style={...t,...i.style}}return i}function Ug(e=!1){return(t,n,r,{latestValues:i},s)=>{const o=(Ym(t)?jg:Mg)(n,i,s,t),a=function(e,t,n){const r={};for(const i in e)"values"===i&&"object"==typeof e.values||(Ig(i)||!0===n&&Rg(i)||!t&&!Rg(i)||e.draggable&&i.startsWith("onDrag"))&&(r[i]=e[i]);return r}(n,"string"==typeof t,e),l=t!==El.Fragment?{...a,...o,ref:r}:{},{children:u}=n,c=(0,El.useMemo)((()=>Jm(u)?u.get():u),[u]);return(0,El.createElement)(t,{...l,children:c})}}function Gg(e,{style:t,vars:n},r,i){Object.assign(e.style,t,i&&i.getProjectionStyles(r));for(const t in n)e.style.setProperty(t,n[t])}const Vg=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Hg(e,t,n,r){Gg(e,t,void 0,r);for(const n in t.attrs)e.setAttribute(Vg.has(n)?n:xm(n),t.attrs[n])}function Wg(e,t,n){var r;const{style:i}=e,s={};for(const o in i)(Jm(i[o])||t.style&&Jm(t.style[o])||Qm(o,e)||void 0!==(null===(r=null==n?void 0:n.getValue(o))||void 0===r?void 0:r.liveStyle))&&(s[o]=i[o]);return s}function Xg(e,t,n){const r=Wg(e,t,n);for(const n in e)(Jm(e[n])||Jm(t[n]))&&(r[-1!==Km.indexOf(n)?"attr"+n.charAt(0).toUpperCase()+n.substring(1):n]=e[n]);return r}function $g(e){const t=[{},{}];return null==e||e.values.forEach(((e,n)=>{t[0][n]=e.get(),t[1][n]=e.getVelocity()})),t}function Yg(e,t,n,r){if("function"==typeof t){const[i,s]=$g(r);t=t(void 0!==n?n:e.custom,i,s)}if("string"==typeof t&&(t=e.variants&&e.variants[t]),"function"==typeof t){const[i,s]=$g(r);t=t(void 0!==n?n:e.custom,i,s)}return t}function qg(e){const t=(0,El.useRef)(null);return null===t.current&&(t.current=e()),t.current}const Kg=e=>Array.isArray(e),Zg=e=>Boolean(e&&"object"==typeof e&&e.mix&&e.toValue),Qg=e=>Kg(e)?e[e.length-1]||0:e;function Jg(e){const t=Jm(e)?e.get():e;return Zg(t)?t.toValue():t}const ey=e=>(t,n)=>{const r=(0,El.useContext)(pm),i=(0,El.useContext)(mm),s=()=>function({scrapeMotionValuesFromProps:e,createRenderState:t,onMount:n},r,i,s){const o={latestValues:ty(r,i,s,e),renderState:t()};return n&&(o.mount=e=>n(r,e,o)),o}(e,t,r,i);return n?s():qg(s)};function ty(e,t,n,r){const i={},s=r(e,{});for(const e in s)i[e]=Jg(s[e]);let{initial:o,animate:a}=e;const l=Bm(e),u=Om(e);t&&u&&!l&&!1!==e.inherit&&(void 0===o&&(o=t.initial),void 0===a&&(a=t.animate));let c=!!n&&!1===n.initial;c=c||!1===o;const h=c?a:o;return h&&"boolean"!=typeof h&&!Fm(h)&&(Array.isArray(h)?h:[h]).forEach((t=>{const n=Yg(e,t);if(!n)return;const{transitionEnd:r,transition:s,...o}=n;for(const e in o){let t=o[e];Array.isArray(t)&&(t=t[c?t.length-1:0]),null!==t&&(i[e]=t)}for(const e in r)i[e]=r[e]})),i}const ny=e=>e,{schedule:ry,cancel:iy,state:sy,steps:oy}=_m("undefined"!=typeof requestAnimationFrame?requestAnimationFrame:ny,!0),ay={useVisualState:ey({scrapeMotionValuesFromProps:Xg,createRenderState:Og,onMount:(e,t,{renderState:n,latestValues:r})=>{ry.read((()=>{try{n.dimensions="function"==typeof t.getBBox?t.getBBox():t.getBoundingClientRect()}catch(e){n.dimensions={x:0,y:0,width:0,height:0}}})),ry.render((()=>{Bg(n,r,{enableHardwareAcceleration:!1},zg(t.tagName),e.transformTemplate),Hg(t,n)}))}})},ly={useVisualState:ey({scrapeMotionValuesFromProps:Wg,createRenderState:kg})};function uy(e,t,n,r={passive:!0}){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n)}const cy=e=>"mouse"===e.pointerType?"number"!=typeof e.button||e.button<=0:!1!==e.isPrimary;function hy(e,t="page"){return{point:{x:e[`${t}X`],y:e[`${t}Y`]}}}const dy=e=>t=>cy(t)&&e(t,hy(t));function fy(e,t,n,r){return uy(e,t,dy(n),r)}const py=(e,t)=>n=>t(e(n)),my=(...e)=>e.reduce(py);function gy(e){let t=null;return()=>null===t&&(t=e,()=>{t=null})}const yy=gy("dragHorizontal"),vy=gy("dragVertical");function xy(e){let t=!1;if("y"===e)t=vy();else if("x"===e)t=yy();else{const e=yy(),n=vy();e&&n?t=()=>{e(),n()}:(e&&e(),n&&n())}return t}function by(){const e=xy(!0);return!e||(e(),!1)}class wy{constructor(e){this.isMounted=!1,this.node=e}update(){}}function Sy(e,t){const n=t?"pointerenter":"pointerleave",r=t?"onHoverStart":"onHoverEnd";return fy(e.current,n,((n,i)=>{if("touch"===n.pointerType||by())return;const s=e.getProps();e.animationState&&s.whileHover&&e.animationState.setActive("whileHover",t);const o=s[r];o&&ry.postRender((()=>o(n,i)))}),{passive:!e.getProps()[r]})}const _y=(e,t)=>!!t&&(e===t||_y(e,t.parentElement));function Ty(e,t){if(!t)return;const n=new PointerEvent("pointer"+e);t(n,hy(n))}const Ey=new WeakMap,Cy=new WeakMap,ky=e=>{const t=Ey.get(e.target);t&&t(e)},Ay=e=>{e.forEach(ky)};const My={some:0,all:1},Py={inView:{Feature:class extends wy{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:n,amount:r="some",once:i}=e,s={root:t?t.current:void 0,rootMargin:n,threshold:"number"==typeof r?r:My[r]};return function(e,t,n){const r=function({root:e,...t}){const n=e||document;Cy.has(n)||Cy.set(n,{});const r=Cy.get(n),i=JSON.stringify(t);return r[i]||(r[i]=new IntersectionObserver(Ay,{root:e,...t})),r[i]}(t);return Ey.set(e,n),r.observe(e),()=>{Ey.delete(e),r.unobserve(e)}}(this.node.current,s,(e=>{const{isIntersecting:t}=e;if(this.isInView===t)return;if(this.isInView=t,i&&!t&&this.hasEnteredView)return;t&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",t);const{onViewportEnter:n,onViewportLeave:r}=this.node.getProps(),s=t?n:r;s&&s(e)}))}mount(){this.startObserver()}update(){if("undefined"==typeof IntersectionObserver)return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(function({viewport:e={}},{viewport:t={}}={}){return n=>e[n]!==t[n]}(e,t))&&this.startObserver()}unmount(){}}},tap:{Feature:class extends wy{constructor(){super(...arguments),this.removeStartListeners=ny,this.removeEndListeners=ny,this.removeAccessibleListeners=ny,this.startPointerPress=(e,t)=>{if(this.isPressing)return;this.removeEndListeners();const n=this.node.getProps(),r=fy(window,"pointerup",((e,t)=>{if(!this.checkPressEnd())return;const{onTap:n,onTapCancel:r,globalTapTarget:i}=this.node.getProps(),s=i||_y(this.node.current,e.target)?n:r;s&&ry.update((()=>s(e,t)))}),{passive:!(n.onTap||n.onPointerUp)}),i=fy(window,"pointercancel",((e,t)=>this.cancelPress(e,t)),{passive:!(n.onTapCancel||n.onPointerCancel)});this.removeEndListeners=my(r,i),this.startPress(e,t)},this.startAccessiblePress=()=>{const e=uy(this.node.current,"keydown",(e=>{"Enter"!==e.key||this.isPressing||(this.removeEndListeners(),this.removeEndListeners=uy(this.node.current,"keyup",(e=>{"Enter"===e.key&&this.checkPressEnd()&&Ty("up",((e,t)=>{const{onTap:n}=this.node.getProps();n&&ry.postRender((()=>n(e,t)))}))})),Ty("down",((e,t)=>{this.startPress(e,t)})))})),t=uy(this.node.current,"blur",(()=>{this.isPressing&&Ty("cancel",((e,t)=>this.cancelPress(e,t)))}));this.removeAccessibleListeners=my(e,t)}}startPress(e,t){this.isPressing=!0;const{onTapStart:n,whileTap:r}=this.node.getProps();r&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),n&&ry.postRender((()=>n(e,t)))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!by()}cancelPress(e,t){if(!this.checkPressEnd())return;const{onTapCancel:n}=this.node.getProps();n&&ry.postRender((()=>n(e,t)))}mount(){const e=this.node.getProps(),t=fy(e.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(e.onTapStart||e.onPointerStart)}),n=uy(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=my(t,n)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}},focus:{Feature:class extends wy{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(t){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=my(uy(this.node.current,"focus",(()=>this.onFocus())),uy(this.node.current,"blur",(()=>this.onBlur())))}unmount(){}}},hover:{Feature:class extends wy{mount(){this.unmount=my(Sy(this.node,!0),Sy(this.node,!1))}unmount(){}}}};function Ry(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}function Iy(e,t,n){const r=e.getProps();return Yg(r,t,void 0!==n?n:r.custom,e)}const Dy=e=>1e3*e,Fy=e=>e/1e3,Ny={type:"spring",stiffness:500,damping:25,restSpeed:10},Ly={type:"keyframes",duration:.8},By={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Oy=(e,{keyframes:t})=>t.length>2?Ly:Zm.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===t[1]?2*Math.sqrt(550):30,restSpeed:10}:Ny:By;function zy(e,t){return e[t]||e.default||e}const jy=e=>null!==e;function Uy(e,{repeat:t,repeatType:n="loop"},r){const i=e.filter(jy),s=t&&"loop"!==n&&t%2==1?0:i.length-1;return s&&void 0!==r?r:i[s]}let Gy;function Vy(){Gy=void 0}const Hy={now:()=>(void 0===Gy&&Hy.set(sy.isProcessing?sy.timestamp:performance.now()),Gy),set:e=>{Gy=e,queueMicrotask(Vy)}},Wy=e=>/^0[^.\s]+$/u.test(e);function Xy(e){return"number"==typeof e?0===e:null===e||"none"===e||"0"===e||Wy(e)}let $y=ny,Yy=ny;const qy=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),Ky=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Zy(e,t,n=1){Yy(n<=4,`Max CSS variable fallback depth detected in property "${e}". This may indicate a circular fallback dependency.`);const[r,i]=function(e){const t=Ky.exec(e);if(!t)return[,];const[,n,r,i]=t;return[`--${null!=n?n:r}`,i]}(e);if(!r)return;const s=window.getComputedStyle(t).getPropertyValue(r);if(s){const e=s.trim();return qy(e)?parseFloat(e):e}return sg(i)?Zy(i,t,n+1):i}const Qy=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),Jy=e=>e===ug||e===bg,ev=(e,t)=>parseFloat(e.split(", ")[t]),tv=(e,t)=>(n,{transform:r})=>{if("none"===r||!r)return 0;const i=r.match(/^matrix3d\((.+)\)$/u);if(i)return ev(i[1],t);{const t=r.match(/^matrix\((.+)\)$/u);return t?ev(t[1],e):0}},nv=new Set(["x","y","z"]),rv=Km.filter((e=>!nv.has(e))),iv={width:({x:e},{paddingLeft:t="0",paddingRight:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),height:({y:e},{paddingTop:t="0",paddingBottom:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:tv(4,13),y:tv(5,14)};iv.translateX=iv.x,iv.translateY=iv.y;const sv=e=>t=>t.test(e),ov=[ug,bg,xg,vg,Sg,wg,{test:e=>"auto"===e,parse:e=>e}],av=e=>ov.find(sv(e)),lv=new Set;let uv=!1,cv=!1;function hv(){if(cv){const e=Array.from(lv).filter((e=>e.needsMeasurement)),t=new Set(e.map((e=>e.element))),n=new Map;t.forEach((e=>{const t=function(e){const t=[];return rv.forEach((n=>{const r=e.getValue(n);void 0!==r&&(t.push([n,r.get()]),r.set(n.startsWith("scale")?1:0))})),t}(e);t.length&&(n.set(e,t),e.render())})),e.forEach((e=>e.measureInitialState())),t.forEach((e=>{e.render();const t=n.get(e);t&&t.forEach((([t,n])=>{var r;null===(r=e.getValue(t))||void 0===r||r.set(n)}))})),e.forEach((e=>e.measureEndState())),e.forEach((e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)}))}cv=!1,uv=!1,lv.forEach((e=>e.complete())),lv.clear()}function dv(){lv.forEach((e=>{e.readKeyframes(),e.needsMeasurement&&(cv=!0)}))}class fv{constructor(e,t,n,r,i,s=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=n,this.motionValue=r,this.element=i,this.isAsync=s}scheduleResolve(){this.isScheduled=!0,this.isAsync?(lv.add(this),uv||(uv=!0,ry.read(dv),ry.resolveKeyframes(hv))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:n,motionValue:r}=this;for(let i=0;i<e.length;i++)if(null===e[i])if(0===i){const i=null==r?void 0:r.get(),s=e[e.length-1];if(void 0!==i)e[0]=i;else if(n&&t){const r=n.readValue(t,s);null!=r&&(e[0]=r)}void 0===e[0]&&(e[0]=s),r&&void 0===i&&r.set(e[0])}else e[i]=e[i-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),lv.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,lv.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const pv=(e,t)=>n=>Boolean(gg(n)&&mg.test(n)&&n.startsWith(e)||t&&Object.prototype.hasOwnProperty.call(n,t)),mv=(e,t,n)=>r=>{if(!gg(r))return r;const[i,s,o,a]=r.match(fg);return{[e]:parseFloat(i),[t]:parseFloat(s),[n]:parseFloat(o),alpha:void 0!==a?parseFloat(a):1}},gv={...ug,transform:e=>Math.round((e=>lg(0,255,e))(e))},yv={test:pv("rgb","red"),parse:mv("red","green","blue"),transform:({red:e,green:t,blue:n,alpha:r=1})=>"rgba("+gv.transform(e)+", "+gv.transform(t)+", "+gv.transform(n)+", "+dg(cg.transform(r))+")"},vv={test:pv("#"),parse:function(e){let t="",n="",r="",i="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),r=e.substring(5,7),i=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),r=e.substring(3,4),i=e.substring(4,5),t+=t,n+=n,r+=r,i+=i),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(r,16),alpha:i?parseInt(i,16)/255:1}},transform:yv.transform},xv={test:pv("hsl","hue"),parse:mv("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:n,alpha:r=1})=>"hsla("+Math.round(e)+", "+xg.transform(dg(t))+", "+xg.transform(dg(n))+", "+dg(cg.transform(r))+")"},bv={test:e=>yv.test(e)||vv.test(e)||xv.test(e),parse:e=>yv.test(e)?yv.parse(e):xv.test(e)?xv.parse(e):vv.parse(e),transform:e=>gg(e)?e:e.hasOwnProperty("red")?yv.transform(e):xv.transform(e)},wv="number",Sv="color",_v="var",Tv="var(",Ev="${}",Cv=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function kv(e){const t=e.toString(),n=[],r={color:[],number:[],var:[]},i=[];let s=0;const o=t.replace(Cv,(e=>(bv.test(e)?(r.color.push(s),i.push(Sv),n.push(bv.parse(e))):e.startsWith(Tv)?(r.var.push(s),i.push(_v),n.push(e)):(r.number.push(s),i.push(wv),n.push(parseFloat(e))),++s,Ev))).split(Ev);return{values:n,split:o,indexes:r,types:i}}function Av(e){return kv(e).values}function Mv(e){const{split:t,types:n}=kv(e),r=t.length;return e=>{let i="";for(let s=0;s<r;s++)if(i+=t[s],void 0!==e[s]){const t=n[s];i+=t===wv?dg(e[s]):t===Sv?bv.transform(e[s]):e[s]}return i}}const Pv=e=>"number"==typeof e?0:e,Rv={test:function(e){var t,n;return isNaN(e)&&gg(e)&&((null===(t=e.match(fg))||void 0===t?void 0:t.length)||0)+((null===(n=e.match(pg))||void 0===n?void 0:n.length)||0)>0},parse:Av,createTransformer:Mv,getAnimatableNone:function(e){const t=Av(e);return Mv(e)(t.map(Pv))}},Iv=new Set(["brightness","contrast","saturate","opacity"]);function Dv(e){const[t,n]=e.slice(0,-1).split("(");if("drop-shadow"===t)return e;const[r]=n.match(fg)||[];if(!r)return e;const i=n.replace(r,"");let s=Iv.has(t)?1:0;return r!==n&&(s*=100),t+"("+s+i+")"}const Fv=/\b([a-z-]*)\(.*?\)/gu,Nv={...Rv,getAnimatableNone:e=>{const t=e.match(Fv);return t?t.map(Dv).join(" "):e}},Lv={...Eg,color:bv,backgroundColor:bv,outlineColor:bv,fill:bv,stroke:bv,borderColor:bv,borderTopColor:bv,borderRightColor:bv,borderBottomColor:bv,borderLeftColor:bv,filter:Nv,WebkitFilter:Nv},Bv=e=>Lv[e];function Ov(e,t){let n=Bv(e);return n!==Nv&&(n=Rv),n.getAnimatableNone?n.getAnimatableNone(t):void 0}const zv=new Set(["auto","none","0"]);class jv extends fv{constructor(e,t,n,r){super(e,t,n,r,null==r?void 0:r.owner,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:n}=this;if(!t.current)return;super.readKeyframes();for(let n=0;n<e.length;n++){let r=e[n];if("string"==typeof r&&(r=r.trim(),sg(r))){const i=Zy(r,t.current);void 0!==i&&(e[n]=i),n===e.length-1&&(this.finalKeyframe=r)}}if(this.resolveNoneKeyframes(),!Qy.has(n)||2!==e.length)return;const[r,i]=e,s=av(r),o=av(i);if(s!==o)if(Jy(s)&&Jy(o))for(let t=0;t<e.length;t++){const n=e[t];"string"==typeof n&&(e[t]=parseFloat(n))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,n=[];for(let t=0;t<e.length;t++)Xy(e[t])&&n.push(t);n.length&&function(e,t,n){let r,i=0;for(;i<e.length&&!r;){const t=e[i];"string"==typeof t&&!zv.has(t)&&kv(t).values.length&&(r=e[i]),i++}if(r&&n)for(const i of t)e[i]=Ov(n,r)}(e,n,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:n}=this;if(!e.current)return;"height"===n&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=iv[n](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const r=t[t.length-1];void 0!==r&&e.getValue(n,r).jump(r,!1)}measureEndState(){var e;const{element:t,name:n,unresolvedKeyframes:r}=this;if(!t.current)return;const i=t.getValue(n);i&&i.jump(this.measuredOrigin,!1);const s=r.length-1,o=r[s];r[s]=iv[n](t.measureViewportBox(),window.getComputedStyle(t.current)),null!==o&&void 0===this.finalKeyframe&&(this.finalKeyframe=o),(null===(e=this.removedTransforms)||void 0===e?void 0:e.length)&&this.removedTransforms.forEach((([e,n])=>{t.getValue(e).set(n)})),this.resolveNoneKeyframes()}}function Uv(e){let t;return()=>(void 0===t&&(t=e()),t)}const Gv=(e,t)=>!("zIndex"===t||"number"!=typeof e&&!Array.isArray(e)&&("string"!=typeof e||!Rv.test(e)&&"0"!==e||e.startsWith("url(")));class Vv{constructor({autoplay:e=!0,delay:t=0,type:n="keyframes",repeat:r=0,repeatDelay:i=0,repeatType:s="loop",...o}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.options={autoplay:e,delay:t,type:n,repeat:r,repeatDelay:i,repeatType:s,...o},this.updateFinishedPromise()}get resolved(){return this._resolved||this.hasAttemptedResolve||(dv(),hv()),this._resolved}onKeyframesResolved(e,t){this.hasAttemptedResolve=!0;const{name:n,type:r,velocity:i,delay:s,onComplete:o,onUpdate:a,isGenerator:l}=this.options;if(!l&&!function(e,t,n,r){const i=e[0];if(null===i)return!1;if("display"===t||"visibility"===t)return!0;const s=e[e.length-1],o=Gv(i,t),a=Gv(s,t);return $y(o===a,`You are trying to animate ${t} from "${i}" to "${s}". ${i} is not an animatable value - to enable this animation set ${i} to a value animatable to ${s} via the \`style\` property.`),!(!o||!a)&&(function(e){const t=e[0];if(1===e.length)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}(e)||"spring"===n&&r)}(e,n,r,i)){if(!s)return null==a||a(Uy(e,this.options,t)),null==o||o(),void this.resolveFinishedPromise();this.options.duration=0}const u=this.initPlayback(e,t);!1!==u&&(this._resolved={keyframes:e,finalKeyframe:t,...u},this.onPostResolved())}onPostResolved(){}then(e,t){return this.currentFinishedPromise.then(e,t)}updateFinishedPromise(){this.currentFinishedPromise=new Promise((e=>{this.resolveFinishedPromise=e}))}}function Hv(e,t){return t?e*(1e3/t):0}const Wv=5;function Xv(e,t,n){const r=Math.max(t-Wv,0);return Hv(n-e(r),t-r)}const $v=.001,Yv=.01,qv=10,Kv=.05,Zv=1;const Qv=12;function Jv(e,t){return e*Math.sqrt(1-t*t)}const ex=["duration","bounce"],tx=["stiffness","damping","mass"];function nx(e,t){return t.some((t=>void 0!==e[t]))}function rx({keyframes:e,restDelta:t,restSpeed:n,...r}){const i=e[0],s=e[e.length-1],o={done:!1,value:i},{stiffness:a,damping:l,mass:u,duration:c,velocity:h,isResolvedFromDuration:d}=function(e){let t={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...e};if(!nx(e,tx)&&nx(e,ex)){const n=function({duration:e=800,bounce:t=.25,velocity:n=0,mass:r=1}){let i,s;$y(e<=Dy(qv),"Spring duration must be 10 seconds or less");let o=1-t;o=lg(Kv,Zv,o),e=lg(Yv,qv,Fy(e)),o<1?(i=t=>{const r=t*o,i=r*e,s=r-n,a=Jv(t,o),l=Math.exp(-i);return $v-s/a*l},s=t=>{const r=t*o*e,s=r*n+n,a=Math.pow(o,2)*Math.pow(t,2)*e,l=Math.exp(-r),u=Jv(Math.pow(t,2),o);return(-i(t)+$v>0?-1:1)*((s-a)*l)/u}):(i=t=>Math.exp(-t*e)*((t-n)*e+1)-$v,s=t=>Math.exp(-t*e)*(e*e*(n-t)));const a=function(e,t,n){let r=n;for(let n=1;n<Qv;n++)r-=e(r)/t(r);return r}(i,s,5/e);if(e=Dy(e),isNaN(a))return{stiffness:100,damping:10,duration:e};{const t=Math.pow(a,2)*r;return{stiffness:t,damping:2*o*Math.sqrt(r*t),duration:e}}}(e);t={...t,...n,mass:1},t.isResolvedFromDuration=!0}return t}({...r,velocity:-Fy(r.velocity||0)}),f=h||0,p=l/(2*Math.sqrt(a*u)),m=s-i,g=Fy(Math.sqrt(a/u)),y=Math.abs(m)<5;let v;if(n||(n=y?.01:2),t||(t=y?.005:.5),p<1){const e=Jv(g,p);v=t=>{const n=Math.exp(-p*g*t);return s-n*((f+p*g*m)/e*Math.sin(e*t)+m*Math.cos(e*t))}}else if(1===p)v=e=>s-Math.exp(-g*e)*(m+(f+g*m)*e);else{const e=g*Math.sqrt(p*p-1);v=t=>{const n=Math.exp(-p*g*t),r=Math.min(e*t,300);return s-n*((f+p*g*m)*Math.sinh(r)+e*m*Math.cosh(r))/e}}return{calculatedDuration:d&&c||null,next:e=>{const r=v(e);if(d)o.done=e>=c;else{let i=f;0!==e&&(i=p<1?Xv(v,e,r):0);const a=Math.abs(i)<=n,l=Math.abs(s-r)<=t;o.done=a&&l}return o.value=o.done?s:r,o}}}function ix({keyframes:e,velocity:t=0,power:n=.8,timeConstant:r=325,bounceDamping:i=10,bounceStiffness:s=500,modifyTarget:o,min:a,max:l,restDelta:u=.5,restSpeed:c}){const h=e[0],d={done:!1,value:h},f=e=>void 0===a?l:void 0===l||Math.abs(a-e)<Math.abs(l-e)?a:l;let p=n*t;const m=h+p,g=void 0===o?m:o(m);g!==m&&(p=g-h);const y=e=>-p*Math.exp(-e/r),v=e=>g+y(e),x=e=>{const t=y(e),n=v(e);d.done=Math.abs(t)<=u,d.value=d.done?g:n};let b,w;const S=e=>{(e=>void 0!==a&&e<a||void 0!==l&&e>l)(d.value)&&(b=e,w=rx({keyframes:[d.value,f(d.value)],velocity:Xv(v,e,d.value),damping:i,stiffness:s,restDelta:u,restSpeed:c}))};return S(0),{calculatedDuration:null,next:e=>{let t=!1;return w||void 0!==b||(t=!0,x(e),S(e)),void 0!==b&&e>=b?w.next(e-b):(!t&&x(e),d)}}}const sx=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e;function ox(e,t,n,r){if(e===t&&n===r)return ny;return i=>0===i||1===i?i:sx(function(e,t,n,r,i){let s,o,a=0;do{o=t+(n-t)/2,s=sx(o,r,i)-e,s>0?n=o:t=o}while(Math.abs(s)>1e-7&&++a<12);return o}(i,0,1,e,n),t,r)}const ax=ox(.42,0,1,1),lx=ox(0,0,.58,1),ux=ox(.42,0,.58,1),cx=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,hx=e=>t=>1-e(1-t),dx=e=>1-Math.sin(Math.acos(e)),fx=hx(dx),px=cx(dx),mx=ox(.33,1.53,.69,.99),gx=hx(mx),yx=cx(gx),vx={linear:ny,easeIn:ax,easeInOut:ux,easeOut:lx,circIn:dx,circInOut:px,circOut:fx,backIn:gx,backInOut:yx,backOut:mx,anticipate:e=>(e*=2)<1?.5*gx(e):.5*(2-Math.pow(2,-10*(e-1)))},xx=e=>{if(Array.isArray(e)){Yy(4===e.length,"Cubic bezier arrays must contain four numerical values.");const[t,n,r,i]=e;return ox(t,n,r,i)}return"string"==typeof e?(Yy(void 0!==vx[e],`Invalid easing type '${e}'`),vx[e]):e},bx=(e,t,n)=>{const r=t-e;return 0===r?1:(n-e)/r},wx=(e,t,n)=>e+(t-e)*n;function Sx(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function _x(e,t){return n=>n>0?t:e}const Tx=(e,t,n)=>{const r=e*e,i=n*(t*t-r)+r;return i<0?0:Math.sqrt(i)},Ex=[vv,yv,xv];function Cx(e){const t=(e=>Ex.find((t=>t.test(e))))(e);if($y(Boolean(t),`'${e}' is not an animatable color. Use the equivalent color code instead.`),!Boolean(t))return!1;let n=t.parse(e);return t===xv&&(n=function({hue:e,saturation:t,lightness:n,alpha:r}){e/=360,n/=100;let i=0,s=0,o=0;if(t/=100){const r=n<.5?n*(1+t):n+t-n*t,a=2*n-r;i=Sx(a,r,e+1/3),s=Sx(a,r,e),o=Sx(a,r,e-1/3)}else i=s=o=n;return{red:Math.round(255*i),green:Math.round(255*s),blue:Math.round(255*o),alpha:r}}(n)),n}const kx=(e,t)=>{const n=Cx(e),r=Cx(t);if(!n||!r)return _x(e,t);const i={...n};return e=>(i.red=Tx(n.red,r.red,e),i.green=Tx(n.green,r.green,e),i.blue=Tx(n.blue,r.blue,e),i.alpha=wx(n.alpha,r.alpha,e),yv.transform(i))},Ax=new Set(["none","hidden"]);function Mx(e,t){return n=>wx(e,t,n)}function Px(e){return"number"==typeof e?Mx:"string"==typeof e?sg(e)?_x:bv.test(e)?kx:Dx:Array.isArray(e)?Rx:"object"==typeof e?bv.test(e)?kx:Ix:_x}function Rx(e,t){const n=[...e],r=n.length,i=e.map(((e,n)=>Px(e)(e,t[n])));return e=>{for(let t=0;t<r;t++)n[t]=i[t](e);return n}}function Ix(e,t){const n={...e,...t},r={};for(const i in n)void 0!==e[i]&&void 0!==t[i]&&(r[i]=Px(e[i])(e[i],t[i]));return e=>{for(const t in r)n[t]=r[t](e);return n}}const Dx=(e,t)=>{const n=Rv.createTransformer(t),r=kv(e),i=kv(t);return r.indexes.var.length===i.indexes.var.length&&r.indexes.color.length===i.indexes.color.length&&r.indexes.number.length>=i.indexes.number.length?Ax.has(e)&&!i.values.length||Ax.has(t)&&!r.values.length?function(e,t){return Ax.has(e)?n=>n<=0?e:t:n=>n>=1?t:e}(e,t):my(Rx(function(e,t){var n;const r=[],i={color:0,var:0,number:0};for(let s=0;s<t.values.length;s++){const o=t.types[s],a=e.indexes[o][i[o]],l=null!==(n=e.values[a])&&void 0!==n?n:0;r[s]=l,i[o]++}return r}(r,i),i.values),n):($y(!0,`Complex values '${e}' and '${t}' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.`),_x(e,t))};function Fx(e,t,n){return"number"==typeof e&&"number"==typeof t&&"number"==typeof n?wx(e,t,n):Px(e)(e,t)}function Nx({duration:e=300,keyframes:t,times:n,ease:r="easeInOut"}){const i=(e=>Array.isArray(e)&&"number"!=typeof e[0])(r)?r.map(xx):xx(r),s={done:!1,value:t[0]},o=function(e,t){return e.map((e=>e*t))}(n&&n.length===t.length?n:function(e){const t=[0];return function(e,t){const n=e[e.length-1];for(let r=1;r<=t;r++){const i=bx(0,t,r);e.push(wx(n,1,i))}}(t,e.length-1),t}(t),e),a=function(e,t,{clamp:n=!0,ease:r,mixer:i}={}){const s=e.length;if(Yy(s===t.length,"Both input and output ranges must be the same length"),1===s)return()=>t[0];if(2===s&&e[0]===e[1])return()=>t[1];e[0]>e[s-1]&&(e=[...e].reverse(),t=[...t].reverse());const o=function(e,t,n){const r=[],i=n||Fx,s=e.length-1;for(let n=0;n<s;n++){let s=i(e[n],e[n+1]);if(t){const e=Array.isArray(t)?t[n]||ny:t;s=my(e,s)}r.push(s)}return r}(t,r,i),a=o.length,l=t=>{let n=0;if(a>1)for(;n<e.length-2&&!(t<e[n+1]);n++);const r=bx(e[n],e[n+1],t);return o[n](r)};return n?t=>l(lg(e[0],e[s-1],t)):l}(o,t,{ease:Array.isArray(i)?i:(l=t,u=i,l.map((()=>u||ux)).splice(0,l.length-1))});var l,u;return{calculatedDuration:e,next:t=>(s.value=a(t),s.done=t>=e,s)}}const Lx=e=>{const t=({timestamp:t})=>e(t);return{start:()=>ry.update(t,!0),stop:()=>iy(t),now:()=>sy.isProcessing?sy.timestamp:Hy.now()}},Bx={decay:ix,inertia:ix,tween:Nx,keyframes:Nx,spring:rx},Ox=e=>e/100;class zx extends Vv{constructor({KeyframeResolver:e=fv,...t}){super(t),this.holdTime=null,this.startTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.teardown();const{onStop:e}=this.options;e&&e()};const{name:n,motionValue:r,keyframes:i}=this.options,s=(e,t)=>this.onKeyframesResolved(e,t);n&&r&&r.owner?this.resolver=r.owner.resolveKeyframes(i,s,n,r):this.resolver=new e(i,s,n,r),this.resolver.scheduleResolve()}initPlayback(e){const{type:t="keyframes",repeat:n=0,repeatDelay:r=0,repeatType:i,velocity:s=0}=this.options,o=Bx[t]||Nx;let a,l;o!==Nx&&"number"!=typeof e[0]&&(a=my(Ox,Fx(e[0],e[1])),e=[0,100]);const u=o({...this.options,keyframes:e});"mirror"===i&&(l=o({...this.options,keyframes:[...e].reverse(),velocity:-s})),null===u.calculatedDuration&&(u.calculatedDuration=function(e){let t=0,n=e.next(t);for(;!n.done&&t<2e4;)t+=50,n=e.next(t);return t>=2e4?1/0:t}(u));const{calculatedDuration:c}=u,h=c+r;return{generator:u,mirroredGenerator:l,mapPercentToKeyframes:a,calculatedDuration:c,resolvedDuration:h,totalDuration:h*(n+1)-r}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),"paused"!==this.pendingPlayState&&e?this.state=this.pendingPlayState:this.pause()}tick(e,t=!1){const{resolved:n}=this;if(!n){const{keyframes:e}=this.options;return{done:!0,value:e[e.length-1]}}const{finalKeyframe:r,generator:i,mirroredGenerator:s,mapPercentToKeyframes:o,keyframes:a,calculatedDuration:l,totalDuration:u,resolvedDuration:c}=n;if(null===this.startTime)return i.next(0);const{delay:h,repeat:d,repeatType:f,repeatDelay:p,onUpdate:m}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-u/this.speed,this.startTime)),t?this.currentTime=e:null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const g=this.currentTime-h*(this.speed>=0?1:-1),y=this.speed>=0?g<0:g>u;this.currentTime=Math.max(g,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=u);let v=this.currentTime,x=i;if(d){const e=Math.min(this.currentTime,u)/c;let t=Math.floor(e),n=e%1;!n&&e>=1&&(n=1),1===n&&t--,t=Math.min(t,d+1),Boolean(t%2)&&("reverse"===f?(n=1-n,p&&(n-=p/c)):"mirror"===f&&(x=s)),v=lg(0,1,n)*c}const b=y?{done:!1,value:a[0]}:x.next(v);o&&(b.value=o(b.value));let{done:w}=b;y||null===l||(w=this.speed>=0?this.currentTime>=u:this.currentTime<=0);const S=null===this.holdTime&&("finished"===this.state||"running"===this.state&&w);return S&&void 0!==r&&(b.value=Uy(a,this.options,r)),m&&m(b.value),S&&this.finish(),b}get duration(){const{resolved:e}=this;return e?Fy(e.calculatedDuration):0}get time(){return Fy(this.currentTime)}set time(e){e=Dy(e),this.currentTime=e,null!==this.holdTime||0===this.speed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=Fy(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved)return void(this.pendingPlayState="running");if(this.isStopped)return;const{driver:e=Lx,onPlay:t}=this.options;this.driver||(this.driver=e((e=>this.tick(e)))),t&&t();const n=this.driver.now();null!==this.holdTime?this.startTime=n-this.holdTime:this.startTime&&"finished"!==this.state||(this.startTime=n),"finished"===this.state&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;this._resolved?(this.state="paused",this.holdTime=null!==(e=this.currentTime)&&void 0!==e?e:0):this.pendingPlayState="paused"}complete(){"running"!==this.state&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){null!==this.cancelTime&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const jx=e=>Array.isArray(e)&&"number"==typeof e[0];function Ux(e){return Boolean(!e||"string"==typeof e&&e in Vx||jx(e)||Array.isArray(e)&&e.every(Ux))}const Gx=([e,t,n,r])=>`cubic-bezier(${e}, ${t}, ${n}, ${r})`,Vx={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Gx([0,.65,.55,1]),circOut:Gx([.55,0,1,.45]),backIn:Gx([.31,.01,.66,-.59]),backOut:Gx([.33,1.53,.69,.99])};function Hx(e){return Wx(e)||Vx.easeOut}function Wx(e){return e?jx(e)?Gx(e):Array.isArray(e)?e.map(Hx):Vx[e]:void 0}const Xx=Uv((()=>Object.hasOwnProperty.call(Element.prototype,"animate"))),$x=new Set(["opacity","clipPath","filter","transform"]);class Yx extends Vv{constructor(e){super(e);const{name:t,motionValue:n,keyframes:r}=this.options;this.resolver=new jv(r,((e,t)=>this.onKeyframesResolved(e,t)),t,n),this.resolver.scheduleResolve()}initPlayback(e,t){var n;let{duration:r=300,times:i,ease:s,type:o,motionValue:a,name:l}=this.options;if(!(null===(n=a.owner)||void 0===n?void 0:n.current))return!1;if(function(e){return"spring"===e.type||"backgroundColor"===e.name||!Ux(e.ease)}(this.options)){const{onComplete:t,onUpdate:n,motionValue:a,...l}=this.options,u=function(e,t){const n=new zx({...t,keyframes:e,repeat:0,delay:0,isGenerator:!0});let r={done:!1,value:e[0]};const i=[];let s=0;for(;!r.done&&s<2e4;)r=n.sample(s),i.push(r.value),s+=10;return{times:void 0,keyframes:i,duration:s-10,ease:"linear"}}(e,l);1===(e=u.keyframes).length&&(e[1]=e[0]),r=u.duration,i=u.times,s=u.ease,o="keyframes"}const u=function(e,t,n,{delay:r=0,duration:i=300,repeat:s=0,repeatType:o="loop",ease:a,times:l}={}){const u={[t]:n};l&&(u.offset=l);const c=Wx(a);return Array.isArray(c)&&(u.easing=c),e.animate(u,{delay:r,duration:i,easing:Array.isArray(c)?"linear":c,fill:"both",iterations:s+1,direction:"reverse"===o?"alternate":"normal"})}(a.owner.current,l,e,{...this.options,duration:r,times:i,ease:s});return u.startTime=Hy.now(),this.pendingTimeline?(u.timeline=this.pendingTimeline,this.pendingTimeline=void 0):u.onfinish=()=>{const{onComplete:n}=this.options;a.set(Uy(e,this.options,t)),n&&n(),this.cancel(),this.resolveFinishedPromise()},{animation:u,duration:r,times:i,type:o,ease:s,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:t}=e;return Fy(t)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:t}=e;return Fy(t.currentTime||0)}set time(e){const{resolved:t}=this;if(!t)return;const{animation:n}=t;n.currentTime=Dy(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:t}=e;return t.playbackRate}set speed(e){const{resolved:t}=this;if(!t)return;const{animation:n}=t;n.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:t}=e;return t.playState}attachTimeline(e){if(this._resolved){const{resolved:t}=this;if(!t)return ny;const{animation:n}=t;n.timeline=e,n.onfinish=null}else this.pendingTimeline=e;return ny}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:t}=e;"finished"===t.playState&&this.updateFinishedPromise(),t.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:t}=e;t.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;const{resolved:e}=this;if(!e)return;const{animation:t,keyframes:n,duration:r,type:i,ease:s,times:o}=e;if("idle"!==t.playState&&"finished"!==t.playState){if(this.time){const{motionValue:e,onUpdate:t,onComplete:a,...l}=this.options,u=new zx({...l,keyframes:n,duration:r,type:i,ease:s,times:o,isGenerator:!0}),c=Dy(this.time);e.setWithVelocity(u.sample(c-10).value,u.sample(c).value,10)}this.cancel()}}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:t,name:n,repeatDelay:r,repeatType:i,damping:s,type:o}=e;return Xx()&&n&&$x.has(n)&&t&&t.owner&&t.owner.current instanceof HTMLElement&&!t.owner.getProps().onUpdate&&!r&&"mirror"!==i&&0!==s&&"inertia"!==o}}const qx=Uv((()=>void 0!==window.ScrollTimeline));class Kx{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}then(e,t){return Promise.all(this.animations).then(e).catch(t)}getAll(e){return this.animations[0][e]}setAll(e,t){for(let n=0;n<this.animations.length;n++)this.animations[n][e]=t}attachTimeline(e){const t=this.animations.map((t=>{if(!qx()||!t.attachTimeline)return t.pause(),function(e,n){let r;const i=()=>{const{currentTime:e}=n,i=(null===e?0:e.value)/100;r!==i&&(e=>{t.time=t.duration*e})(i),r=i};return ry.update(i,!0),()=>iy(i)}(0,e);t.attachTimeline(e)}));return()=>{t.forEach(((e,t)=>{e&&e(),this.animations[t].stop()}))}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get duration(){let e=0;for(let t=0;t<this.animations.length;t++)e=Math.max(e,this.animations[t].duration);return e}runAll(e){this.animations.forEach((t=>t[e]()))}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}const Zx=(e,t,n,r={},i,s)=>o=>{const a=zy(r,e)||{},l=a.delay||r.delay||0;let{elapsed:u=0}=r;u-=Dy(l);let c={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity(),...a,delay:-u,onUpdate:e=>{t.set(e),a.onUpdate&&a.onUpdate(e)},onComplete:()=>{o(),a.onComplete&&a.onComplete()},name:e,motionValue:t,element:s?void 0:i};(function({when:e,delay:t,delayChildren:n,staggerChildren:r,staggerDirection:i,repeat:s,repeatType:o,repeatDelay:a,from:l,elapsed:u,...c}){return!!Object.keys(c).length})(a)||(c={...c,...Oy(e,c)}),c.duration&&(c.duration=Dy(c.duration)),c.repeatDelay&&(c.repeatDelay=Dy(c.repeatDelay)),void 0!==c.from&&(c.keyframes[0]=c.from);let h=!1;if((!1===c.type||0===c.duration&&!c.repeatDelay)&&(c.duration=0,0===c.delay&&(h=!0)),h&&!s&&void 0!==t.get()){const e=Uy(c.keyframes,a);if(void 0!==e)return ry.update((()=>{c.onUpdate(e),c.onComplete()})),new Kx([])}return!s&&Yx.supports(c)?new Yx(c):new zx(c)};function Qx(e){return Boolean(Jm(e)&&e.add)}function Jx(e,t){-1===e.indexOf(t)&&e.push(t)}function eb(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}class tb{constructor(){this.subscriptions=[]}add(e){return Jx(this.subscriptions,e),()=>eb(this.subscriptions,e)}notify(e,t,n){const r=this.subscriptions.length;if(r)if(1===r)this.subscriptions[0](e,t,n);else for(let i=0;i<r;i++){const r=this.subscriptions[i];r&&r(e,t,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const nb={current:void 0};class rb{constructor(e,t={}){this.version="11.2.12",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(e,t=!0)=>{const n=Hy.now();this.updatedAt!==n&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(e),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),t&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=Hy.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=(e=>!isNaN(parseFloat(e)))(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new tb);const n=this.events[e].add(t);return"change"===e?()=>{n(),ry.read((()=>{this.events.change.getSize()||this.stop()}))}:n}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e,t=!0){t&&this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e,t)}setWithVelocity(e,t,n){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-n}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return nb.current&&nb.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const e=Hy.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||e-this.updatedAt>30)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,30);return Hv(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise((t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()})).then((()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()}))}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function ib(e,t){return new rb(e,t)}function sb(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,ib(n))}function ob(e,t){const n=Iy(e,t);let{transitionEnd:r={},transition:i={},...s}=n||{};s={...s,...r};for(const t in s)sb(e,t,Qg(s[t]))}function ab(e){return e.getProps()[bm]}function lb({protectedKeys:e,needsAnimating:t},n){const r=e.hasOwnProperty(n)&&!0!==t[n];return t[n]=!1,r}function ub(e,t,{delay:n=0,transitionOverride:r,type:i}={}){var s;let{transition:o=e.getDefaultTransition(),transitionEnd:a,...l}=t;const u=e.getValue("willChange");r&&(o=r);const c=[],h=i&&e.animationState&&e.animationState.getState()[i];for(const t in l){const r=e.getValue(t,null!==(s=e.latestValues[t])&&void 0!==s?s:null),i=l[t];if(void 0===i||h&&lb(h,t))continue;const a={delay:n,elapsed:0,...zy(o||{},t)};let d=!1;if(window.HandoffAppearAnimations){const n=ab(e);if(n){const e=window.HandoffAppearAnimations(n,t,r,ry);null!==e&&(a.elapsed=e,d=!0)}}r.start(Zx(t,r,i,e.shouldReduceMotion&&Zm.has(t)?{type:!1}:a,e,d));const f=r.animation;f&&(Qx(u)&&(u.add(t),f.then((()=>u.remove(t)))),c.push(f))}return a&&Promise.all(c).then((()=>{ry.update((()=>{a&&ob(e,a)}))})),c}function cb(e,t,n={}){var r;const i=Iy(e,t,"exit"===n.type?null===(r=e.presenceContext)||void 0===r?void 0:r.custom:void 0);let{transition:s=e.getDefaultTransition()||{}}=i||{};n.transitionOverride&&(s=n.transitionOverride);const o=i?()=>Promise.all(ub(e,i,n)):()=>Promise.resolve(),a=e.variantChildren&&e.variantChildren.size?(r=0)=>{const{delayChildren:i=0,staggerChildren:o,staggerDirection:a}=s;return function(e,t,n=0,r=0,i=1,s){const o=[],a=(e.variantChildren.size-1)*r,l=1===i?(e=0)=>e*r:(e=0)=>a-e*r;return Array.from(e.variantChildren).sort(hb).forEach(((e,r)=>{e.notify("AnimationStart",t),o.push(cb(e,t,{...s,delay:n+l(r)}).then((()=>e.notify("AnimationComplete",t))))})),Promise.all(o)}(e,t,i+r,o,a,n)}:()=>Promise.resolve(),{when:l}=s;if(l){const[e,t]="beforeChildren"===l?[o,a]:[a,o];return e().then((()=>t()))}return Promise.all([o(),a(n.delay)])}function hb(e,t){return e.sortNodePosition(t)}function db(e,t,n={}){let r;if(e.notify("AnimationStart",t),Array.isArray(t)){const i=t.map((t=>cb(e,t,n)));r=Promise.all(i)}else if("string"==typeof t)r=cb(e,t,n);else{const i="function"==typeof t?Iy(e,t,n.custom):t;r=Promise.all(ub(e,i,n))}return r.then((()=>{ry.postRender((()=>{e.notify("AnimationComplete",t)}))}))}const fb=[...Nm].reverse(),pb=Nm.length;function mb(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function gb(){return{animate:mb(!0),whileInView:mb(),whileHover:mb(),whileTap:mb(),whileDrag:mb(),whileFocus:mb(),exit:mb()}}let yb=0;const vb={animation:{Feature:class extends wy{constructor(e){super(e),e.animationState||(e.animationState=function(e){let t=function(e){return t=>Promise.all(t.map((({animation:t,options:n})=>db(e,t,n))))}(e),n=gb(),r=!0;const i=t=>(n,r)=>{var i;const s=Iy(e,r,"exit"===t?null===(i=e.presenceContext)||void 0===i?void 0:i.custom:void 0);if(s){const{transition:e,transitionEnd:t,...r}=s;n={...n,...r,...t}}return n};function s(s){const o=e.getProps(),a=e.getVariantContext(!0)||{},l=[],u=new Set;let c={},h=1/0;for(let t=0;t<pb;t++){const p=fb[t],m=n[p],g=void 0!==o[p]?o[p]:a[p],y=Dm(g),v=p===s?m.isActive:null;!1===v&&(h=t);let x=g===a[p]&&g!==o[p]&&y;if(x&&r&&e.manuallyAnimateOnMount&&(x=!1),m.protectedKeys={...c},!m.isActive&&null===v||!g&&!m.prevProp||Fm(g)||"boolean"==typeof g)continue;let b=(d=m.prevProp,("string"==typeof(f=g)?f!==d:!!Array.isArray(f)&&!Ry(f,d))||p===s&&m.isActive&&!x&&y||t>h&&y),w=!1;const S=Array.isArray(g)?g:[g];let _=S.reduce(i(p),{});!1===v&&(_={});const{prevResolvedValues:T={}}=m,E={...T,..._},C=t=>{b=!0,u.has(t)&&(w=!0,u.delete(t)),m.needsAnimating[t]=!0;const n=e.getValue(t);n&&(n.liveStyle=!1)};for(const e in E){const t=_[e],n=T[e];if(c.hasOwnProperty(e))continue;let r=!1;r=Kg(t)&&Kg(n)?!Ry(t,n):t!==n,r?null!=t?C(e):u.add(e):void 0!==t&&u.has(e)?C(e):m.protectedKeys[e]=!0}m.prevProp=g,m.prevResolvedValues=_,m.isActive&&(c={...c,..._}),r&&e.blockInitialAnimation&&(b=!1),!b||x&&!w||l.push(...S.map((e=>({animation:e,options:{type:p}}))))}var d,f;if(u.size){const t={};u.forEach((n=>{const r=e.getBaseTarget(n),i=e.getValue(n);i&&(i.liveStyle=!0),t[n]=null!=r?r:null})),l.push({animation:t})}let p=Boolean(l.length);return!r||!1!==o.initial&&o.initial!==o.animate||e.manuallyAnimateOnMount||(p=!1),r=!1,p?t(l):Promise.resolve()}return{animateChanges:s,setActive:function(t,r){var i;if(n[t].isActive===r)return Promise.resolve();null===(i=e.variantChildren)||void 0===i||i.forEach((e=>{var n;return null===(n=e.animationState)||void 0===n?void 0:n.setActive(t,r)})),n[t].isActive=r;const o=s(t);for(const e in n)n[e].protectedKeys={};return o},setAnimateFunction:function(n){t=n(e)},getState:()=>n,reset:()=>{n=gb(),r=!0}}}(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Fm(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),null===(e=this.unmountControls)||void 0===e||e.call(this)}}},exit:{Feature:class extends wy{constructor(){super(...arguments),this.id=yb++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===n)return;const r=this.node.animationState.setActive("exit",!e);t&&!e&&r.then((()=>t(this.id)))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}}},xb=(e,t)=>Math.abs(e-t);class bb{constructor(e,t,{transformPagePoint:n,contextWindow:r,dragSnapToOrigin:i=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=_b(this.lastMoveEventInfo,this.history),t=null!==this.startEvent,n=function(e,t){const n=xb(e.x,t.x),r=xb(e.y,t.y);return Math.sqrt(n**2+r**2)}(e.offset,{x:0,y:0})>=3;if(!t&&!n)return;const{point:r}=e,{timestamp:i}=sy;this.history.push({...r,timestamp:i});const{onStart:s,onMove:o}=this.handlers;t||(s&&s(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),o&&o(this.lastMoveEvent,e)},this.handlePointerMove=(e,t)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=wb(t,this.transformPagePoint),ry.update(this.updatePoint,!0)},this.handlePointerUp=(e,t)=>{this.end();const{onEnd:n,onSessionEnd:r,resumeAnimation:i}=this.handlers;if(this.dragSnapToOrigin&&i&&i(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const s=_b("pointercancel"===e.type?this.lastMoveEventInfo:wb(t,this.transformPagePoint),this.history);this.startEvent&&n&&n(e,s),r&&r(e,s)},!cy(e))return;this.dragSnapToOrigin=i,this.handlers=t,this.transformPagePoint=n,this.contextWindow=r||window;const s=wb(hy(e),this.transformPagePoint),{point:o}=s,{timestamp:a}=sy;this.history=[{...o,timestamp:a}];const{onSessionStart:l}=t;l&&l(e,_b(s,this.history)),this.removeListeners=my(fy(this.contextWindow,"pointermove",this.handlePointerMove),fy(this.contextWindow,"pointerup",this.handlePointerUp),fy(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),iy(this.updatePoint)}}function wb(e,t){return t?{point:t(e.point)}:e}function Sb(e,t){return{x:e.x-t.x,y:e.y-t.y}}function _b({point:e},t){return{point:e,delta:Sb(e,Eb(t)),offset:Sb(e,Tb(t)),velocity:Cb(t,.1)}}function Tb(e){return e[0]}function Eb(e){return e[e.length-1]}function Cb(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,r=null;const i=Eb(e);for(;n>=0&&(r=e[n],!(i.timestamp-r.timestamp>Dy(t)));)n--;if(!r)return{x:0,y:0};const s=Fy(i.timestamp-r.timestamp);if(0===s)return{x:0,y:0};const o={x:(i.x-r.x)/s,y:(i.y-r.y)/s};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function kb(e){return e.max-e.min}function Ab(e,t=0,n=.01){return Math.abs(e-t)<=n}function Mb(e,t,n,r=.5){e.origin=r,e.originPoint=wx(t.min,t.max,e.origin),e.scale=kb(n)/kb(t),(Ab(e.scale,1,1e-4)||isNaN(e.scale))&&(e.scale=1),e.translate=wx(n.min,n.max,e.origin)-e.originPoint,(Ab(e.translate)||isNaN(e.translate))&&(e.translate=0)}function Pb(e,t,n,r){Mb(e.x,t.x,n.x,r?r.originX:void 0),Mb(e.y,t.y,n.y,r?r.originY:void 0)}function Rb(e,t,n){e.min=n.min+t.min,e.max=e.min+kb(t)}function Ib(e,t,n){e.min=t.min-n.min,e.max=e.min+kb(t)}function Db(e,t,n){Ib(e.x,t.x,n.x),Ib(e.y,t.y,n.y)}function Fb(e,t,n){return{min:void 0!==t?e.min+t:void 0,max:void 0!==n?e.max+n-(e.max-e.min):void 0}}function Nb(e,t){let n=t.min-e.min,r=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,r]=[r,n]),{min:n,max:r}}const Lb=.35;function Bb(e,t,n){return{min:Ob(e,t),max:Ob(e,n)}}function Ob(e,t){return"number"==typeof e?e:e[t]||0}const zb=()=>({x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}}),jb=()=>({x:{min:0,max:0},y:{min:0,max:0}});function Ub(e){return[e("x"),e("y")]}function Gb({top:e,left:t,right:n,bottom:r}){return{x:{min:t,max:n},y:{min:e,max:r}}}function Vb(e){return void 0===e||1===e}function Hb({scale:e,scaleX:t,scaleY:n}){return!Vb(e)||!Vb(t)||!Vb(n)}function Wb(e){return Hb(e)||Xb(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function Xb(e){return $b(e.x)||$b(e.y)}function $b(e){return e&&"0%"!==e}function Yb(e,t,n){return n+t*(e-n)}function qb(e,t,n,r,i){return void 0!==i&&(e=Yb(e,i,r)),Yb(e,n,r)+t}function Kb(e,t=0,n=1,r,i){e.min=qb(e.min,t,n,r,i),e.max=qb(e.max,t,n,r,i)}function Zb(e,{x:t,y:n}){Kb(e.x,t.translate,t.scale,t.originPoint),Kb(e.y,n.translate,n.scale,n.originPoint)}function Qb(e){return Number.isInteger(e)||e>1.0000000000001||e<.999999999999?e:1}function Jb(e,t){e.min=e.min+t,e.max=e.max+t}function ew(e,t,[n,r,i]){const s=void 0!==t[i]?t[i]:.5,o=wx(e.min,e.max,s);Kb(e,t[n],t[r],o,t.scale)}const tw=["x","scaleX","originX"],nw=["y","scaleY","originY"];function rw(e,t){ew(e.x,t,tw),ew(e.y,t,nw)}function iw(e,t){return Gb(function(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),r=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:r.y,right:r.x}}(e.getBoundingClientRect(),t))}const sw=({current:e})=>e?e.ownerDocument.defaultView:null,ow=new WeakMap;class aw{constructor(e){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=jb(),this.visualElement=e}start(e,{snapToCursor:t=!1}={}){const{presenceContext:n}=this.visualElement;if(n&&!1===n.isPresent)return;const{dragSnapToOrigin:r}=this.getProps();this.panSession=new bb(e,{onSessionStart:e=>{const{dragSnapToOrigin:n}=this.getProps();n?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(hy(e,"page").point)},onStart:(e,t)=>{const{drag:n,dragPropagation:r,onDragStart:i}=this.getProps();if(n&&!r&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=xy(n),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Ub((e=>{let t=this.getAxisMotionValue(e).get()||0;if(xg.test(t)){const{projection:n}=this.visualElement;if(n&&n.layout){const r=n.layout.layoutBox[e];r&&(t=kb(r)*(parseFloat(t)/100))}}this.originPoint[e]=t})),i&&ry.postRender((()=>i(e,t)));const{animationState:s}=this.visualElement;s&&s.setActive("whileDrag",!0)},onMove:(e,t)=>{const{dragPropagation:n,dragDirectionLock:r,onDirectionLock:i,onDrag:s}=this.getProps();if(!n&&!this.openGlobalLock)return;const{offset:o}=t;if(r&&null===this.currentDirection)return this.currentDirection=function(e,t=10){let n=null;return Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x"),n}(o),void(null!==this.currentDirection&&i&&i(this.currentDirection));this.updateAxis("x",t.point,o),this.updateAxis("y",t.point,o),this.visualElement.render(),s&&s(e,t)},onSessionEnd:(e,t)=>this.stop(e,t),resumeAnimation:()=>Ub((e=>{var t;return"paused"===this.getAnimationState(e)&&(null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.play())}))},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:r,contextWindow:sw(this.visualElement)})}stop(e,t){const n=this.isDragging;if(this.cancel(),!n)return;const{velocity:r}=t;this.startAnimation(r);const{onDragEnd:i}=this.getProps();i&&ry.postRender((()=>i(e,t)))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,n){const{drag:r}=this.getProps();if(!n||!lw(e,r,this.currentDirection))return;const i=this.getAxisMotionValue(e);let s=this.originPoint[e]+n[e];this.constraints&&this.constraints[e]&&(s=function(e,{min:t,max:n},r){return void 0!==t&&e<t?e=r?wx(t,e,r.min):Math.max(e,t):void 0!==n&&e>n&&(e=r?wx(n,e,r.max):Math.min(e,n)),e}(s,this.constraints[e],this.elastic[e])),i.set(s)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:n}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):null===(e=this.visualElement.projection)||void 0===e?void 0:e.layout,i=this.constraints;t&&Cm(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!t||!r)&&function(e,{top:t,left:n,bottom:r,right:i}){return{x:Fb(e.x,n,i),y:Fb(e.y,t,r)}}(r.layoutBox,t),this.elastic=function(e=Lb){return!1===e?e=0:!0===e&&(e=Lb),{x:Bb(e,"left","right"),y:Bb(e,"top","bottom")}}(n),i!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&Ub((e=>{!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,t){const n={};return void 0!==t.min&&(n.min=t.min-e.min),void 0!==t.max&&(n.max=t.max-e.min),n}(r.layoutBox[e],this.constraints[e]))}))}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!Cm(e))return!1;const n=e.current;Yy(null!==n,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop.");const{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const i=function(e,t,n){const r=iw(e,n),{scroll:i}=t;return i&&(Jb(r.x,i.offset.x),Jb(r.y,i.offset.y)),r}(n,r.root,this.visualElement.getTransformPagePoint());let s=function(e,t){return{x:Nb(e.x,t.x),y:Nb(e.y,t.y)}}(r.layout.layoutBox,i);if(t){const e=t(function({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}(s));this.hasMutatedConstraints=!!e,e&&(s=Gb(e))}return s}startAnimation(e){const{drag:t,dragMomentum:n,dragElastic:r,dragTransition:i,dragSnapToOrigin:s,onDragTransitionEnd:o}=this.getProps(),a=this.constraints||{},l=Ub((o=>{if(!lw(o,t,this.currentDirection))return;let l=a&&a[o]||{};s&&(l={min:0,max:0});const u=r?200:1e6,c=r?40:1e7,h={type:"inertia",velocity:n?e[o]:0,bounceStiffness:u,bounceDamping:c,timeConstant:750,restDelta:1,restSpeed:10,...i,...l};return this.startAxisValueAnimation(o,h)}));return Promise.all(l).then(o)}startAxisValueAnimation(e,t){const n=this.getAxisMotionValue(e);return n.start(Zx(e,n,0,t,this.visualElement))}stopAnimation(){Ub((e=>this.getAxisMotionValue(e).stop()))}pauseAnimation(){Ub((e=>{var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.pause()}))}getAnimationState(e){var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,n=this.visualElement.getProps();return n[t]||this.visualElement.getValue(e,(n.initial?n.initial[e]:void 0)||0)}snapToCursor(e){Ub((t=>{const{drag:n}=this.getProps();if(!lw(t,n,this.currentDirection))return;const{projection:r}=this.visualElement,i=this.getAxisMotionValue(t);if(r&&r.layout){const{min:n,max:s}=r.layout.layoutBox[t];i.set(e[t]-wx(n,s,.5))}}))}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:n}=this.visualElement;if(!Cm(t)||!n||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};Ub((e=>{const t=this.getAxisMotionValue(e);if(t&&!1!==this.constraints){const n=t.get();r[e]=function(e,t){let n=.5;const r=kb(e),i=kb(t);return i>r?n=bx(t.min,t.max-r,e.min):r>i&&(n=bx(e.min,e.max-i,t.min)),lg(0,1,n)}({min:n,max:n},this.constraints[e])}}));const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),Ub((t=>{if(!lw(t,e,null))return;const n=this.getAxisMotionValue(t),{min:i,max:s}=this.constraints[t];n.set(wx(i,s,r[t]))}))}addListeners(){if(!this.visualElement.current)return;ow.set(this.visualElement,this);const e=fy(this.visualElement.current,"pointerdown",(e=>{const{drag:t,dragListener:n=!0}=this.getProps();t&&n&&this.start(e)})),t=()=>{const{dragConstraints:e}=this.getProps();Cm(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,r=n.addEventListener("measure",t);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),ry.read(t);const i=uy(window,"resize",(()=>this.scalePositionWithinConstraints())),s=n.addEventListener("didUpdate",(({delta:e,hasLayoutChanged:t})=>{this.isDragging&&t&&(Ub((t=>{const n=this.getAxisMotionValue(t);n&&(this.originPoint[t]+=e[t].translate,n.set(n.get()+e[t].translate))})),this.visualElement.render())}));return()=>{i(),e(),r(),s&&s()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:n=!1,dragPropagation:r=!1,dragConstraints:i=!1,dragElastic:s=Lb,dragMomentum:o=!0}=e;return{...e,drag:t,dragDirectionLock:n,dragPropagation:r,dragConstraints:i,dragElastic:s,dragMomentum:o}}}function lw(e,t,n){return!(!0!==t&&t!==e||null!==n&&n!==e)}const uw=e=>(t,n)=>{e&&ry.postRender((()=>e(t,n)))},cw={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function hw(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const dw={correct:(e,t)=>{if(!t.target)return e;if("string"==typeof e){if(!bg.test(e))return e;e=parseFloat(e)}return`${hw(e,t.target.x)}% ${hw(e,t.target.y)}%`}},fw={correct:(e,{treeScale:t,projectionDelta:n})=>{const r=e,i=Rv.parse(e);if(i.length>5)return r;const s=Rv.createTransformer(e),o="number"!=typeof i[0]?1:0,a=n.x.scale*t.x,l=n.y.scale*t.y;i[0+o]/=a,i[1+o]/=l;const u=wx(a,l,.5);return"number"==typeof i[2+o]&&(i[2+o]/=u),"number"==typeof i[3+o]&&(i[3+o]/=u),s(i)}};class pw extends El.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n,layoutId:r}=this.props,{projection:i}=e;var s;s=gw,Object.assign(qm,s),i&&(t.group&&t.group.add(i),n&&n.register&&r&&n.register(i),i.root.didUpdate(),i.addEventListener("animationComplete",(()=>{this.safeToRemove()})),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),cw.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:n,drag:r,isPresent:i}=this.props,s=n.projection;return s?(s.isPresent=i,r||e.layoutDependency!==t||void 0===t?s.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?s.promote():s.relegate()||ry.postRender((()=>{const e=s.getStack();e&&e.members.length||this.safeToRemove()}))),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Tm.postRender((()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()})))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n}=this.props,{projection:r}=e;r&&(r.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(r),n&&n.deregister&&n.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function mw(e){const[t,n]=function(){const e=(0,El.useContext)(mm);if(null===e)return[!0,null];const{isPresent:t,onExitComplete:n,register:r}=e,i=(0,El.useId)();return(0,El.useEffect)((()=>r(i)),[]),!t&&n?[!1,()=>n&&n(i)]:[!0]}(),r=(0,El.useContext)(Gm);return(0,um.jsx)(pw,{...e,layoutGroup:r,switchLayoutGroup:(0,El.useContext)(km),isPresent:t,safeToRemove:n})}const gw={borderRadius:{...dw,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:dw,borderTopRightRadius:dw,borderBottomLeftRadius:dw,borderBottomRightRadius:dw,boxShadow:fw},yw=["TopLeft","TopRight","BottomLeft","BottomRight"],vw=yw.length,xw=e=>"string"==typeof e?parseFloat(e):e,bw=e=>"number"==typeof e||bg.test(e);function ww(e,t){return void 0!==e[t]?e[t]:e.borderRadius}const Sw=Tw(0,.5,fx),_w=Tw(.5,.95,ny);function Tw(e,t,n){return r=>r<e?0:r>t?1:n(bx(e,t,r))}function Ew(e,t){e.min=t.min,e.max=t.max}function Cw(e,t){Ew(e.x,t.x),Ew(e.y,t.y)}function kw(e,t,n,r,i){return e=Yb(e-=t,1/n,r),void 0!==i&&(e=Yb(e,1/i,r)),e}function Aw(e,t,[n,r,i],s,o){!function(e,t=0,n=1,r=.5,i,s=e,o=e){if(xg.test(t)&&(t=parseFloat(t),t=wx(o.min,o.max,t/100)-o.min),"number"!=typeof t)return;let a=wx(s.min,s.max,r);e===s&&(a-=t),e.min=kw(e.min,t,n,a,i),e.max=kw(e.max,t,n,a,i)}(e,t[n],t[r],t[i],t.scale,s,o)}const Mw=["x","scaleX","originX"],Pw=["y","scaleY","originY"];function Rw(e,t,n,r){Aw(e.x,t,Mw,n?n.x:void 0,r?r.x:void 0),Aw(e.y,t,Pw,n?n.y:void 0,r?r.y:void 0)}function Iw(e){return 0===e.translate&&1===e.scale}function Dw(e){return Iw(e.x)&&Iw(e.y)}function Fw(e,t){return Math.round(e.x.min)===Math.round(t.x.min)&&Math.round(e.x.max)===Math.round(t.x.max)&&Math.round(e.y.min)===Math.round(t.y.min)&&Math.round(e.y.max)===Math.round(t.y.max)}function Nw(e){return kb(e.x)/kb(e.y)}class Lw{constructor(){this.members=[]}add(e){Jx(this.members,e),e.scheduleRender()}remove(e){if(eb(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const t=this.members.findIndex((t=>e===t));if(0===t)return!1;let n;for(let e=t;e>=0;e--){const t=this.members[e];if(!1!==t.isPresent){n=t;break}}return!!n&&(this.promote(n),!0)}promote(e,t){const n=this.lead;if(e!==n&&(this.prevLead=n,this.lead=e,e.show(),n)){n.instance&&n.scheduleRender(),e.scheduleRender(),e.resumeFrom=n,t&&(e.resumeFrom.preserveOpacity=!0),n.snapshot&&(e.snapshot=n.snapshot,e.snapshot.latestValues=n.animationValues||n.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;!1===r&&n.hide()}}exitAnimationComplete(){this.members.forEach((e=>{const{options:t,resumingFrom:n}=e;t.onExitComplete&&t.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()}))}scheduleRender(){this.members.forEach((e=>{e.instance&&e.scheduleRender(!1)}))}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Bw(e,t,n){let r="";const i=e.x.translate/t.x,s=e.y.translate/t.y,o=(null==n?void 0:n.z)||0;if((i||s||o)&&(r=`translate3d(${i}px, ${s}px, ${o}px) `),1===t.x&&1===t.y||(r+=`scale(${1/t.x}, ${1/t.y}) `),n){const{transformPerspective:e,rotate:t,rotateX:i,rotateY:s,skewX:o,skewY:a}=n;e&&(r=`perspective(${e}px) ${r}`),t&&(r+=`rotate(${t}deg) `),i&&(r+=`rotateX(${i}deg) `),s&&(r+=`rotateY(${s}deg) `),o&&(r+=`skewX(${o}deg) `),a&&(r+=`skewY(${a}deg) `)}const a=e.x.scale*t.x,l=e.y.scale*t.y;return 1===a&&1===l||(r+=`scale(${a}, ${l})`),r||"none"}const Ow=(e,t)=>e.depth-t.depth;class zw{constructor(){this.children=[],this.isDirty=!1}add(e){Jx(this.children,e),this.isDirty=!0}remove(e){eb(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(Ow),this.isDirty=!1,this.children.forEach(e)}}const jw=["","X","Y","Z"],Uw={visibility:"hidden"};let Gw=0;const Vw={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function Hw(e,t,n,r){const{latestValues:i}=t;i[e]&&(n[e]=i[e],t.setStaticValue(e,0),r&&(r[e]=0))}function Ww(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return!1;const{visualElement:t}=e.options;return!!t&&(!!ab(t)||!(!e.parent||e.parent.hasCheckedOptimisedAppear)&&Ww(e.parent))}function Xw({attachResizeListener:e,defaultParent:t,measureScroll:n,checkIsScrollRoot:r,resetTransform:i}){return class{constructor(e={},n=(null==t?void 0:t())){this.id=Gw++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{var e;this.projectionUpdateScheduled=!1,Vw.totalNodes=Vw.resolvedTargetDeltas=Vw.recalculatedProjection=0,this.nodes.forEach(qw),this.nodes.forEach(nS),this.nodes.forEach(rS),this.nodes.forEach(Kw),e=Vw,window.MotionDebug&&window.MotionDebug.record(e)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=n?n.root||n:this,this.path=n?[...n.path,n]:[],this.parent=n,this.depth=n?n.depth+1:0;for(let e=0;e<this.path.length;e++)this.path[e].shouldResetTransform=!0;this.root===this&&(this.nodes=new zw)}addEventListener(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new tb),this.eventHandlers.get(e).add(t)}notifyListeners(e,...t){const n=this.eventHandlers.get(e);n&&n.notify(...t)}hasListeners(e){return this.eventHandlers.has(e)}mount(t,n=this.root.hasTreeAnimated){if(this.instance)return;var r;this.isSVG=(r=t)instanceof SVGElement&&"svg"!==r.tagName,this.instance=t;const{layoutId:i,layout:s,visualElement:o}=this.options;if(o&&!o.current&&o.mount(t),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),n&&(s||i)&&(this.isLayoutDirty=!0),e){let n;const r=()=>this.root.updateBlockedByResize=!1;e(t,(()=>{this.root.updateBlockedByResize=!0,n&&n(),n=function(e,t){const n=Hy.now(),r=({timestamp:t})=>{const i=t-n;i>=250&&(iy(r),e(i-250))};return ry.read(r,!0),()=>iy(r)}(r),cw.hasAnimatedSinceResize&&(cw.hasAnimatedSinceResize=!1,this.nodes.forEach(tS))}))}i&&this.root.registerSharedNode(i,this),!1!==this.options.animate&&o&&(i||s)&&this.addEventListener("didUpdate",(({delta:e,hasLayoutChanged:t,hasRelativeTargetChanged:n,layout:r})=>{if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const i=this.options.transition||o.getDefaultTransition()||uS,{onLayoutAnimationStart:s,onLayoutAnimationComplete:a}=o.getProps(),l=!this.targetLayout||!Fw(this.targetLayout,r)||n,u=!t&&n;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||u||t&&(l||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(e,u);const t={...zy(i,"layout"),onPlay:s,onComplete:a};(o.shouldReduceMotion||this.options.layoutRoot)&&(t.delay=0,t.type=!1),this.startAnimation(t)}else t||tS(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=r}))}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,iy(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(iS),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(e=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(window.HandoffCancelAllAnimations&&Ww(this)&&window.HandoffCancelAllAnimations(),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let e=0;e<this.path.length;e++){const t=this.path[e];t.shouldResetTransform=!0,t.updateScroll("snapshot"),t.options.layoutRoot&&t.willUpdate(!1)}const{layoutId:t,layout:n}=this.options;if(void 0===t&&!n)return;const r=this.getTransformTemplate();this.prevTransformTemplateValue=r?r(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(Qw);this.isUpdating||this.nodes.forEach(Jw),this.isUpdating=!1,this.nodes.forEach(eS),this.nodes.forEach($w),this.nodes.forEach(Yw),this.clearAllSnapshots();const e=Hy.now();sy.delta=lg(0,1e3/60,e-sy.timestamp),sy.timestamp=e,sy.isProcessing=!0,oy.update.process(sy),oy.preRender.process(sy),oy.render.process(sy),sy.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Tm.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Zw),this.sharedNodes.forEach(sS)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,ry.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){ry.postRender((()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()}))}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure())}updateLayout(){if(!this.instance)return;if(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead()||this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let e=0;e<this.path.length;e++)this.path[e].updateScroll();const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected=jb(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(e="measure"){let t=Boolean(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(t=!1),t&&(this.scroll={animationId:this.root.animationId,phase:e,isRoot:r(this.instance),offset:n(this.instance)})}resetTransform(){if(!i)return;const e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,t=this.projectionDelta&&!Dw(this.projectionDelta),n=this.getTransformTemplate(),r=n?n(this.latestValues,""):void 0,s=r!==this.prevTransformTemplateValue;e&&(t||Wb(this.latestValues)||s)&&(i(this.instance,r),this.shouldResetTransform=!1,this.scheduleRender())}measure(e=!0){const t=this.measurePageBox();let n=this.removeElementScroll(t);var r;return e&&(n=this.removeTransform(n)),dS((r=n).x),dS(r.y),{animationId:this.root.animationId,measuredBox:t,layoutBox:n,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:e}=this.options;if(!e)return jb();const t=e.measureViewportBox(),{scroll:n}=this.root;return n&&(Jb(t.x,n.offset.x),Jb(t.y,n.offset.y)),t}removeElementScroll(e){const t=jb();Cw(t,e);for(let n=0;n<this.path.length;n++){const r=this.path[n],{scroll:i,options:s}=r;if(r!==this.root&&i&&s.layoutScroll){if(i.isRoot){Cw(t,e);const{scroll:n}=this.root;n&&(Jb(t.x,-n.offset.x),Jb(t.y,-n.offset.y))}Jb(t.x,i.offset.x),Jb(t.y,i.offset.y)}}return t}applyTransform(e,t=!1){const n=jb();Cw(n,e);for(let e=0;e<this.path.length;e++){const r=this.path[e];!t&&r.options.layoutScroll&&r.scroll&&r!==r.root&&rw(n,{x:-r.scroll.offset.x,y:-r.scroll.offset.y}),Wb(r.latestValues)&&rw(n,r.latestValues)}return Wb(this.latestValues)&&rw(n,this.latestValues),n}removeTransform(e){const t=jb();Cw(t,e);for(let e=0;e<this.path.length;e++){const n=this.path[e];if(!n.instance)continue;if(!Wb(n.latestValues))continue;Hb(n.latestValues)&&n.updateSnapshot();const r=jb();Cw(r,n.measurePageBox()),Rw(t,n.latestValues,n.snapshot?n.snapshot.layoutBox:void 0,r)}return Wb(this.latestValues)&&Rw(t,this.latestValues),t}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options={...this.options,...e,crossfade:void 0===e.crossfade||e.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==sy.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(e=!1){var t;const n=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=n.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=n.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=n.isSharedProjectionDirty);const r=Boolean(this.resumingFrom)||this!==n;if(!(e||r&&this.isSharedProjectionDirty||this.isProjectionDirty||(null===(t=this.parent)||void 0===t?void 0:t.isProjectionDirty)||this.attemptToResolveRelativeTarget))return;const{layout:i,layoutId:s}=this.options;if(this.layout&&(i||s)){if(this.resolvedRelativeTargetAt=sy.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget=jb(),this.relativeTargetOrigin=jb(),Db(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),Cw(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(this.relativeTarget||this.targetDelta){var o,a,l;if(this.target||(this.target=jb(),this.targetWithTransforms=jb()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),o=this.target,a=this.relativeTarget,l=this.relativeParent.target,Rb(o.x,a.x,l.x),Rb(o.y,a.y,l.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):Cw(this.target,this.layout.layoutBox),Zb(this.target,this.targetDelta)):Cw(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget=jb(),this.relativeTargetOrigin=jb(),Db(this.relativeTargetOrigin,this.target,e.target),Cw(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Vw.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(this.parent&&!Hb(this.parent.latestValues)&&!Xb(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var e;const t=this.getLead(),n=Boolean(this.resumingFrom)||this!==t;let r=!0;if((this.isProjectionDirty||(null===(e=this.parent)||void 0===e?void 0:e.isProjectionDirty))&&(r=!1),n&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(r=!1),this.resolvedRelativeTargetAt===sy.timestamp&&(r=!1),r)return;const{layout:i,layoutId:s}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!i&&!s)return;Cw(this.layoutCorrected,this.layout.layoutBox);const o=this.treeScale.x,a=this.treeScale.y;!function(e,t,n,r=!1){const i=n.length;if(!i)return;let s,o;t.x=t.y=1;for(let a=0;a<i;a++){s=n[a],o=s.projectionDelta;const i=s.instance;i&&i.style&&"contents"===i.style.display||(r&&s.options.layoutScroll&&s.scroll&&s!==s.root&&rw(e,{x:-s.scroll.offset.x,y:-s.scroll.offset.y}),o&&(t.x*=o.x.scale,t.y*=o.y.scale,Zb(e,o)),r&&Wb(s.latestValues)&&rw(e,s.latestValues))}t.x=Qb(t.x),t.y=Qb(t.y)}(this.layoutCorrected,this.treeScale,this.path,n),!t.layout||t.target||1===this.treeScale.x&&1===this.treeScale.y||(t.target=t.layout.layoutBox,t.targetWithTransforms=jb());const{target:l}=t;if(!l)return void(this.projectionTransform&&(this.projectionDelta=zb(),this.projectionTransform="none",this.scheduleRender()));this.projectionDelta||(this.projectionDelta=zb(),this.projectionDeltaWithTransform=zb());const u=this.projectionTransform;Pb(this.projectionDelta,this.layoutCorrected,l,this.latestValues),this.projectionTransform=Bw(this.projectionDelta,this.treeScale),this.projectionTransform===u&&this.treeScale.x===o&&this.treeScale.y===a||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",l)),Vw.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(e=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),e){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(e,t=!1){const n=this.snapshot,r=n?n.latestValues:{},i={...this.latestValues},s=zb();this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;const o=jb(),a=(n?n.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),u=!l||l.members.length<=1,c=Boolean(a&&!u&&!0===this.options.crossfade&&!this.path.some(lS));let h;this.animationProgress=0,this.mixTargetDelta=t=>{const n=t/1e3;oS(s.x,e.x,n),oS(s.y,e.y,n),this.setTargetDelta(s),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Db(o,this.layout.layoutBox,this.relativeParent.layout.layoutBox),function(e,t,n,r){aS(e.x,t.x,n.x,r),aS(e.y,t.y,n.y,r)}(this.relativeTarget,this.relativeTargetOrigin,o,n),h&&function(e,t){return e.x.min===t.x.min&&e.x.max===t.x.max&&e.y.min===t.y.min&&e.y.max===t.y.max}(this.relativeTarget,h)&&(this.isProjectionDirty=!1),h||(h=jb()),Cw(h,this.relativeTarget)),a&&(this.animationValues=i,function(e,t,n,r,i,s){i?(e.opacity=wx(0,void 0!==n.opacity?n.opacity:1,Sw(r)),e.opacityExit=wx(void 0!==t.opacity?t.opacity:1,0,_w(r))):s&&(e.opacity=wx(void 0!==t.opacity?t.opacity:1,void 0!==n.opacity?n.opacity:1,r));for(let i=0;i<vw;i++){const s=`border${yw[i]}Radius`;let o=ww(t,s),a=ww(n,s);void 0===o&&void 0===a||(o||(o=0),a||(a=0),0===o||0===a||bw(o)===bw(a)?(e[s]=Math.max(wx(xw(o),xw(a),r),0),(xg.test(a)||xg.test(o))&&(e[s]+="%")):e[s]=a)}(t.rotate||n.rotate)&&(e.rotate=wx(t.rotate||0,n.rotate||0,r))}(i,r,this.latestValues,n,c,u)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=n},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(iy(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=ry.update((()=>{cw.hasAnimatedSinceResize=!0,this.currentAnimation=function(e,t,n){const r=Jm(0)?0:ib(0);return r.start(Zx("",r,1e3,n)),r.animation}(0,0,{...e,onUpdate:t=>{this.mixTargetDelta(t),e.onUpdate&&e.onUpdate(t)},onComplete:()=>{e.onComplete&&e.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0}))}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:t,target:n,layout:r,latestValues:i}=e;if(t&&n&&r){if(this!==e&&this.layout&&r&&fS(this.options.animationType,this.layout.layoutBox,r.layoutBox)){n=this.target||jb();const t=kb(this.layout.layoutBox.x);n.x.min=e.target.x.min,n.x.max=n.x.min+t;const r=kb(this.layout.layoutBox.y);n.y.min=e.target.y.min,n.y.max=n.y.min+r}Cw(t,n),rw(t,i),Pb(this.projectionDeltaWithTransform,this.layoutCorrected,t,i)}}registerSharedNode(e,t){this.sharedNodes.has(e)||this.sharedNodes.set(e,new Lw),this.sharedNodes.get(e).add(t);const n=t.options.initialPromotionConfig;t.promote({transition:n?n.transition:void 0,preserveFollowOpacity:n&&n.shouldPreserveFollowOpacity?n.shouldPreserveFollowOpacity(t):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){var e;const{layoutId:t}=this.options;return t&&(null===(e=this.getStack())||void 0===e?void 0:e.lead)||this}getPrevLead(){var e;const{layoutId:t}=this.options;return t?null===(e=this.getStack())||void 0===e?void 0:e.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote({needsReset:e,transition:t,preserveFollowOpacity:n}={}){const r=this.getStack();r&&r.promote(this,n),e&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){const{visualElement:e}=this.options;if(!e)return;let t=!1;const{latestValues:n}=e;if((n.z||n.rotate||n.rotateX||n.rotateY||n.rotateZ||n.skewX||n.skewY)&&(t=!0),!t)return;const r={};n.z&&Hw("z",e,r,this.animationValues);for(let t=0;t<jw.length;t++)Hw(`rotate${jw[t]}`,e,r,this.animationValues),Hw(`skew${jw[t]}`,e,r,this.animationValues);e.render();for(const t in r)e.setStaticValue(t,r[t]),this.animationValues&&(this.animationValues[t]=r[t]);e.scheduleRender()}getProjectionStyles(e){var t,n;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Uw;const r={visibility:""},i=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,r.opacity="",r.pointerEvents=Jg(null==e?void 0:e.pointerEvents)||"",r.transform=i?i(this.latestValues,""):"none",r;const s=this.getLead();if(!this.projectionDelta||!this.layout||!s.target){const t={};return this.options.layoutId&&(t.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,t.pointerEvents=Jg(null==e?void 0:e.pointerEvents)||""),this.hasProjected&&!Wb(this.latestValues)&&(t.transform=i?i({},""):"none",this.hasProjected=!1),t}const o=s.animationValues||s.latestValues;this.applyTransformsToTarget(),r.transform=Bw(this.projectionDeltaWithTransform,this.treeScale,o),i&&(r.transform=i(o,r.transform));const{x:a,y:l}=this.projectionDelta;r.transformOrigin=`${100*a.origin}% ${100*l.origin}% 0`,s.animationValues?r.opacity=s===this?null!==(n=null!==(t=o.opacity)&&void 0!==t?t:this.latestValues.opacity)&&void 0!==n?n:1:this.preserveOpacity?this.latestValues.opacity:o.opacityExit:r.opacity=s===this?void 0!==o.opacity?o.opacity:"":void 0!==o.opacityExit?o.opacityExit:0;for(const e in qm){if(void 0===o[e])continue;const{correct:t,applyTo:n}=qm[e],i="none"===r.transform?o[e]:t(o[e],s);if(n){const e=n.length;for(let t=0;t<e;t++)r[n[t]]=i}else r[e]=i}return this.options.layoutId&&(r.pointerEvents=s===this?Jg(null==e?void 0:e.pointerEvents)||"":"none"),r}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach((e=>{var t;return null===(t=e.currentAnimation)||void 0===t?void 0:t.stop()})),this.root.nodes.forEach(Qw),this.root.sharedNodes.clear()}}}function $w(e){e.updateLayout()}function Yw(e){var t;const n=(null===(t=e.resumeFrom)||void 0===t?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&n&&e.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:r}=e.layout,{animationType:i}=e.options,s=n.source!==e.layout.source;"size"===i?Ub((e=>{const r=s?n.measuredBox[e]:n.layoutBox[e],i=kb(r);r.min=t[e].min,r.max=r.min+i})):fS(i,n.layoutBox,t)&&Ub((r=>{const i=s?n.measuredBox[r]:n.layoutBox[r],o=kb(t[r]);i.max=i.min+o,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[r].max=e.relativeTarget[r].min+o)}));const o=zb();Pb(o,t,n.layoutBox);const a=zb();s?Pb(a,e.applyTransform(r,!0),n.measuredBox):Pb(a,t,n.layoutBox);const l=!Dw(o);let u=!1;if(!e.resumeFrom){const r=e.getClosestProjectingParent();if(r&&!r.resumeFrom){const{snapshot:i,layout:s}=r;if(i&&s){const o=jb();Db(o,n.layoutBox,i.layoutBox);const a=jb();Db(a,t,s.layoutBox),Fw(o,a)||(u=!0),r.options.layoutRoot&&(e.relativeTarget=a,e.relativeTargetOrigin=o,e.relativeParent=r)}}}e.notifyListeners("didUpdate",{layout:t,snapshot:n,delta:a,layoutDelta:o,hasLayoutChanged:l,hasRelativeTargetChanged:u})}else if(e.isLead()){const{onExitComplete:t}=e.options;t&&t()}e.options.transition=void 0}function qw(e){Vw.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Kw(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function Zw(e){e.clearSnapshot()}function Qw(e){e.clearMeasurements()}function Jw(e){e.isLayoutDirty=!1}function eS(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function tS(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function nS(e){e.resolveTargetDelta()}function rS(e){e.calcProjection()}function iS(e){e.resetSkewAndRotation()}function sS(e){e.removeLeadSnapshot()}function oS(e,t,n){e.translate=wx(t.translate,0,n),e.scale=wx(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function aS(e,t,n,r){e.min=wx(t.min,n.min,r),e.max=wx(t.max,n.max,r)}function lS(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const uS={duration:.45,ease:[.4,0,.1,1]},cS=e=>"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),hS=cS("applewebkit/")&&!cS("chrome/")?Math.round:ny;function dS(e){e.min=hS(e.min),e.max=hS(e.max)}function fS(e,t,n){return"position"===e||"preserve-aspect"===e&&!Ab(Nw(t),Nw(n),.2)}const pS=Xw({attachResizeListener:(e,t)=>uy(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),mS={current:void 0},gS=Xw({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!mS.current){const e=new pS({});e.mount(window),e.setOptions({layoutScroll:!0}),mS.current=e}return mS.current},resetTransform:(e,t)=>{e.style.transform=void 0!==t?t:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),yS={pan:{Feature:class extends wy{constructor(){super(...arguments),this.removePointerDownListener=ny}onPointerDown(e){this.session=new bb(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:sw(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:n,onPanEnd:r}=this.node.getProps();return{onSessionStart:uw(e),onStart:uw(t),onMove:n,onEnd:(e,t)=>{delete this.session,r&&ry.postRender((()=>r(e,t)))}}}mount(){this.removePointerDownListener=fy(this.node.current,"pointerdown",(e=>this.onPointerDown(e)))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends wy{constructor(e){super(e),this.removeGroupControls=ny,this.removeListeners=ny,this.controls=new aw(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||ny}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:gS,MeasureLayout:mw}},vS={current:null},xS={current:!1},bS=new WeakMap,wS=[...ov,bv,Rv],SS=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],_S=Lm.length;class TS{scrapeMotionValuesFromProps(e,t,n){return{}}constructor({parent:e,props:t,presenceContext:n,reducedMotionConfig:r,blockInitialAnimation:i,visualState:s},o={}){this.resolveKeyframes=(e,t,n,r)=>new this.KeyframeResolver(e,t,n,r,this),this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=fv,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>ry.render(this.render,!1,!0);const{latestValues:a,renderState:l}=s;this.latestValues=a,this.baseTarget={...a},this.initialValues=t.initial?{...a}:{},this.renderState=l,this.parent=e,this.props=t,this.presenceContext=n,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=o,this.blockInitialAnimation=Boolean(i),this.isControllingVariants=Bm(t),this.isVariantNode=Om(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(e&&e.current);const{willChange:u,...c}=this.scrapeMotionValuesFromProps(t,{},this);for(const e in c){const t=c[e];void 0!==a[e]&&Jm(t)&&(t.set(a[e],!1),Qx(u)&&u.add(e))}}mount(e){this.current=e,bS.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach(((e,t)=>this.bindToMotionValue(t,e))),xS.current||function(){if(xS.current=!0,gm)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>vS.current=e.matches;e.addListener(t),t()}else vS.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||vS.current),this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){bS.delete(this.current),this.projection&&this.projection.unmount(),iy(this.notifyUpdate),iy(this.render),this.valueSubscriptions.forEach((e=>e())),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}bindToMotionValue(e,t){const n=Zm.has(e),r=t.on("change",(t=>{this.latestValues[e]=t,this.props.onUpdate&&ry.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0)})),i=t.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(e,(()=>{r(),i(),t.owner&&t.stop()}))}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in Um){const t=Um[e];if(!t)continue;const{isEnabled:n,Feature:r}=t;if(!this.features[e]&&r&&n(this.props)&&(this.features[e]=new r(this)),this.features[e]){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):jb()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let t=0;t<SS.length;t++){const n=SS[t];this.propEventSubscriptions[n]&&(this.propEventSubscriptions[n](),delete this.propEventSubscriptions[n]);const r=e["on"+n];r&&(this.propEventSubscriptions[n]=this.on(n,r))}this.prevMotionValues=function(e,t,n){const{willChange:r}=t;for(const i in t){const s=t[i],o=n[i];if(Jm(s))e.addValue(i,s),Qx(r)&&r.add(i);else if(Jm(o))e.addValue(i,ib(s,{owner:e})),Qx(r)&&r.remove(i);else if(o!==s)if(e.hasValue(i)){const t=e.getValue(i);!0===t.liveStyle?t.jump(s):t.hasAnimated||t.set(s)}else{const t=e.getStaticValue(i);e.addValue(i,ib(void 0!==t?t:s,{owner:e}))}}for(const r in n)void 0===t[r]&&e.removeValue(r);return t}(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(e=!1){if(e)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const e=this.parent&&this.parent.getVariantContext()||{};return void 0!==this.props.initial&&(e.initial=this.props.initial),e}const t={};for(let e=0;e<_S;e++){const n=Lm[e],r=this.props[n];(Dm(r)||!1===r)&&(t[n]=r)}return t}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const n=this.values.get(e);t!==n&&(n&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let n=this.values.get(e);return void 0===n&&void 0!==t&&(n=ib(null===t?void 0:t,{owner:this}),this.addValue(e,n)),n}readValue(e,t){var n;let r=void 0===this.latestValues[e]&&this.current?null!==(n=this.getBaseTargetFromProps(this.props,e))&&void 0!==n?n:this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];return null!=r&&("string"==typeof r&&(qy(r)||Wy(r))?r=parseFloat(r):!(e=>wS.find(sv(e)))(r)&&Rv.test(t)&&(r=Ov(e,t)),this.setBaseTarget(e,Jm(r)?r.get():r)),Jm(r)?r.get():r}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var t;const{initial:n}=this.props;let r;if("string"==typeof n||"object"==typeof n){const i=Yg(this.props,n,null===(t=this.presenceContext)||void 0===t?void 0:t.custom);i&&(r=i[e])}if(n&&void 0!==r)return r;const i=this.getBaseTargetFromProps(this.props,e);return void 0===i||Jm(i)?void 0!==this.initialValues[e]&&void 0===r?void 0:this.baseTarget[e]:i}on(e,t){return this.events[e]||(this.events[e]=new tb),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}}class ES extends TS{constructor(){super(...arguments),this.KeyframeResolver=jv}sortInstanceNodePosition(e,t){return 2&e.compareDocumentPosition(t)?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:n}){delete t[e],delete n[e]}}class CS extends ES{constructor(){super(...arguments),this.type="html"}readValueFromInstance(e,t){if(Zm.has(t)){const e=Bv(t);return e&&e.default||0}{const r=(n=e,window.getComputedStyle(n)),i=(rg(t)?r.getPropertyValue(t):r[t])||0;return"string"==typeof i?i.trim():i}var n}measureInstanceViewportBox(e,{transformPagePoint:t}){return iw(e,t)}build(e,t,n,r){Cg(e,t,n,r.transformTemplate)}scrapeMotionValuesFromProps(e,t,n){return Wg(e,t,n)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Jm(e)&&(this.childSubscription=e.on("change",(e=>{this.current&&(this.current.textContent=`${e}`)})))}renderInstance(e,t,n,r){Gg(e,t,n,r)}}class kS extends ES{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(Zm.has(t)){const e=Bv(t);return e&&e.default||0}return t=Vg.has(t)?t:xm(t),e.getAttribute(t)}measureInstanceViewportBox(){return jb()}scrapeMotionValuesFromProps(e,t,n){return Xg(e,t,n)}build(e,t,n,r){Bg(e,t,n,this.isSVGTag,r.transformTemplate)}renderInstance(e,t,n,r){Hg(e,t,0,r)}mount(e){this.isSVGTag=zg(e.tagName),super.mount(e)}}const AS=(e,t)=>Ym(e)?new kS(t,{enableHardwareAcceleration:!1}):new CS(t,{allowProjection:e!==El.Fragment,enableHardwareAcceleration:!0}),MS={...vb,...Py,...yS,layout:{ProjectionNode:gS,MeasureLayout:mw}},PS=Xm(((e,t)=>function(e,{forwardMotionProps:t=!1},n,r){return{...Ym(e)?ay:ly,preloadedFeatures:n,useRender:Ug(t),createVisualElement:r,Component:e}}(e,t,MS,AS)));var RS=function(){return RS=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},RS.apply(this,arguments)},IS=[n.Sand,n.WetSand,n.Gold,n.Slag,n.BurntSlag,n.FreezingIce,n.Spore,n.WetSpore,n.Petalium,n.Sandium,n.Gloom,n.Basalt];function DS(e){kl(e.state,k.FilterConfig);var t=(0,El.useRef)(null),n=(0,El.useState)("allow"),r=n[0],i=n[1];return e.state.session.windows.building.filterConfig?(0,um.jsx)("div",RS({className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",onClick:function(n){t.current&&!t.current.contains(n.target)&&(e.state.session.windows.building.filterConfig=!1,Cl(e.state,k.FilterConfig))}},{children:(0,um.jsx)("div",RS({ref:t,style:{height:"400px",width:"300px",transform:"scale(".concat(qf(e.state),")"),transformOrigin:"center"}},{children:(0,um.jsxs)(PS.div,RS({initial:{y:10},animate:{y:0},transition:{y:{duration:.1}},className:"h-full bg-black bg-opacity-85 p-4 shadow-lg ui-box card-2 overflow-y-auto"},{children:[(0,um.jsxs)("div",RS({className:"mb-4"},{children:[(0,um.jsxs)("div",RS({className:"flex items-center mb-2"},{children:[(0,um.jsx)("input",{type:"radio",id:"allow",name:"filterMode",value:"allow",checked:"allow"===r,onChange:function(){return i("allow")},className:"mr-2"}),(0,um.jsx)("label",RS({htmlFor:"allow",className:"text-white text-sm"},{children:"Allow only selected element through"}))]})),(0,um.jsxs)("div",RS({className:"flex items-center"},{children:[(0,um.jsx)("input",{type:"radio",id:"block",name:"filterMode",value:"block",checked:"block"===r,onChange:function(){return i("block")},className:"mr-2"}),(0,um.jsx)("label",RS({htmlFor:"block",className:"text-white text-sm"},{children:"Block selected element, allow everything else"}))]}))]})),(0,um.jsx)("div",RS({className:"grid grid-cols-2 gap-2"},{children:IS.map((function(e){var t;return{id:e,text:null!==(t=Ih[e].name)&&void 0!==t?t:"NO NAME"}})).map((function(t,n){return(0,um.jsx)("button",RS({className:"px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-md transition-colors duration-200 text-sm",onClick:function(){e.state.session.windows.building.filterConfig=!1,e.state.session.windows.building.open=!1,e.state.store.options.defaultFilter={elementType:t.id,mode:r},e.state.session.building.activeStructureType=d.FilterRight,Cl(e.state,k.FilterConfig),Cl(e.state,k.Management)}},{children:t.text}),n)}))}))]}))}))})):(0,um.jsx)(um.Fragment,{})}var FS,NS=function(){return NS=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},NS.apply(this,arguments)},LS=function(e){e.session.windows.building.open=!1,e.session.windows.inventory.open=!1,Cl(e,k.Management)},BS=function(e,t,n){return Hl(e.session.soundEngine,"click"),lc(e,gf(e)),t.type===o.Building?t.id===d.FilterRight?(e.session.windows.building.filterConfig=!0,void Cl(e,k.FilterConfig)):t.id===d.SoundBox?(e.session.windows.building.soundBoxConfig=!0,Cl(e,k.SoundBoxConfig),void LS(e)):(LS(e),e.session.building.activeStructureType=t.id,e.store.player.hotbar.activeSlotIndex=null,e.store.player.action=null,void Cl(e,k.Hotbar)):t.type===o.Tool||t.type===o.Weapon?(e.store.player.action={id:t.id,type:t.type},LS(e),e.store.player.hotbar.activeSlotIndex=null,e.session.building.activeStructureType=null,Cl(e,k.Hotbar),void zl(e,t)):void 0},OS=((FS={})[l.Demolisher]="x",FS[l.Copier]="copy",FS[l.Grabber]="grabber_icon",FS[l.Shovel]="shovel",FS[l.Gun]="gun_icon",FS[l.RocketLauncher]="rocket_launcher",FS[l.PipeRemover]="x",FS[l.Flamethrower]="flamethrower_icon",FS),zS=function(e,t){if(t.type===o.Tool||t.type===o.Weapon){var n=OS[t.id];return n||(n="default_icon"),{imageName:n,size:{width:16,height:16}}}var r=t.type===o.Building?Pf[t.id]:Pf[1];return r||(r=Pf[1]),r};function jS(t){var n=t.action;if(!n)return(0,um.jsx)("div",NS({className:"w-16 h-16 border border-black bg-gray-500 bg-opacity-25 relative",onDragOver:function(e){return e.preventDefault(),!1},onDrop:function(e){var n=JSON.parse(e.dataTransfer.getData("dragData"));t.state.store.player.hotbar.items[t.index]={id:n.action.id,type:n.action.type},Cl(t.state,t.parentComponentId)}},{children:void 0!==t.number&&(0,um.jsx)("span",NS({className:"absolute top-0 left-0 text-xs text-white bg-black bg-opacity-50 px-1 rounded-br"},{children:t.number}))}));var r=zS(t.state,n),i=t.state.session.rendering.images[r.imageName],s=t.parentComponentId===k.Hotbar,o=s&&t.state.store.player.hotbar.activeSlotIndex===t.index;return(0,um.jsxs)("div",NS({className:"\n            w-16 \n            h-16 \n            text-white \n            bg-black\n            border\n            bg-opacity-75\n            cursor-pointer \n            flex \n            justify-center \n            items-center \n            shadow-md\n            skew-x-0\n            relative\n            ".concat(o?"border-yellow-200 border-opacity-100":"border-slate-200 border-opacity-25 hover:border-opacity-50 ".concat(s?"":"item-button-transition"),"\n            active:scale-90\n        "),style:o?{boxShadow:"rgba(255, 255, 190, 0.4) 0px 0px 6px 2px"}:{},onDrop:function(e){if(s){var n=JSON.parse(e.dataTransfer.getData("dragData"));t.state.store.player.hotbar.items[t.index]={id:n.action.id,type:n.action.type},Cl(t.state,t.parentComponentId)}},onDragStart:function(e){e.dataTransfer.setData("dragData",JSON.stringify({action:n,index:t.index}))},onDragOver:function(e){return e.preventDefault(),!1},draggable:!0,onClick:function(){s?If(t.state,t.index):(BS(t.state,n,s),Cl(t.state,k.ShortcutHelper))},onMouseEnter:function(){return Hl(t.state.session.soundEngine,"blip",{playbackRate:4,volume:.05})}},{children:[(0,um.jsx)("div",NS({style:{width:"16px",height:"16px",overflow:"hidden",boxShadow:"rgba(255, 255, 190, 0.4) 0px 0px 6px 2px",outline:"1px solid black",backgroundColor:"rgba(255, 255, 255, 0.25)",pointerEvents:"none"}},{children:(0,um.jsx)("img",{src:i.image.src,style:{width:"16px",height:"16px",objectFit:"none",objectPosition:"top left",imageRendering:"pixelated",transform:"scale(".concat(r.size?r.size.width/e.cellSize/4:4,")"),transformOrigin:"top left"}})})),function(){if(n.id!==l.RocketLauncher)return null;for(var e=t.state.store.player.weaponsMeta.rocketLauncher.ammo,r=[],i=0;i<ac(t.state);i++)r.push((0,um.jsx)("div",{className:"w-1.5 h-1.5 m-0.5 ".concat(i<e.current?"bg-green-500":"bg-gray-500")},i));return(0,um.jsx)("div",NS({className:"absolute bottom-0.5 left-0.5 flex"},{children:r}))}(),void 0!==t.number&&(0,um.jsx)("span",NS({className:"absolute top-0 left-0 text-xs text-white bg-black bg-opacity-50 px-1 rounded-br"},{children:t.number}))]}))}var US=function(){return US=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},US.apply(this,arguments)};function GS(e){return kl(e.state,k.Hotbar),e.state.store.tutorial.active&&e.state.store.tutorial.currentStep<b.Hotbar?null:(0,um.jsxs)("div",US({className:"fixed bottom-4 left-0 right-0 mx-auto pointer-events-none",style:{transform:"scale(".concat(qf(e.state),")"),transformOrigin:"bottom",width:"fit-content"}},{children:[function(){var t=gf(e.state);if(!t||t.id!==l.RocketLauncher)return null;for(var n=e.state.store.player.weaponsMeta.rocketLauncher.ammo,r=[],i=0;i<ac(e.state);i++){var s=i===n.current;r.push((0,um.jsx)("div",{className:"w-3 h-3 m-1 ".concat(i<n.current?"bg-green-500":s?"bg-gray-500 animate-pulse":"bg-gray-500")},i))}return(0,um.jsx)("div",US({className:"flex justify-center mb-2"},{children:(0,um.jsx)("div",US({className:"flex"},{children:r}))}))}(),(0,um.jsx)("div",US({className:"flex justify-center gap-2 pointer-events-auto"},{children:e.state.store.player.hotbar.items.map((function(t,n){return(0,um.jsx)(jS,{number:n+1,state:e.state,action:t,index:n,parentComponentId:k.Hotbar},n)}))}))]}))}var VS=function(){return VS=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},VS.apply(this,arguments)},HS=function(e,t){return!!e.session.windows[t]&&e.session.windows[t].open},WS=function(e){var t={display:"flex",justifyContent:"space-between"};return e.active&&(t.borderColor="#ffe700"),(0,um.jsxs)("div",VS({className:"\n        w-48\n        text-white \n        bg-black\n        border\n        bg-opacity-25\n        rounded-tr-md rounded-bl-md\n        cursor-pointer \n        flex \n        justify-center \n        items-center \n        shadow-md\n        skew-x-0\n        active:scale-90\n        px-2\n        border-slate-200\n        border-opacity-100 \n        hover:border-opacity-0\n        item-button-transition\n        hover:text-[#ffe700]\n        overflow-hidden\n        before:ease before:absolute before:right-0 before:top-0 before:h-12 before:w-6 before:translate-x-12 before:rotate-6 before:bg-white before:opacity-10 before:duration-700 hover:before:-translate-x-44\n        relative\n    ",style:t,onClick:function(){Hl(e.state.session.soundEngine,"click"),e.onClick()},onMouseEnter:function(){return Hl(e.state.session.soundEngine,"blip",{playbackRate:4,volume:.05})}},{children:[(0,um.jsxs)("div",VS({className:"\n            tracking-wider\n        "},{children:[(0,um.jsx)("span",{children:e.text.charAt(0)}),(0,um.jsx)("span",VS({style:{color:"white"}},{children:e.text.slice(1)}))]})),(0,um.jsx)("span",VS({className:"text-outline",style:{color:"#ffe700"}},{children:e.hint}))]}))};function XS(e){return e.state.store.scene.active===x.MainMenu?(0,um.jsx)(um.Fragment,{}):(kl(e.state,k.Resources),(0,um.jsxs)("div",VS({className:" text-white flex gap-2"},{children:[(0,um.jsx)(WS,{state:e.state,text:"Inventory",hint:"[TAB]",active:HS(e.state,"inventory"),onClick:function(){Vp(e.state,"inventory"),e.state.session.windows.inventory.open=!0,Cl(e.state,k.Management)}}),(0,um.jsx)(WS,{state:e.state,text:"Building",hint:"[Q]",active:HS(e.state,"building"),onClick:function(){Vp(e.state,"building"),zu(e.state,b.OpenBuildMenu),e.state.session.windows.building.open=!0,Cl(e.state,k.Management)}}),(0,um.jsx)(WS,{state:e.state,text:"Research",hint:"[T]",active:HS(e.state,"techTree"),onClick:function(){Pc(e.state),Vp(e.state,"techTree"),zu(e.state,b.OpenTechTree),e.state.session.windows.techTree.open=!0,Cl(e.state,k.Management)}}),(0,um.jsx)(WS,{state:e.state,text:"Upgrades",hint:"[U]",active:HS(e.state,"upgrades"),onClick:function(){Vp(e.state,"upgrades"),e.state.session.windows.upgrades.open=!0,Cl(e.state,k.Management)}})]})))}var $S=function(){return $S=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},$S.apply(this,arguments)},YS=function(e){return(0,um.jsx)("div",$S({className:"\n            w-24\n            text-white \n            bg-black\n            bg-opacity-75\n            border\n            rounded-tr-md rounded-bl-md\n            cursor-pointer \n            shadow-md\n            skew-x-0\n            active:scale-90\n            px-2\n            item-button-transition\n            hover:text-[#ffe700]\n            overflow-hidden\n            ".concat(e.isResearched?"border-green-400":e.isActive?"border-yellow-200":"border-slate-200 border-opacity-25 hover:border-opacity-50","\n          "),onClick:e.onClick,onMouseEnter:function(){return Hl(e.state.session.soundEngine,"blip",{playbackRate:4,volume:.05})}},{children:e.children}))},qS=function(e){var t=(0,El.useState)(null),n=t[0],r=t[1],i=(0,El.useState)(!1),s=i[0],o=i[1],a=function(e){return Of().map((function(t){return Lf(Nf(t,e))}))}(e.state),l=function(t){return(0,um.jsxs)("div",$S({className:"flex flex-col items-center"},{children:[(0,um.jsxs)(YS,$S({state:e.state,onClick:function(){t.status!==S.Unknown&&t.status!==S.Visible&&r(t)},isActive:n&&n.id===t.id,isResearched:e.state.store.player.tech[t.id]},{children:[(0,um.jsx)("div",{children:function(){switch(t.status){case S.Unknown:return(0,um.jsx)(um.Fragment,{children:(0,um.jsx)("span",{children:"???"})});case S.Visible:default:return(0,um.jsxs)(um.Fragment,{children:[(0,um.jsx)("span",{children:t.name.charAt(0)}),(0,um.jsx)("span",$S({className:"text-xs tracking-wider"},{children:t.name.slice(1)}))]})}}()}),function(){switch(t.status){case S.Researched:return(0,um.jsx)("span",$S({className:"text-green-400"},{children:"✓"}));case S.Available:return(0,um.jsxs)("span",$S({className:"text-outline",style:{color:"#8aff4b"}},{children:["$",t.cost]}));case S.Visible:return(0,um.jsx)("span",$S({className:"text-outline text-xs",style:{color:"#8aff4b"}},{children:"🔒"}));case S.Unknown:default:return(0,um.jsx)("span",$S({className:"text-outline",style:{color:"#8aff4b"}},{children:" "}))}}()]})),t.children&&t.children.length>0&&(0,um.jsxs)(um.Fragment,{children:[(0,um.jsx)("div",{className:"w-px h-8 bg-gray-400"}),(0,um.jsxs)("div",$S({className:"flex flex-col items-center"},{children:[t.children.length>1&&(0,um.jsx)("div",{className:"w-full h-px bg-gray-400",style:$S({},t.id===w.Guns1&&t.status!==S.Unknown&&t.status!==S.Visible?{width:"545px",marginLeft:"-63px"}:{})}),(0,um.jsx)("div",$S({className:"flex justify-center space-x-8",style:{width:t.id===w.Refining1?"608px":null}},{children:t.children.map((function(e){return(0,um.jsx)("div",$S({className:"flex flex-col items-center"},{children:l(e)}),e.id)}))}))]}))]})]}),t.id)};return(0,um.jsxs)("div",$S({className:"overflow-auto pl-2 relative"},{children:[(0,um.jsx)("div",$S({className:"flex justify-end"},{children:l(a[0])})),(0,um.jsx)("div",$S({className:"absolute top-0 left-0 bg-black bg-opacity-75 p-4 shadow-lg ui-box w-1/2 text-white",style:{border:"1px solid rgb(30 41 59)"}},{children:n?(0,um.jsx)(KS,{state:e.state,tech:n,onResearch:function(t){if(!zf(e.state,t))return o(!0),void setTimeout((function(){return o(!1)}),820)},unlockFailed:s}):(0,um.jsx)("p",{children:"Select a tech."})})),(0,um.jsxs)("p",$S({className:"text-slate-300 text-center text-sm italic mt-4"},{children:[(0,um.jsx)("em",$S({style:{color:"#fff"}},{children:"Tip"})),": Every ",(0,um.jsx)("em",$S({style:{color:"#8aff4b"}},{children:"$"}))," is one ",(0,um.jsx)("em",$S({style:{color:"#ffe700"}},{children:"gold"}))," pixel currently inside a ",(0,um.jsx)("em",$S({style:{color:"white"}},{children:"collector"})),"."]}))]}))},KS=function(e){var t=e.state,n=e.tech,r=e.onResearch,i=e.unlockFailed;return(0,um.jsxs)("div",{children:[(0,um.jsx)("h3",$S({className:"text-lg mb-2"},{children:n.name})),n.description&&(0,um.jsx)("p",$S({className:"text-sm mb-2"},{children:n.description})),!t.store.player.tech[n.id]&&!n.unavailable&&(0,um.jsxs)(um.Fragment,{children:[(0,um.jsxs)("p",$S({className:"text-2xl"},{children:["Cost: ",(0,um.jsx)("span",$S({className:"text-[#8aff4b]"},{children:"$"})),n.cost]})),(0,um.jsx)(PS.button,$S({className:"mt-2 px-4 py-2 bg-black border text-white ".concat(i?"border-red-500":"border-green-400"),onClick:function(){return r(n)},animate:i?"wiggle":"",variants:{wiggle:{x:[0,5,-5,5,0],transition:{duration:.4,repeat:1,repeatType:"reverse"}}},onMouseEnter:function(){return Hl(t.session.soundEngine,"blip",{playbackRate:4,volume:.05})}},{children:"Research"}))]}),n.unavailable&&(0,um.jsx)("p",{children:"Not available in demo..."})]})},ZS=function(){return ZS=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},ZS.apply(this,arguments)},QS=function(e){var t=e.state,n=e.upgrade,r=e.itemId,i=e.onUpgrade,s=e.onSetLevel,o=(0,El.useState)(0),a=o[0],l=o[1],u=t.store.upgrades[r][n.id].availableLevel,c=t.store.upgrades[r][n.id].level,h=u>=n.maxLevel,d=n.oneOff?u>=2?(0,um.jsx)("div",ZS({className:"cursor-pointer mt-1 w-4 h-4",onClick:function(){s(2===c?1:2)}},{children:(0,um.jsx)("input",{type:"checkbox",checked:2===c,readOnly:!0,className:"w-4 h-4 accent-fuchsia-400 pointer-events-none"})})):(0,um.jsx)("div",{className:"w-4 h-4 mt-1 bg-gray-600"}):(0,um.jsx)("div",ZS({className:"flex gap-1 mt-1"},{children:Array(n.maxLevel).fill(0).map((function(e,t){return(0,um.jsx)("div",{className:"w-2 h-2 ".concat(0===t?"":"rounded-full"," cursor-pointer ").concat(t<u?0===t?"":"border-2 border-fuchsia-400 bg-black":"bg-gray-600"," ").concat(t<c?0===t?"bg-gray-800":"bg-fuchsia-400":""),onClick:function(){t<u&&s(t+1)}},t)}))})),f=n.costs[u-1];return(0,um.jsxs)("div",ZS({className:"flex items-center justify-between bg-black bg-opacity-75 p-3 rounded ui-box",style:{border:"1px solid rgb(30 41 59)"}},{children:[(0,um.jsxs)("div",{children:[(0,um.jsx)("div",ZS({className:"text-white font-medium"},{children:n.name})),(0,um.jsx)("div",ZS({className:"text-slate-400 text-sm"},{children:n.description})),d]}),(0,um.jsx)(PS.button,ZS({animate:a?{x:[0,-10,10,-10,10,0],transition:{duration:.4}}:{},className:"px-4 py-2 rounded ".concat(h?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-slate-800 hover:bg-slate-700 text-white"),onClick:function(){Hl(t.session.soundEngine,"click"),!h&&t.store.resources.fluxite<f&&l((function(e){return e+1})),i()},onMouseEnter:function(){return Hl(t.session.soundEngine,"blip",{playbackRate:4,volume:.05})},disabled:h},{children:h?"MAX":(0,um.jsxs)("span",{children:[f," ",(0,um.jsx)("span",ZS({className:"text-fuchsia-400"},{children:"⬢"}))]})}),a)]}))};function JS(e){var t=e.state;kl(t,k.Upgrades);var n=Uu.filter((function(e){var n;return!(null===(n=e.requirement)||void 0===n?void 0:n.tech)||Bf(t,e.requirement.tech)})),r=(0,El.useState)(n[0]),i=r[0],s=r[1],o=(0,El.useState)(!1),a=o[0],l=o[1],u=(0,El.useRef)(null),c=function(e){e&&l(e.scrollHeight-e.scrollTop-e.clientHeight>10)};return t.store.progression.upgradesUnlocked?(0,um.jsxs)("div",ZS({className:"flex gap-8 h-full overflow-hidden",style:{height:"598px"}},{children:[(0,um.jsx)("div",ZS({className:"w-48 bg-black bg-opacity-75 p-4 rounded ui-box h-fit",style:{border:"1px solid rgb(30 41 59)"}},{children:n.map((function(e){return(0,um.jsxs)("button",ZS({className:"\n                            w-full\n                            text-left\n                            p-2\n                            text-white \n                            bg-black\n                            border\n                            rounded-tr-md \n                            rounded-bl-md\n                            cursor-pointer \n                            shadow-md\n                            skew-x-0\n                            mb-2\n                            px-2\n                            border-slate-200\n                            ".concat(i.name===e.name?"border-opacity-100 text-[#ffe700]":"border-opacity-25 hover:border-opacity-50","\n                            item-button-transition\n                            hover:text-[#ffe700]\n                            overflow-hidden\n                            before:ease \n                            before:absolute \n                            before:right-0 \n                            before:top-0 \n                            before:h-12 \n                            before:w-6 \n                            before:translate-x-12 \n                            before:rotate-6 \n                            before:bg-white \n                            before:opacity-10 \n                            before:duration-700 \n                            hover:before:-translate-x-44\n                            relative\n                            left-0\n                            hover:left-2\n                        "),onClick:function(){Hl(t.session.soundEngine,"click"),s(e)},onMouseEnter:function(){return Hl(t.session.soundEngine,"blip",{playbackRate:4,volume:.05})}},{children:[(0,um.jsx)("span",{children:e.name.charAt(0)}),(0,um.jsx)("span",ZS({style:{color:"white"}},{children:e.name.slice(1)}))]}),e.name)}))})),(0,um.jsxs)("div",ZS({className:"flex-1 relative"},{children:[(0,um.jsx)("div",ZS({className:"overflow-y-auto pr-4",style:{height:"100%"},onScroll:function(e){c(e.currentTarget)},ref:function(e){u.current=e,c(e)}},{children:i.items.map((function(e){var n=!e.requirement||e.requirement.item&&t.store.player.inventory.some((function(t){return t.id===e.requirement.item}))||e.requirement.building&&t.store.player.buildings.includes(e.requirement.building);return n?(0,um.jsxs)("div",ZS({className:"mb-6"},{children:[(0,um.jsx)("h3",ZS({className:"text-white text-xl mb-3"},{children:e.name})),(0,um.jsx)("div",ZS({className:"space-y-3"},{children:e.upgrades.map((function(n){return(0,um.jsx)(QS,{state:t,upgrade:n,itemId:e.id,onUpgrade:function(){return function(e,n){var r=Uu.find((function(t){return t.items.some((function(t){return t.id===e}))})),i=null==r?void 0:r.items.find((function(t){return t.id===e})),s=null==i?void 0:i.upgrades.find((function(e){return e.id===n}));if(s){var o=t.store.upgrades[e][n].availableLevel,a=s.costs[o-1];t.store.resources.fluxite>=a&&o<s.maxLevel&&(Hl(t.session.soundEngine,"research"),t.store.upgrades[e][n].availableLevel+=1,t.store.upgrades[e][n].level=t.store.upgrades[e][n].availableLevel,t.store.resources.fluxite-=a,"scanner"===s.id&&Mu(t,"upgrade_grabber"),Cl(t,k.Upgrades),Cl(t,k.Resources))}}(e.id,n.id)},onSetLevel:function(r){return i=e.id,s=n.id,void((o=r)<=t.store.upgrades[i][s].availableLevel&&(t.store.upgrades[i][s].level=o,Cl(t,k.Upgrades)));var i,s,o}},n.name)}))}))]}),e.name):null}))})),a&&(0,um.jsx)("div",ZS({className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-white animate-bounce cursor-pointer",onClick:function(){u.current&&u.current.scrollTo({top:u.current.scrollHeight,behavior:"smooth"})}},{children:"↓"}))]}))]})):(0,um.jsxs)("div",ZS({className:"text-white text-center mt-4"},{children:["Mine ",(0,um.jsx)("span",ZS({className:"text-fuchsia-400"},{children:"Fluxite"}))," to unlock."]}))}var e_=function(){return e_=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},e_.apply(this,arguments)},t_=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},n_=[l.Demolisher,l.Copier,l.PipeRemover],r_=function(e){var t=function(e){if(e.session.windows.building.open){var t=e.store.player.buildings.map((function(e){var t=md[e];return{type:o.Building,id:e,name:t.name,description:t.description}})),n=e.store.player.inventory.filter((function(e){return n_.includes(e.id)})).map((function(e){return{type:o.Tool,id:e.id,name:e.name,description:e.description}}));return t_(t_([],t,!0),n,!0)}return e.session.windows.inventory.open?e.store.player.inventory.filter((function(e){return!n_.includes(e.id)})).map((function(e){return{type:e.itemType===a.Tool?o.Tool:o.Weapon,id:e.id,name:e.name,description:e.description}})):[]}(e.state),n=(0,El.useState)(null),r=n[0],i=n[1];return(0,um.jsxs)("div",e_({className:"flex gap-8"},{children:[(0,um.jsx)("div",e_({className:"grid grid-cols-5 gap-4 w-full"},{children:t.map((function(t,n){return(0,um.jsxs)("div",e_({className:"text-center text-slate-50 text-xs w-16",onMouseEnter:function(){return i(t)}},{children:[(0,um.jsx)(jS,{state:e.state,action:t,index:n,parentComponentId:k.Management}),(0,um.jsx)("p",e_({className:"mt-2"},{children:t.name}))]}),n)}))})),(0,um.jsx)("div",e_({className:"bg-black bg-opacity-75 p-4 shadow-lg ui-box w-full text-white",style:{border:"1px solid rgb(30 41 59)"}},{children:(0,um.jsxs)("div",e_({style:{width:"341px",overflow:"hidden"}},{children:[(0,um.jsx)("p",e_({className:"mb-2 text-lg"},{children:r?r.name:"Block"})),(0,um.jsx)("p",e_({className:"text-sm"},{children:r?r.description:"Basic building."}))]}))}))]}))};function i_(e){kl(e.state,k.Management);var t=(0,El.useRef)(null),n=e.state.session.windows.building.open||e.state.session.windows.inventory.open,r=e.state.session.windows.techTree.open,i=e.state.session.windows.upgrades.open;return n||r||i?(0,um.jsx)("div",e_({className:"fixed inset-0",onClick:function(n){t.current&&!t.current.contains(n.target)&&(e.state.session.windows.building.open=!1,e.state.session.windows.inventory.open=!1,e.state.session.windows.techTree.open=!1,e.state.session.windows.upgrades.open=!1,Cl(e.state,k.Management))}},{children:(0,um.jsx)("div",e_({ref:t,className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"},{children:(0,um.jsx)("div",e_({style:{height:"700px",transform:"scale(".concat(qf(e.state),")"),transformOrigin:"center"}},{children:(0,um.jsxs)(PS.div,e_({initial:{y:10},animate:{y:0},transition:{y:{duration:.1}},className:"h-full bg-black bg-opacity-85 p-4 shadow-lg ui-box card-2 flex flex-col"},{children:[(0,um.jsx)(XS,{state:e.state}),(0,um.jsx)(PS.div,{initial:{width:0},animate:{width:"100%"},transition:{delay:.1,duration:.1},className:"separator"}),(0,um.jsxs)("div",e_({className:"flex-grow overflow-auto"},{children:[n&&(0,um.jsx)(r_,{state:e.state}),r&&(0,um.jsx)(qS,{state:e.state}),i&&(0,um.jsx)(JS,{state:e.state})]})),n&&(0,um.jsxs)("div",e_({className:"text-slate-300 text-sm italic text-center mt-4"},{children:["Tip: Drag and drop ",(0,um.jsx)("em",e_({style:{color:"#ffe700"}},{children:"items"}))," or ",(0,um.jsx)("em",e_({style:{color:"#ffe700"}},{children:"buildings"}))," to the hotbar for quick access."]}))]}))}))}))})):null}var s_=function(){return s_=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},s_.apply(this,arguments)},o_=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,a)}l((r=r.apply(e,t||[])).next())}))},a_=function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};function l_(e){var t=this,n=e.state,r=e.onClose,i=(0,El.useState)([]),s=i[0],o=i[1],a=(0,El.useState)(null),l=a[0],u=a[1],c=(0,El.useState)(""),h=c[0],d=c[1],f=(0,El.useRef)(null);return(0,El.useEffect)((function(){o_(t,void 0,void 0,(function(){var e,t,r,i;return a_(this,(function(s){switch(s.label){case 0:return"electron"!==n.session.runtime?[3,2]:[4,window.electron.getSaveFiles()];case 1:return e=s.sent(),t=e.filter((function(e){return"autosave"!==e.name})).map((function(e){return{id:e.id,metaData:e}})).sort((function(e,t){return new Date(t.metaData.timestamp).getTime()-new Date(e.metaData.timestamp).getTime()})),o(t),[2];case 2:return r=window.indexedDB,(i=r.open("SandustryDatabase",1)).onsuccess=function(){var e=i.result.transaction("SandustryObjectStore","readonly").objectStore("SandustryObjectStore").openCursor(),t=[];e.onsuccess=function(e){var n=e.target.result;if(n)"autosave"!==n.value.id&&t.push({id:n.value.id,metaData:n.value.metaData}),n.continue();else{var r=t.sort((function(e,t){var n,r;return new Date((null===(n=t.metaData)||void 0===n?void 0:n.timestamp)||0).getTime()-new Date((null===(r=e.metaData)||void 0===r?void 0:r.timestamp)||0).getTime()}));o(r)}}},[2]}}))}))}),[]),(0,um.jsx)("div",s_({className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",onClick:function(e){f.current&&!f.current.contains(e.target)&&r()}},{children:(0,um.jsx)("div",s_({ref:f,style:{transform:"scale(".concat(qf(n),")"),transformOrigin:"center"}},{children:(0,um.jsxs)(PS.div,s_({initial:{y:10},animate:{y:0},transition:{y:{duration:.1}},className:"h-full bg-black bg-opacity-85 p-4 shadow-lg ui-box card-2 text-white"},{children:[(0,um.jsx)("h2",s_({className:"text-2xl font-bold mb-4"},{children:"Save Game"})),(0,um.jsx)("div",s_({className:"mb-4"},{children:(0,um.jsx)("input",{type:"text",value:h,onChange:function(e){d(e.target.value),u(null)},onFocus:function(){return u(null)},className:"w-full border p-2 rounded bg-black text-white border-slate-600 focus:border-slate-400 outline-none",placeholder:"Enter new save name..."})})),s.length>0&&(0,um.jsxs)(um.Fragment,{children:[(0,um.jsx)("div",s_({className:"text-lg font-semibold mb-2"},{children:"Or select existing save:"})),(0,um.jsx)("ul",s_({className:"space-y-4 mb-4 max-h-[40vh] overflow-y-auto pr-2"},{children:s.map((function(e){var t,n;return(0,um.jsx)("li",s_({className:"\n                                            p-3 rounded-lg transition-all duration-200 border cursor-pointer\n                                            ".concat(l===e.id?"bg-slate-800 border-slate-600":"border-transparent hover:bg-slate-900","\n                                        "),onClick:function(){u(e.id),d("")}},{children:(0,um.jsxs)("div",s_({className:"flex flex-col"},{children:[(0,um.jsx)("span",s_({className:"text-lg font-semibold mb-1"},{children:(null===(t=e.metaData)||void 0===t?void 0:t.name)||e.id})),(null===(n=e.metaData)||void 0===n?void 0:n.timestamp)&&(0,um.jsx)("span",s_({className:"text-sm text-gray-400"},{children:new Date(e.metaData.timestamp).toLocaleString()}))]}))}),e.id)}))}))]}),(0,um.jsx)("button",s_({onClick:function(){var e;if(l||h){if(h)cp(n,{type:"new",name:h});else if(l){var t=s.find((function(e){return e.id===l}));t&&cp(n,{type:"existing",id:t.id,name:null===(e=t.metaData)||void 0===e?void 0:e.name})}Al(n,"Saving..."),n.session.windows.menu.open=!1,setTimeout((function(){Cl(n,k.Menu),Op(n),Yl(n)}),1e3),r()}},disabled:!h&&!l,className:"\n                            w-full text-white bg-black border rounded-tr-lg rounded-bl-lg cursor-pointer shadow-md px-4 py-2\n                            border-slate-200 border-opacity-100 hover:border-opacity-0 item-button-transition hover:text-[#ffe700]\n                            overflow-hidden before:ease before:absolute before:right-0 before:-top-4 before:h-20 before:w-6 \n                            before:translate-x-12 before:rotate-6 before:bg-white before:opacity-10 before:duration-700 \n                            hover:before:-translate-x-52 relative left-0 hover:left-2 pointer-events-auto\n                            ".concat(h||l?"":"opacity-50 cursor-not-allowed hover:border-opacity-100 hover:text-white hover:left-0","\n                        "),onMouseEnter:function(){return Hl(n.session.soundEngine,"blip",{volume:n.session.settings.sound.sfxVolume/Gl*.1,ignoreGlobalVolume:!0})}},{children:"Save"}))]}))}))}))}function u_(e){var t=window.location.protocol+"//"+window.location.host+window.location.pathname,n=!1===e?t:t+"?"+e;window.history.replaceState({},"",n),window.location.reload()}var c_=function(){return c_=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},c_.apply(this,arguments)},h_={open:{opacity:1,y:0,transition:{type:"spring",stiffness:300,damping:24}},closed:{opacity:0,y:20,scale:1},active:{scale:.95}},d_=function(e){return(0,um.jsxs)(PS.div,c_({variants:h_,whileTap:"active",className:"\n        w-64\n        text-3xl\n        leading-10\n        tracking-wider\n        text-white \n        bg-black\n        border\n        rounded-tr-lg rounded-bl-lg\n        cursor-pointer \n        shadow-md\n        skew-x-0\n        mb-2\n        px-2\n        border-slate-200\n        border-opacity-100 \n        hover:border-opacity-0\n        item-button-transition\n        hover:text-[#ffe700]\n        overflow-hidden\n        before:ease before:absolute before:right-0 before:-top-4 before:h-20 before:w-6 before:translate-x-12 before:rotate-6 before:bg-white before:opacity-10 before:duration-700 hover:before:-translate-x-52\n        relative\n        left-0\n        hover:left-2\n        pointer-events-auto\n    ",style:{outline:"#000 solid 1px"},onClick:function(){Hl(e.state.session.soundEngine,"click",{volume:e.state.session.settings.sound.sfxVolume/Gl*.4,ignoreGlobalVolume:!0}),e.onClick()},onMouseEnter:function(){return Hl(e.state.session.soundEngine,"blip",{volume:e.state.session.settings.sound.sfxVolume/Gl*.1,ignoreGlobalVolume:!0})}},{children:[(0,um.jsx)("span",{children:e.text.charAt(0)}),(0,um.jsx)("span",c_({style:{color:"white"}},{children:e.text.slice(1)}))]}))};function f_(t){kl(t.state,k.Menu);var n=(0,El.useRef)(null),r=(0,El.useState)(!1),i=r[0],s=r[1];return t.state.session.windows.menu.open?(0,um.jsx)("div",c_({className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",onClick:function(e){n.current&&!n.current.contains(e.target)&&(s(!1),t.state.session.windows.menu.open=!1,Cl(t.state,k.Menu),Op(t.state),Yl(t.state))}},{children:(0,um.jsxs)("div",c_({ref:n,style:{transform:"scale(".concat(qf(t.state),")"),transformOrigin:"center"}},{children:[(0,um.jsxs)(PS.div,c_({initial:{y:10},animate:{y:0},transition:{y:{duration:.1}},className:"h-full"},{children:[(0,um.jsx)(d_,{state:t.state,text:"Continue",onClick:function(){t.state.session.windows.menu.open=!1,Cl(t.state,k.Menu),Op(t.state),Yl(t.state)}}),(0,um.jsx)(d_,{state:t.state,onClick:function(){return s(!0)},text:"Save"}),(0,um.jsx)(d_,{state:t.state,text:"Options",onClick:function(){t.state.session.windows.options.open=!0,Cl(t.state,k.Options)}}),(0,um.jsx)(d_,{state:t.state,text:"Exit",onClick:function(){u_(!1)}}),(0,um.jsxs)(PS.a,c_({href:"https://discord.gg/HJNk5eMnmt",target:"_blank",rel:"noopener noreferrer",variants:h_,className:"mt-4 flex items-center gap-2 bg-black border rounded-tr-lg rounded-bl-lg cursor-pointer shadow-md border-slate-200 border-opacity-100 hover:border-opacity-0 item-button-transition hover:left-2 relative pointer-events-auto active:bg-opacity-75 px-3 py-2",onClick:function(){return Hl(t.state.session.soundEngine,"click",{volume:t.state.session.settings.sound.sfxVolume/Gl*.4,ignoreGlobalVolume:!0})},onMouseEnter:function(){return Hl(t.state.session.soundEngine,"blip",{volume:t.state.session.settings.sound.sfxVolume/Gl*.1,ignoreGlobalVolume:!0})}},{children:[(0,um.jsx)("svg",c_({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 127 96",className:"w-8 h-8 fill-white"},{children:(0,um.jsx)("path",{d:"M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.7,77.7,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22h0C129.24,52.84,122.09,29.11,107.7,8.07ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5-12.74,11.44-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z"})})),(0,um.jsx)("span",c_({className:"text-white text-sm"},{children:"Join the Discord server"}))]})),(0,um.jsx)("div",c_({className:"mt-2 text-center text-xs text-white"},{children:e.version}))]})),i&&(0,um.jsx)(l_,{state:t.state,onClose:function(){return s(!1)}})]}))})):(0,um.jsx)(um.Fragment,{})}var p_=function(){return p_=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},p_.apply(this,arguments)},m_=[{tone:"C",octave:0},{tone:"D",octave:0},{tone:"E",octave:0},{tone:"G",octave:0},{tone:"C",octave:1},{tone:"D",octave:1},{tone:"E",octave:1},{tone:"G",octave:1},{tone:"C",octave:2},{tone:"D",octave:2},{tone:"E",octave:2},{tone:"G",octave:2}];function g_(e){return kl(e.state,k.SoundBoxConfig),e.state.session.windows.building.soundBoxConfig?(0,um.jsx)("div",p_({className:"w-72 h-48 \n    fixed \n    top-1/2 left-1/2 -translate-y-1/2 -translate-x-1/2\n    bg-yellow-500 drop-shadow-xl rounded-xl p-10"},{children:m_.map((function(t,n){return(0,um.jsxs)("button",p_({className:"w-10 h-10 bg-gray-500 rounded-full m-2",onClick:function(){e.state.session.soundBox.selectedNote=t,e.state.session.windows.building.soundBoxConfig=!1,e.state.session.building.activeStructureType=d.SoundBox,e.state.store.player.hotbar.activeSlotIndex=null,Cl(e.state,k.SoundBoxConfig)}},{children:[t.tone,t.octave]}),n)}))})):(0,um.jsx)(um.Fragment,{})}function y_(e,t){[...t].reverse().forEach((n=>{const r=e.getVariant(n);r&&ob(e,r),e.variantChildren&&e.variantChildren.forEach((e=>{y_(e,t)}))}))}function v_(){let e=!1;const t=new Set,n={subscribe:e=>(t.add(e),()=>{t.delete(e)}),start(n,r){Yy(e,"controls.start() should only be called after a component has mounted. Consider calling within a useEffect hook.");const i=[];return t.forEach((e=>{i.push(db(e,n,{transitionOverride:r}))})),Promise.all(i)},set:n=>(Yy(e,"controls.set() should only be called after a component has mounted. Consider calling within a useEffect hook."),t.forEach((e=>{!function(e,t){Array.isArray(t)?y_(e,t):"string"==typeof t?y_(e,[t]):ob(e,t)}(e,n)}))),stop(){t.forEach((e=>{!function(e){e.values.forEach((e=>e.stop()))}(e)}))},mount:()=>(e=!0,()=>{e=!1,n.stop()})};return n}var x_=function(){return x_=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},x_.apply(this,arguments)},b_=function(e){var t=function(){const e=qg(v_);return ym(e.mount,[]),e}(),n=e.state.store.resources[e.resourceType],r="gold"===e.resourceType?"$":"⬢",i="gold"===e.resourceType?"#8aff4b":"#d700e0";return(0,El.useEffect)((function(){t.start({scale:[1,1.1,1],color:["#ffffff",i,"#ffffff"],transition:{duration:.1}})}),[n,i]),(0,um.jsxs)("div",x_({className:"text-3xl px-2 text-outline",style:{background:"linear-gradient(to right, rgba(30, 41, 59, 0.25), transparent)"}},{children:[(0,um.jsx)("span",x_({style:{color:i,display:"inline-block",width:"24px",fontSize:"fluxite"===e.resourceType?"0.9em":"1em",verticalAlign:"fluxite"===e.resourceType?"text-bottom":"initial"}},{children:r})),(0,um.jsx)(PS.div,x_({animate:t,style:{display:"inline-block",transformOrigin:"left"}},{children:n}))]}))},w_=function(e){return(0,um.jsxs)("div",x_({className:"\n        w-52\n        text-white \n        bg-black\n        border\n        bg-opacity-25\n        rounded-tr-md rounded-bl-md\n        cursor-pointer \n        flex \n        justify-center \n        items-center \n        shadow-md\n        skew-x-0\n        active:scale-90\n        mb-2\n        px-2\n        border-slate-200\n        border-opacity-100 \n        hover:border-opacity-0\n        item-button-transition\n        hover:text-[#ffe700]\n        overflow-hidden\n        before:ease before:absolute before:right-0 before:top-0 before:h-12 before:w-6 before:translate-x-12 before:rotate-6 before:bg-white before:opacity-10 before:duration-700 hover:before:-translate-x-44\n        relative\n        left-0\n        hover:left-2\n    ",style:{display:"flex",justifyContent:"space-between"},onClick:function(){Hl(e.state.session.soundEngine,"click"),e.onClick()},onMouseEnter:function(){return Hl(e.state.session.soundEngine,"blip",{playbackRate:4,volume:.05})}},{children:[(0,um.jsxs)("div",x_({className:"\n            tracking-wider\n        "},{children:[(0,um.jsx)("span",{children:e.text.charAt(0)}),(0,um.jsx)("span",x_({style:{color:"white"}},{children:e.text.slice(1)}))]})),(0,um.jsx)("span",x_({className:"text-outline",style:{color:"#ffe700"}},{children:e.hint}))]}))};function S_(e){return kl(e.state,k.Resources),e.state.store.scene.active===x.MainMenu||e.state.store.tutorial.active&&e.state.store.tutorial.currentStep<b.OpenTechTree?(0,um.jsx)(um.Fragment,{}):(0,um.jsxs)("div",x_({className:"fixed top-4 left-4 text-white",style:{transform:"scale(".concat(qf(e.state),")"),transformOrigin:"top left"}},{children:[(0,um.jsxs)("div",x_({className:"mb-4"},{children:[(0,um.jsx)(b_,{state:e.state,resourceType:"gold"}),e.state.store.progression.upgradesUnlocked&&(0,um.jsx)(b_,{state:e.state,resourceType:"fluxite"})]})),(0,um.jsx)(w_,{state:e.state,text:"Inventory",hint:"[TAB]",onClick:function(){Vp(e.state,"inventory"),e.state.session.windows.inventory.open=!0,Cl(e.state,k.Management)}}),(0,um.jsx)(w_,{state:e.state,text:"Building",hint:"[Q]",onClick:function(){Vp(e.state,"building"),zu(e.state,b.OpenBuildMenu),e.state.session.windows.building.open=!0,Cl(e.state,k.Management)}}),(0,um.jsx)(w_,{state:e.state,text:"Research",hint:"[T]",onClick:function(){Pc(e.state),Vp(e.state,"techTree"),zu(e.state,b.OpenTechTree),e.state.session.windows.techTree.open=!0,Cl(e.state,k.Management)}}),(0,um.jsx)(w_,{state:e.state,text:"Upgrades",hint:"[U]",onClick:function(){Vp(e.state,"upgrades"),e.state.session.windows.upgrades.open=!0,Cl(e.state,k.Management)}})]}))}var __=function(){return __=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},__.apply(this,arguments)};function T_(e){var t=e.state,n=e.isOpen,r=e.onClose,i=e.title,s=e.children,o=e.width,a=void 0===o?"400px":o,l=e.height,u=void 0===l?"auto":l,c=(0,El.useRef)(null);return(0,um.jsx)("div",__({style:{display:n?"block":"none"}},{children:n&&(0,um.jsx)("div",__({className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",onClick:function(e){c.current&&!c.current.contains(e.target)&&r()}},{children:(0,um.jsx)("div",__({ref:c,style:{width:a,height:u,transform:"scale(".concat(qf(t),")"),transformOrigin:"center"}},{children:(0,um.jsxs)(PS.div,__({initial:{y:10,opacity:0},animate:{y:0,opacity:1},className:"h-full bg-black bg-opacity-85 p-4 shadow-lg ui-box card-2 max-h-[80vh] overflow-y-auto"},{children:[i&&(0,um.jsxs)("div",__({className:"flex justify-between items-center mb-4"},{children:[(0,um.jsx)("h2",__({className:"text-xl text-white"},{children:i})),(0,um.jsx)("button",__({className:"text-white hover:text-[#ffe700] transition-colors",onClick:function(){Hl(t.session.soundEngine,"click"),r()},onMouseEnter:function(){return Hl(t.session.soundEngine,"blip",{playbackRate:4,volume:.05})}},{children:"✕"}))]})),s]}))}))}))}))}var E_=function(){return E_=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},E_.apply(this,arguments)};function C_(){return(0,um.jsxs)("div",E_({className:"text-white space-y-6"},{children:[(0,um.jsxs)("div",{children:[(0,um.jsx)("h3",E_({className:"text-[#ffe700] text-lg mb-2"},{children:"Special Thanks"})),(0,um.jsxs)("ul",E_({className:"space-y-1"},{children:[(0,um.jsx)("li",E_({className:"flex items-center space-x-2 before:content-['★'] before:text-[#ffe700] before:mr-2"},{children:(0,um.jsx)("span",{children:"The amazing community"})})),(0,um.jsx)("li",E_({className:"flex space-x-2 before:content-['★'] before:text-[#ffe700] before:mr-2"},{children:(0,um.jsxs)("div",{children:[(0,um.jsx)("div",{children:"Early playtesters (let me know on Discord if you've been part of the playtest and want to be mentioned here!)"}),(0,um.jsxs)("ul",E_({className:"ml-6 mt-1"},{children:[(0,um.jsx)("li",E_({className:"before:content-['•'] before:mr-2 flex items-center"},{children:"cleverdumb"})),(0,um.jsx)("li",E_({className:"before:content-['•'] before:mr-2 flex items-center"},{children:"Dekadenri"})),(0,um.jsx)("li",E_({className:"before:content-['•'] before:mr-2 flex items-center"},{children:"DynamitThePlayer"})),(0,um.jsx)("li",E_({className:"before:content-['•'] before:mr-2 flex items-center"},{children:"Enjyko"})),(0,um.jsx)("li",E_({className:"before:content-['•'] before:mr-2 flex items-center"},{children:"hundlaser"})),(0,um.jsx)("li",E_({className:"before:content-['•'] before:mr-2 flex items-center"},{children:"Lottie"})),(0,um.jsx)("li",E_({className:"before:content-['•'] before:mr-2 flex items-center"},{children:"s4gan"})),(0,um.jsx)("li",E_({className:"before:content-['•'] before:mr-2 flex items-center"},{children:"ScarlettCatte"})),(0,um.jsx)("li",E_({className:"before:content-['•'] before:mr-2 flex items-center"},{children:"Spike"})),(0,um.jsx)("li",E_({className:"before:content-['•'] before:mr-2 flex items-center"},{children:"taylorryver"})),(0,um.jsx)("li",E_({className:"before:content-['•'] before:mr-2 flex items-center"},{children:"Vix"}))]}))]})}))]}))]}),(0,um.jsxs)("div",{children:[(0,um.jsx)("h3",E_({className:"text-[#ffe700] text-lg mb-2"},{children:"SFX"})),(0,um.jsxs)("ul",E_({className:"space-y-1 text-sm"},{children:[(0,um.jsxs)("li",{children:["London UK Ambience Feb 2013 04 by ",(0,um.jsx)("a",E_({href:"https://freesound.org/people/Carlvus/sounds/178689/",className:"text-blue-300 hover:text-blue-400"},{children:"Carlvus"}))]}),(0,um.jsxs)("li",{children:["Water splash 1 by ",(0,um.jsx)("a",E_({href:"https://freesound.org/people/swordofkings128/sounds/398038/",className:"text-blue-300 hover:text-blue-400"},{children:"swordofkings128"}))]}),(0,um.jsxs)("li",{children:["04-Vapor.wav by ",(0,um.jsx)("a",E_({href:"https://freesound.org/people/HidroLion/sounds/491706/",className:"text-blue-300 hover:text-blue-400"},{children:"HidroLion"}))]}),(0,um.jsxs)("li",{children:["Coin_Misc_05 by ",(0,um.jsx)("a",E_({href:"https://freesound.org/people/Valenspire/sounds/699534/",className:"text-blue-300 hover:text-blue-400"},{children:"Valenspire"}))]}),(0,um.jsxs)("li",{children:["icesplashes1.wav by ",(0,um.jsx)("a",E_({href:"https://freesound.org/people/plingativator/sounds/112152/",className:"text-blue-300 hover:text-blue-400"},{children:"plingativator"}))]}),(0,um.jsxs)("li",{children:["Head out of water by ",(0,um.jsx)("a",E_({href:"https://freesound.org/people/klankbeeld/sounds/648883/",className:"text-blue-300 hover:text-blue-400"},{children:"klankbeeld"}))]}),(0,um.jsxs)("li",{children:["fire2.wav by ",(0,um.jsx)("a",E_({href:"https://freesound.org/people/tc630/sounds/47835/",className:"text-blue-300 hover:text-blue-400"},{children:"tc630"}))]}),(0,um.jsxs)("li",{children:["Click by ",(0,um.jsx)("a",E_({href:"https://freesound.org/people/lebaston100/sounds/192277/",className:"text-blue-300 hover:text-blue-400"},{children:"lebaston100"}))]}),(0,um.jsxs)("li",{children:["computer_fan_humming by ",(0,um.jsx)("a",E_({href:"https://freesound.org/people/TheSounderGuy/sounds/746461/",className:"text-blue-300 hover:text-blue-400"},{children:"TheSounderGuy"}))]}),(0,um.jsxs)("li",{children:["RPG Sound Pack by ",(0,um.jsx)("a",E_({href:"https://opengameart.org/content/rpg-sound-pack",className:"text-blue-300 hover:text-blue-400"},{children:"artisticdude"}))]}),(0,um.jsxs)("li",{children:["Weapons and Apparel SFX Library by ",(0,um.jsx)("a",E_({href:"http://www.vehiclemusic.eu",className:"text-blue-300 hover:text-blue-400"},{children:"jan.schupke@gmail.com"}))]}),(0,um.jsxs)("li",{children:["Interface Sounds by ",(0,um.jsx)("a",E_({href:"https://kenney.nl/assets/interface-sounds",className:"text-blue-300 hover:text-blue-400"},{children:"Kenney"}))]}),(0,um.jsxs)("li",{children:["Gunshots by ",(0,um.jsx)("a",E_({href:"https://opengameart.org/content/gunshots",className:"text-blue-300 hover:text-blue-400"},{children:"kurt"}))]}),(0,um.jsxs)("li",{children:["9 explosion sounds by ",(0,um.jsx)("a",E_({href:"https://opengameart.org/content/9-explosion-sounds",className:"text-blue-300 hover:text-blue-400"},{children:"Unnamed"}))]}),(0,um.jsxs)("li",{children:["Freeze sound effect FX by ",(0,um.jsx)("a",E_({href:"https://freesound.org/people/antonsoederberg/sounds/685253/",className:"text-blue-300 hover:text-blue-400"},{children:"antonsoederberg"}))]}),(0,um.jsxs)("li",{children:["Flamethrower.wav by ",(0,um.jsx)("a",E_({href:"https://freesound.org/people/MATRIXXX_/sounds/459884/",className:"text-blue-300 hover:text-blue-400"},{children:"MATRIXXX_"}))]}),(0,um.jsxs)("li",{children:["Gas Torch Burn by ",(0,um.jsx)("a",E_({href:"https://freesound.org/people/SyntaxSeed/sounds/244230/",className:"text-blue-300 hover:text-blue-400"},{children:"SyntaxSeed"}))]}),(0,um.jsxs)("li",{children:["Sound Effects Pack by ",(0,um.jsx)("a",E_({href:"https://opengameart.org/content/sound-effects-pack",className:"text-blue-300 hover:text-blue-400"},{children:"OwlishMedia"}))]}),(0,um.jsxs)("li",{children:["Happy Machinery Loop by ",(0,um.jsx)("a",E_({href:"https://freesound.org/people/RavenWolfProds/sounds/564844/",className:"text-blue-300 hover:text-blue-400"},{children:"RavenWolfProds"}))]}),(0,um.jsxs)("li",{children:["Industrial Conveyor Belt by ",(0,um.jsx)("a",E_({href:"https://freesound.org/people/Kinoton/sounds/519027/",className:"text-blue-300 hover:text-blue-400"},{children:"Kinoton"}))]}),(0,um.jsxs)("li",{children:["Industrial ambiance by ",(0,um.jsx)("a",E_({href:"https://freesound.org/people/cedric_villain/sounds/323797/",className:"text-blue-300 hover:text-blue-400"},{children:"cedric_villain"}))]}),(0,um.jsxs)("li",{children:["Ambience: Machinery by ",(0,um.jsx)("a",E_({href:"https://freesound.org/people/Sheyvan/sounds/540221/",className:"text-blue-300 hover:text-blue-400"},{children:"Sheyvan"}))]}),(0,um.jsxs)("li",{children:["Oil burner ignition loop by ",(0,um.jsx)("a",E_({href:"https://freesound.org/people/gear_clinkz/sounds/547856/",className:"text-blue-300 hover:text-blue-400"},{children:"gear_clinkz"}))]}),(0,um.jsxs)("li",{children:["Conveyor belt by ",(0,um.jsx)("a",E_({href:"https://freesound.org/people/freemaster2/sounds/172350/",className:"text-blue-300 hover:text-blue-400"},{children:"freemaster2"}))]}),(0,um.jsxs)("li",{children:["Welding conveyor 4 LOOPs by ",(0,um.jsx)("a",E_({href:"https://freesound.org/people/scivirus/sounds/435732/",className:"text-blue-300 hover:text-blue-400"},{children:"scivirus"}))]}),(0,um.jsxs)("li",{children:["Good Jetpack sound Loop by ",(0,um.jsx)("a",E_({href:"https://freesound.org/people/MostyXS/sounds/512815/",className:"text-blue-300 hover:text-blue-400"},{children:"MostyXS"}))]}),(0,um.jsxs)("li",{children:["Jetpack Loop by ",(0,um.jsx)("a",E_({href:"https://freesound.org/people/jacksonacademyashmore/sounds/402816/",className:"text-blue-300 hover:text-blue-400"},{children:"jacksonacademyashmore"}))]}),(0,um.jsxs)("li",{children:["Gun Shot.wav by ",(0,um.jsx)("a",E_({href:"https://freesound.org/people/Bird_man/sounds/275151/",className:"text-blue-300 hover:text-blue-400"},{children:"Bird_man"}))]}),(0,um.jsxs)("li",{children:["Pistol Gun Cocking by ",(0,um.jsx)("a",E_({href:"https://freesound.org/people/EminYILDIRIM/sounds/543927/",className:"text-blue-300 hover:text-blue-400"},{children:"EminYILDIRIM"}))]}),(0,um.jsxs)("li",{children:["Sci-fi Sounds by ",(0,um.jsx)("a",E_({href:"https://kenney.nl/assets/sci-fi-sounds",className:"text-blue-300 hover:text-blue-400"},{children:"Kenney"}))]}),(0,um.jsxs)("li",{children:["Digging in wet course sand by ",(0,um.jsx)("a",E_({href:"https://freesound.org/people/f3bbbo/sounds/651292/",className:"text-blue-300 hover:text-blue-400"},{children:"f3bbbo"}))]}),(0,um.jsxs)("li",{children:["Shovel - Sand/Gravel/Snow by ",(0,um.jsx)("a",E_({href:"https://freesound.org/people/Bricklover/sounds/560957/",className:"text-blue-300 hover:text-blue-400"},{children:"Bricklover"}))]})]}))]}),(0,um.jsxs)("div",{children:[(0,um.jsx)("h3",E_({className:"text-[#ffe700] text-lg mb-2"},{children:"Demo Trailer Music"})),(0,um.jsx)("ul",E_({className:"space-y-1 text-sm"},{children:(0,um.jsxs)("li",{children:["Cyberpunk Beauty by ",(0,um.jsx)("a",E_({href:"https://opengameart.org/content/cyberpunk-beauty",className:"text-blue-300 hover:text-blue-400"},{children:"Tarush Singhal"}))]})}))]}),(0,um.jsxs)("div",E_({className:"text-sm text-gray-400 pt-4"},{children:["Version ",e.version]}))]}))}var k_=function(){return k_=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},k_.apply(this,arguments)},A_={open:{opacity:1,y:0,transition:{type:"spring",stiffness:300,damping:24}},closed:{opacity:0,y:20,scale:1},active:{scale:.95}},M_={open:{opacity:1,y:0,rotate:-6,transition:{delay:.8,duration:.3}},closed:{opacity:0,y:-10,rotate:-6}},P_={open:{opacity:1,x:0,transition:{delay:1.25,duration:.3}},closed:{opacity:0,x:20}},R_=function(){return(0,um.jsx)(PS.div,k_({variants:M_,initial:"closed",animate:"open",className:"absolute -top-16 bg-yellow-400 text-black px-4 py-1 font-bold text-lg rounded shadow-md"},{children:"Demo"}))},I_=function(e){return(0,um.jsxs)(PS.div,k_({variants:A_,className:"\n        w-64\n        text-3xl\n        leading-10\n        tracking-wider\n        text-white \n        bg-black\n        border\n        rounded-tr-lg rounded-bl-lg\n        cursor-pointer \n        shadow-md\n        skew-x-0\n        mb-2\n        px-2\n        border-slate-200\n        border-opacity-100 \n        hover:border-opacity-0\n        item-button-transition\n        hover:text-[#ffe700]\n        overflow-hidden\n        before:ease before:absolute before:right-0 before:-top-4 before:h-20 before:w-6 before:translate-x-12 before:rotate-6 before:bg-white before:opacity-10 before:duration-700 hover:before:-translate-x-52\n        relative\n        left-0\n        hover:left-2\n        pointer-events-auto\n        active:bg-opacity-75\n    ",style:{outline:"#000 solid 1px"},onClick:function(){Hl(e.state.session.soundEngine,"click"),e.onClick()},onMouseEnter:function(){return Hl(e.state.session.soundEngine,"blip")}},{children:[(0,um.jsx)("span",{children:e.text.charAt(0)}),(0,um.jsx)("span",k_({style:{color:"white"}},{children:e.text.slice(1)}))]}))};function D_(t){var n="electron"===t.state.session.runtime?window.electron.getLastPlayedGameSync():localStorage.getItem("lastPlayedGame"),r=n?JSON.parse(n).id:null,i=(0,El.useState)(!1),s=i[0],o=i[1];return t.state.store.scene.active!==x.MainMenu?(0,um.jsx)(um.Fragment,{}):(0,um.jsxs)(um.Fragment,{children:[(0,um.jsx)("div",k_({className:"fixed inset-0 flex items-center justify-center pointer-events-none mt-40",style:{transform:"scale(".concat(qf(t.state),")")}},{children:(0,um.jsxs)("div",k_({className:"flex items-start gap-8"},{children:[(0,um.jsxs)(PS.div,k_({initial:"closed",animate:"open",variants:{open:{transition:{delayChildren:.3,staggerChildren:.1}}},className:"bg-opacity-25 text-white flex flex-col items-center justify-center relative"},{children:[(0,um.jsx)(R_,{}),r&&(0,um.jsx)(I_,{state:t.state,text:"Continue",hint:"",onClick:function(){u_("db_load=".concat(r))}}),(0,um.jsx)(I_,{state:t.state,text:"New",hint:"[TAB]",onClick:function(){u_("new_game=true")}}),(0,um.jsx)(I_,{state:t.state,text:"Load",hint:"[U]",onClick:function(){t.state.session.windows.loader.open=!0,Cl(t.state,k.Loader)}}),(0,um.jsx)(I_,{state:t.state,text:"Options",hint:"[U]",onClick:function(){t.state.session.windows.options.open=!0,Cl(t.state,k.Options)}}),(0,um.jsx)(I_,{state:t.state,text:"Quit",hint:"[U]",onClick:function(){window.close()}})]})),(0,um.jsxs)("div",k_({className:"flex flex-col gap-4"},{children:[(0,um.jsxs)(PS.div,k_({initial:"closed",animate:"open",variants:{open:{transition:{delayChildren:.8,staggerChildren:.1}}},className:"flex flex-col"},{children:[(0,um.jsxs)(PS.a,k_({href:"https://discord.gg/HJNk5eMnmt",target:"_blank",rel:"noopener noreferrer",variants:A_,className:"flex items-center gap-2 bg-black border rounded-tr-lg rounded-bl-lg cursor-pointer shadow-md border-slate-200 border-opacity-100 hover:border-opacity-0 item-button-transition hover:left-2 relative pointer-events-auto active:bg-opacity-75 px-3 py-2",onClick:function(){return Hl(t.state.session.soundEngine,"click")},onMouseEnter:function(){return Hl(t.state.session.soundEngine,"blip")}},{children:[(0,um.jsx)("svg",k_({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 127 96",className:"w-8 h-8 fill-white"},{children:(0,um.jsx)("path",{d:"M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.7,77.7,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22h0C129.24,52.84,122.09,29.11,107.7,8.07ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5-12.74,11.44-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z"})})),(0,um.jsx)("span",k_({className:"text-white text-sm"},{children:"Join the Discord server"}))]})),(0,um.jsx)(PS.a,k_({href:"https://store.steampowered.com/app/2764460/Sandustry/",target:"_blank",rel:"noopener noreferrer",variants:A_,className:"mt-2 flex items-center gap-2 bg-black border rounded-tr-lg rounded-bl-lg cursor-pointer shadow-md border-slate-200 border-opacity-100 hover:border-opacity-0 item-button-transition hover:left-2 relative pointer-events-auto active:bg-opacity-75 px-3 py-2",onClick:function(){return Hl(t.state.session.soundEngine,"click")},onMouseEnter:function(){return Hl(t.state.session.soundEngine,"blip")}},{children:(0,um.jsxs)("span",k_({className:"text-white text-lg"},{children:["Wishlist on ",(0,um.jsx)("span",k_({className:"text-[#66c0f4]"},{children:"Steam"}))]}))}))]})),(0,um.jsxs)(PS.div,k_({initial:"closed",animate:"open",variants:P_,className:"w-64 bg-transparent border rounded-tr-lg rounded-bl-lg border-white border-opacity-100 p-4 pointer-events-auto"},{children:[(0,um.jsxs)("div",k_({className:"flex flex-col gap-2"},{children:[(0,um.jsxs)("a",k_({href:"https://lanttogames.itch.io/sandustry/devlog/872229/005-wrapping-up-phase-1",target:"_blank",rel:"noopener noreferrer",className:"text-black text-sm hover:text-white transition-colors",onClick:function(){return Hl(t.state.session.soundEngine,"click")},onMouseEnter:function(){return Hl(t.state.session.soundEngine,"blip",{playbackRate:4,volume:.05})}},{children:["🚀 Version ",e.version," Release Notes"]})),(0,um.jsx)("a",k_({href:"https://lanttogames.itch.io/sandustry/devlog",target:"_blank",rel:"noopener noreferrer",className:"text-black text-sm hover:text-white transition-colors",onClick:function(){return Hl(t.state.session.soundEngine,"click")},onMouseEnter:function(){return Hl(t.state.session.soundEngine,"blip",{playbackRate:4,volume:.05})}},{children:"📝 Development Blog"}))]})),(0,um.jsx)("div",k_({className:"mt-4 pt-4 border-t border-black border-opacity-25"},{children:(0,um.jsx)("button",k_({className:"text-black text-sm hover:text-white transition-colors",onClick:function(){Hl(t.state.session.soundEngine,"click"),o(!0)},onMouseEnter:function(){return Hl(t.state.session.soundEngine,"blip",{playbackRate:4,volume:.05})}},{children:"ℹ️ Credits"}))}))]}))]}))]}))})),(0,um.jsx)(T_,k_({state:t.state,isOpen:s,onClose:function(){return o(!1)},title:"Credits",width:"500px"},{children:(0,um.jsx)(C_,{})}))]})}function F_(){const e=(0,El.useRef)(!1);return ym((()=>(e.current=!0,()=>{e.current=!1})),[]),e}class N_ extends El.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function L_({children:e,isPresent:t}){const n=(0,El.useId)(),r=(0,El.useRef)(null),i=(0,El.useRef)({width:0,height:0,top:0,left:0}),{nonce:s}=(0,El.useContext)(fm);return(0,El.useInsertionEffect)((()=>{const{width:e,height:o,top:a,left:l}=i.current;if(t||!r.current||!e||!o)return;r.current.dataset.motionPopId=n;const u=document.createElement("style");return s&&(u.nonce=s),document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`\n          [data-motion-pop-id="${n}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${o}px !important;\n            top: ${a}px !important;\n            left: ${l}px !important;\n          }\n        `),()=>{document.head.removeChild(u)}}),[t]),(0,um.jsx)(N_,{isPresent:t,childRef:r,sizeRef:i,children:El.cloneElement(e,{ref:r})})}const B_=({children:e,initial:t,isPresent:n,onExitComplete:r,custom:i,presenceAffectsLayout:s,mode:o})=>{const a=qg(O_),l=(0,El.useId)(),u=(0,El.useMemo)((()=>({id:l,initial:t,isPresent:n,custom:i,onExitComplete:e=>{a.set(e,!0);for(const e of a.values())if(!e)return;r&&r()},register:e=>(a.set(e,!1),()=>a.delete(e))})),s?[Math.random()]:[n]);return(0,El.useMemo)((()=>{a.forEach(((e,t)=>a.set(t,!1)))}),[n]),El.useEffect((()=>{!n&&!a.size&&r&&r()}),[n]),"popLayout"===o&&(e=(0,um.jsx)(L_,{isPresent:n,children:e})),(0,um.jsx)(mm.Provider,{value:u,children:e})};function O_(){return new Map}const z_=e=>e.key||"",j_=({children:e,custom:t,initial:n=!0,onExitComplete:r,exitBeforeEnter:i,presenceAffectsLayout:s=!0,mode:o="sync"})=>{Yy(!i,"Replace exitBeforeEnter with mode='wait'");const a=(0,El.useContext)(Gm).forceRender||function(){const e=F_(),[t,n]=(0,El.useState)(0),r=(0,El.useCallback)((()=>{e.current&&n(t+1)}),[t]);return[(0,El.useCallback)((()=>ry.postRender(r)),[r]),t]}()[0],l=F_(),u=function(e){const t=[];return El.Children.forEach(e,(e=>{(0,El.isValidElement)(e)&&t.push(e)})),t}(e);let c=u;const h=(0,El.useRef)(new Map).current,d=(0,El.useRef)(c),f=(0,El.useRef)(new Map).current,p=(0,El.useRef)(!0);var m;if(ym((()=>{p.current=!1,function(e,t){e.forEach((e=>{const n=z_(e);t.set(n,e)}))}(u,f),d.current=c})),m=()=>{p.current=!0,f.clear(),h.clear()},(0,El.useEffect)((()=>()=>m()),[]),p.current)return(0,um.jsx)(um.Fragment,{children:c.map((e=>(0,um.jsx)(B_,{isPresent:!0,initial:!!n&&void 0,presenceAffectsLayout:s,mode:o,children:e},z_(e))))});c=[...c];const g=d.current.map(z_),y=u.map(z_),v=g.length;for(let e=0;e<v;e++){const t=g[e];-1!==y.indexOf(t)||h.has(t)||h.set(t,void 0)}return"wait"===o&&h.size&&(c=[]),h.forEach(((e,n)=>{if(-1!==y.indexOf(n))return;const i=f.get(n);if(!i)return;const p=g.indexOf(n);let m=e;if(!m){const e=()=>{h.delete(n);const e=Array.from(f.keys()).filter((e=>!y.includes(e)));if(e.forEach((e=>f.delete(e))),d.current=u.filter((t=>{const r=z_(t);return r===n||e.includes(r)})),!h.size){if(!1===l.current)return;a(),r&&r()}};m=(0,um.jsx)(B_,{isPresent:!1,onExitComplete:e,custom:t,presenceAffectsLayout:s,mode:o,children:i},z_(i)),h.set(n,m)}c.splice(p,0,m)})),c=c.map((e=>{const t=e.key;return h.has(t)?e:(0,um.jsx)(B_,{isPresent:!0,presenceAffectsLayout:s,mode:o,children:e},z_(e))})),(0,um.jsx)(um.Fragment,{children:h.size?c:c.map((e=>(0,El.cloneElement)(e)))})};var U_=function(){return U_=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},U_.apply(this,arguments)},G_=function(e){var t=(0,El.useState)(e.tutorialStep),n=t[0],r=t[1],i=(0,El.useState)(e.children),s=i[0],o=i[1],a=(0,El.useState)(!1),l=a[0],u=a[1];return(0,El.useEffect)((function(){e.tutorialStep!==n?(u(!0),r((function(e){return e+"_exiting"})),setTimeout((function(){r(e.tutorialStep),o(e.children),u(!1)}),300)):l||o(e.children)}),[e.tutorialStep,e.children]),(0,um.jsx)("div",U_({style:{transform:"scale(".concat(qf(e.state),")")}},{children:(0,um.jsx)(j_,U_({mode:"wait"},{children:(0,um.jsx)(PS.div,U_({initial:{opacity:0,y:-20,x:"-50%"},animate:{opacity:1,y:0,x:"-50%"},exit:{opacity:0,y:-20},transition:{duration:.3},style:{position:"fixed",top:"2rem",left:"50%",color:e.state.store.tutorial.transitioningToNextStep?"#8aff4b":"white"},className:"bg-black bg-opacity-85 p-4 shadow-lg ui-box card-2 text-center text-white text-2xl whitespace-nowrap"},{children:s}),n)}))}))},V_=function(e){kl(e.state,k.Tutorial);var t=e.state;if(e.state.store.scene.active!==x.Game)return null;if(!t.store.tutorial.active)return null;var n=null;switch(t.store.tutorial.currentStep){case b.Move:n="Use [W] [A] [S] [D] to move";break;case b.Dig:n="Use the mouse to dig: ".concat(t.store.tutorial.data.amount,"/5");break;case b.Hotbar:n="Press [2] to select the grabber";break;case b.PickUpSand:n="Click, hold and drag to pick up sand";break;case b.WetSand:n="Drop dry sand in water";break;case b.RefineWetSand:n=(0,um.jsxs)(um.Fragment,{children:[(0,um.jsx)("p",{children:"Pick up wet sand and shake it"}),(0,um.jsx)("p",U_({className:"mt-2 text-lg"},{children:"(move mouse back and forth)"})),(0,um.jsxs)("p",U_({className:"mt-2"},{children:["Refined gold: ",t.store.tutorial.data.amount,"/3"]}))]});break;case b.SellGold:n="Put gold in sell box: ".concat(t.store.resources.gold,"/20");break;case b.OpenTechTree:n="Open tech tree with [T]";break;case b.UnlockRefining:n="Research Refining 1";break;case b.OpenBuildMenu:n="Open build menu with [Q]";break;case b.BuildShaker:n="Build shakers: ".concat(t.store.tutorial.data.amount,"/5");break;case b.RefineGoldWithShaker:n="Drop wet sand on shakers";break;case b.UnlockLogistics:n="Research Logistics 1"}return n?(0,um.jsx)(G_,U_({tutorialStep:t.store.tutorial.currentStep,state:e.state},{children:n})):null},H_=function(){return H_=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},H_.apply(this,arguments)},W_=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,a)}l((r=r.apply(e,t||[])).next())}))},X_=function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};const $_=function(e){kl(e.state,k.Loader);var t=(0,El.useState)([]),n=t[0],r=t[1],i=(0,El.useState)(null),s=i[0],o=i[1],a=(0,El.useRef)(null),l=(0,El.useState)(!1),u=l[0],c=l[1],h=(0,El.useRef)(null);return(0,El.useEffect)((function(){e.state.session.windows.loader.open&&W_(void 0,void 0,void 0,(function(){var t,n,i,s;return X_(this,(function(o){switch(o.label){case 0:return"electron"!==e.state.session.runtime?[3,2]:[4,window.electron.getSaveFiles()];case 1:return t=o.sent(),n=t.map((function(e){return{id:e.id,metaData:e,data:null}})).sort((function(e,t){return new Date(t.metaData.timestamp).getTime()-new Date(e.metaData.timestamp).getTime()})),r(n),[2];case 2:return i=window.indexedDB,(s=i.open("SandustryDatabase",1)).onsuccess=function(){var e=s.result,t=e.transaction("SandustryObjectStore","readonly"),n=t.objectStore("SandustryObjectStore").openCursor(),i=[];n.onsuccess=function(e){var t=e.target.result;if(t)i.push({id:t.value.id,metaData:t.value.metaData,data:null}),t.continue();else{var n=i.sort((function(e,t){var n,r;return new Date((null===(n=t.metaData)||void 0===n?void 0:n.timestamp)||0).getTime()-new Date((null===(r=e.metaData)||void 0===r?void 0:r.timestamp)||0).getTime()}));r(n)}},t.oncomplete=function(){e.close()}},[2]}}))}))}),[e.state.session.windows.loader.open]),e.state.session.windows.loader.open?u?(0,um.jsx)("div",H_({className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"},{children:(0,um.jsxs)(PS.div,H_({initial:{scale:.95},animate:{scale:1},className:"bg-black bg-opacity-85 p-6 shadow-lg ui-box card-2 text-white max-w-md"},{children:[(0,um.jsx)("h3",H_({className:"text-xl font-bold mb-4"},{children:"Confirm Delete"})),(0,um.jsx)("p",H_({className:"mb-6"},{children:"Are you sure you want to delete this save? This action cannot be undone."})),(0,um.jsxs)("div",H_({className:"flex justify-end space-x-4"},{children:[(0,um.jsx)("button",H_({onClick:function(){return c(!1)},className:"text-white bg-black border rounded-tr-lg rounded-bl-lg px-4 py-2 hover:text-[#ffe700] item-button-transition",onMouseEnter:function(){return Hl(e.state.session.soundEngine,"blip",{playbackRate:4,volume:.05})}},{children:"Cancel"})),(0,um.jsx)("button",H_({onClick:function(){return W_(void 0,void 0,void 0,(function(){var t;return X_(this,(function(i){switch(i.label){case 0:if(!s)return[3,5];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,dp(s)];case 2:return i.sent(),r(n.filter((function(e){return e.id!==s}))),o(null),Hl(e.state.session.soundEngine,"blip",{playbackRate:4,volume:.05}),[3,4];case 3:return t=i.sent(),console.error("Failed to delete save:",t),[3,4];case 4:c(!1),i.label=5;case 5:return[2]}}))}))},className:"text-white bg-black border rounded-tr-lg rounded-bl-lg px-4 py-2 hover:text-red-500 item-button-transition",onMouseEnter:function(){return Hl(e.state.session.soundEngine,"blip",{playbackRate:4,volume:.05})}},{children:"Delete"}))]}))]}))})):(0,um.jsxs)("div",H_({className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",onClick:function(t){a.current&&!a.current.contains(t.target)&&(e.state.session.windows.loader.open=!1,Cl(e.state,k.Loader))}},{children:[(0,um.jsx)("div",H_({ref:a,style:{transform:"scale(".concat(qf(e.state),")"),transformOrigin:"center"}},{children:(0,um.jsxs)(PS.div,H_({initial:{y:10},animate:{y:0},transition:{y:{duration:.1}},className:"h-full bg-black bg-opacity-85 p-4 shadow-lg ui-box card-2 text-white"},{children:[(0,um.jsxs)("div",H_({className:"flex justify-between items-center mb-4"},{children:[(0,um.jsx)("h2",H_({className:"text-2xl font-bold"},{children:"Saved Games"})),(0,um.jsx)("button",H_({onClick:function(){var e;null===(e=h.current)||void 0===e||e.click()},className:"text-gray-400 hover:text-[#ffe700] transition-colors",onMouseEnter:function(){return Hl(e.state.session.soundEngine,"blip",{playbackRate:4,volume:.05})}},{children:"Import"}))]})),(0,um.jsx)("ul",H_({className:"space-y-4 mb-4 max-h-[60vh] overflow-y-auto pr-2"},{children:0===n.length?(0,um.jsx)("li",H_({className:"text-gray-400 text-center p-4"},{children:"No saved games found"})):n.map((function(e){var t,n;return(0,um.jsx)("li",H_({className:"\n                                    p-3 rounded-lg transition-all duration-200 border\n                                    ".concat(s===e.id?"bg-slate-800 border-slate-600":"border-transparent hover:bg-slate-900","\n                                ")},{children:(0,um.jsxs)("label",H_({className:"flex items-start space-x-3 cursor-pointer w-full"},{children:[(0,um.jsx)("input",{type:"radio",name:"savedGame",value:e.id,checked:s===e.id,onChange:function(){return o(e.id)},className:"mt-1.5 form-radio text-blue-600"}),(0,um.jsxs)("div",H_({className:"flex flex-col flex-grow"},{children:[(0,um.jsx)("span",H_({className:"text-lg font-semibold mb-1"},{children:(null===(t=e.metaData)||void 0===t?void 0:t.name)||e.id})),(null===(n=e.metaData)||void 0===n?void 0:n.timestamp)&&(0,um.jsxs)("div",H_({className:"text-sm space-y-1.5"},{children:[(0,um.jsxs)("div",H_({className:"flex items-center text-gray-400"},{children:[(0,um.jsx)("svg",H_({className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},{children:(0,um.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})),new Date(e.metaData.timestamp).toLocaleString()]})),(0,um.jsxs)("div",H_({className:"flex items-center text-gray-400"},{children:[(0,um.jsx)("svg",H_({className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},{children:(0,um.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})),"Play time: ",Math.floor(e.metaData.playTime/6e4),"m"]})),(0,um.jsxs)("div",H_({className:"flex items-center space-x-4 text-gray-400"},{children:[(0,um.jsxs)("div",H_({className:"flex items-center"},{children:[(0,um.jsx)("span",H_({className:"text-[#8aff4b] mr-1"},{children:"$"})),e.metaData.resources.gold]})),(0,um.jsxs)("div",H_({className:"flex items-center"},{children:[(0,um.jsx)("span",H_({className:"text-[#d700e0] text-lg mr-1"},{children:"⬢"})),e.metaData.resources.fluxite]})),(0,um.jsxs)("div",H_({className:"flex items-center"},{children:[(0,um.jsx)("svg",H_({className:"w-4 h-4 mr-1 text-yellow-500",fill:"currentColor",viewBox:"0 0 20 20"},{children:(0,um.jsx)("path",{d:"M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"})})),e.metaData.resources.artifacts]}))]}))]}))]}))]}))}),e.id)}))})),(0,um.jsxs)("div",H_({className:"flex flex-col gap-2"},{children:[(0,um.jsx)("button",H_({onClick:function(){if(s){var e=n.find((function(e){return e.id===s}));e&&u_("db_load="+e.id)}},disabled:!s,className:"\n                                text-white \n                                bg-black\n                                border\n                                rounded-tr-lg rounded-bl-lg\n                                cursor-pointer \n                                shadow-md\n                                px-4\n                                py-2\n                                border-slate-200\n                                border-opacity-100 \n                                hover:border-opacity-0\n                                item-button-transition\n                                hover:text-[#ffe700]\n                                overflow-hidden\n                                before:ease before:absolute before:right-0 before:-top-4 before:h-20 before:w-6 before:translate-x-12 before:rotate-6 before:bg-white before:opacity-10 before:duration-700 hover:before:-translate-x-52\n                                relative\n                                left-0\n                                hover:left-2\n                                pointer-events-auto\n                                ".concat(s?"":"opacity-50 cursor-not-allowed hover:border-opacity-100 hover:text-white hover:left-0","\n                            "),onMouseEnter:function(){return Hl(e.state.session.soundEngine,"blip",{playbackRate:4,volume:.05})}},{children:"Load"})),(0,um.jsxs)("div",H_({className:"flex gap-2"},{children:[(0,um.jsx)("button",H_({onClick:function(){s&&(function(e,t){ip(void 0,void 0,void 0,(function(){var n,r,i,s,o,a,l,u,c;return sp(this,(function(h){switch(h.label){case 0:return"electron"!==e.session.runtime?[3,2]:[4,window.electron.loadRaw(t)];case 1:return i=h.sent(),n=i.metaData,r=i.data,[3,4];case 2:return[4,op(t)];case 3:s=h.sent(),n=s.metaData,r=s.data,h.label=4;case 4:return o="".concat(t,".save"),a=JSON.stringify(n)+"\n"+JSON.stringify(r),l=new Blob([a],{type:"application/json"}),u=URL.createObjectURL(l),(c=document.createElement("a")).href=u,c.download=o,c.click(),URL.revokeObjectURL(u),[2]}}))}))}(e.state,s),Hl(e.state.session.soundEngine,"blip",{playbackRate:4,volume:.05}))},disabled:!s,className:"\n                                    text-white \n                                    bg-black\n                                    border\n                                    rounded-tr-lg rounded-bl-lg\n                                    cursor-pointer \n                                    shadow-md\n                                    px-4\n                                    py-2\n                                    border-slate-200\n                                    border-opacity-100 \n                                    hover:border-opacity-0\n                                    item-button-transition\n                                    hover:text-[#ffe700]\n                                    overflow-hidden\n                                    before:ease before:absolute before:right-0 before:-top-4 before:h-20 before:w-6 before:translate-x-12 before:rotate-6 before:bg-white before:opacity-10 before:duration-700 hover:before:-translate-x-52\n                                    relative\n                                    left-0\n                                    hover:left-2\n                                    pointer-events-auto\n                                    ".concat(s?"":"opacity-50 cursor-not-allowed hover:border-opacity-100 hover:text-white hover:left-0","\n                                "),onMouseEnter:function(){return Hl(e.state.session.soundEngine,"blip",{playbackRate:4,volume:.05})},style:{flex:1}},{children:"Export"})),(0,um.jsx)("button",H_({onClick:function(){return W_(void 0,void 0,void 0,(function(){return X_(this,(function(e){return s&&c(!0),[2]}))}))},disabled:!s,className:"\n                                    text-white \n                                    bg-black\n                                    border\n                                    rounded-tr-lg rounded-bl-lg\n                                    cursor-pointer \n                                    shadow-md\n                                    px-4\n                                    py-2\n                                    border-slate-200\n                                    border-opacity-100 \n                                    hover:border-opacity-0\n                                    item-button-transition\n                                    hover:text-red-500\n                                    overflow-hidden\n                                    before:ease before:absolute before:right-0 before:-top-4 before:h-20 before:w-6 before:translate-x-12 before:rotate-6 before:bg-white before:opacity-10 before:duration-700 hover:before:-translate-x-52\n                                    relative\n                                    left-0\n                                    hover:left-2\n                                    pointer-events-auto\n                                    ".concat(s?"":"opacity-50 cursor-not-allowed hover:border-opacity-100 hover:text-white hover:left-0","\n                                "),onMouseEnter:function(){return Hl(e.state.session.soundEngine,"blip",{playbackRate:4,volume:.05})},style:{flex:1}},{children:"Delete"}))]}))]}))]}))})),(0,um.jsx)("input",{type:"file",ref:h,onChange:function(t){return W_(void 0,void 0,void 0,(function(){var n,r,i,s,o,a,l,u,c;return X_(this,(function(d){switch(d.label){case 0:if(!(n=null===(c=t.target.files)||void 0===c?void 0:c[0]))return[2];d.label=1;case 1:return d.trys.push([1,4,,5]),[4,n.text()];case 2:return r=d.sent(),i=r.split("\n"),s=i[0],o=i[1],a=JSON.parse(s),l=JSON.parse(o),[4,ap(e.state.session.runtime,a.id,a.name,l)];case 3:return d.sent(),e.state.session.windows.loader.open=!1,Cl(e.state,k.Loader),setTimeout((function(){e.state.session.windows.loader.open=!0,Cl(e.state,k.Loader)}),0),Hl(e.state.session.soundEngine,"blip",{playbackRate:4,volume:.05}),[3,5];case 4:return u=d.sent(),console.error("Failed to import save:",u),[3,5];case 5:return h.current&&(h.current.value=""),[2]}}))}))},onClick:function(e){return e.stopPropagation()},accept:".save",className:"hidden"})]})):(0,um.jsx)(um.Fragment,{})};var Y_=function(){return Y_=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Y_.apply(this,arguments)},q_=function(e){if("Escape"===e.key){e.currentTarget.blur();var t=new KeyboardEvent("keydown",{key:"Escape",bubbles:!0,cancelable:!0});document.dispatchEvent(t)}},K_=function(e){var t=e.volume,n=e.label,r=e.onChange,i=e.onRelease;return(0,um.jsxs)("div",Y_({className:"flex items-center mb-2",style:{width:"325px"}},{children:[(0,um.jsx)("span",Y_({className:"text-sm font-medium text-white w-28"},{children:n})),(0,um.jsx)("input",{type:"range",min:"0",max:"100",value:t,onChange:function(e){var t=parseInt(e.target.value,10);r(t)},onKeyDown:q_,className:"w-48 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer mx-4",onMouseUp:i}),(0,um.jsxs)("span",Y_({className:"text-sm font-medium text-white w-12 text-right"},{children:[t,"%"]}))]}))},Z_=function(e){var t=e.uiScale,n=e.onChange,r=t||100;return(0,um.jsxs)("div",Y_({className:"flex items-center mb-2",style:{width:"325px"}},{children:[(0,um.jsx)("span",Y_({className:"text-sm font-medium text-white w-28"},{children:"UI Scale"})),(0,um.jsx)("input",{type:"range",min:"50",max:"150",value:r,onChange:function(e){var t=parseInt(e.target.value,10);n(t)},onKeyDown:q_,className:"w-48 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer mx-4"}),(0,um.jsxs)("span",Y_({className:"text-sm font-medium text-white w-12 text-right"},{children:[r,"%"]}))]}))},Q_=function(e){var t=e.capFrameRate,n=e.onChange;return(0,um.jsxs)("div",Y_({className:"flex items-center mb-2",style:{width:"325px"}},{children:[(0,um.jsx)("span",Y_({className:"text-sm font-medium text-white w-28"},{children:"Cap Frame Rate"})),(0,um.jsx)("div",Y_({className:"w-48 mx-4 flex"},{children:(0,um.jsx)("input",{type:"checkbox",checked:t,onChange:function(e){return n(e.target.checked)},className:"w-6 h-6 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500"})}))]}))},J_=function(e){var t=e.lockSkyColor,n=e.onChange;return(0,um.jsxs)("div",Y_({className:"flex items-center mb-2",style:{width:"325px"}},{children:[(0,um.jsx)("span",Y_({className:"text-sm font-medium text-white w-28"},{children:"Lock Sky Color"})),(0,um.jsx)("div",Y_({className:"w-48 mx-4 flex"},{children:(0,um.jsx)("input",{type:"checkbox",checked:t,onChange:function(e){return n(e.target.checked)},className:"w-6 h-6 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500"})}))]}))},eT=function(e){var t=e.onChange,n=e.state,r="electron"===n.session.runtime?"fullscreen"===n.session.settings.windowMode:!!document.fullscreenElement;return(0,um.jsxs)("div",Y_({className:"flex items-center mb-2",style:{width:"325px"}},{children:[(0,um.jsx)("span",Y_({className:"text-sm font-medium text-white w-28"},{children:"Fullscreen"})),(0,um.jsx)("div",Y_({className:"w-48 mx-4 flex"},{children:(0,um.jsx)("input",{type:"checkbox",checked:r,onChange:function(e){return t(e.target.checked?"fullscreen":"windowed")},className:"w-6 h-6 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500"})}))]}))},tT=function(e){var t=e.state,n=e.onClick,r=e.variant,i=void 0===r?"default":r,s=e.children;return(0,um.jsx)(PS.button,Y_({whileTap:"active",onClick:n,className:"\n                flex-1 text-white bg-black border rounded-tr-lg rounded-bl-lg cursor-pointer shadow-md px-2 py-2\n                ".concat("danger"===i?"border-red-400":"border-slate-200","\n                border-opacity-100 hover:border-opacity-0 item-button-transition hover:text-[#ffe700]\n                overflow-hidden before:ease before:absolute before:right-0 before:-top-4 before:h-20 before:w-6 \n                before:translate-x-12 before:rotate-6 before:bg-white before:opacity-10 before:duration-700 \n                hover:before:-translate-x-52 relative left-0 hover:left-2 pointer-events-auto\n            "),onMouseEnter:function(){return Hl(t.session.soundEngine,"blip",{volume:t.session.settings.sound.sfxVolume/Gl*.1,ignoreGlobalVolume:!0})}},{children:s}))},nT=function(e){var t=e.label,n=e.currentKey,r=e.onChange,i=(0,El.useState)(!1),s=i[0],o=i[1],a=function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),r(e.key.toLowerCase()),o(!1),e.target.blur()};(0,El.useEffect)((function(){if(s)return window.addEventListener("keydown",a,{capture:!0}),function(){return window.removeEventListener("keydown",a,{capture:!0})}}),[s]);var l,u=" "===n?"space":n;return(0,um.jsxs)("div",Y_({className:"flex items-center space-x-4 mb-2"},{children:[(0,um.jsx)("span",Y_({className:"text-sm font-medium text-white w-48"},{children:(l=t,l.replace(/([A-Z])/g," $1").trim().replace(/^\w/,(function(e){return e.toUpperCase()})))})),(0,um.jsx)("button",Y_({onClick:function(){return o(!0)},className:"px-3 py-1 bg-gray-700 text-white rounded hover:bg-gray-600"},{children:s?"Press any key...":u}))]}))},rT=function(e){var t=e.disableShadows,n=e.onChange;return(0,um.jsxs)("div",Y_({className:"flex items-center mb-2",style:{width:"325px"}},{children:[(0,um.jsx)("span",Y_({className:"text-sm font-medium text-white w-28"},{children:"Disable Shadows"})),(0,um.jsx)("div",Y_({className:"w-48 mx-4 flex"},{children:(0,um.jsx)("input",{type:"checkbox",checked:t,onChange:function(e){return n(e.target.checked)},className:"w-6 h-6 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500"})}))]}))},iT=function(e){var t=e.disableBackgroundShader,n=e.onChange;return(0,um.jsxs)("div",Y_({className:"flex items-center mb-2",style:{width:"325px"}},{children:[(0,um.jsx)("span",Y_({className:"text-sm font-medium text-white w-28"},{children:"Disable Shaders"})),(0,um.jsx)("div",Y_({className:"w-48 mx-4 flex"},{children:(0,um.jsx)("input",{type:"checkbox",checked:t,onChange:function(e){return n(e.target.checked)},className:"w-6 h-6 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500"})}))]}))},sT=function(e){var t=e.showFps,n=e.onChange;return(0,um.jsxs)("div",Y_({className:"flex items-center mb-2",style:{width:"325px"}},{children:[(0,um.jsx)("span",Y_({className:"text-sm font-medium text-white w-28"},{children:"Show FPS"})),(0,um.jsx)("div",Y_({className:"w-48 mx-4 flex"},{children:(0,um.jsx)("input",{type:"checkbox",checked:t,onChange:function(e){return n(e.target.checked)},className:"w-6 h-6 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500"})}))]}))},oT=function(e){var t=(0,El.useRef)(null),n=(0,El.useState)((function(){return JSON.stringify(e.state.session.settings)}))[0],r=(0,El.useState)("general"),i=r[0],s=r[1],o=function(){e.state.session.settings=JSON.parse(n),Xl(e.state,e.state.session.settings.sound.sfxVolume/Gl,!0),e.state.session.windows.options.open=!1,Cl(e.state,k.Root)};return(0,um.jsx)("div",Y_({className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",onClick:function(e){t.current&&!t.current.contains(e.target)&&o()}},{children:(0,um.jsx)("div",Y_({ref:t,style:{height:"600px",width:"500px",transform:"scale(".concat(qf(e.state),")"),transformOrigin:"center"}},{children:(0,um.jsxs)(PS.div,Y_({initial:{y:10},animate:{y:0},transition:{y:{duration:.1}},className:"h-full w-full bg-black bg-opacity-85 p-4 shadow-lg ui-box card-2 flex flex-col"},{children:[(0,um.jsxs)("div",Y_({className:"flex mb-4 border-b border-gray-700"},{children:[(0,um.jsx)("button",Y_({className:"px-4 py-2 ".concat("general"===i?"text-[#ffe700] border-b-2 border-[#ffe700]":"text-white"),onClick:function(){return s("general")}},{children:"General"})),(0,um.jsx)("button",Y_({className:"px-4 py-2 ".concat("controls"===i?"text-[#ffe700] border-b-2 border-[#ffe700]":"text-white"),onClick:function(){return s("controls")}},{children:"Controls"}))]})),(0,um.jsx)("div",Y_({className:"flex-grow overflow-y-auto"},{children:"general"===i?(0,um.jsxs)("div",{children:[(0,um.jsx)(K_,{label:"Music Volume",volume:e.state.session.settings.sound.musicVolume,onChange:function(t){e.state.session.settings.sound.musicVolume=t,e.state.session.music.engine.setVolume(t/Gl),Cl(e.state,k.Options)}}),(0,um.jsx)(K_,{label:"SFX Volume",volume:e.state.session.settings.sound.sfxVolume,onChange:function(t){e.state.session.settings.sound.sfxVolume=t,Xl(e.state,t/Gl,!1),Cl(e.state,k.Options)},onRelease:function(){Hl(e.state.session.soundEngine,"blip"),Hl(e.state.session.soundEngine,"dig",{fadeOut:.4}),Hl(e.state.session.soundEngine,"dig",{playbackRate:.5,fadeOut:.7}),Hl(e.state.session.soundEngine,"gun_overlay",{volume:.3})}}),(0,um.jsx)(Z_,{uiScale:e.state.session.settings.uiScale,onChange:function(t){e.state.session.settings.uiScale=t,Cl(e.state,k.Root)}}),(0,um.jsx)(Q_,{capFrameRate:e.state.session.settings.capFrameRate,onChange:function(t){e.state.session.settings.capFrameRate=t,Cl(e.state,k.Options)}}),(0,um.jsx)(J_,{lockSkyColor:e.state.session.settings.lockSkyColor,onChange:function(t){e.state.session.settings.lockSkyColor=t,Cl(e.state,k.Options)}}),(0,um.jsx)(rT,{disableShadows:e.state.session.settings.disableShadows,onChange:function(t){e.state.session.settings.disableShadows=t,Cl(e.state,k.Options)}}),(0,um.jsx)(iT,{disableBackgroundShader:e.state.session.settings.disableBackgroundShader,onChange:function(t){e.state.session.settings.disableBackgroundShader=t,e.state.session.rendering.pixi.toggleSkyFilter(!t),Cl(e.state,k.Options)}}),(0,um.jsx)(sT,{showFps:e.state.session.settings.showFps,onChange:function(t){e.state.session.settings.showFps=t;var n=document.getElementById("fps");n&&(n.style.display=t?"block":"none"),Cl(e.state,k.Options)}}),(0,um.jsx)(eT,{state:e.state,onChange:function(t){return n=void 0,r=void 0,s=function(){var n;return function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}(this,(function(r){switch(r.label){case 0:return r.trys.push([0,7,,8]),"electron"!==e.state.session.runtime?[3,2]:[4,window.electron.setFullscreen("fullscreen"===t)];case 1:return r.sent(),e.state.session.settings.windowMode=t,[3,6];case 2:return"fullscreen"!==t?[3,4]:[4,document.documentElement.requestFullscreen()];case 3:return r.sent(),[3,6];case 4:return document.fullscreenElement?[4,document.exitFullscreen()]:[3,6];case 5:r.sent(),r.label=6;case 6:return Cl(e.state,k.Options),[3,8];case 7:return n=r.sent(),console.error("Fullscreen mode change failed:",n),"electron"===e.state.session.runtime&&(e.state.session.settings.windowMode="windowed",Cl(e.state,k.Options)),[3,8];case 8:return[2]}}))},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{l(s.next(e))}catch(e){t(e)}}function a(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(o,a)}l((s=s.apply(n,r||[])).next())}));var n,r,i,s}}),"electron"===e.state.session.runtime&&(0,um.jsxs)("div",Y_({className:"flex items-center mb-2",style:{width:"325px"}},{children:[(0,um.jsx)("span",Y_({className:"text-sm font-medium text-white w-28"},{children:"Debug Console"})),(0,um.jsx)("div",Y_({className:"w-48 mx-4 flex"},{children:(0,um.jsx)("button",Y_({onClick:function(){return window.electron.openDevTools()},className:"px-3 py-1 bg-gray-700 text-white rounded hover:bg-gray-600"},{children:"Open"}))}))]}))]}):(0,um.jsx)("div",{children:Object.entries(e.state.session.settings.keyBindings).filter((function(e){var t=e[0];return!kp.includes(t)})).map((function(t){var n=t[0],r=t[1];return(0,um.jsx)(nT,{label:g[n],currentKey:r,onChange:function(t){e.state.session.settings.keyBindings[n]=t,Cl(e.state,k.Options)}},n)}))})})),(0,um.jsxs)("div",Y_({className:"flex gap-2 mt-4"},{children:[(0,um.jsx)(tT,Y_({state:e.state,onClick:function(){e.state.session.settings=JSON.parse(JSON.stringify(Cp)),Xl(e.state,e.state.session.settings.sound.sfxVolume/Gl,!0),e.state.session.rendering.pixi.toggleSkyFilter(!0);var t=document.getElementById("fps");t&&(t.style.display="none"),Cl(e.state,k.Root)},variant:"danger"},{children:"Reset to Default"})),(0,um.jsx)(tT,Y_({state:e.state,onClick:function(){o()}},{children:"Cancel"})),(0,um.jsx)(tT,Y_({state:e.state,onClick:function(){!function(e){np()?window.electron.saveSettings(e):localStorage.setItem("settings",JSON.stringify(e))}(e.state.session.settings),e.state.session.windows.options.open=!1,Cl(e.state,k.Options)}},{children:"Save"}))]}))]}))}))}))};const aT=function(e){return kl(e.state,k.Options),e.state.session.windows.options.open?(0,um.jsx)(oT,{state:e.state}):(0,um.jsx)(um.Fragment,{})};var lT=function(){return lT=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},lT.apply(this,arguments)};function uT(e){var t=e.state;if(kl(t,k.ShortcutHelper),t.store.scene.active===x.MainMenu||t.store.tutorial.active&&t.store.tutorial.currentStep<b.BuildShaker)return(0,um.jsx)(um.Fragment,{});var n={"Shift (hold)":"Select buildings","X (hold)":"Delete buildings"};t.session.action.customData&&t.session.action.customData.marqueeSelected&&(n={"C (hold)":"Copy selected buildings",Delete:"Delete selected buildings"});var r=gf(t);return t.session.building.placing&&((n=r&&r.id===d.LauncherUp?{"Shift (hold)":"Skip outlet"}:{"Shift (hold)":"Reverse direction"})["V (hold)"]="Show number of blocks"),r&&r.type===o.Building&&(n.R="Switch build mode (current: ".concat(t.store.options.buildMode===T.Linear?"linear":"rectangular",")")),(0,um.jsx)("div",lT({className:"fixed bottom-4 left-4 bg-black bg-opacity-70 text-white p-2 rounded",style:{transform:"scale(".concat(qf(t),")"),transformOrigin:"bottom left"}},{children:Object.entries(n).map((function(e){var t=e[0],n=e[1];return(0,um.jsxs)("div",lT({className:"mb-1.5"},{children:[(0,um.jsx)("strong",{children:t}),": ",n]}),t)}))}))}var cT=function(){return cT=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},cT.apply(this,arguments)},hT=function(e,t){if("grabber"===e.type){var n=void 0;if(void 0!==e.elementType)n=Ih[e.elementType];else if(void 0!==e.groundCellType)n=au[e.groundCellType];else if(void 0!==e.structure&&e.structure.filter)return(0,um.jsxs)("div",{children:[(0,um.jsx)("div",{children:"Filter"}),(0,um.jsxs)("div",cT({className:"text-sm"},{children:["allow"===e.structure.filter.mode?"Allow ↓":"Allow ↓ everything except",void 0!==e.structure.filter.elementType&&(Array.isArray(e.structure.filter.elementType)?" ".concat(e.structure.filter.elementType.map((function(e){return Ih[e].name})).join(", ")):" ".concat(Ih[e.structure.filter.elementType].name)),void 0!==e.structure.filter.density&&" density ".concat(e.structure.filter.density)]}))]});if(n)return(0,um.jsxs)("div",{children:[(0,um.jsx)("div",{children:n.name||"?"}),t>=2&&n.interactions&&(0,um.jsx)("div",cT({className:"text-sm"},{children:n.interactions.join(" ")}))]})}if("building"===e.type)return(0,um.jsxs)("div",{children:[(0,um.jsxs)("div",{children:[e.amountOfTiles," tiles"]}),e.dimensions&&(0,um.jsxs)("div",cT({className:"text-sm"},{children:[e.dimensions.width,"w × ",e.dimensions.height,"h"]}))]})};function dT(e){var t,n;if(kl(e.state,k.Tooltip),!e.state.session.ui.tooltip.activeTick)return(0,um.jsx)(um.Fragment,{});var r=(null===(n=null===(t=e.state.store.upgrades.grabber)||void 0===t?void 0:t.scanner)||void 0===n?void 0:n.level)||0;return(0,um.jsx)("div",cT({className:"fixed bg-black bg-opacity-70 text-white px-2 py-1 rounded pointer-events-none",style:{left:"".concat(e.state.session.rendering.canvas.getBoundingClientRect().left+e.state.session.input.mouse.position.x*e.state.session.scale,"px"),top:"".concat(e.state.session.rendering.canvas.getBoundingClientRect().top+e.state.session.input.mouse.position.y*e.state.session.scale,"px"),transform:"translate(8px, 8px) scale(".concat(qf(e.state),")"),transformOrigin:"top left"}},{children:hT(e.state.session.ui.tooltip.data,r)}))}var fT=function(){return fT=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},fT.apply(this,arguments)};function pT(e){return e.state.store.scene.active===x.MainMenu?null:(0,um.jsx)("div",fT({className:"fixed top-4 right-4 flex items-center gap-4",style:{transform:"scale(".concat(qf(e.state),")"),transformOrigin:"top right"}},{children:(0,um.jsxs)("button",fT({className:"text-white bg-black bg-opacity-75 p-2 rounded hover:bg-opacity-50 transition-all",onClick:function(){Hl(e.state.session.soundEngine,"click"),e.state.session.windows.menu.open=!0,Bp(e.state),Cl(e.state,k.Menu),$l(e.state)},onMouseEnter:function(){return Hl(e.state.session.soundEngine,"blip",{playbackRate:4,volume:.05})}},{children:[(0,um.jsx)("svg",fT({xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},{children:(0,um.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})),(0,um.jsx)("span",fT({className:"sr-only"},{children:"Menu [ESC]"}))]}))}))}var mT=function(){return mT=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},mT.apply(this,arguments)};function gT(e){var t=e.state;kl(t,k.Notifications);var n=!t.store.tutorial.active,r=t.session.notifications.toast;return(0,um.jsx)(j_,{children:t.session.notifications.toast&&(0,um.jsx)(PS.div,mT({className:"fixed text-2xl p-2 text-outline text-white ".concat(n?"left-1/2 top-4":"left-4 top-1/2"),style:{background:n?"linear-gradient(to bottom, rgba(30, 41, 59, 0.25), transparent)":"linear-gradient(to right, rgba(30, 41, 59, 0.25), transparent)"},initial:n?{x:"-50%",y:"-200%"}:{x:"-100%"},animate:n?{x:"-50%",y:0}:{x:0},exit:n?{x:"-50%",y:"-200%"}:{x:"-100%"},transition:{type:"tween",duration:.3}},{children:r}))})}var yT=function(){return yT=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},yT.apply(this,arguments)},vT=function(e){return kl(e.state,k.Objectives),e.state.store.scene.active===x.MainMenu?null:e.state.store.tutorial.active?(0,um.jsx)("div",yT({className:"fixed top-20 right-4"},{children:(0,um.jsx)("button",yT({className:"bg-gray-600 text-sm text-white p-1 px-2 opacity-50 hover:opacity-100 rounded",onClick:function(){e.state.store.tutorial.active=!1,e.state.store.tutorial.data={},Cu(e.state),e.state.environment.multithreading.simulation.postAll(e.state,[f.SetTutorialStep,b.TutorialEnd]),zf(e.state,{id:w.Refining1,cost:0,unlocks:{structures:[d.ShakerRight]}}),Cl(e.state,k.Root)}},{children:"Skip Tutorial"}))})):0===e.state.store.objectives.active.length?null:(0,um.jsxs)("div",yT({className:"fixed top-20 right-4",style:{transform:"scale(".concat(qf(e.state),")"),transformOrigin:"top right"}},{children:[(0,um.jsx)("h3",yT({className:"text-white text-xl mb-3 text-outline px-2 text-right",style:{background:"linear-gradient(to left, rgba(30, 41, 59, 0.25), transparent)"}},{children:"Objectives"})),(0,um.jsx)(j_,yT({mode:"popLayout"},{children:e.state.store.objectives.active.map((function(t){var n,r;return(0,um.jsx)(PS.div,yT({initial:{opacity:0,height:0,y:-10},animate:{opacity:1,height:"auto",y:0},exit:{opacity:0,height:0,y:-10},className:"text-white mb-2 last:mb-0"},{children:(0,um.jsx)("div",yT({className:"\n                            flex items-center gap-2 px-3 py-1.5 rounded bg-black bg-opacity-85\n                            ".concat(t.completed?"text-green-500":"","\n                            transition-colors duration-200 ui-box card-2\n                            w-[200px]\n                        ")},{children:(0,um.jsxs)("div",yT({className:"flex flex-col"},{children:[(0,um.jsxs)("div",yT({className:"flex items-center gap-2"},{children:[(0,um.jsx)("span",yT({className:"text-lg w-4 flex-shrink-0"},{children:t.completed?"✓":"•"})),(0,um.jsxs)("span",yT({className:t.completed?"line-through":""},{children:[function(){var e,n=(null===(e=Tu[t.id])||void 0===e?void 0:e.title)||t.id;return"Find Fluxite"===n?(0,um.jsxs)(um.Fragment,{children:["Find ",(0,um.jsx)("span",yT({style:{color:"#f975ff"}},{children:"Fluxite"}))]}):"Find Artifacts"===n?(0,um.jsxs)(um.Fragment,{children:["Find ",(0,um.jsx)("span",yT({style:{background:"linear-gradient(to right, #9c5eea, #3ad3cc)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"}},{children:"Artifacts"}))]}):n}(),(null===(n=Tu[t.id])||void 0===n?void 0:n.counter)&&!t.completed&&(0,um.jsxs)("span",yT({className:"ml-1 text-sm opacity-75"},{children:["(",Tu[t.id].counter.current(e.state)," / ",Tu[t.id].counter.required,")"]}))]}))]})),(null===(r=Tu[t.id])||void 0===r?void 0:r.description)&&!t.completed&&(0,um.jsx)("div",yT({className:"text-sm opacity-75 font-normal ml-6"},{children:Tu[t.id].description}))]}))}))}),t.id)}))}))]}))},xT=function(){return xT=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},xT.apply(this,arguments)};function bT(e){return e.state.session.windows.playtestFinished.open?(0,um.jsx)(T_,xT({state:e.state,isOpen:!0,onClose:function(){e.state.session.windows.playtestFinished.open=!1,Cl(e.state,k.Root)},title:"Demo Complete!",width:"500px"},{children:(0,um.jsxs)("div",xT({className:"text-white space-y-6"},{children:[(0,um.jsx)("p",xT({className:"text-lg"},{children:"🎉 Congratulations! You've reached the end of the demo."})),(0,um.jsx)("p",{children:"Thank you for playing! You can continue exploring and building in the world, but there won't be any more story content or artifacts to find in this version."}),(0,um.jsxs)("div",xT({className:"flex flex-col gap-4 mt-8"},{children:[(0,um.jsxs)("a",xT({href:"https://discord.gg/HJNk5eMnmt",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 bg-black border rounded-tr-lg rounded-bl-lg cursor-pointer shadow-md border-slate-200 border-opacity-100 hover:border-opacity-0 item-button-transition hover:left-2 relative pointer-events-auto active:bg-opacity-75 px-3 py-2",onClick:function(){return Hl(e.state.session.soundEngine,"click",{volume:e.state.session.settings.sound.sfxVolume/Gl*.4})},onMouseEnter:function(){return Hl(e.state.session.soundEngine,"blip",{volume:e.state.session.settings.sound.sfxVolume/Gl*.1})}},{children:[(0,um.jsx)("svg",xT({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 127 96",className:"w-8 h-8 fill-white"},{children:(0,um.jsx)("path",{d:"M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.7,77.7,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22h0C129.24,52.84,122.09,29.11,107.7,8.07ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5-12.74,11.44-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z"})})),(0,um.jsx)("span",xT({className:"text-white"},{children:"Join the Discord community"}))]})),(0,um.jsx)("a",xT({href:"https://store.steampowered.com/app/2764460/Sandustry/",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 bg-black border rounded-tr-lg rounded-bl-lg cursor-pointer shadow-md border-slate-200 border-opacity-100 hover:border-opacity-0 item-button-transition hover:left-2 relative pointer-events-auto active:bg-opacity-75 px-3 py-2",onClick:function(){return Hl(e.state.session.soundEngine,"click",{volume:e.state.session.settings.sound.sfxVolume/Gl*.4})},onMouseEnter:function(){return Hl(e.state.session.soundEngine,"blip",{volume:e.state.session.settings.sound.sfxVolume/Gl*.1})}},{children:(0,um.jsxs)("span",xT({className:"text-white text-lg"},{children:["Wishlist on ",(0,um.jsx)("span",xT({className:"text-[#66c0f4]"},{children:"Steam"}))]}))}))]}))]}))})):null}function wT(e){return kl(e.state,k.Root),e.state.session.ui.visible?(0,um.jsxs)(um.Fragment,{children:[(0,um.jsx)(i_,{state:e.state}),(0,um.jsx)(GS,{state:e.state}),(0,um.jsx)(g_,{state:e.state}),(0,um.jsx)(DS,{state:e.state}),(0,um.jsx)(f_,{state:e.state}),(0,um.jsx)(dm,{state:e.state}),(0,um.jsx)(S_,{state:e.state}),(0,um.jsx)(gT,{state:e.state}),(0,um.jsx)(D_,{state:e.state}),(0,um.jsx)(V_,{state:e.state}),(0,um.jsx)(vT,{state:e.state}),(0,um.jsx)($_,{state:e.state}),(0,um.jsx)(aT,{state:e.state}),(0,um.jsx)(uT,{state:e.state}),(0,um.jsx)(dT,{state:e.state}),(0,um.jsx)(pT,{state:e.state}),(0,um.jsx)(bT,{state:e.state})]}):null}var ST=i(5072),_T=i.n(ST),TT=i(7825),ET=i.n(TT),CT=i(40),kT=i.n(CT),AT=i(5056),MT=i.n(AT),PT=i(540),RT=i.n(PT),IT=i(1113),DT=i.n(IT),FT=i(8916),NT={};NT.styleTagTransform=DT(),NT.setAttributes=MT(),NT.insert=kT().bind(null,"head"),NT.domAPI=ET(),NT.insertStyleElement=RT(),_T()(FT.A,NT),FT.A&&FT.A.locals&&FT.A.locals;const LT=function(t,n){return{x:t,y:n,width:e.playerSize.width,height:e.playerSize.height,velocity:{x:0,y:0},threshold:{x:0,y:0},onGround:!1,inventory:[{id:l.Shovel,itemType:a.Weapon,abilities:[{type:c.Dig,cooldown:{time:667,last:0}}],name:"Shovel",description:"Dig a hole."},{id:l.Grabber,itemType:a.Tool,data:new Array(27).fill(0),name:"Grabber",description:"A grabber that can be used to pick up sand."},{id:l.Demolisher,itemType:a.Tool,name:"Demolisher",description:"A demolisher that can be used to remove structures. Shortcut: [X]"},{id:l.Copier,itemType:a.Tool,name:"Marquee",description:"A marquee tool that can be used to move or copy structures (hold [C] to copy and [Backspace] to delete). Shortcut: [Shift]"}],buildings:[d.Foundation,d.Collector],tech:{},action:null,hotbar:{activeSlotIndex:0,items:[{id:l.Shovel,type:o.Weapon},{id:l.Grabber,type:o.Tool},null,null,null,null,null,null,null]},animations:{muzzleFlash:!1},grapplingHook:!1,cooldowns:{boostParticle:{time:16,last:0},hoverParticle:{time:16,last:0}},isHovering:!1,weaponsMeta:{rocketLauncher:{ammo:{current:3,reload:{last:0}}}}}};const BT=function(r,i){var s,o=function(r){for(var i=performance.now(),s=r.terrain.imageData,o=!!r.lights&&r.lights.imageData,a=!!r.sensors&&r.sensors.imageData,l=[],u=[],c=[],h=function(e,n){return Array.from(Array(n),(function(n,r){return Array.from({length:e},(function(e,n){return t.Empty}))}))}(s.width,s.height),d=[],f=[],p=0;p<s.height;p++)for(var m=0;m<s.width;m++){var g=4*(m+p*s.width),y=s.data[g+0],v=s.data[g+1],x=s.data[g+2],b="".concat(y,", ").concat(v,", ").concat(x);switch(b){case"255, 255, 255":(!l[m]||l[m]<p)&&(l[m]=p),(!u[m]||u[m]<p)&&(u[m]=p),h[p][m]=t.Empty;break;case"170, 170, 170":h[p][m]=t.Bedrock;break;case"0, 0, 255":case"102, 0, 255":h[p][m]=Ch(n.Water,m,p),(!u[m]||u[m]<p)&&(u[m]=p);break;case"102, 204, 255":h[p][m]=t.Ice;break;case"255, 0, 0":c.push({name:b,x:m,y:p}),h[p][m]=t.Empty;break;case"153, 0, 0":break;default:var w=Td["".concat(y,", ").concat(v,", ").concat(x)];if(Number.isInteger(w)||(w=w.fg),!w)throw Error("Unknown color in blueprint: "+"".concat(y,", ").concat(v,", ").concat(x));h[p][m]=w,t.Fluxite}o&&Ed(d,o,g,m,p),a&&Cd(f,a,g,m,p)}var S=[];for(p=0;p<Math.floor(h.length/e.chunkSize);p++)for(S.push([]),m=0;m<Math.floor(h[p].length/e.chunkSize);m++)S[p].push(re(m,p));return console.log("createWorld",performance.now()-i),{size:{width:s.width,height:s.height},matrix:h,chunks:S,updatedCellPositions:[],deferredChunkReports:[],matrixTraverseDirection:1,horizon:l,groundHorizon:u,fixtures:c,lights:d,sensors:f}}(r),a=function(t,n){return t===x.MainMenu?{x:n.fixtures[0].x*e.cellSize+21*e.snapGridCellSize*e.cellSize+10,y:n.fixtures[0].y*e.cellSize+15*e.snapGridCellSize*e.cellSize}:e.playtest?{x:363*e.cellSize,y:200*e.cellSize}:{x:699*e.cellSize,y:200*e.cellSize}}(i,o);return{version:e.version,player:LT(a.x,a.y),resources:{gold:e.startingResources,fluxite:e.startingResources,artifacts:0},world:o,projectiles:[],structures:[],drones:[],pipes:[],pumpsCache:[],worldItems:[],gloom:{emitterPositions:[]},machineryEngine:{runLaunchers:!1},meta:{tick:1,nextId:{projectile:1,drone:1,worldItem:1},time:0},options:{defaultFilter:{density:200,mode:"allow"},buildMode:T.Linear},scene:{active:i,start:0,triggers:am(i)},tutorial:{active:!0,currentStep:b.Move,transitioningToNextStep:!1,data:ju(b.Move)},progression:{upgradesUnlocked:!1,dungeons:(s={},s[I.Boss1]={done:!1},s)},upgrades:{grabber:{scanner:{level:1,availableLevel:1}},jetpack:{speed:{level:1,availableLevel:1}},shovel:{speed:{level:1,availableLevel:1},momentum:{level:1,availableLevel:1}},gun:{speed:{level:1,availableLevel:1},damage:{level:1,availableLevel:1},bullets:{level:1,availableLevel:1}},rocketLauncher:{reload:{level:1,availableLevel:1},maxAmmo:{level:1,availableLevel:1},napalm:{level:1,availableLevel:1}},hauler:{maxDrones:{level:1,availableLevel:1},speed:{level:1,availableLevel:1}},digger:{cooldown:{level:1,availableLevel:1},hp:{level:1,availableLevel:1},gravity:{level:1,availableLevel:1}},flamethrower:{range:{level:1,availableLevel:1}}},hints:{nonDestructible:!1},objectives:{active:[]}}};const OT=function(t,n){return r=void 0,i=void 0,o=function(){var r,i,s,o,u,c;return function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}(this,(function(h){switch(h.label){case 0:return r=new URLSearchParams(window.location.search),i=r.has("skip_version_check"),r.has("db_load")?[4,up(r.get("db_load"))]:[3,2];case 1:if(function(t){!t.version||t.version<"0.0.3"||t.version!==e.version&&("0.0.3"===t.version&&(t.pipes=[],t.pumpsCache=[],t.drones=[],t.meta.nextId.drone=1,t.upgrades.hauler={maxDrones:{level:1,availableLevel:1},speed:{level:1,availableLevel:1}},t.upgrades.digger={cooldown:{level:1,availableLevel:1},hp:{level:1,availableLevel:1},gravity:{level:1,availableLevel:1}},t.gloom={emitterPositions:[]},t.player.inventory&&(t.player.inventory=t.player.inventory.map((function(e){if(!e)return e;switch(!0){case e.itemType===a.Tool&&e.id===l.GrapplingHook:return df();case e.itemType===a.Weapon&&e.id===l.Flamethrower:return oc();case e.itemType===a.Weapon&&e.id===l.RocketLauncher:return sc();default:return e}})))),"0.0.4"===t.version&&(t.worldItems=[],t.meta.nextId.worldItem=1,t.objectives.active=[],t.resources.artifacts=0),t.version="0.0.5")}(s=h.sent()),!i&&s.version!==e.version)throw new Error("Save file version mismatch. Expected ".concat(e.version,", got ").concat(s.version));return[2,s];case 2:return r.has("file_load")?((o=document.createElement("button")).textContent="Please select a file",o.className="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded absolute inset-1/2 transform -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2",document.body.appendChild(o),[4,new Promise((function(e){return o.onclick=e}))]):[3,5];case 3:return h.sent(),o.remove(),[4,new Promise((function(e,t){var n=document.createElement("input");n.type="file",n.accept="application/json",n.onchange=function(n){var r=n.target.files[0],i=new FileReader;i.onload=function(n){try{var r=JSON.parse(n.target.result);e(r)}catch(e){t(e)}},i.onerror=function(e){return t(e)},i.readAsText(r)},n.click()}))];case 4:if(u=h.sent(),!i&&u.version!==e.version)throw new Error("Save file version mismatch. Expected ".concat(e.version,", got ").concat(u.version));return[2,u];case 5:return r.has("load")?[4,fetch("saves/".concat(r.get("load"),".json"))]:[2,BT(t,n)];case 6:return[4,h.sent().json()];case 7:if(c=h.sent(),!i&&c.version!==e.version)throw new Error("Save file version mismatch. Expected ".concat(e.version,", got ").concat(c.version));return[2,c]}}))},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{l(o.next(e))}catch(e){t(e)}}function a(e){try{l(o.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof s?e:new s((function(t){t(e)}))}(t.value).then(n,a)}l((o=o.apply(r,i||[])).next())}));var r,i,s,o};const zT=function(e,t,n){for(var r=performance.now(),i=(e.store,function(e){return Object.entries(Td).reduce((function(t,n){for(var r,i,s=n[0],o=function(e){return Number.isInteger(e)?au[e]:"object"==typeof e.bg?{background:e.bg}:au[e.bg]}(n[1]),a=null!==(i=null===(r=o.background)||void 0===r?void 0:r.patternSprite)&&void 0!==i?i:"soil_backdrop_test",l=e.images[a],u=new Array(16).fill(0).map((function(){return new Array(16).fill(0)})),c=l.imageData.data,h=0;h<16;h++)for(var d=0;d<16;d++){var f=4*(d+16*h);u[h][d]=255===c[f]?1:0}return t[s]={pattern:u,config:o},t}),{})}(n)),s=function(e){var t=new Uint8Array(1020);t[0]=0,t[1]=0,t[2]=0,t[3]=0;for(var n=1,r=0,i=Object.entries(e);r<i.length;r++){var s=i[r],o=void s[0],a=void 0,l=s[1].config;if(l.background)if("rgb"===l.background.model)o=l.background.bg,a=l.background.fg;else{var u=l.background.bg,c=u[0],h=u[1],d=u[2];o=K.HSLToRGBA(c,h,d);var f=l.background.fg,p=f[0],m=f[1],g=f[2];a=K.HSLToRGBA(p,m,g)}else if(l.fog){var y=fu(l.backgroundElementType);o=K.HSLToRGBA(y,60,24),a=K.HSLToRGBA(y,60,22)}else y=fu(l.output.elementType),o=K.HSLToRGBA(y,60,25),a=K.HSLToRGBA(y,60,23);t[4*n]=o[0],t[4*n+1]=o[1],t[4*n+2]=o[2],t[4*n+3]=o[3]||255,t[4*++n]=a[0],t[4*n+1]=a[1],t[4*n+2]=a[2],t[4*n+3]=a[3]||255,n++}return Mr.fromBuffer(t,255,1)}(i),o=t.imageData,a=0;a<o.height;a++)for(var l=0;l<o.width;l++){var u=4*(l+a*o.width),c=o.data[u+0],h=o.data[u+1],d=o.data[u+2],f="".concat(c,", ").concat(h,", ").concat(d);if(!["255, 255, 255","102, 0, 255","255, 0, 0"].includes(f)){var p=l%16,m=a%16,g=(i[f]||i["0, 0, 0"]).pattern[m][p],y=Object.keys(i).indexOf(f);-1===y&&(y=Object.keys(i).indexOf("0, 0, 0"));var v=2*y+g+1,x=l+a*o.width;e.shared.wallData.data[x]=v}}return console.log("setupWall",performance.now()-r),{wallRGBALookupTexture:s,authorizationByColorIndex:{}}};var jT=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,a)}l((r=r.apply(e,t||[])).next())}))},UT=function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},GT=function(r,i){return jT(void 0,void 0,void 0,(function(){var o;return UT(this,(function(a){switch(a.label){case 0:return o=i/1e3,[4,xp(r,i)];case 1:return a.sent(),function(r,i){r.store.projectiles.forEach((function(o){return function(r,i,o){if(i.x<=10||i.y<=10||i.x>=r.store.world.size.width*e.cellSize-10||i.y>=r.store.world.size.height*e.cellSize-10)Ic(r,i);else if(-1!==i.duration.max&&(i.duration.left-=o,i.duration.left<=0))Ic(r,i);else{var a;if(i.type===s.Bouncer&&(a=1-.3*(r.store.upgrades.digger.gravity.level-1),i.velocity.y+=e.gravity*a*o,i.velocity.y*=.99),i.type===s.Rocket){if(i.duration.max-i.duration.left>1){var l=dc(K.getVelocityFromAngle(i.initialAngle),500);i.velocity.x*=1.05,i.velocity.y*=1.05,(Math.abs(i.velocity.x)>Math.abs(l.x)||Math.abs(i.velocity.y)>Math.abs(l.y))&&(i.velocity.x=l.x,i.velocity.y=l.y);var u=Math.min(600,Math.max(i.x-r.store.player.x,-600))/1e3,c=K.getDistance({x:i.x,y:i.y},{x:r.store.player.x,y:r.store.player.y}),h=200/Math.max(200,c)*.05;r.session.soundEngine.sfx.jet.source&&(r.session.soundEngine.sfx.jet.panner.pan.setValueAtTime(u,r.session.soundEngine.audioContext.currentTime),r.session.soundEngine.sfx.jet.gainNode.gain.setValueAtTime(h*r.session.soundEngine.globalVolume,r.session.soundEngine.audioContext.currentTime))}else i.velocity.x*=.99,i.velocity.y*=.99;Lu(r.store,i.attributes.cooldowns.emitSmoke)&&Fc(r,i.x,i.y,{x:0,y:0})}var d={x:i.x+i.velocity.x*o,y:i.y+i.velocity.y*o},p=mc(r,i,d,{ignoreStructures:i.type!==s.GrapplingHook});if(p){if(i.x=Math.round(p.x),i.y=Math.round(p.y),p.collidedCell){switch(i.type){case s.Bullet:e.useMultithreading?r.environment.multithreading.simulation.postAll(r,[f.Blast,[i,p.cX,p.cY]]):pc(r,i,p.cX,p.cY),Ql(r,i.x,i.y);break;case s.Rocket:r.environment.multithreading.simulation.post(r,K.getThreadIndexFromCellX(p.cX,r.environment.multithreading.simulation.threads.length),[f.Explode,[p.cX,p.cY,i.attributes.napalm]]),Ql(r,i.x,i.y,{group:!0,brightness:1.33,duration:50,size:200});break;case s.GrapplingHook:!function(e,t){e.store.player.grapplingHook?e.store.player.grapplingHook.eyelet={x:t.x,y:t.y}:console.error("Unable to attach grappling hook!")}(r,i);break;case s.Bouncer:i.x=p.lastFreePosition.x,i.y=p.lastFreePosition.y,e.useMultithreading?r.environment.multithreading.simulation.postAll(r,[f.Blast,[i,p.cX,p.cY]]):pc(r,i,p.cX,p.cY),Ql(r,i.x,i.y);var m=$d(r,p.cX,p.cY);if(([t.Bedrock,t.Ice,t.Crackstone].includes(m)||Yd(r,p.cX,p.cY))&&(i.attributes.hp-=1,i.attributes.hp<=0))return void Ic(r,i);var g=Math.abs(i.x-p.x),y=Math.abs(i.y-p.y);if(g===y){var v=Math.abs(i.velocity.x),x=Math.abs(i.velocity.y);return x===v?(i.velocity.x=-i.velocity.x,void(i.velocity.y=-i.velocity.y)):void(v<x?i.velocity.x=-i.velocity.x:i.velocity.y=-i.velocity.y)}return void(g>y?i.velocity.x=-i.velocity.x:i.velocity.y=-i.velocity.y);case s.Fire:e.useMultithreading&&r.environment.multithreading.simulation.postAll(r,[f.FireProjectileHit,[p.cX,p.cY]])}Ic(r,i)}}else if(i.x=d.x,i.y=d.y,void 0!==i.tracerLightIndex&&r.session.lights[i.tracerLightIndex]&&(r.session.lights[i.tracerLightIndex].x=i.x,r.session.lights[i.tracerLightIndex].y=i.y),i.type===s.Fire&&Lu(r.store,i.attributes.cooldowns.emitFire)){var b={x:Math.round(i.x/e.cellSize),y:Math.round(i.y/e.cellSize)},w=b.x,S=b.y,_=(.64-i.duration.left)/.64*40,T=Math.round(Math.pow(1.01,_)),E={x:K.getRandomIntBetween(w-T,w+T),y:K.getRandomIntBetween(S-T,S+T)};r.environment.multithreading.simulation.post(r,K.getThreadIndexFromCellX(E.x,r.environment.multithreading.simulation.threads.length),[f.Ignite,[E.x,E.y,i.duration.left]]);var C=Xd(r,w,S);if(C===n.Slag||C===n.Flame)return C===n.Slag&&r.environment.multithreading.simulation.post(r,K.getThreadIndexFromCellX(w,r.environment.multithreading.simulation.threads.length),[f.Ignite,[w,S,i.duration.left]]),void Ic(r,i)}}}(r,o,i)}))}(r,o),function(t,n){t.session.visualParticles=t.session.visualParticles.filter((function(r){return function(t,n,r){if(t.store.meta.time-n.time>=n.duration)return(n.background?t.session.rendering.pixi.backgroundEntitiesContainer:t.session.rendering.pixi.foregroundEntitiesContainer).removeChild(n.sprite),!1;n.threshold.x+=n.velocity.x*r,n.threshold.y+=n.velocity.y*r;var i=n.threshold.x<0?Math.ceil(n.threshold.x):Math.floor(n.threshold.x),s=n.threshold.y<0?Math.ceil(n.threshold.y):Math.floor(n.threshold.y);if(0===i&&0===s)return Sc(t,n),!0;0!==i&&(n.threshold.x=n.threshold.x%1),0!==s&&(n.threshold.y=n.threshold.y%1);var o={x:n.x+i,y:n.y+s},a=K.iterateToAndGetLastPosFulfillingCondition(n,o,(function(n,r,i,s){var o=Math.floor(n/e.cellSize),a=Math.floor(r/e.cellSize);if(e.useMultithreading){var l=t.shared.obstacleImageData,u=4*(o+a*l.width);return 0===l.data[u+3]}return!Ld(kd(t.store,n,r))})),l=a.x,u=a.y,c=-60*Math.log(.9);return n.velocity.y>60&&(n.velocity.y*=1-c*r),n.velocity.x*=1-c*r,l===n.x&&u===n.y?(n.velocity.x=0,n.velocity.y=0,Sc(t,n),!0):(n.x=l,n.y=u,Sc(t,n),!0)}(t,r,n)}))}(r,o),function(e,t){e.store.drones.forEach((function(n){return Rl(e,n,t)}))}(r,o),function(e,t){e.store.worldItems.forEach((function(e){return function(e,t,n){t.type===F.Artifact&&(t.data.hoverData||(t.data.hoverData={hoverOffset:0,baseY:t.y}),t.data.hoverData.hoverOffset+=2*n,t.y=t.data.hoverData.baseY+5*Math.sin(t.data.hoverData.hoverOffset))}(0,e,t)}))}(r,o),r.store.scene.active!==x.MainMenu&&function(t,n){if(function(t,n){var r,i,s;if(!t.store.player.grapplingHook||!t.store.player.grapplingHook.eyelet){var o=t.session.action.state[u.Active]?1:(null===(s=null===(i=null===(r=t.store.upgrades)||void 0===r?void 0:r.jetpack)||void 0===i?void 0:i.speed)||void 0===s?void 0:s.level)||1,a=120+30*(o-1);if(t.session.input.action.boost){if(qu(t,t.store.player)){var l=1+.3*(o-1),c="up"===t.session.input.action.boost?-1:1,h=c*(60+30*(o-1));if(t.store.player.velocity.y+=.2*c*l*60*60*n,Lu(t.store,t.store.player.cooldowns.boostParticle)){if(-1===c){var d={x:.3*(1.5-(f=K.getRandomIntBetween(0,3)))*60,y:180};Fc(t,t.store.player.x+f*e.cellSize,t.store.player.y+7*e.cellSize,d,{background:!0})}else Lp(t);var f;t.store.scene.active===x.Intro&&(d={x:.6*(1.5-(f=K.getRandomIntBetween(-8,11)))*60,y:480},Fc(t,t.store.player.x+f*e.cellSize,t.store.player.y+7*e.cellSize,d,{background:!0,lifetime:K.getRandomFloatBetween(3.5,5)}))}(-1===c&&t.store.player.velocity.y<60||1===c&&t.store.player.velocity.y>-60)&&(t.store.player.velocity.y=h)}}else t.session.input.action.jump?Np(t)&&(t.store.player.velocity.y=-120):t.store.player.isHovering&&qu(t,t.store.player)&&(t.store.player.velocity.y=0,Lu(t.store,t.store.player.cooldowns.hoverParticle)&&Lp(t));if(t.session.input.action.move.order.length>0){var p=t.session.input.action.move.order[t.session.input.action.move.order.length-1];switch(p){case"left":t.store.player.velocity.x=-a;break;case"right":t.store.player.velocity.x=a}"left"!==p&&"right"!==p&&t.store.player.velocity.x<=a&&t.store.player.velocity.x>=-a&&(t.store.player.velocity.x=0)}else t.store.player.velocity.x<=a&&t.store.player.velocity.x>=-a&&(t.store.player.velocity.x=0)}}(t,n),function(e){if(e.store.player.grapplingHook&&e.store.player.grapplingHook.eyelet){var t=e.store.player,n=K.getGunArmAxis(t),r=e.store.player.grapplingHook.eyelet,i=K.getDistance(n,r),s=K.getAngle(n,r),o=K.getVelocityFromAngle(s),a=Math.min(100,i)/200*60;t.velocity.x+=o.x*a,t.velocity.y+=o.y*a}}(t),function(t,n){var r=t.store.player,i=r.x+r.velocity.x*n,s=r.y+r.velocity.y*n;if(0!=r.velocity.x){var o=Math.floor(i/Fp),a=Math.ceil((i+r.width)/Fp),l=Math.floor(r.y/Fp),u=Math.ceil((r.y+r.height)/Fp);if(r.velocity.x<0){for(var c=l;c<=u;c++)for(var h=o-1;h<=a;h++)if(Ip(t,h,c)){var d={x:h*Fp,y:c*Fp,width:Fp,height:Fp};if(Dp(Rp(Rp({},r),{x:i}),d)){i=d.x+d.width,r.velocity.x=0;break}}}else if(r.velocity.x>0)for(c=l;c<=u;c++)for(h=o;h<=a+1;h++)if(Ip(t,h,c)&&(d={x:h*Fp,y:c*Fp,width:Fp,height:Fp},Dp(Rp(Rp({},r),{x:i}),d))){i=d.x-r.width,r.velocity.x=0;break}}if(r.x=i,0!=r.velocity.y)if(o=Math.floor(r.x/Fp),a=Math.ceil((r.x+r.width)/Fp),l=Math.floor(s/Fp),u=Math.ceil((s+r.height)/Fp),r.velocity.y>0){for(c=l;c<=u+1;c++)for(h=o;h<=a;h++)if(Ip(t,h,c)&&(d={x:h*Fp,y:c*Fp,width:Fp,height:Fp},Dp(Rp(Rp({},r),{y:s}),d))){s=d.y-r.height,r.velocity.y=0;break}}else if(r.velocity.y<0)for(c=l-1;c<=u;c++)for(h=o;h<=a;h++)if(Ip(t,h,c)&&(d={x:h*Fp,y:c*Fp,width:Fp,height:Fp},Dp(Rp(Rp({},r),{y:s}),d))){s=d.y+d.height,r.velocity.y=0;break}r.y=s,t.shared.playerPos[0]=r.x,t.shared.playerPos[1]=r.y,r.isHovering&&qu(t,t.store.player)||(r.velocity.y+=2*e.gravity*n)}(t,n),function(t){var n=t.store.player,r=Math.floor((n.x+n.width/2)/e.cellSize),i=Math.floor((n.y+n.height/2-2)/e.cellSize);t.session.mainSensorCache.get(r,i)&&(t.store.progression.dungeons[I.Boss1].done||(console.log("sensor triggered"),t.store.progression.dungeons[I.Boss1].done=!0))}(t),function(t){var n=t.store.player,r={x:n.x,y:n.y,width:n.width,height:n.height};t.store.worldItems.forEach((function(n){var i={x:n.x-8,y:n.y-8,width:16,height:16};if(Dp(r,i)&&n.type===F.Artifact){t.store.resources.artifacts++,Au(t,!0),2===t.store.resources.artifacts&&(t.session.windows.playtestFinished.open=!0,Cl(t,k.Root)),function(e,t){Bl(e,"worldItems",t.id),function(e,t){e.store.worldItems=e.store.worldItems.filter((function(e){return e.id!==t.id}))}(e,t)}(t,n);for(var s=[3721923,7878858,0],o=0;o<40;o++){var a=Math.random()*Math.PI*2,l=K.getRandomFloatBetween(1e3,3e3),u={x:Math.cos(a)*l,y:Math.sin(a)*l};Fc(t,n.x,n.y,u,{color:s[o%3],size:K.getRandomFloatBetween(1,2),lifetime:K.getRandomFloatBetween(1,2)})}for(o=0;o<10;o++)a=Math.random()*Math.PI*2,l=K.getRandomFloatBetween(5,10),u={x:Math.cos(a)*l,y:Math.sin(a)*l},Fc(t,n.x,n.y,u,{color:s[o%3],size:K.getRandomFloatBetween(1,2),lifetime:K.getRandomFloatBetween(5,10)});console.log("removing light at",n.data.sensor.position.x*e.cellSize,n.data.sensor.position.y*e.cellSize),Hh(t,n.data.sensor.position.x*e.cellSize,n.data.sensor.position.y*e.cellSize),Hl(t.session.soundEngine,"artifact_shimmer"),Hl(t.session.soundEngine,"sine"),Al(t,"Artifact acquired: ".concat(n.data.name))}}))}(t),function(e){var t=e.store.player.weaponsMeta.rocketLauncher.ammo;if(!(t.current>=ac(e))){var n=e.store.meta.time,r=n-t.reload.last,i=function(e){return Vu(5e3,e.store.upgrades.rocketLauncher.reload.level,"rocketLauncher")}(e);r>=i&&(t.current++,t.reload.last=n,Cl(e,k.Hotbar),e.session.windows.inventory.open&&Cl(e,k.Management))}}(t),t.session.soundEngine.sfx.boost.source)if(t.session.soundEngine.sfx.boost.filter){var r=Date.now()-t.session.soundEngine.sfx.boost.start,i=Math.min(2e3,Math.max(100,2*r-t.store.player.velocity.y/60*100));t.session.soundEngine.sfx.boost.filter.frequency.value=i,t.session.soundEngine.sfx.boost_overlay.filter.frequency.value=i}else console.log("no filter")}(r,o),zp(r),function(e){e.session.lights=e.session.lights.map((function(t){if(null===t)return null;if(-1===t.duration)return t;if(iu(e,t)===t.duration-1){var n=nu(e,t.x,t.y);return e.session.lightZones[n.yIndex][n.xIndex]=null,null}return t}))}(r),function(e){if(e.store.tutorial.active&&e.store.scene.active===x.Game){if(e.store.tutorial.transitioningToNextStep&&e.store.meta.time>=e.store.tutorial.transitioningToNextStep+1500)return e.store.tutorial.transitioningToNextStep=!1,e.store.tutorial.currentStep++,e.environment.multithreading.simulation.postAll(e,[f.SetTutorialStep,e.store.tutorial.currentStep]),e.store.tutorial.currentStep===b.Hotbar&&Cl(e,k.Hotbar),e.store.tutorial.currentStep===b.OpenTechTree&&Cl(e,k.Resources),e.store.tutorial.currentStep===b.BuildShaker&&Cl(e,k.ShortcutHelper),e.store.tutorial.currentStep===b.TutorialEnd?(Al(e,"You've completed the tutorial!",{duration:1e4}),e.store.tutorial.active=!1,e.store.tutorial.data={},Cu(e),Cl(e,k.Tutorial),void Cl(e,k.Objectives)):(e.store.tutorial.data=ju(e.store.tutorial.currentStep),void Cl(e,k.Tutorial));switch(e.store.tutorial.currentStep){case b.Move:if(e.store.tutorial.transitioningToNextStep)break;e.session.input.action.boost&&(e.store.tutorial.data.up=!0),0!==e.store.player.velocity.x&&(e.store.tutorial.data.sides=!0),e.session.input.action.boost&&e.store.tutorial.data.sides&&Ou(e)}}}(r),function(t,n){var r=t.session.rendering,i={x:t.session.camera.x+Math.floor(t.session.rendering.canvas.width/2)-t.store.player.width/2,y:t.session.camera.y+Math.floor(t.session.rendering.canvas.height/2)-t.store.player.height/2};t.session.rendering.fog.lastPosition||(t.session.rendering.fog.lastPosition=lm({},i),t.session.rendering.fog.lastPosition.y+=2);var s=t.session.rendering.fog.lastPosition,o=Math.abs(i.y-s.y)>1,a=t.store.world.horizon[Math.floor(i.x/e.cellSize)];void 0===a&&(a=0);var l,u=a*e.cellSize,c=e.debug.overrideLightSize?e.debug.lightSize:(l=i.y)<=3400?700:l>=4200?200:700-(l-3400)/800*500,h=e.debug.overrideTerrainShadow?e.debug.terrainShadowValue:function(e){var t=.9949;return e<=3800?t:e>=4200?.95:t-(e-3800)/400*(t-.95)}(i.y);switch(r.pixi.filter.uniforms.uTerrainShadowValue=h,t.session.rendering.fog.state){case E.Above:r.pixi.filter.uniforms.lightSize=0,r.pixi.fogSprite.visible=r.pixi.filter.uniforms.uDrawUndergroundFog=!0;var d=t.store.meta.time-t.session.rendering.fog.cooldown.last;i.y>u-16&&d>2e3&&o&&(t.session.rendering.fog.state=E.TransitioningBelow,t.session.rendering.fog.cooldown.last=t.store.meta.time,t.session.rendering.fog.lastPosition=lm({},i));break;case E.TransitioningBelow:var f=(t.store.meta.time-t.session.rendering.fog.cooldown.last)/50;r.pixi.filter.uniforms.lightSize=c+c*(1-f),r.pixi.filter.uniforms.minLightAmount=1-f,r.pixi.outlineElementsFilter.uniforms.minLightAmount=1-f,r.pixi.fogSprite.visible=r.pixi.filter.uniforms.uDrawUndergroundFog=!0,f>=1&&(t.session.rendering.fog.state=E.Below);break;case E.Below:r.pixi.filter.uniforms.lightSize=c,r.pixi.filter.uniforms.minLightAmount=0,r.pixi.outlineElementsFilter.uniforms.minLightAmount=0,r.pixi.fogSprite.visible=r.pixi.filter.uniforms.uDrawUndergroundFog=!1,d=t.store.meta.time-t.session.rendering.fog.cooldown.last,i.y<u&&d>2e3&&o&&(t.session.rendering.fog.state=E.TransitioningAbove,t.session.rendering.fog.cooldown.last=t.store.meta.time,t.session.rendering.fog.lastPosition=lm({},i));break;case E.TransitioningAbove:f=(t.store.meta.time-t.session.rendering.fog.cooldown.last)/500,r.pixi.filter.uniforms.lightSize=c+c*f,r.pixi.filter.uniforms.minLightAmount=f,r.pixi.outlineElementsFilter.uniforms.minLightAmount=f,r.pixi.fogSprite.visible=r.pixi.filter.uniforms.uDrawUndergroundFog=!0,f>=1&&(t.session.rendering.fog.state=E.Above)}r.pixi.filter.uniforms.time+=.6*n,r.pixi.outlineElementsFilter.uniforms.time+=.6*n,r.pixi.skyFilter.uniforms.uTime+=1.2*n}(r,o),function(e){e.session.ui.tooltip.activeTick&&e.session.ui.tooltip.activeTick!==e.store.meta.tick&&(e.session.ui.tooltip.activeTick=!1,e.session.ui.tooltip.data=null,Cl(e,k.Tooltip))}(r),r.store.meta.tick++,[2]}}))}))},VT=Wf.createFpsMeter("all"),HT=1e3/60,WT=HT-1,XT=0,$T=function(e,t){return jT(void 0,void 0,void 0,(function(){var n,r,i;return UT(this,(function(s){switch(s.label){case 0:if(e.session.settings.capFrameRate){if(n=performance.now(),(r=n-XT)<WT)return requestAnimationFrame((function(t){return $T(e,t)})),[2];XT=n-r%HT}return e.session.settings.showFps&&VT(),e.session.saving?[4,lp(e)]:[3,2];case 1:s.sent(),s.label=2;case 2:return!e.session.tabActive||e.session.paused?(e.session.timestep.lastTime=t,e.session.paused&&zp(e),requestAnimationFrame((function(t){return $T(e,t)})),[2]):((i=t-e.session.timestep.lastTime)>20&&(i=20),e.session.timestep.lastTime=t,e.store.meta.time+=i,[4,GT(e,i)]);case 3:return s.sent(),function(e){var t=Jd(e);if(e.session.lerpCamera){var n=e.session.lerpCamera.time,r=e.session.lerpCamera.duration,i=e.session.lerpCamera.start.x,s=e.session.lerpCamera.start.y,o=Date.now()-n,a=Math.min(o/r,1);a=a<.5?4*a*a*a:1-Math.pow(-2*a+2,3)/2,e.session.camera.x=Math.round(i+(t.x-i)*a),e.session.camera.y=Math.round(s+(t.y-s)*a)}else e.session.camera.x=t.x,e.session.camera.y=t.y}(e),Ef(e),function(e){switch(e.store.scene.active){case x.Intro:if(om=!0,!e.store.scene.triggers[0].done&&e.store.meta.time>=e.store.scene.start+1726&&(e.store.scene.triggers[0].done=!0,Hl(e.session.soundEngine,"boost"),Hl(e.session.soundEngine,"boost_overlay"),e.session.input.action.boost="up"),!e.store.scene.triggers[1].done&&e.store.meta.time>=e.store.scene.start+5e3&&(e.store.scene.triggers[1].done=!0,Wl(e.session.soundEngine,"boost"),Wl(e.session.soundEngine,"boost_overlay"),e.session.input.action.boost=!1),!e.store.scene.triggers[2].done&&e.store.meta.time>=e.store.scene.start+5146){e.store.scene.triggers[2].done=!0,e.store.scene.active=x.Game,Hl(e.session.soundEngine,"cocking");var t=gf(e);zl(e,t),setTimeout((function(){Cl(e,k.Tutorial)}),1e3)}break;case x.Game:om||(t=gf(e),zl(e,t),om=!0)}}(e),function(e){for(var t=e.session.soundEngine,n=0;n<Oh.length;n++){var r=Oh[n],i=e.session.ambience[r.name].distance;if(i>Bh)for(var s=0;s<r.sounds.length;s++){var o=r.sounds[s].id;(a=t.sfx[o]).source&&Wl(t,o)}else for(s=0;s<r.sounds.length;s++){var a,l=r.sounds[s];o=l.id,(a=t.sfx[o]).source||Hl(t,o);var u=Math.pow(1-i/Bh,4);a.gainNode.gain.setValueAtTime(u*l.volMod*t.globalVolume,t.audioContext.currentTime);var c=0;e.session.ambience[r.name].xDistance.left===1/0?c=e.session.ambience[r.name].xDistance.right:e.session.ambience[r.name].xDistance.right===1/0&&(c=-e.session.ambience[r.name].xDistance.left),a.panner.pan.setValueAtTime(c/Bh,t.audioContext.currentTime)}}!function(e){var t=e.session.soundEngine;if(null==t?void 0:t.audioContext){var n=Date.now(),r=e.shared.naturalAmbience[0],i=e.shared.naturalAmbience[1];r<=ah?((null==(s=t.sfx.fire_ambience)?void 0:s.source)||(Hl(t,"fire_ambience"),s=t.sfx.fire_ambience),(null==s?void 0:s.gainNode)&&(s.gainNode.gain.value=.03*(1-r/ah)),(null==s?void 0:s.panner)&&(s.panner.pan.value=i),lh={time:n,distance:r,pan:i}):n-lh.time>3e3&&Wl(t,"fire_ambience");var s,o=e.shared.naturalAmbience[2],a=e.shared.naturalAmbience[3];o<=ah?((null==(s=t.sfx.water_ambience)?void 0:s.source)||(Hl(t,"water_ambience"),s=t.sfx.water_ambience),(null==s?void 0:s.gainNode)&&(s.gainNode.gain.value=.1*(1-o/ah)),(null==s?void 0:s.panner)&&(s.panner.pan.value=a),uh={time:n,distance:o,pan:a}):n-uh.time>500&&Wl(t,"water_ambience"),e.shared.naturalAmbience[0]=1/0,e.shared.naturalAmbience[1]=0,e.shared.naturalAmbience[2]=1/0,e.shared.naturalAmbience[3]=0}}(e),e.session.ambience=jh()}(e),requestAnimationFrame((function(t){return $T(e,t)})),[2]}}))}))};jT(void 0,void 0,void 0,(function(){var t,n,r,i,s,o,a,l,u,c;return UT(this,(function(h){switch(h.label){case 0:return document.fonts.load("1em Play").then((function(){document.getElementById("loading").style.visibility=""})),t=new URLSearchParams(window.location.search),(n=["new_game","load","db_load","file_load"].some((function(e){return t.has(e)})))||(document.getElementById("splash-screen").style.cssText="display: block; opacity: 0; transition: opacity 0.5s ease-in;",document.getElementById("splash-screen").offsetHeight,document.getElementById("splash-screen").style.opacity="1"),document.getElementById("loading-step").innerText="🖼️ Images.",[4,Xp(void 0,void 0,void 0,(function(){var e;return $p(this,(function(t){switch(t.label){case 0:return e={},[4,Promise.all([Yp("player"),Yp("player_arm_horisontal"),Yp("player_arm_vertical"),Yp("weapon"),Yp("gun"),Yp("builder"),Yp("conveyor_right"),Yp("conveyor_left"),Yp("launcher"),Yp("launcher_left"),Yp("launcher_right"),Yp("shaker_left"),Yp("shaker_right"),Yp("soil_backdrop_test",{withImageData:!0}),Yp("menu_blueprint",{withImageData:!0}),Yp("map_blueprint",{withImageData:!0,fileName:"map_blueprint_playtest"}),Yp("lights_blueprint",{withImageData:!0,fileName:"map_blueprint_playtest_lights"}),Yp("sensors_blueprint",{withImageData:!0,fileName:"map_blueprint_playtest_sensors"}),Yp("authorization_blueprint",{withImageData:!0,fileName:"map_blueprint_playtest_authorization"}),Yp("mountains_tiling_4x"),Yp("explosion_11x11"),Yp("explosion_44x44"),Yp("build_flash"),Yp("build_flash2"),Yp("build_flash3"),Yp("build_flash4"),Yp("muzzle_flash"),Yp("splitter_left"),Yp("splitter_right"),Yp("characters_with_shadow_4x"),Yp("block"),Yp("triangle_right"),Yp("triangle_right_del"),Yp("triangle_left"),Yp("triangle_left_del"),Yp("button"),Yp("button2"),Yp("button3"),Yp("no_jetpack_backdrop",{withImageData:!0}),Yp("backdrop_variant",{withImageData:!0}),Yp("build_button"),Yp("x"),Yp("copy"),Yp("sell"),Yp("filter_left"),Yp("filter_right"),Yp("bullet"),Yp("rocket"),Yp("velocity"),Yp("farm"),Yp("sound_box"),Yp("sound_box_flash"),Yp("shovel"),Yp("grabber_icon"),Yp("gun_icon"),Yp("fume_particle"),Yp("fog",{withImageData:!0,fileName:"fog_playtest"}),Yp("default_icon"),Yp("pipes"),Yp("pump"),Yp("liquid_vent"),Yp("light"),Yp("bouncer"),Yp("hauler"),Yp("hauler_closed"),Yp("gloom_emitter"),Yp("artifact"),Yp("trees_tiling_4x"),Yp("rocket_launcher"),Yp("flamethrower_icon")])];case 1:return[2,(e.images=t.sent().reduce((function(e,t){return e[t.name]=t.imageAsset,e}),{}),e)]}}))}))];case 1:return r=h.sent(),n?(s=x.Intro,i={terrain:r.images.map_blueprint,lights:r.images.lights_blueprint,sensors:r.images.sensors_blueprint,authorization:r.images.authorization_blueprint}):(s=x.MainMenu,i={terrain:r.images.menu_blueprint}),document.getElementById("loading-step").innerText="🔊 Sounds.",[4,rm(void 0,void 0,void 0,(function(){var e,t,n,r,i,s;return im(this,(function(o){switch(o.label){case 0:e=new window.AudioContext,t=[["boost",{fileName:"512815__mostyxs__good-jetpack-sound-loop.wav",loop:!0,filters:[{type:"notch"}],volume:.1}],["boost_overlay",{fileName:"thrusterFire_000.ogg",loop:!0,playbackRate:2,filters:[{type:"notch"}],volume:.2}],["gun",{fileName:"laserSmall_003.ogg",filters:[{type:"notch"}],playbackRate:.5,volume:.4,fadeOut:.7}],["gun_overlay",{fileName:"explosionCrunch_004.ogg",playbackRate:8,filters:[{type:"notch"}],volume:.4}],["explosion",{fileName:"explosionCrunch_000.ogg",filters:[{type:"notch"}],volume:.75,fadeOut:.5}],["explosion_overlay",{fileName:"lowFrequency_explosion_001.ogg",filters:[{type:"notch"}]}],["explosion2",{fileName:"explosion01.wav",filters:[{type:"notch"}]}],["cocking",{fileName:"543927__eminyildirim__pistol-gun-cocking.wav",filters:[{type:"notch"}],volume:.2}],["dig",{fileName:"560957__bricklover__shovel-sandgravelsnow.mp3",filters:[{type:"notch"}],offset:.4}],["dig_overlay",{fileName:"560957__bricklover__shovel-sandgravelsnow.mp3",filters:[{type:"notch"}],volume:.5,offset:.35}],["dig_2",{fileName:"651292__f3bbbo__digging-in-wet-course-sand-1.wav",filters:[{type:"notch"}],volume:.1}],["machinery",{fileName:"519027__kinoton__industrial-conveyor-belt.mp3",loop:!0,filters:[{type:"notch"}],pan:0}],["machinery_ambience",{fileName:"540221__sheyvan__ambience-machinery.mp3",loop:!0,filters:[{type:"notch"}],pan:0}],["machinery_rhythm",{fileName:"564844__ravenwolfprods__happy-machinery-loop.mp3",loop:!0,filters:[{type:"notch"}],playbackRate:.9,pan:0}],["machinery_rhythm_2",{fileName:"435732__scivirus__welding-conveyor-4-loops-05.mp3",loop:!0,filters:[{type:"notch"}],pan:0}],["machinery_rhythm_2_b",{fileName:"435732__scivirus__welding-conveyor-4-loops-05.mp3",loop:!0,filters:[{type:"notch"}],playbackRate:8,pan:0}],["shake",{fileName:"swing2.wav",filters:[{type:"notch"}]}],["beads",{fileName:"beads.wav",filters:[{type:"notch"}]}],["build",{fileName:"Accepting Perc.wav",filters:[{type:"notch"}],fadeOut:.15}],["build_start",{fileName:"Update Message.wav",filters:[{type:"notch"}]}],["build_start2",{fileName:"Inventory Diamonds A.wav",filters:[{type:"notch"}]}],["build4",{fileName:"fruit3.wav",filters:[{type:"notch"}]}],["flamethrower",{fileName:"244230__syntaxseed__gas-torch-burn.ogg",loop:!0,filters:[{type:"notch"}],volume:.08}],["flamethrower_overlay",{fileName:"thrusterFire_000.ogg",loop:!0,playbackRate:1.95,filters:[{type:"notch"}],volume:.3}],["flamethrower2",{fileName:"459884__matrixxx__flamethrower-shot.wav",playbackRate:.5,filters:[{type:"notch"}],volume:.08}],["research",{fileName:"Accepting Key.wav",filters:[{type:"notch"}],volume:.4}],["click",{fileName:"fruit3.wav",filters:[{type:"notch"}],volume:.4,playbackRate:8}],["freeze",{fileName:"685253__antonsoederberg__freeze-sound-effect-fx.mp3",filters:[{type:"notch"}],volume:.4,offset:2}],["pistol",{fileName:"pistol2_mono.wav",filters:[{type:"notch"}]}],["blip",{fileName:"bong_001.ogg",filters:[{type:"notch",frequency:500}],volume:.1,playbackRate:3}],["fluxite",{fileName:"bong_001.ogg",filters:[{type:"notch"}],volume:.5,playbackRate:2}],["fluxite_2",{fileName:"Click Glass Wet.wav",filters:[{type:"notch"}]}],["fluxite_3",{fileName:"Accepting Perc.wav",filters:[{type:"notch"}]}],["humming",{fileName:"746461__thesounderguy__computer_fan_humming.ogg",loop:!0,filters:[{type:"notch"}],volume:.3,playbackRate:.5}],["ammo_empty",{fileName:"192277__lebaston100__click.mp3",filters:[{type:"notch"}]}],["rocket_explosion",{fileName:"Rocket Explosion C.wav",filters:[{type:"notch"}]}],["rocket_launch",{fileName:"Missile Launch C.wav",filters:[{type:"notch"}]}],["jet",{fileName:"Spaceship Jet-Like.wav",filters:[{type:"notch"}]}],["fire_ambience",{fileName:"47835__tc630__fire2.ogg",filters:[{type:"notch"}],loop:!0,pan:0}],["water_ambience",{fileName:"648883__klankbeeld__head-out-of-water-220903.mp3",filters:[{type:"notch"}],loop:!0,pan:0}],["splash",{fileName:"112152__plingativator__icesplashes1.mp3",filters:[{type:"notch"}]}],["splash_2",{fileName:"398038__swordofkings128__water-splash-1.mp3",filters:[{type:"notch"}]}],["coin",{fileName:"699534__valenspire__coin_misc_05.wav",filters:[{type:"notch"}]}],["collect",{fileName:"Inventory Diamonds C.wav",filters:[{type:"notch"}],pan:0}],["open",{fileName:"Scroll Wood Single.wav",filters:[{type:"notch"}]}],["vaporize",{fileName:"491706__hidrolion__04-vapor.wav",filters:[{type:"notch"}]}],["artifact_shimmer",{fileName:"Shimmer Scary_short_edit.ogg",filters:[{type:"notch"}],volume:.3}],["sine",{fileName:"Update Sine.wav",filters:[{type:"notch"}]}]],n={audioContext:e,sfx:{},gate:{dig:!1},globalVolume:1},r=3,i=0,o.label=1;case 1:return i<t.length?(s=t.slice(i,i+r),[4,Promise.all(s.map((function(t){var n=t[0],r=t[1];return function(e,t,n){return void 0===n&&(n={}),rm(void 0,void 0,void 0,(function(){var r,i;return im(this,(function(s){switch(s.label){case 0:return[4,sm(e,"sfx/".concat(null!==(i=n.fileName)&&void 0!==i?i:t+".wav"))];case 1:return r=s.sent(),[2,{name:t,buffer:r,opts:n}]}}))}))}(e,n,r)})))]):[3,4];case 2:o.sent().forEach((function(e){n.sfx[e.name]={buffer:e.buffer,sound:e.sound,opts:e.opts}})),o.label=3;case 3:return i+=r,[3,1];case 4:return[2,n]}}))}))];case 2:return o=h.sent(),document.getElementById("loading-step").innerText="🛠️ Setting stuff up.",np()?[3,4]:[4,new Promise((function(e,t){var n=window.indexedDB.open("SandustryDatabase",1);n.onupgradeneeded=function(){console.log("Upgrading DB..."),n.result.createObjectStore("SandustryObjectStore",{keyPath:"id"})},n.onsuccess=function(){e()},n.onerror=function(e){console.error("Error initializing database:",e),t(new Error("Failed to initialize database"))}}))];case 3:h.sent(),h.label=4;case 4:return h.trys.push([4,6,,7]),[4,OT(i,s)];case 5:return a=h.sent(),[3,7];case 6:return l=h.sent(),console.error("Error getting store:",l),(u=document.getElementById("loading-step")).innerText="❌ Error: ".concat(l.message),(c=document.createElement("button")).innerText="Try anyway",c.style.marginTop="10px",c.style.border="1px solid #ccc",c.style.padding="5px 10px",c.onclick=function(){var e=new URL(window.location.href);e.searchParams.set("skip_version_check","true"),window.location.href=e.toString()},u.appendChild(document.createElement("br")),u.appendChild(c),[2];case 7:return document.getElementById("loading-step").innerText="🚀 Starting.",function(t,n,r,i){jT(void 0,void 0,void 0,(function(){var s,o,a,l,u,c,h,f,m,g,v;return UT(this,(function(b){switch(b.label){case 0:if(s={store:t,session:n},o=i.terrain,oe.init(t,n,!0),t.world.sensors.forEach((function(e){n.mainSensorCache.set(e.x,e.y,e.type)})),!e.useMultithreading)for(l=0;l<t.world.matrix.length;l++)for(u=0;u<t.world.matrix[l].length;u++)c=t.world.matrix[l][u],xu(s,u,l,c);return function(e){e.store.drones.forEach((function(t){var n=t.type===D.Hauler&&t.data.inventory.amount>0?"haulerClosed":"hauler";Ll(e,"drones",n,t.id,t.x,t.y)}))}(s),e.debug.active&&Wf.setup(s),e.useMultithreading?(s.environment={context:p.Main,multithreading:nm()},s.session.monitor.threads=s.environment.multithreading.simulation.threads.map((function(e){return{updateTime:0,updateStarted:0,loadDisplay:document.createElement("div")}})),[4,s.environment.multithreading.simulation.init(s)]):[3,2];case 1:for(b.sent(),l=0;l<t.world.matrix.length;l++)for(u=0;u<t.world.matrix[l].length;u++)c=t.world.matrix[l][u],h=u+l*s.shared.mapData.width,s.shared.mapData.data[h]=_u(s,c,u,l,!0),(a=!!i.authorization&&i.authorization.imageData)&&Xu(s,a,u,l);for(l=0;l<t.world.matrix.length;l++)for(u=0;u<t.world.matrix[l].length;u++)c=t.world.matrix[l][u],h=u+l*s.shared.mapData.width,s.shared.mapData.data[h]=_u(s,c,u,l);f=zT(s,o,r),m=f.wallRGBALookupTexture,f.authorizationByColorIndex,n.rendering.pixi.outlineElementsFilter.uniforms.uWallRGBALookupTexture=m,b.label=2;case 2:return function(e){for(var t=0,n=Object.entries(e.session.settings.keyBindings);t<n.length;t++){var r=n[t],i=(r[0],r[1]);e.session.input.keys[i]=y.Up}}(s),g=n.settings.sound.sfxVolume/Gl,Xl(s,g,!0),t.scene.active!==x.Game&&function(t){t.store.world.fixtures.forEach((function(n){if("255, 0, 0"===n.name)if(t.store.scene.active===x.MainMenu)for(var r=d.Foundation,i=d.FoundationAngledLeft,s=d.FoundationAngledRight,o=d.FoundationTriangleLeftDel,a=d.FoundationTriangleRightDel,l=d.ConveyorLeft,u=d.ConveyorRight,c=d.LauncherLeft,h=d.LauncherRight,f=d.LauncherUp,p=(d.Collector,[[r,r,r,r,0,u,u,u,u,0,u,0,0,r,0,l,l,l,s,0,c,0,0,h,0,r,r,r,r,0,u,u,u,u,u,0,l,l,l,s,0,u,0,0,0,l],[r,0,0,r,0,r,0,0,r,0,r,0,0,r,0,r,0,0,r,0,f,0,0,f,0,r,0,0,r,0,0,0,f,0,0,0,r,0,0,r,0,r,0,0,0,r],[r,0,0,0,0,r,0,0,r,0,r,s,0,r,0,r,0,0,r,0,f,0,0,f,0,r,0,0,0,0,0,0,f,0,0,0,r,0,0,r,0,o,s,0,i,a],[r,r,r,r,0,r,r,r,r,0,r,o,s,o,0,r,0,0,r,0,f,0,0,f,0,r,r,r,r,0,0,0,f,0,0,0,r,r,r,a,0,0,o,r,a,0],[0,0,0,r,0,r,0,0,r,0,r,0,o,s,0,r,0,0,r,0,f,0,0,f,0,0,0,0,r,0,0,0,f,0,0,0,r,0,o,s,0,0,0,r,0,0],[r,0,0,r,0,r,0,0,r,0,r,0,0,r,0,r,0,0,r,0,f,0,0,f,0,r,0,0,r,0,0,0,f,0,0,0,r,0,0,r,0,0,0,r,0,0],[r,r,r,r,0,r,0,0,r,0,r,0,0,r,0,r,r,r,a,0,l,l,l,l,0,r,r,r,r,0,0,0,f,0,0,0,r,0,0,r,0,0,0,r,0,0]]),m=0;m<p.length;m++)for(var g=0;g<p[m].length;g++)0!==(y=p[m][g])&&hd(t,{x:n.x+g*e.snapGridCellSize,y:n.y+m*e.snapGridCellSize},{structureType:y});else for(p=[[r=d.Foundation,0,0,0,r],[r,i=d.Collector,i,i,r],[r,i,i,i,r],[r,i,i,i,r],[r,r,r,r,r]],m=0;m<p.length;m++)for(g=0;g<p[m].length;g++){var y;0!==(y=p[m][g])&&hd(t,{x:n.x+g*e.snapGridCellSize,y:n.y+m*e.snapGridCellSize},{structureType:y})}}))}(s),s.session.settings.disableBackgroundShader&&s.session.rendering.pixi.toggleSkyFilter(!1),s.session.settings.showFps&&(v=document.getElementById("fps"))&&(v.style.display="block"),s.session.music.ambient.engine.play(),t.scene.active!==x.MainMenu&&setTimeout((function(){s.session.music.engine.play()}),6e3),s.store.objectives.active=s.store.objectives.active.filter((function(e){return!e.completed})),["canvas","background-canvas","foreground-canvas","overlay-canvas"].forEach((function(e){var t=document.getElementById(e);t.style.display="block",t.style.opacity="0",t.style.transition="opacity 0.5s ease-in",t.offsetHeight,t.style.opacity="1"})),requestAnimationFrame((function(e){s.session.timestep.lastTime=e,$T(s,e)})),document.getElementById("loading").style.visibility="hidden",function(e){(0,cm.H)(document.getElementById("ui")).render((0,um.jsx)(wT,{state:e}))}(s),s.environment.multithreading.simulation.startManager(s),[2]}}))}))}(a,Pp(a,i,r,o),r,i),[2]}}))}))})()})();